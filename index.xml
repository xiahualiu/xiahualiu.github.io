<?xml version="1.0" encoding="utf-8" ?>
<?xml-stylesheet type="text/xsl" href="https://xiahualiu.github.io/xml/base.min.xml" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Xiahua</title>
    <link>https://xiahualiu.github.io/</link>
    <description>Recent content on Xiahua</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Thu, 30 Jan 2020 20:17:54 -0500</lastBuildDate>
    <atom:link href="https://xiahualiu.github.io/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Matrix Calculus</title>
      <link>https://xiahualiu.github.io/posts/2020-01-30-matrix-multiplication/</link>
      <pubDate>Thu, 30 Jan 2020 20:17:54 -0500</pubDate>
      <guid>https://xiahualiu.github.io/posts/2020-01-30-matrix-multiplication/</guid>
      <description>&lt;p&gt;Matrix calculus is very important in machine learning and control theories. However there are all kinds of rules making it hard to remember and use. In this post, I summarize some basic rules and an important proof in machine learning theory, which includes the famous &amp;quot;Trace Trick&amp;quot;! This trick is super useful and super hard as well! Haha, this is the reason why we always explore new things, because it is hard!&lt;/p&gt;

&lt;h2 id=&#34;differentiation&#34;&gt;Differentiation&lt;/h2&gt;

&lt;p&gt;For the rules of matrix differentiation, all we need to remember are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Gradient&lt;/li&gt;
&lt;li&gt;The Jacobian matrix&lt;/li&gt;
&lt;li&gt;The Hessian matrix&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;* All vectors in this post refer to column vectors with dimension &lt;span  class=&#34;math&#34;&gt;\(N\)&lt;/span&gt;.&lt;/p&gt;

&lt;h3 id=&#34;getting-started&#34;&gt;Getting started&lt;/h3&gt;

&lt;p&gt;To start with the concept, we differentiate a matrix with respect to a scalar variable, the result is pretty intuitive and natural:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\dot{A}=\begin{bmatrix}
\dot{A}_{11} &amp; \cdots &amp; \dot{A}_{1n} \\
\vdots &amp; \ddots &amp; \vdots \\
\dot{A}_{n1} &amp; \cdots &amp; \dot{A}_{nn} 
\end{bmatrix}\]&lt;/span&gt;&lt;/p&gt;

&lt;h3 id=&#34;gradient&#34;&gt;Gradient&lt;/h3&gt;

&lt;p&gt;The gradient of a scalar function can be visualized as the changes in different directions.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\nabla f(\textbf{x})=\begin{bmatrix}
\frac{\partial f}{\partial x_1} \\
\frac{\partial f}{\partial x_2} \\
\vdots \\
\frac{\partial f}{\partial x_n} \\
\end{bmatrix}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;It is the most simplifed case, remember it returns a vector that&#39;s in the same shape as the input vector variable.&lt;/p&gt;

&lt;h3 id=&#34;jacobian-matrix&#34;&gt;Jacobian Matrix&lt;/h3&gt;

&lt;p&gt;Jacobian matrix is the first-order derivative of a &lt;strong&gt;vector function&lt;/strong&gt;, a vector function is a function that &lt;strong&gt;receives a vector value and returns a vector value&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Jacobian matrix is obtained from &lt;span  class=&#34;math&#34;&gt;\((\nabla \textbf{f})^{\top}\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[(\nabla \textbf{f})^{\top}=[\frac{\partial \textbf{f}}{\partial x_1} \cdots \frac{\partial \textbf{f}}{\partial x_n}]=\begin{bmatrix}
\frac{\partial f_1}{\partial x_1}  &amp; \cdots &amp; \frac{\partial f_1}{\partial x_n} \\
\vdots &amp; \ddots &amp; \vdots \\
\frac{\partial f_n}{\partial x_1} &amp; \cdots &amp; \frac{\partial f_n}{\partial x_n}
\end{bmatrix}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;We did gradient operation at first, transposed the result, then applied the simple first derivative expansion as discussed in the warm up section.&lt;/p&gt;

&lt;h2 id=&#34;hessian-matrix&#34;&gt;Hessian Matrix&lt;/h2&gt;

&lt;p&gt;Hessian matrix is the second-order partial derivatives of a &lt;strong&gt;scalar-valued&lt;/strong&gt; function. A scalar-valued function is a function that &lt;strong&gt;receives a scalar or vector and returns a scalar&lt;/strong&gt;. Here we assume it the function receives a vector.&lt;/p&gt;

&lt;p&gt;Since it is a scalar function, first we find the gradient:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\frac{\partial y}{\partial \textbf{x}}=\begin{bmatrix} \frac{\partial y}{\partial x_1} \\
\vdots \\
\frac{\partial y}{\partial x_n} \\
\end{bmatrix}=\nabla \textbf{f}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;And we need to do this one more time.A sharp eye reader may notice the second derivative is the Jacobian matrix of the gradient, which is:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\textbf{J}(\nabla \textbf{f})\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;However, &lt;strong&gt;Hessian matrix is defined with an extra tranpose operation&lt;/strong&gt;, so it is actually:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\textbf{J}(\nabla \textbf{f})^{\top}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\mathbf{H}=\left[\begin{array}{cccc}
{\frac{\partial^{2} f}{\partial x_{1}^{2}}} &amp; {\frac{\partial^{2} f}{\partial x_{1} \partial x_{2}}} &amp; {\cdots} &amp; {\frac{\partial^{2} f}{\partial x_{1} \partial x_{n}}} \\
{\frac{\partial^{2} f}{\partial x_{2} \partial x_{1}}} &amp; {\frac{\partial^{2} f}{\partial x_{2}^{2}}} &amp; {\cdots} &amp; {\frac{\partial^{2} f}{\partial x_{2} \partial x_{n}}} \\
{\vdots} &amp; {\vdots} &amp; {\ddots} &amp; {\vdots} \\
{\frac{\partial^{2} f}{\partial x_{n} \partial x_{1}}} &amp; {\frac{\partial^{2} f}{\partial x_{n} \partial x_{2}}} &amp; {\cdots} &amp; {\frac{\partial^{2} f}{\partial x_{n}^{2}}}
\end{array}\right]\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Till now I hope you can understand what Jacobian matrix and Hessian matrix are, and be able to write the steps how we get Jacobian and Hessian matrix.&lt;/p&gt;

&lt;h2 id=&#34;integral&#34;&gt;Integral&lt;/h2&gt;

&lt;p&gt;Calculating the integral of the whole matrix is as simple as the warm up part.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\int A(t) {\rm d}t=\begin{bmatrix}
\int A_{11}{\rm d}t &amp; \cdots &amp; \int A_{1n}(t){\rm d}t \\
\vdots &amp; \ddots &amp; \vdots \\
\int A_{n1}(t){\rm d}t &amp; \cdots &amp; \int A_{nn}(t){\rm d}t
\end{bmatrix}\]&lt;/span&gt;&lt;/p&gt;

&lt;h2 id=&#34;trace-trick&#34;&gt;Trace trick&lt;/h2&gt;

&lt;p&gt;In this section, we will teach you what trace trick is. As usual, we start with a simple case:&lt;/p&gt;

&lt;h3 id=&#34;derivative-of-a-quadratic-form&#34;&gt;Derivative of a quadratic form&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;If you have no idea what a quadratic form is, I suggest you stop reading downwards&lt;/strong&gt;, because you have to have a good understanding of it, otherwise you cannot realize why we want to find its derivative.&lt;/p&gt;

&lt;p&gt;I also suggest a wonderful book for that foundation, &lt;em&gt;Linear Algebra and its Applications&lt;/em&gt;, this is a must-read for all new learners.&lt;/p&gt;

&lt;p&gt;So here we begin!&lt;/p&gt;

&lt;p&gt;Define a function:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[f(\textbf{x})=\textbf{x}^{\top}\textbf{Ax}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This is a scalar function, since &lt;span  class=&#34;math&#34;&gt;\(\textbf{x}\)&lt;/span&gt; is &lt;span  class=&#34;math&#34;&gt;\(m\times 1\)&lt;/span&gt;. So the size of the output is:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[(1\times m)\times(m\times m)\times(m\times 1)=(1\times 1)\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;And we need to find its first derivative w.r.t &lt;span  class=&#34;math&#34;&gt;\(\textbf{x}\)&lt;/span&gt;. How?&lt;/p&gt;

&lt;p&gt;You may think, it is same as finding the gradient of the function, so just expand the equation and find the partial derivative.&lt;/p&gt;

&lt;p&gt;Yes, it is indeed a reasonal idea, but expanding all the terms is way to tedious and humans are fallible. Is there any other way to obtain the result without messing the matrix?&lt;/p&gt;

&lt;p&gt;Yes, there is. It is called &lt;strong&gt;&amp;quot;Trace Trick&amp;quot;&lt;/strong&gt; and is widely used in finding the derivative of quadratic form function.&lt;/p&gt;

&lt;h3 id=&#34;trace&#34;&gt;Trace&lt;/h3&gt;

&lt;p&gt;From wikipedia:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;In linear algebra, the trace of a square matrix &lt;span  class=&#34;math&#34;&gt;\(A\)&lt;/span&gt; is defined to be the sum of elements on the main diagonal of &lt;span  class=&#34;math&#34;&gt;\(A\)&lt;/span&gt;. The trace of a matrix is the sum of its eigenvalues, and it is invariant with respect to a change of basis.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;trace-laws&#34;&gt;Trace laws&lt;/h3&gt;

&lt;p&gt;Here are two most important laws:&lt;/p&gt;

&lt;h4 id=&#34;transpose-law&#34;&gt;Transpose law&lt;/h4&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\operatorname{tr}(\mathbf{A})=\operatorname{tr}\left(\mathbf{A}^{\top}\right)\]&lt;/span&gt;&lt;/p&gt;

&lt;h4 id=&#34;cyclic-permutation-law&#34;&gt;Cyclic permutation law&lt;/h4&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\operatorname{tr}(\mathbf{A B C D})=\operatorname{tr}(\mathbf{B C D A})=\operatorname{tr}(\mathbf{C D A B})=\operatorname{tr}(\mathbf{D A B C})\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;How do we apply the trace trick in our calculation? Well, from the definition of the trace, a trace of a scalar (which can be considered as a &lt;span  class=&#34;math&#34;&gt;\(1\times 1\)&lt;/span&gt; matrix) is itself, so:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\operatorname{tr}(\textbf{x}^{\top}\textbf{Ax})=\textbf{x}^{\top}\textbf{Ax}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Now it is the trick time, I will write everything here, please read the following equation, and try to understand how I get to the final line:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
{\rm d}(\textbf{x}^{\top}\textbf{Ax}) &amp;={\rm d}(\operatorname{tr}(\textbf{x}^{\top}\textbf{Ax})) \\
&amp;=\operatorname{tr}({\rm d}(\textbf{Ax}\textbf{x}^{\top})) \\
&amp;=\operatorname{tr}({\rm d}(\textbf{Ax})\textbf{x}^{\top}+{\bf Ax}{\rm d}(\textbf{x}^{\top})) \\
&amp;=\operatorname{tr}({\rm d}(\textbf{Ax})\textbf{x}^{\top})+\operatorname{tr}({\bf Ax}{\rm d}(\textbf{x}^{\top})) \\
&amp;=\operatorname{tr}(\textbf{A}({\rm d}\textbf{x})\textbf{x}^{\top})+\operatorname{tr}\left((({\rm d}\textbf{x})\textbf{x}^{\top} \textbf{A}^{\top})^{\top}\right) \\
&amp;=\operatorname{tr}((\textbf{x}^{\top}\textbf{A}({\rm d}\textbf{x})) + \operatorname{tr}(\textbf{x}^{\top}\textbf{A}^{\top}({\rm d}\textbf{x})) \\
&amp;=\operatorname{tr}(\textbf{x}^{\top}\textbf{A}){\rm d}\textbf{x} + \operatorname{tr}(\textbf{x}^{\top}\textbf{A}^{\top}){\rm d}\textbf{x} \\
&amp;=\operatorname{tr}\left((\textbf{x}^{\top}\textbf{A}+\textbf{x}^{\top}\textbf{A}^{\top}){\rm d}\textbf{x}\right) \\
&amp;=(\textbf{x}^{\top}\textbf{A}+\textbf{x}^{\top}\textbf{A}^{\top}){\rm d}\textbf{x}
\end{aligned}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I used cyclic permutation law at beginning and at the end twice, and used transpose law only once to transform &lt;span  class=&#34;math&#34;&gt;\({\rm d}\textbf{x}^{\top}\)&lt;/span&gt;. I installed trace function on first line and uninstall the trace function on the last line, &lt;span  class=&#34;math&#34;&gt;\({\rm d}\textbf{x}=\lim(\textbf{x}_1-\textbf{x}_2)\in \Bbb{R}^{N}\)&lt;/span&gt;, it can be proved that the expression on final line is still a scalar.&lt;/p&gt;

&lt;p&gt;And we can get the result &lt;span  class=&#34;math&#34;&gt;\(\textbf{x}^{\top}\textbf{A}+\textbf{x}^{\top}\textbf{A}^{\top}\)&lt;/span&gt; simply in several steps!&lt;/p&gt;

&lt;h4 id=&#34;another-important-law&#34;&gt;Another Important Law&lt;/h4&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\frac{\partial}{\partial A}\operatorname{tr}(AB)=B^{\top}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This law will be used once in the next section.&lt;/p&gt;

&lt;h2 id=&#34;multivariate-guassian-distribution-maximum-likelihood-estimate&#34;&gt;Multivariate Guassian Distribution Maximum Likelihood Estimate&lt;/h2&gt;

&lt;p&gt;In the end, I want to show you how to calculate the MLE for a multivariate guassian distribution model with all the stuff discussed in this post, I really hope you can enjoy it as much as I do!&lt;/p&gt;

&lt;h4 id=&#34;problem&#34;&gt;Problem:&lt;/h4&gt;

&lt;p&gt;Given &lt;span  class=&#34;math&#34;&gt;\(N\)&lt;/span&gt; samples &lt;span  class=&#34;math&#34;&gt;\(\{X_1,X_2,X_3,...,X_i\}\)&lt;/span&gt; are drawn from a p-variate multivariate guassian distribution model i.i.d:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[p(x | \mu, \Sigma)=\frac{1}{(2 \pi)^{p / 2}|\Sigma|^{1 / 2}} \exp \left\{-\frac{1}{2}(x-\mu)^{T} \Sigma^{-1}(x-\mu)\right\}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Find the MLE for &lt;span  class=&#34;math&#34;&gt;\(\mu\ \Sigma\)&lt;/span&gt;.&lt;/p&gt;

&lt;h4 id=&#34;solution&#34;&gt;Solution:&lt;/h4&gt;

&lt;p&gt;Define the likelihood function &lt;span  class=&#34;math&#34;&gt;\(L\)&lt;/span&gt;:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[f(\mu, \Sigma)=\frac{1}{(2\pi)^{\frac{pN}{2}}|\Sigma|^{\frac{N}{2}}}\exp{\left\{\sum_{i=1}^{N}-\frac{1}{2}(X_i-\mu)^{\top}\Sigma^{-1}(X_i-\mu)\right\}}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;In order to simplify the problem, plus due to the fact that the multivariate guassian distribution belongs to the exponential distribution family. Instead straight differentiating the likelihood function, it is better to calculate the logarithmic differentiation of the function.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[L(\mu, \Sigma)=\ln f(\mu, \Sigma)=\sum_{i=1}^{N}-\frac{1}{2}(X_i-\mu)^{\top}\Sigma^{-1}(X_i-\mu)-\frac{pN}{2}\ln 2\pi - \frac{N}{2}\ln|\Sigma|\]&lt;/span&gt;&lt;/p&gt;

&lt;h5 id=&#34;find-the-mle-for-the-the-mean&#34;&gt;Find the MLE for the the mean&lt;/h5&gt;

&lt;p&gt;Find &lt;span  class=&#34;math&#34;&gt;\(\mu\)&lt;/span&gt; first, then &lt;span  class=&#34;math&#34;&gt;\(\Sigma\)&lt;/span&gt;, calculate the first-order partial derivative of &lt;span  class=&#34;math&#34;&gt;\(L(\mu, \Sigma)\)&lt;/span&gt; w.r.t &lt;span  class=&#34;math&#34;&gt;\(\mu\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\frac{\partial L(\mu, \Sigma)}{\partial \mu} = \sum_{i=1}^n - \partial \frac{1}{2}(X_i-\mu)^{\top}\Sigma^{-1}(X_i-\mu) /\partial \mu \]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;And if we regard &lt;span  class=&#34;math&#34;&gt;\((X_i-\mu)\)&lt;/span&gt; as &lt;span  class=&#34;math&#34;&gt;\(\textbf{x}\)&lt;/span&gt; in the former section, the partial derivative on the right side is simply:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\frac{1}{2}\sum_{i=1}^{N} (X_i-\mu)^{\top}\Sigma^{-1}+ (X_i-\mu)^{\top}(\Sigma^{-1})^T\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Since &lt;span  class=&#34;math&#34;&gt;\(\Sigma\)&lt;/span&gt; is the covariance matrix, it is symmetric:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
\Sigma^{-1}\Sigma&amp;=(\Sigma\Sigma^{-1})^{\top} \\
\Sigma^{-1}\Sigma&amp;=(\Sigma^{-1})^{\top}\Sigma^{\top} \\
\Sigma^{-1}&amp;=(\Sigma^{-1})^{\top}
\end{aligned}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The partial derivative w.r.t &lt;span  class=&#34;math&#34;&gt;\(\mu\)&lt;/span&gt; in the conclusion:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\frac{\partial L(\mu, \Sigma)}{\partial \mu} =\sum_{i=1}^n(X_i-\mu)^{\top}\Sigma^{-1}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Find its critical point, i.e. the mean of all samples:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\hat{\mu}=\frac{1}{N}\sum_{i=1}^{N}X_i\]&lt;/span&gt;&lt;/p&gt;

&lt;h5 id=&#34;find-the-mle-for-the-covariance-matrix&#34;&gt;Find the MLE for the covariance matrix&lt;/h5&gt;

&lt;p&gt;Since we get &lt;span  class=&#34;math&#34;&gt;\(\hat{\mu}\)&lt;/span&gt;, and apparently the &lt;span  class=&#34;math&#34;&gt;\(\mu\)&lt;/span&gt; estimate does not rely on &lt;span  class=&#34;math&#34;&gt;\(\Sigma\)&lt;/span&gt;, these two parameters are independent. We can safely substitute all &lt;span  class=&#34;math&#34;&gt;\(\mu\)&lt;/span&gt; with &lt;span  class=&#34;math&#34;&gt;\(\hat{\mu}\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
\frac{\partial L(\hat{\mu}, \Sigma)}{\partial \Sigma^{-1}}&amp;=\partial\left(-\frac{N}{2}\ln|\Sigma|\right)/\partial\Sigma^{-1}-\frac{1}{2}\sum_{i=1}^{N}(X_i-\hat{\mu})(X_i-\hat{\mu})^{\top} \\
&amp;=\partial (\frac{N}{2}\ln|\Sigma^{-1}|)/\partial \Sigma^{-1} -\frac{1}{2}\sum_{i=1}^{N}(X_i-\hat{\mu})(X_i-\hat{\mu})^{\top} \\
&amp;=\frac{N}{2\Sigma^{-1}}-\frac{1}{2}\sum_{i=1}^{N}(X_i-\hat{\mu})(X_i-\hat{\mu})^{\top} \\
&amp;=\frac{N}{2}\Sigma-\frac{1}{2}\sum_{i=1}^{N}(X_i-\hat{\mu})(X_i-\hat{\mu})^{\top}
\end{aligned} \]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The last term on the first line was obtained by first using the cyclic permutaion then using the extra law in the former section.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\frac{1}{2} \sum_{n}\left(x_{n}-\mu\right)^{\top} \Sigma^{-1}\left(x_{n}-\mu\right)=\frac{1}{2} \sum_{i=1}^{N} \operatorname{tr}\left[\left(X_{i}-\hat{\mu}\right)\left(X_{i}-\hat{\mu}\right)^{\top} \Sigma^{-1}\right]\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Then using the extra law.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\frac{\partial}{\partial\Sigma^{-1}}(\frac{1}{2} \sum_{i=1}^{N} \operatorname{tr}\left[\left(X_{i}-\hat{\mu}\right)\left(X_{i}-\hat{\mu}\right)^{\top} \Sigma^{-1}\right])=\frac{1}{2}\sum_{i=1}^{N}(X_i-\hat{\mu})(X_i-\hat{\mu})^{\top}\]&lt;/span&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>LRTA* AND-OR ALPHA-BETA algorithms</title>
      <link>https://xiahualiu.github.io/posts/2020-01-11-lrta-ab/</link>
      <pubDate>Sat, 11 Jan 2020 21:59:55 -0500</pubDate>
      <guid>https://xiahualiu.github.io/posts/2020-01-11-lrta-ab/</guid>
      <description>&lt;p&gt;In this post, I will write down my understanding of these three algorithms, which are intended to solve:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Unknown but fully observable environment: LRTA*&lt;/li&gt;
&lt;li&gt;Known but non-deterministic environment: AND-OR Tree Search&lt;/li&gt;
&lt;li&gt;Classical two-player adversary game: ALPHA-BETA Tree Search&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The reason I put AND-OR and ALPHA-BETA Tree searches together is I think they are quite similiar, one is agent versus environment, one is agent versus another optimal agent.&lt;/p&gt;
&lt;p&gt;The reason I skipped genetic algorithm is that it is just a concept, and contains too many sub algorithms that follow the same evolutionary concept. I wrote a program using GA solving TSP problem, &lt;a href=&#34;https://github.com/xiahualiu/TSP_example&#34;&gt;TSP example&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;learning-real-time-a&#34;&gt;Learning Real Time A*&lt;/h2&gt;
&lt;p&gt;LRTA* is a simple implement of a online search agent. It is suitable for an unknown environment and the environment is safe to explore.&lt;/p&gt;
&lt;p&gt;The LRTA* algorithm is just like the value iteration algorithm of MDP, but the difference is in value iteration algorithm, the environment is known, we initialize the utility randomly with a random value linked to any state.&lt;/p&gt;
&lt;p&gt;But LRTA* is able to solve the unknown environment, we cannot assign a value at first, instead, the agent can only get access to the states where it has been in. So LRTA* use a &lt;code&gt;result&lt;/code&gt; to store transitions, and a &lt;code&gt;H&lt;/code&gt; to store the value of the explored states.&lt;/p&gt;
&lt;p&gt;And there is a problem which cannot be overcome by any type of algorithms, i.e. asserting the optimality of the solution, since we can only explored limited state space, so there is not guarantee that there is no better solution than the one we found.&lt;/p&gt;
&lt;h2 id=&#34;and-or-search&#34;&gt;AND-OR Search&lt;/h2&gt;
&lt;p&gt;AND-OR search include two functions that calling each other. It is an interesting idea.&lt;/p&gt;
&lt;p&gt;AND nodes can be regarded as an unstable transition model, which leads to different next states. AND-OR search is a DFS search, every path will end in a failure (loop or dead) or goal.&lt;/p&gt;
&lt;p&gt;OR nodes is the agent choice node, agent choose what to do in OR nodes. If the OR node is goal, OR search return the empty plan, and the upper OR nodes will add reflexes (if state n then do x) to that plan and the plan will eventually leads the agent to the goal.&lt;/p&gt;
&lt;p&gt;In AND nodes, the nodes return &amp;ldquo;switch&amp;rdquo; plans, so not matter what the environment outcome is, the plan is consistent for an agent. However this switch may have a failure case.&lt;/p&gt;
&lt;p&gt;It is a little tricky the fact that AND-OR search only need to find one goal, because OR searches exhausts all outcomes of an action, and AND searches are the choices of an agent, so if we only need a solution which can be not optimal, we just need find one possible plan.&lt;/p&gt;
&lt;h2 id=&#34;alpha-beta-pruningsearch&#34;&gt;ALPHA-BETA Pruning/Search&lt;/h2&gt;
&lt;p&gt;Alpha-Beta search is actually a smarter version of minimax search. Every path maintains a value bound (alpha and beta) that some bad branches will not be considered and explored if they are in the bound.&lt;/p&gt;
&lt;p&gt;Values need to be backed-up along the path. So every node on the path shares the same bound.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Searching Methods - AI: A Modern Approach Notes</title>
      <link>https://xiahualiu.github.io/posts/2020-01-07-searching/</link>
      <pubDate>Tue, 07 Jan 2020 13:02:01 -0500</pubDate>
      <guid>https://xiahualiu.github.io/posts/2020-01-07-searching/</guid>
      <description>&lt;h2 id=&#34;abstract&#34;&gt;Abstract&lt;/h2&gt;
&lt;p&gt;This article is my personal version summary of the famous book, Artificial Intelligence: A Modern Approach Chapter 3.&lt;/p&gt;
&lt;h2 id=&#34;tree-search-and-graph-search&#34;&gt;Tree Search and Graph Search&lt;/h2&gt;
&lt;p&gt;Tree search expands all child nodes and adds them into frontier even some of them have been visited.&lt;/p&gt;
&lt;p&gt;Graph search maintains a explored list where stores all visited nodes, it only adds unexplored nodes into frontier.&lt;/p&gt;
&lt;h2 id=&#34;uninformed-search&#34;&gt;Uninformed Search&lt;/h2&gt;
&lt;p&gt;There are many types of uninformed search algorithms:&lt;/p&gt;
&lt;h3 id=&#34;step-cost-problem&#34;&gt;Step-cost Problem&lt;/h3&gt;
&lt;p&gt;This kind of problems have the same step cost, we only need to find the minimal steps from initial state to goal state.&lt;/p&gt;
&lt;h4 id=&#34;breath-first-search&#34;&gt;Breath first search:&lt;/h4&gt;
&lt;p&gt;This method uses a FIFO (first-input-first-output) queue to implement. And is not sensitive to the choice between tree search or graph search.&lt;/p&gt;
&lt;h5 id=&#34;advantage-of-bfs&#34;&gt;Advantage of BFS:&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;It can find the optimal solution naturally without generating overhead nodes.&lt;/li&gt;
&lt;li&gt;It generates the fewest nodes before finding a solution for step-cost problem.&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;distadvantage-of-bfs&#34;&gt;Distadvantage of BFS:&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;It needs to store all the nodes on last layer.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;depth-first-search&#34;&gt;Depth first search:&lt;/h4&gt;
&lt;p&gt;DFS can be implement by two ways, one is using a LIFO (last input first output) stack, the other is calling &lt;code&gt;child()&lt;/code&gt; function recursively.&lt;/p&gt;
&lt;p&gt;Natural DFS under tree search (not the graph search) condition is incomplete, because the depth is infinite. The DFS itself is not an optimal algrithm.&lt;/p&gt;
&lt;h5 id=&#34;advantage-of-dfs&#34;&gt;Advantage of DFS:&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;It frees node memory once it finishs digging a branch, all the nodes on the branch can be deleted. So it can run on a memory-limited machine.&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;disadvantage-of-dfs&#34;&gt;Disadvantage of DFS:&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;It generates excessive nodes compared with BFS.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;varaints-of-dfs&#34;&gt;Varaints of DFS:&lt;/h4&gt;
&lt;h5 id=&#34;backtracking-search&#34;&gt;Backtracking search&lt;/h5&gt;
&lt;p&gt;It is more memory economical. Every generated node on searching tree has a successor information on its depth, so we only need to store &lt;em&gt;m&lt;/em&gt; nodes (m equals the depth of the frontier) at any time.&lt;/p&gt;
&lt;p&gt;It is suitable when a node is super large in memory.&lt;/p&gt;
&lt;h5 id=&#34;iterative-deeping-depth-first-search&#34;&gt;Iterative deeping depth-first search&lt;/h5&gt;
&lt;p&gt;It is simply a DFS with depth limitation. After each episode of IDS, the depth limit increases by 1.&lt;/p&gt;
&lt;p&gt;Two types of return result:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cutoff: Current episode reached depth limit.&lt;/li&gt;
&lt;li&gt;failure: Current episode ends before reaching depth limit.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;uniform-cost-problem&#34;&gt;Uniform-cost Problem&lt;/h3&gt;
&lt;p&gt;Uniform-cost problems have a postive cost for each step, however costs for different steps varys.&lt;/p&gt;
&lt;h4 id=&#34;uniform-cost-search&#34;&gt;Uniform-cost search&lt;/h4&gt;
&lt;p&gt;It is origin from the two-point shortest-path algorithm of Dijkstra.&lt;/p&gt;
&lt;p&gt;It relys on a priority queue, instead expanding randomly, it always expands the lowest path cost node on the present searching tree.&lt;/p&gt;
&lt;p&gt;Two modification:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The goal test is applied to a node when it is selected for expansion (fetched from the priority queue). This seems inefficient but it is essential. Once a node is generated, we cannot ensure that it will be pushed back to the top of priority queue, but the second time we met it, it must be the optimal solution, beacuse the path cost can only increase in uniformed cost problem case.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The second modification is similar to dynamic programming, a test is added and when we enter the same state multiple times, rather than storing all of the nodes, we only store the best node that reach this state.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;bidirection-search&#34;&gt;Bidirection search&lt;/h3&gt;
&lt;p&gt;Bidirection search is based on the simple math:&lt;/p&gt;
&lt;p&gt;$$2\ast branch^{depth/2} \quad  \text{is much less than} \quad branch^{depth}$$&lt;/p&gt;
&lt;p&gt;It needs a test to check whether the frontiers of two searches intersect.&lt;/p&gt;
&lt;p&gt;But calculating the predecessors needs substantial ingenuity.&lt;/p&gt;
&lt;h2 id=&#34;informed-heuristic-search&#34;&gt;Informed (Heuristic) Search&lt;/h2&gt;
&lt;p&gt;The difference between informed and uninformed search is whether we can find a heuristic function.&lt;/p&gt;
&lt;p&gt;$$h(n)=\text{heuristic function of a node}$$&lt;/p&gt;
&lt;h3 id=&#34;greedy-best-first-search&#34;&gt;Greedy best-first search&lt;/h3&gt;
&lt;p&gt;It chooses to expand the node that is most likely to lead to a solution. In two-point shortest route finding problem, the heuristic function is the 2-norm between the current address and goal address.&lt;/p&gt;
&lt;p&gt;In this case:&lt;/p&gt;
&lt;p&gt;$$h(n)=norm(n,goal)$$&lt;/p&gt;
&lt;h3 id=&#34;a-search&#34;&gt;A* search&lt;/h3&gt;
&lt;p&gt;Unlike uniform-cost search&#39;s only considering path cost from start, and greedy best-first search&#39;s only considering heuristic function value. A* combines them both.&lt;/p&gt;
&lt;p&gt;$$f(n)=g(n)+h(n)$$&lt;/p&gt;
&lt;h4 id=&#34;variants-of-a-search&#34;&gt;Variants of A* search&lt;/h4&gt;
&lt;p&gt;The biggest problem of A* is that A* stores all the nodes before finding a optimal solution.&lt;/p&gt;
&lt;p&gt;So the variants of A* mainly optimize the memory efficiency.&lt;/p&gt;
&lt;h5 id=&#34;iterative-deepening-a-search&#34;&gt;Iterative-deepening A* search&lt;/h5&gt;
&lt;p&gt;Cutoff &lt;em&gt;f&lt;/em&gt;-cost is the smallest &lt;em&gt;f&lt;/em&gt;-cost node that exceeded the cutoff on the previous iteration.&lt;/p&gt;
&lt;p&gt;Honestly, iterative deepening search only works efficiently for BFS, algorithms like iterative-deeping depth first search or iterative-deeping depth A* search all suffer from the cost of repeating expanding upper layers in each iteration.&lt;/p&gt;
&lt;h5 id=&#34;recursive-best-first-search-rbfs&#34;&gt;Recursive best-first search (RBFS)&lt;/h5&gt;
&lt;p&gt;If a node&#39;s children all cost more than a node&#39;s peer, we can just label the node with the best children cost then delete all the decendants, then move the peer node.&lt;/p&gt;
&lt;h5 id=&#34;memory-bounded-a-ma-and-simplified-ma-sma&#34;&gt;Memory-bounded A* (MA*) and simplified MA* (SMA*)&lt;/h5&gt;
&lt;p&gt;SMA* behaves same as A* before exhausting all the memory, after no node can be added to the memory, it removes the worst node in the tree and adds new node.&lt;/p&gt;
&lt;h3 id=&#34;how-to-choose-heuristic-function&#34;&gt;How to choose heuristic function&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Generating admissible heuristics from relaxed problem.&lt;/li&gt;
&lt;li&gt;Generating admissible heuristics from subproblems.&lt;/li&gt;
&lt;li&gt;Learning heuristics from experience.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;parallel-search&#34;&gt;Parallel search&lt;/h4&gt;
&lt;p&gt;Not covered but useful for computer cluster.&lt;/p&gt;
</description>
    </item>
    <item>
      <title>A Dynamic Programming Tuturial</title>
      <link>https://xiahualiu.github.io/posts/2019-12-23-dp/</link>
      <pubDate>Mon, 23 Dec 2019 17:59:10 -0500</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-12-23-dp/</guid>
      <description>&lt;p&gt;Well, it sounds old but for me, the true understanding of dynamic programming actually happended after I finished reading the book:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Optimal Control Theory: An Introduction by Donald E. Kirk&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;However, the book used an example that is too complicated for a beginner to understand (I think, for me it is.). So I wrote this article to help those who want to take a peek in the basics of dynamic programming, I will try my best to make it easy and you will see that dynamic programming is quite simple and intuitive.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Revised:&lt;/strong&gt; After finishing the canonical book AI: A Modern Approach, I felt I was fooled by the former book, dynamic programming is as simple as BFS or DFS.&lt;/p&gt;
&lt;h2 id=&#34;some-notations&#34;&gt;Some notations&lt;/h2&gt;
&lt;p&gt;In the rest of the article, some notations will appear more than once and I do not want to confuse any of you about the notations, what they mean.&lt;/p&gt;
&lt;p&gt;The first two is state and policy:&lt;/p&gt;
&lt;p&gt;Dynamic programming is suitable for solving problems that contain a series of decisions and states.&lt;/p&gt;
&lt;p&gt;For example, if you are a postman and today your job is to deliver some packages in an area, a common postman will stick to the same route everyday or randomly drives the van. But a clever postman like you will try to find a path that can visit all the package addresses meanwhile has the shortest distance among all viable routes.&lt;/p&gt;
&lt;p&gt;And for your information, This problem has another name, called &lt;a href=&#34;https://en.wikipedia.org/wiki/Travelling_salesman_problem&#34;&gt;Traveling Salesman Problem (TSP)&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We can tear the problem into a series of decisions, i.e. which address to visit first, then, after you finish the first delivery, at the first address, you have to decide which address to visit next.&lt;/p&gt;
&lt;p&gt;So here the states here, at first glance (not right though), are the different addresses, in other words, different outcomes of your decision. And the policy is like a GPS navigation system installed on your car, it tells you what is your next decision once you reach a state (address). So if your policy is optimal, you can follow the policy and traverse these addresses and finish the given task in the shortest path (and use less gas!). So&lt;/p&gt;
&lt;p&gt;Policy:&lt;/p&gt;
&lt;p&gt;$$P(state)=action$$&lt;/p&gt;
&lt;p&gt;Policy works like a function, it accepts discrete states and outputs corresponding actions at given state.&lt;/p&gt;
&lt;p&gt;However in the postman problem discribed above, the state is not simply address because once you made a decision, the outcome is not a simply change of your location, you also have one less package to deliver, so the state in this problem also has information of the package you are carry at the certain address. If you are at Address #1, but you only carry 1 package (1 address to go), apparently the situation differs from that you carry 10 packages (10 addresses to go), the biggest difference is your action set next is not same (you have 1 choice versus 10 choices).&lt;/p&gt;
&lt;p&gt;So a state can be more complexed.&lt;/p&gt;
&lt;h2 id=&#34;principle-of-optimality&#34;&gt;Principle of Optimality&lt;/h2&gt;
&lt;p&gt;Since we have discussed state and policy, we can move on to the principle of optimality.&lt;/p&gt;
&lt;p&gt;We can tear the problem into a series of decisions and states, right? Image we start at State #1 and reach State #n, the pricinple of optimality ensure that, if the policy is optimal, and path from the beginning state (State #1) to the State #(n-1) provided by the policy is optimal. This is simple to proof, if you can find a better path from State #1 to State #(n-1), you can simply do the same last step (State #(n-1) to State #n) and get a better result!&lt;/p&gt;
&lt;p&gt;This may confuse you a little, I will show an example using the above postman problem. Imagine you have reached the Address #i and you only have no package to deliver (but you need to return to the post office). And you recall your history moves, &amp;ldquo;Did I make the right moves?&amp;quot;. Well if you can think of a better waythat can lead you into the same situation you are right now, the route you chose is definitely not optimal, becase the next move clearly makes no difference on the total distance cost.&lt;/p&gt;
&lt;p&gt;If we do the backward deduction several times (Since the path from State #1 to State #(n-1) is optimal, the path from State #1 to State #(n-2) is also optimal, and so on), then we can get a conclusion:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If you get an optimal path to finish the task, all the sub-paths from the begginning state to any states inside the path are optimal.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;You may think, while, that is easy, we only need to find the optimal path from State #1 to State #2 and the optimal path from State #1 to State #3. Then we find State #1 to State #n.&lt;/p&gt;
&lt;p&gt;Yes, that is the gist of the dynamic programming. However, the hidden difficulty in the process is, once you get the optimal path from State #1 to State #2, how do you get the optimal path from State #1 to State #3.&lt;/p&gt;
&lt;p&gt;In some simple problems, like &lt;a href=&#34;https://en.wikipedia.org/wiki/Knapsack_problem&#34;&gt;Knapsack problem&lt;/a&gt;. You can use this way to find the best result, becasue in such problems, states are heavily history related, (Forgive me for not able to think of a better description), so you can push your current state towards the ending.&lt;/p&gt;
&lt;p&gt;Some of the problems are not simple like that, you need to search for all probably states that can reach State #3 in one move and check which one is the best, (In terms, which costs least).&lt;/p&gt;
&lt;p&gt;So the forward programming process can be simply described in one formula:&lt;/p&gt;
&lt;p&gt;$$ J^\ast=\min(C_h^\ast+C_i)$$&lt;/p&gt;
&lt;p&gt;The J star is the best cost for current state, Ch star is the best history cost from beginning to the state before current state, Ci is the cost for taking action i in a given former state.&lt;/p&gt;
&lt;p&gt;If you record all Ci&#39;s, you get the optimal path one by one.&lt;/p&gt;
&lt;h2 id=&#34;how-to-implement-dp&#34;&gt;How to implement DP&lt;/h2&gt;
&lt;p&gt;Well, there are two ways to implement a dynamic programming algorithm for a problem, one is forward way, like I discribed above, and you can do it backward. For every iteration, you do not own a history when you do it backward, but you can evaluate it later, and just accumulate the action costs, until you reach the begginning state.&lt;/p&gt;
&lt;p&gt;However they do not differ very much, choose one you like or according to the problem! Because you can planning the path in any direction you like, but you have to execute the actions one by one once you finish planning!&lt;/p&gt;
&lt;h2 id=&#34;a-tsp-example&#34;&gt;A TSP Example&lt;/h2&gt;
&lt;p&gt;This example can be found at my github repository &lt;a href=&#34;https://github.com/xiahualiu/TSP_example&#34;&gt;here&lt;/a&gt;. I used 3 different ways to solve the TSP problem but you only need the DP solution.&lt;/p&gt;
&lt;p&gt;So In this example the problem is stated as:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;There are 4 cities on the map. Their locations are (20,20) (20,40) (40,40) (40,20) respectively and they are are X Y values in the cartesian system. Find the shortest tour among those cities, each city must be at least visited once and you cannot visit a city twice, except the city where you start off, you need to return to the begin city after visiting all cities.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In this problem, we can start at any arbitrary city because the tours are required to be closed circles as described, the optimal solution is same for every beginning choice.&lt;/p&gt;
&lt;p&gt;Imagine we chose City #1 (20,20) to begin with.&lt;/p&gt;
&lt;p&gt;The states in this problem need to carry such information:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Total Distance&lt;/strong&gt;: How far did I go? (We need to know this while making comparsion in DP iteration)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Visited City Set&lt;/strong&gt;: Unordered set of all cities I have visited. (Why this is needed was talked above)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Current City&lt;/strong&gt;: Where am I now? (We need to know this before calculating the distance increments.)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;So we have the structure of the state in this problem, what we need now is &lt;strong&gt;evolving the intial state until the state reachs the final state&lt;/strong&gt;. This may sound strange to you, but you will know what I am talking about later.&lt;/p&gt;
&lt;p&gt;I used a common notaion for our state.&lt;/p&gt;
&lt;p&gt;$$g(current_city | visited_set)=total_distance$$&lt;/p&gt;
&lt;p&gt;And we did the DP forward using our hand, what we get is a tree:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-12-23-DP/p2.png&#34; alt=&#34;DP tree&#34;&gt;&lt;/p&gt;
&lt;p&gt;This problem is simple, we simply did a breath first searching first, and this is enough to lead us to find out all the candidates in the DP iteration formulas (Because the states are historically related so the candidates can always be found out at the former layers). How we did the DP iteration?&lt;/p&gt;
&lt;p&gt;For example, following path 1-3-4-2 and we reach the state where current location is City #2 and we have visited {4,3,2,1}. And later we find a better path 1-4-3-2 which lets us reach exactly the same state and offers a better distance cost. So we update the state and overwrite the new path to the state.&lt;/p&gt;
&lt;p&gt;Please know that this problem can be solved efficiently by BFS (not most efficiently though) does not mean every DP problems can all be solved with BFS. We can use another way to discover the candidate states, but the DP iteration process is same for any problem types.&lt;/p&gt;
&lt;h2 id=&#34;some-comments&#34;&gt;Some comments&lt;/h2&gt;
&lt;p&gt;To be honest, dynamic programming is not a very complicated method, it just systematically records all the solutions for the subproblems then increases the length to the original problem.&lt;/p&gt;
&lt;p&gt;DP essentially, we start with the smallest cases of the subproblem, becase when we find all optimal solutions to every possible subproblems, we can use the DP iteration to find optimal solutions to a bigger subproblem, then do this again and again we will reach the original problem.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Signal Processing Math - Partial Fraction Expansion Strategies</title>
      <link>https://xiahualiu.github.io/posts/2019-07-28-partial-fraction-expansion/</link>
      <pubDate>Sun, 28 Jul 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-07-28-partial-fraction-expansion/</guid>
      <description>&lt;p&gt;Partial fraction expansion (also known as partial fraction decomposition) is a very basic math operation when we want to simplify a problem involving a fraction with polynomial numerator and denominator. We have some methods to handle the fundamental fraction terms like Laplace transform of a simple exponential signal is:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{1}{a+s}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;And the by inverse Laplace Transform we know the signal is either &lt;span  class=&#34;math&#34;&gt;\(e^{-at}u(t)\)&lt;/span&gt; or &lt;span  class=&#34;math&#34;&gt;\(-e^{-at}u(-t)\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;, depending on the transform is left-sided or right-sided.&lt;/p&gt;

&lt;p&gt;But in a more complicated situation, while we are facing the transform like&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{s+3}{s^3+7s^2+10s}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;We want to decompose the fraction into a sum of simple fractions:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{A_1}{s}+\frac{A_2}{s+2}+\frac{A_3}{s+5}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;So we can use the basic Laplace transform pairs to get the signal. But we need a way to determine the values of&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[A_1,\ A_2 \text{ and }A_3\]&lt;/span&gt;&lt;/p&gt;

&lt;h2 id=&#34;a-simple-partial-fraction-expansion&#34;&gt;A Simple Partial Fraction Expansion&lt;/h2&gt;

&lt;p&gt;The simple situation is the one shown above, there is a simple and straightforward method to determining the unknown coefficients&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[A_1,\ A_2 \text{ and }A_3\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;To find &lt;span  class=&#34;math&#34;&gt;\(A_1\)&lt;/span&gt;, multiply &lt;span  class=&#34;math&#34;&gt;\(F(s)\)&lt;/span&gt; by &lt;span  class=&#34;math&#34;&gt;\(s\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
sF(s)&amp;=s\frac{s+3}{s(s+2)(s+5)} \cr 
&amp;=A_1+s\frac{A_2}{s+2}+s\frac{A_3}{s+5}
\end{aligned}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;and then set &lt;span  class=&#34;math&#34;&gt;\(s=0\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
sF(s)|_{s=0}&amp;=A_1+0\frac{A_2}{0+2}+0\frac{A_3}{0+5}=A_1 \cr
&amp;=\frac{s+3}{s(s+5)}|_{s=0}=\frac{3}{10}
\end{aligned}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Likewise, we can get &lt;span  class=&#34;math&#34;&gt;\(A_2\)&lt;/span&gt; by setting &lt;span  class=&#34;math&#34;&gt;\(s=-2\)&lt;/span&gt;, get &lt;span  class=&#34;math&#34;&gt;\(A_3\)&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;by setting &lt;span  class=&#34;math&#34;&gt;\(s=-5\)&lt;/span&gt;.&lt;/p&gt;

&lt;h2 id=&#34;special-cases-of-parial-fraction-expansion&#34;&gt;Special Cases of Parial Fraction Expansion&lt;/h2&gt;

&lt;p&gt;The simple partial fraction expansion can expand fraction into a sum of simpler fractions. However, ther are many situations where the expansion is not so simple.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;em&gt;Order of numerator polynomial is not less than that of the denominator.&lt;/em&gt;&lt;/strong&gt; Partial fraction expansion can only be performed when the order of the denominator polynomial (the bottom term of the fraction) is greater than the order of the numerator (the top term).  If this condition is not met, we must perform an extra step before continuing with the expansion.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;em&gt;DIstinct Real Roots&lt;/em&gt;&lt;/strong&gt; The problem solved above is described as the case of distinct, real roots. This means that each term only appears once in the denominator, and the root of each term in the denominator is a distinct real number.  In the example above, the roots were at &lt;span  class=&#34;math&#34;&gt;\(0\)&lt;/span&gt;, &lt;span  class=&#34;math&#34;&gt;\(-2\)&lt;/span&gt; and &lt;span  class=&#34;math&#34;&gt;\(-5\)&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;em&gt;Repeated Real Roots&lt;/em&gt;&lt;/strong&gt; Another possibility is a case of repeated roots. For example&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{s+3}{s(s+2)^2(s+5)}\]&lt;/span&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Complex Roots&lt;/em&gt;&lt;/strong&gt; If the denominator cannot be reduced to a product of real roots. For example&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{s+3}{(s+5)(s^2+4s+5)}=\frac{s+3}{(s+5)(s+2+j)(s+2-j)}\]&lt;/span&gt;&lt;/p&gt;

&lt;h4 id=&#34;order-of-numerator-polynomial-is-not-less-than-that-of-the-denominator&#34;&gt;Order of numerator polynomial is not less than that of the denominator&lt;/h4&gt;

&lt;p&gt;We can use long division to eliminate the high-order terms on the numerater.&lt;/p&gt;

&lt;h4 id=&#34;distinct-real-roots&#34;&gt;Distinct Real Roots&lt;/h4&gt;

&lt;p&gt;Like the example done above, In general&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{A_1}{s+a_1}+\frac{A_2}{s+a_2}+\cdot\cdot\cdot+\frac{A_n}{s+a_n}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[A_i=(s+a_i)F(s)|_{s=-a_i}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;When calculation is done by hand, it is easily to use the &amp;quot;cover-up&amp;quot; method.&lt;/p&gt;

&lt;h4 id=&#34;repeated-real-roots&#34;&gt;Repeated Real Roots&lt;/h4&gt;

&lt;p&gt;For example, consider the fraction:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{s+3}{s(s+2)^2(s+5)}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The expansion for this case is:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{A_1}{s}+\frac{A_2}{s+2}+\frac{A_3}{(s+2)^2}+\frac{A_4}{s+5}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;And we can proof the simple method cannot be used since $(s+2)$ appear twice, and we can only get one value by setting &lt;span  class=&#34;math&#34;&gt;\(s=-2\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;There are two ways, the most favored by the texbook method uses the relationship&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[A_2=\left[\frac{d}{ds}(s+2)^2F(s)\right]_{s=-2}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;so&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[A_2=\left.\frac{s(s+5)-(s+3)(2s+5)}{(s(s+5))^2}\right|_{s=-2}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;While this method is elegant (and can be extended to multiply repeated roots), the differentiation of the ratio of polynomials is prone to errors.&lt;/p&gt;

&lt;h5 id=&#34;example-cross-multiplication&#34;&gt;Example: Cross Multiplication&lt;/h5&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{s+3}{s(s+2)^2(s+5)}=\frac{A_1}{s}+\frac{A_2}{s+2}+\frac{A_3}{(s+2)^2}+\frac{A_4}{s+5}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[s+3=(s+2)^2(s+5)A_1+s(s+2)(s+5)A_2+s(s+5)A_3+s(s+2^2)A_4\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[s+3=(A_1+A_2+A_4)s^3+(9A_1+7A_2+A_3+4A_4)s^2+(24A_1+10A_2+5A_3+4A_4)s+20A_1 \]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This yields a four-by-four system of equations that can be solved for A1 through A4.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
A_1+A_2+A_4&amp;=0 \cr
9A_1+7A_2+A_3+4A_4 &amp;=0 \cr
24A_1+10A_2+5A_3+4A_4&amp;=1 \cr
20A_1&amp;=3
\end{aligned}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Or, in the matrix form&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{bmatrix}
{1} &amp; {1} &amp; {0} &amp; {1} \cr
{9} &amp; {7} &amp; {1} &amp; {4} \cr
{24} &amp; {10} &amp; {5} &amp; {4} \cr
{20} &amp; {0} &amp; {0} &amp; {0}
\end{bmatrix}\begin{bmatrix}
{A_{1}} \cr
{A_{2}} \cr
{A_{3}} \cr
{A_{4}}
\end{bmatrix}=\begin{bmatrix}
{0} \cr
{0} \cr
{1} \cr
{3}
\end{bmatrix}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;We can combine the cover-up method to get the coefficients that is distinct then use cross multiplication to get the coefficients that corresponds to the repeated roots.&lt;/p&gt;

&lt;h3 id=&#34;complex-roots&#34;&gt;Complex Roots&lt;/h3&gt;

&lt;p&gt;Consider the fraction&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
F(s) &amp;=\frac{s+3}{(s+5)\left(s^{2}+4 s+5\right)}=\frac{s+3}{(s+5)(s+2-j)(s+2+j)} \cr
&amp;=\frac{A_{1}}{(s+5)}+\frac{A_{2}}{(s+2-j)}+\frac{A_{3}}{(s+2+j)}
\end{aligned}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;where&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{array}{l}
{A_{1}=(s+5) F(s)|_{s=-5}} \cr
{A_{2}=(s+2-j) F(s)|_{s=-2+j}} \cr
{A_{3}=(s+2+j) F(s)|_{s=-2+j}=A_{2}^{*}}
\end{array}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Another way to expand the fraction without resorting to complex numbers is to perform the expansion as follows.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{s+3}{(s+5)(s^{2}+4 s+5)}=\frac{A}{s+5}+\frac{B s+C}{s^{2}+4 s+5}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Note that the numerator of the second term is no longer a constant, but is instead a first order polynomial. Use cross-multiplication to get &lt;span  class=&#34;math&#34;&gt;\(A\ B\ C\)&lt;/span&gt;.&lt;/p&gt;</description>
    </item>
    <item>
      <title>How is Linear Feedback Shift Register(LFSR) used on Cyclic Redundancy Check(CRC)</title>
      <link>https://xiahualiu.github.io/posts/2019-04-25-lfsr-crc/</link>
      <pubDate>Fri, 26 Apr 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-04-25-lfsr-crc/</guid>
      <description>&lt;p&gt;Nowadays, cyclic redundancy check (CRC) is widely used on various fields, including data transmission or data integraty check, e.g UART or CAN bus. For many new hardware beginning learners, CRC appears to be a complexed mathematical blackbox which produces a serial of seemingly gibberish binary numbers. But it indeed is a very reliable mechanics which extracts the feature of the data and simple to understand and implement.&lt;/p&gt;
&lt;p&gt;First I want to introduce a thing to you, that is LFSR, Linear Feedback Shift Register. LFSR circuit looks just like below:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-4-25-LFSR-CRC/lfsr.png&#34; alt=&#34;A 4-bit LFSR&#34;&gt;&lt;/p&gt;
&lt;p&gt;If we put D3 D2 D1 D0 in a row, we can have a 4-bit value and every time when the clock edge occurs, the value is renewed by itself with the feedback channel. If only the g0 and g4 were open, LFSR itself transforms into a normal loop shift register.&lt;/p&gt;
&lt;p&gt;The intersting part is that we can acutally define a division calculation rule to describe this iterative process. I do not really understand how it works but it simply works anyway.&lt;/p&gt;
&lt;p&gt;In the case above, if the last value was $M(x)$ and the new value is $R(x)$. We define the polynomial $M(x)=d_3x^3+d_2x^2+d_1x+d_0$ and $d_3,d_2,d_1,d_0\in{1,0}$, $G(x)=g_4x^4+g_3x^3+g_2x^2+g_1x+g_0$ The $x$ in the polynomial has no value and can be ragarded as a symbol to indicate which $d_x$ digit is. And:&lt;/p&gt;
&lt;p&gt;$$
R(x)=M(x)\mod G(x)
$$&lt;/p&gt;
&lt;p&gt;How can it be divided? Let us put hands on a simple example:&lt;/p&gt;
&lt;p&gt;If the last ${d_3,d_2,d_1,d_0}={1,1,1,1}$ and the feedback gates ${g_4,g_3,g_2,g_1,g_0}={1,1,0,0,1}$. We can get new ${d_3,d_2,d_1,d_0}={1,1,1,0}$ by writing down the signal flow on the paper, and let us use the above rule:&lt;/p&gt;
&lt;p&gt;$$
R(x)=x \times (x^3+x^2+x+1)\mod(x^4+x^3+1)
$$&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-4-25-LFSR-CRC/cal1.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;The rule is simple, we only use the power of $x$ to times the divider and we get a result that has at most $x^3$. The substration procedure is acutally $\oplus$ which is also named XOR. We can now use binary digits to substitute the x. &lt;strong&gt;If you have any academic interest in the algebra part, it is called &lt;em&gt;Galois Field&lt;/em&gt; and we are currently use &lt;em&gt;GF(2)&lt;/em&gt;&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Let us continue on the calculation.&lt;/p&gt;
&lt;p&gt;Now we have $x^2+x+1$, which is ${d_3,d_2,d_1,d_0}={1,1,1,0}$ and the next several states are:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-4-25-LFSR-CRC/cal2.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;And by doing so, we get a serial of numbers that loop in circle which length is $x^4 -1$, the only number did not show is $0000$, you can imagine that $0000$ cannot drive these gates so it will always be $0000$. That serial numbers are tested to be a 4-bit pseudo-random number. the initial value is the seed of the random numbers, so we can use LFSR to create random number sequence very easily.&lt;/p&gt;
&lt;p&gt;But also, the gate values are not used without consideration, the gate polynomial has to be a primitive polynomial which means it cannot be a result of other two polynomials. You can refer to a primitive polynomial table to do so. (Google it, of course there is no link here.)&lt;/p&gt;
&lt;p&gt;But there is a very minutely chance that the modulo is all zeroes for example we make gates ${1,0,1,0}$ and the seed is ${0,1,0,1}$. That is how we do CRC.&lt;/p&gt;
&lt;p&gt;All the calculation illustrated above, we did not have an input, this equals to we input a zero every step. Assumed we have a serial of binary data ${1,0,1,1,0,1,0,0,0,&amp;hellip;}$, the length is 1024, and we push them in a 4-bit LFSR one by one, in the end we can get a modulo shorter than 5 bits. And here comes the tricky part, by adding this modulo to the end of the data (the modulo is acutally CRC data), the data now becomes 1028 bits, and also an exact division of the gate polynomial means eventually the LFSR will output all zeroes if we input this data serial.&lt;/p&gt;
&lt;p&gt;We see that LFSR has a random feature, that means if the data is changed somewhere in the serial, only 1 in 15 chance that we can divide it with LFSR exactly, and this is because we only use 4-bit LFSR, if we use a 32-bit LFSR instead, the error chance becomes extremely little.&lt;/p&gt;
&lt;p&gt;And we can also see that LFSR consumes very little gates and works very fast, we connect it to the shifter register of the transmitter and the receiver, so CRC process can work meanwhile the data is transmitted, so it is widely used in CRC.&lt;/p&gt;</description>
    </item>
    <item>
      <title>From SICP - Understand Event Driven Programming</title>
      <link>https://xiahualiu.github.io/posts/2019-04-04-event-driven/</link>
      <pubDate>Thu, 04 Apr 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-04-04-event-driven/</guid>
      <description>&lt;h1 id=&#34;introduction&#34;&gt;Introduction&lt;/h1&gt;
&lt;p&gt;I am recently working on the wizard book SICP (The Structure and Interpretation of Computer Programs) that was recommended by one of my friends who study computer science. To be honest, the book is not so simple and naive as it was firstly acknowledged as the introduction book of MIT CS major. It abstracts and reveals essential programming philosophy in a easiest way, by the vehicle that known as the programming language Scheme. At first I thought scheme was a painful language for normal programmers because I only used C/C++  language that is of imperative style. However after reading the book and finishing every exercise all the way down, I gradually learned how to maneuver it and really got it on the right way.&lt;/p&gt;
&lt;p&gt;In this post I used scheme as the language to illustrate what is event-driven programming, I once worked on a project that required to implement a simple protocal stack on a chip. However at that time I did not know about the event-driven paradigm so I make the processor to process the message packaging and unpackaging in a queue. In fact it worked pretty well (queue is also used in event-driven programming), however because lack of engineering experience, the whole program turned into a really intricate complex, with so many useless parts scattered everywhere. The whole project is difficult to maintain and debug.&lt;/p&gt;
&lt;p&gt;In Chapter 3, SICP gives a special example in scheme, showing students how to use scheme to implement a small circuit simulator just like verilog. However it did not go into details, just provides a rough sketch. And the codes are in a way that easy for adept programmer to read, not for new programmers like me.&lt;/p&gt;
&lt;p&gt;So I reiterate the code here, and describe the code segments in a human sequence (compared with SICP&#39;s only-god-know sequence).&lt;/p&gt;
&lt;h1 id=&#34;full-overview&#34;&gt;Full Overview&lt;/h1&gt;
&lt;p&gt;First of all, we only implement three basical gates (and or not) as primitives. We can imagine the circuit like the one below: In fact all the digital system can unfold into this three gates. So only 3 primitives is enough.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-4-4-Event-Driven/HA.png&#34; alt=&#34;Fig 1. A Half Adder Circuit&#34;&gt;&lt;/p&gt;
&lt;p&gt;We must know how to we make our program behave like the real circuit. The program must transmit the signal from a node to another node, and changed them according to the gates&amp;rsquo; different input output rules. What&#39;s more, we must know the delay of each gate and make every event happend in the time sequence. We will first go through main event-driven part and ignore the time line.&lt;/p&gt;
&lt;p&gt;The signals carried on circuit wires vary over time, when a signal changes, we know it causes a sequence of follow wires jumpping from 0 to 1 or 1 to 0 due to the logic gates rules. So we must invent a program mechanics to let a logic gate node able to catch a change on their input parameters and change their output, but how?&lt;/p&gt;
&lt;p&gt;The answer is add an extra intermedia to hold a state, and let it trigger the event. In this article, the &lt;strong&gt;wire&lt;/strong&gt; object takes this duty, we define wire as below:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; wire) (&lt;span style=&#34;color:#a6e22e&#34;&gt;wire&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;get-signal&lt;/span&gt;))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-signal!&lt;/span&gt; wire new-value)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;wire&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;set-signal!&lt;/span&gt;) new-value))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; wire action-procedure)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;wire&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;add-action!&lt;/span&gt;) action-procedure))

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;make-wire&lt;/span&gt;)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;signal-value&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) (&lt;span style=&#34;color:#a6e22e&#34;&gt;action-procedures&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;()))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-my-signal!&lt;/span&gt; new-value)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(not (= signal-value new-value))
          (&lt;span style=&#34;color:#66d9ef&#34;&gt;begin &lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;set! &lt;/span&gt;signal-value new-value)
                 (&lt;span style=&#34;color:#a6e22e&#34;&gt;call-each&lt;/span&gt; action-procedures))
          &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;not-changed&lt;/span&gt;))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;accept-action-procedure!&lt;/span&gt; proc)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;set! &lt;/span&gt;action-procedures
            (cons proc action-procedures))
      (&lt;span style=&#34;color:#a6e22e&#34;&gt;proc&lt;/span&gt;))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;dispatch&lt;/span&gt; m)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;get-signal&lt;/span&gt;) signal-value)
            ((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;set-signal!&lt;/span&gt;) set-my-signal!)
            ((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;add-action!&lt;/span&gt;) accept-action-procedure!)
            (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Unknown operation on wires&amp;#34;&lt;/span&gt;))))
    dispatch))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can see that the wire holds a local variable &lt;code&gt;signal-value&lt;/code&gt; and a procedure list &lt;code&gt;action-procedures&lt;/code&gt;. Wire has three interfaces to interact with other part of the program. The interesting part is the &lt;code&gt;set-my-signal!&lt;/code&gt; call, which does not simply change the signal value, but also triggeres the procedures in the list.&lt;/p&gt;
&lt;p&gt;So think when the state of a wire is changed, it will call the procedure (these procedures are stored internal but defined as global) to change the state of adjacent wires, by calling their &lt;code&gt;set-signal!&lt;/code&gt; calls, and &lt;code&gt;set-signal!&lt;/code&gt; is defined in a particular way that tiggeres internal-stored procedures which affect the next wires and there becomes a chain reaction till processor reaches the output wires where no procedures are stored, all the wires are refreshed.&lt;/p&gt;
&lt;p&gt;What are the procedures in the list? They are called when the value changes, in this case, they are logic gates. We must define these procedures in a way the connected wires are bound together, because we cannot bind them inside the wire object due to local environment rules. We want to change the connected wires states when called, it is important to construct the procedure environment enclosed in global environment and only in this way the wires state can be changed when internal precedures are called.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;call-each&lt;/code&gt; calls these procedures, which are defined as global procedures (very important) and have no arguments.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;call-each&lt;/span&gt; procedures)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(null? procedures)
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;done&lt;/span&gt;
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;begin &lt;/span&gt;((car procedures))
             (&lt;span style=&#34;color:#a6e22e&#34;&gt;call-each&lt;/span&gt; (cdr procedures)))))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;logic-gates&#34;&gt;Logic Gates&lt;/h1&gt;
&lt;p&gt;The three logic gates are defined below:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;inverter&lt;/span&gt; input output)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;invert-input&lt;/span&gt;)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;new-value&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;logical-not&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; input))))
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-signal!&lt;/span&gt; output new-value)))
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; input invert-input) &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ok&lt;/span&gt;)

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;logical-not&lt;/span&gt; s)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((= s &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        ((= s &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
        (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Invalid signal&amp;#34;&lt;/span&gt; s))))

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;and-gate&lt;/span&gt; input1 input2 output)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;and-input&lt;/span&gt;)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;new-value&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;logical-and&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; input1) (&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; input2))))
      (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-signal!&lt;/span&gt; output new-value)))
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; input1 and-input)
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; input2 and-input) &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ok&lt;/span&gt;)

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;logical-and&lt;/span&gt; s1 s2)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((= (* s1 s2) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        ((&lt;span style=&#34;color:#66d9ef&#34;&gt;or &lt;/span&gt;(= (+ s1 s2) &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) (= (+ s1 s2) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)) &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
        (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Invalid signal&amp;#34;&lt;/span&gt; s1 s2))))

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;or-gate&lt;/span&gt; input1 input2 output)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;or-input&lt;/span&gt;)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;new-value&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;logical-or&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; input1) (&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; input2))))
      (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-signal!&lt;/span&gt; output new-value)))
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; input1 or-input)
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; input2 or-input) &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ok&lt;/span&gt;)

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;logical-or&lt;/span&gt; s1 s2)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((&lt;span style=&#34;color:#66d9ef&#34;&gt;and &lt;/span&gt;(= s1 &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) (= s2 &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        ((&lt;span style=&#34;color:#66d9ef&#34;&gt;and &lt;/span&gt;(= s2 &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) (= s1 &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        ((&lt;span style=&#34;color:#66d9ef&#34;&gt;and &lt;/span&gt;(= s1 &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) (= s2 &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        ((&lt;span style=&#34;color:#66d9ef&#34;&gt;and &lt;/span&gt;(= s1 &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) (= s2 &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)) &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
        (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Invalid Signal&amp;#34;&lt;/span&gt; s1 s2))))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;These gates themselves are like injectors, they create the procedures and injected them into the input wires.&lt;/p&gt;
&lt;h1 id=&#34;probes&#34;&gt;Probes&lt;/h1&gt;
&lt;p&gt;We just finished the gates and the wires, and the simulation is ready to go, but we need a probe on the wires to tell us the change happended to what wire and from what state to another state.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;probe&lt;/span&gt; name wire)
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; wire
               (&lt;span style=&#34;color:#66d9ef&#34;&gt;lambda &lt;/span&gt;()
                 (display name) (display &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;)
                 (display &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; New-value = &amp;#34;&lt;/span&gt;)
                 (display (&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; wire))
                 (&lt;span style=&#34;color:#a6e22e&#34;&gt;newline&lt;/span&gt;))))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;go&#34;&gt;Go!&lt;/h1&gt;
&lt;p&gt;Using the gate primitives defined above, we can implement the &lt;code&gt;half-adder&lt;/code&gt; in picture above:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;half-adder&lt;/span&gt; A B S C)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;D (&lt;span style=&#34;color:#a6e22e&#34;&gt;make-wire&lt;/span&gt;))
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;E (&lt;span style=&#34;color:#a6e22e&#34;&gt;make-wire&lt;/span&gt;))
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;and-gate&lt;/span&gt; A B C)
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;or-gate&lt;/span&gt; A B D)
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;inverter&lt;/span&gt; C E)
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;and-gate&lt;/span&gt; D E S))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I use DrRacket and SCM to test the program, here is the result of DrRacket:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-racket&#34; data-lang=&#34;racket&#34;&gt;&amp;gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;define&lt;/span&gt; in1 (make-wire))
&amp;gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;define&lt;/span&gt; in2 (make-wire))
&amp;gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;define&lt;/span&gt; out1 (make-wire))
&amp;gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;define&lt;/span&gt; cout1 (make-wire))
&amp;gt; (probe &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;in1&lt;/span&gt; in1)
in1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&amp;gt; (probe &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;in2&lt;/span&gt; in2)
in2  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&amp;gt; (probe &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;out1&lt;/span&gt; out1)
out1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&amp;gt; (probe &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;cout1&lt;/span&gt; cout1)
cout1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&amp;gt; (half-adder in1 in2 out1 cout1)
&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ok&lt;/span&gt;
&amp;gt; (set-signal! in1 &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
out1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
in1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;done&lt;/span&gt;
&amp;gt; (set-signal! in2 &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
out1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
cout1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
in2  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;done&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;time-line&#34;&gt;Time Line&lt;/h1&gt;
&lt;p&gt;We finished the event-driven part. Now I believe you have a basical idea of the program architecture. Now move to another question, the difficulty raised, if we add a delay to all the gates, and want to see both state and time line of the change, how to make it?&lt;/p&gt;
&lt;p&gt;We need to import a new concept into our program, a time queue. By this case, it is &lt;strong&gt;The Agenda&lt;/strong&gt;.&lt;/p&gt;
&lt;h2 id=&#34;the-agenda&#34;&gt;The Agenda&lt;/h2&gt;
&lt;p&gt;The agenda is actually a queue, every element in this queue contains a time stamp and the task.&lt;/p&gt;
&lt;p&gt;We can easily wrote down queue structure in scheme:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;;;;This file shows how to present queue in scheme (message-passing style)&lt;/span&gt;

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;nil &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;())

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-queue?&lt;/span&gt; queue)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;queue&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;empty&lt;/span&gt;)))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;front-queue&lt;/span&gt; queue)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;queue&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;front&lt;/span&gt;)))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;insert-queue!&lt;/span&gt; queue item)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;queue&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;insert&lt;/span&gt;) item))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;delete-queue!&lt;/span&gt; queue)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;queue&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;delete&lt;/span&gt;)))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;print-queue&lt;/span&gt; queue)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;queue&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;print&lt;/span&gt;)))

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;make-queue&lt;/span&gt;)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;front-ptr&lt;/span&gt; nil)
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;rear-ptr&lt;/span&gt; nil))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-queue?&lt;/span&gt;)
      (eq? front-ptr nil))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;front-queue&lt;/span&gt;)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-queue?&lt;/span&gt;)
          (&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ERROR front-queue called with an empty queue&amp;#34;&lt;/span&gt;)
          (car front-ptr)))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-front-ptr!&lt;/span&gt; pair)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;set! &lt;/span&gt;front-ptr pair))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-rear-ptr!&lt;/span&gt; pair)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;set! &lt;/span&gt;rear-ptr pair))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;insert-queue!&lt;/span&gt; item)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-queue?&lt;/span&gt;)
             (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-front-ptr!&lt;/span&gt; (cons item nil))
             (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-rear-ptr!&lt;/span&gt; front-ptr)
             front-ptr)
            (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(set-cdr! rear-ptr (cons item nil))
                  (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-rear-ptr!&lt;/span&gt; (cdr rear-ptr))
                  front-ptr)))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;delete-queue!&lt;/span&gt;)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-queue?&lt;/span&gt;)
             (&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ERROR delete-queue called with an empty queue&amp;#34;&lt;/span&gt;))
            (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-front-ptr!&lt;/span&gt; (cdr front-ptr))
                  front-ptr)))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;print-queue&lt;/span&gt;)
      front-ptr)

    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;dispatch&lt;/span&gt; m)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;empty&lt;/span&gt;) empty-queue?)
            ((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;front&lt;/span&gt;) front-queue)
            ((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;insert&lt;/span&gt;) insert-queue!)
            ((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;delete&lt;/span&gt;) delete-queue!)
            ((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;print&lt;/span&gt;) print-queue)
            (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Unknown queue operation&amp;#34;&lt;/span&gt;))))
    dispatch))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;implementing-the-agenda&#34;&gt;Implementing the agenda&lt;/h3&gt;
&lt;p&gt;Agenda is a list of &lt;em&gt;time segments&lt;/em&gt;. Each time segment is a pair of time and a queue (holds the procedures to be run at that time).&lt;/p&gt;
&lt;p&gt;Recall the signal process of each node, nodes are registered with events, we can insert a small piece of code in each event to push a &lt;em&gt;time segment&lt;/em&gt; behind the agenda queue, so after all events terminate, by checking the agenda we know when these changes happends.&lt;/p&gt;
&lt;p&gt;The problem is when we implement the agenda, we only know the delay of gates. Apropos the delay sequence and the exact time of each event, we have to accumulate the former delays and this elicits a formal problem that we have to maintain a current time variable, and &lt;code&gt;set!&lt;/code&gt; it every time when we push a time segment in the agenda structure.&lt;/p&gt;
&lt;p&gt;First we implememt the agenda structure:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;make-agenda&lt;/span&gt;) (list &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;current-time&lt;/span&gt; agenda) (car agenda))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-current-time!&lt;/span&gt; agenda time)
(set-car! agenda time))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;segments&lt;/span&gt; agenda) (cdr agenda))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-segments!&lt;/span&gt; agenda segments)
(set-cdr! agenda segments))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;first-segment&lt;/span&gt; agenda) (car (&lt;span style=&#34;color:#a6e22e&#34;&gt;segments&lt;/span&gt; agenda)))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rest-segments&lt;/span&gt; agenda) (cdr (&lt;span style=&#34;color:#a6e22e&#34;&gt;segments&lt;/span&gt; agenda)))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-agenda?&lt;/span&gt; agenda)
  (null? (&lt;span style=&#34;color:#a6e22e&#34;&gt;segments&lt;/span&gt; agenda)))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To add an action to an agenda, we first check if the agenda is empty. If so, we create a time segment for the action and install this in the agenda. Otherwise, we scan the agenda, examining the time of each segment. If we find a segment for our appointed time, we add the action to the associated queue. If we reach a time later than the one to which we are
appointed, we insert a new time segment into the agenda just before it. If we reach the end of the agenda, we must ceate a new time segment at the end.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;add-to-agenda!&lt;/span&gt; time action agenda)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;belongs-before?&lt;/span&gt; segments)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;or &lt;/span&gt;(null? segments)
        (&amp;lt; time (&lt;span style=&#34;color:#a6e22e&#34;&gt;segment-time&lt;/span&gt; (car segments)))))
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;make-new-time-segment&lt;/span&gt; time action)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;q&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;make-queue&lt;/span&gt;)))
      (&lt;span style=&#34;color:#a6e22e&#34;&gt;insert-queue!&lt;/span&gt; q action)
      (&lt;span style=&#34;color:#a6e22e&#34;&gt;make-time-segment&lt;/span&gt; time q)))
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;add-to-segments!&lt;/span&gt; segments)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(= (&lt;span style=&#34;color:#a6e22e&#34;&gt;segment-time&lt;/span&gt; (car segments)) time)
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;insert-queue!&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;segment-queue&lt;/span&gt; (car segments))
                       action)
        (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;rest&lt;/span&gt; (cdr segments)))
          (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;belongs-before?&lt;/span&gt; rest)
              (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-cdr!&lt;/span&gt;
               segments
               (cons (&lt;span style=&#34;color:#a6e22e&#34;&gt;make-new-time-segment&lt;/span&gt; time action)
                     (cdr segments)))
              (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-to-segments!&lt;/span&gt; rest)))))
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;segments&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;segments&lt;/span&gt; agenda)))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;belongs-before?&lt;/span&gt; segments)
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-segments!&lt;/span&gt;
         agenda
         (cons (&lt;span style=&#34;color:#a6e22e&#34;&gt;make-new-time-segment&lt;/span&gt; time action)
               segments))
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-to-segments!&lt;/span&gt; segments))))

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;remove-first-agenda-item!&lt;/span&gt; agenda)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;q&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;segment-queue&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;first-segment&lt;/span&gt; agenda))))
    (&lt;span style=&#34;color:#a6e22e&#34;&gt;delete-queue!&lt;/span&gt; q)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-queue?&lt;/span&gt; q)
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-segments!&lt;/span&gt; agenda (&lt;span style=&#34;color:#a6e22e&#34;&gt;rest-segments&lt;/span&gt; agenda)))))

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;first-agenda-item&lt;/span&gt; agenda)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-agenda?&lt;/span&gt; agenda)
      (&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Agenda is empty: FIRST-AGENDA-ITEM&amp;#34;&lt;/span&gt;)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;first-seg&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;first-segment&lt;/span&gt; agenda)))
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-current-time!&lt;/span&gt; agenda
                           (&lt;span style=&#34;color:#a6e22e&#34;&gt;segment-time&lt;/span&gt; first-seg))
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;front-queue&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;segment-queue&lt;/span&gt; first-seg)))))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    <item>
      <title>JOS Lab1 My Answers</title>
      <link>https://xiahualiu.github.io/posts/2019-02-23-jos-lab1/</link>
      <pubDate>Sat, 23 Feb 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-02-23-jos-lab1/</guid>
      <description>&lt;p&gt;The &lt;a href=&#34;https://pdos.csail.mit.edu/6.828/2018/labs/lab1/&#34;&gt;xv6 lab1&lt;/a&gt; provides a extern kernel named JOS, it works in the same way as xv6. So student can step in it to explore the world of xv6.&lt;/p&gt;
&lt;h1 id=&#34;part-2-the-boot-loader&#34;&gt;Part 2: The Boot Loader&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;At what point does the processor start executing 32-bit code? What exactly causes the switch from 16- to 32-bit mode?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: After opening A20 Gate and loading GDT table that is prepared in &lt;code&gt;boot.S&lt;/code&gt;, we enable protected mode by moving a value with &lt;code&gt;$CR0_PE_ON&lt;/code&gt; bit to &lt;code&gt;CR0&lt;/code&gt; register. But the exact activation event happens during &lt;code&gt;ljmp&lt;/code&gt; instruction, while &lt;code&gt;CS&lt;/code&gt; and &lt;code&gt;IP&lt;/code&gt; registers both update and point to the beginning of 32-bit code (which is, however, at the next memory address). CPU works in 32-bit mode after that.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;What is the last instruction of the boot loader executed, and what is the first instruction of the kernel it just loaded?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: The boot loader reads kernel in elf file format from disk, then copies each section into the corresponding location in memory. The last job of bootloader is calling the entry address of the kernel &lt;code&gt;*0x10018&lt;/code&gt;(the entry address is stored at the fixed address in memory because its fixed offset in elf file and is &lt;code&gt;0x0010000c&lt;/code&gt; in this case), transferring control to kernel. And the first instruction is: &lt;code&gt;movw $0x1234,0x472&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Where is the first instruction of the kernel?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: Said above, at &lt;code&gt;0x10000c&lt;/code&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;How does the boot loader decide how many sectors it must read in order to fetch the entire kernel from disk? Where does it find this information?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: The boot loader first reads elf header to get the starting address of program header table &lt;code&gt;ph=ELFHDR + ELFHDR-&amp;gt;e_phoff&lt;/code&gt;, then reads the number of entries in the program header table by &lt;code&gt;ELFHDR-&amp;gt;e_phnum&lt;/code&gt;, then adds it to &lt;code&gt;ph&lt;/code&gt; to acquire the end of the program header table &lt;code&gt;eph&lt;/code&gt;, then loops reading each segment.&lt;/p&gt;
&lt;h2 id=&#34;exercise-5&#34;&gt;Exercise 5&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Trace through the first few instructions of the boot loader again and identify the first instruction that would &amp;ldquo;break&amp;rdquo; or otherwise do the wrong thing if you were to get the boot loader&#39;s link address wrong. Then change the link address in boot/Makefrag to something wrong, run &lt;code&gt;make clean&lt;/code&gt;, recompile the lab with &lt;code&gt;make&lt;/code&gt;, and trace into the boot loader again to see what happens. Don&#39;t forget to change the link address back and &lt;code&gt;make clean&lt;/code&gt; again afterward!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: The boot loader&#39;s entry is at &lt;code&gt;0x7c00&lt;/code&gt; if it is changed to &lt;code&gt;0x7c01&lt;/code&gt; or else that are not aligned right, some &lt;code&gt;nop&lt;/code&gt; will be inserted at the top to slide processor to the aligned instructions.&lt;/p&gt;
&lt;p&gt;After that, the code is executed normally, however, when it comes to the first &lt;code&gt;ljmp&lt;/code&gt;, it crashes immediately. But the real problem happened way ahead, the crash is due to a loading GDT table failure (&lt;code&gt;lgdt&lt;/code&gt; did not complain).&lt;/p&gt;
&lt;p&gt;As we know, we changed the linker address however the load address of our program stays unchanged. The BIOS works blindly, it just reads 1st sector on disk (no matter what link address is) then jumps to &lt;code&gt;0x7c00&lt;/code&gt;. Thus the actual GDT table has still been put at the old place (GDT is always put at &lt;code&gt;0x7c4c&lt;/code&gt; in xv6 case), but into the bootloader, the &lt;code&gt;lgdt&lt;/code&gt; only accepts linker address, which is wrong. So what &lt;code&gt;lgdt&lt;/code&gt; actually installed was meaningless trash in memory after the modification.&lt;/p&gt;
&lt;p&gt;So when the &lt;code&gt;ljmp&lt;/code&gt; reads GDT, it gets trash value instead of real GDT entries. Then the program crashes.&lt;/p&gt;
&lt;h2 id=&#34;exercise-6&#34;&gt;Exercise 6&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;We can examine memory using GDB&#39;s &lt;code&gt;x&lt;/code&gt; command. The GDB manual has full details, but for now, it is enough to know that the command &lt;code&gt;x/Nx ADDR&lt;/code&gt; prints N words of memory at ADDR. (Note that both &lt;code&gt;x&lt;/code&gt;s in the command are lowercase.) Warning: The size of a word is not a universal standard. In GNU assembly, a word is two bytes (the &lt;code&gt;w&lt;/code&gt; in xorw, which stands for word, means 2 bytes).
Reset the machine (exit QEMU/GDB and start them again). Examine the 8 words of memory at &lt;code&gt;0x00100000&lt;/code&gt; at the point the BIOS enters the boot loader, and then again at the point the boot loader enters the kernel. Why are they different? What is there at the second breakpoints? (You do not really need to use QEMU to answer this question. Just think.)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: During the time from the CPU changed into protected mode and to the bootloader starts, &lt;code&gt;0x100000&lt;/code&gt; and higher addresses are of full zeroes.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;The reason is simple, we haven&#39;t mapped the kernel into memory yet at that time.&lt;/p&gt;
&lt;h1 id=&#34;part-3-kernel&#34;&gt;Part 3: Kernel&lt;/h1&gt;
&lt;h2 id=&#34;exercise-7&#34;&gt;Exercise 7&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Use QEMU and GDB to trace into the JOS kernel and stop at the movl %eax, %cr0. Examine memory at 0x00100000 and at 0xf0100000. Now, single step over that instruction using the stepi GDB command. Again, examine memory at 0x00100000 and at 0xf0100000. Make sure you understand what just happened.
What is the first instruction after the new mapping is established that would fail to work properly if the mapping weren&#39;t in place? Comment out the movl %eax, %cr0 in kern/entry.S, trace into it, and see if you were right.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: After &lt;code&gt;movl %eax %cr0&lt;/code&gt;, Memory at &lt;code&gt;0x0010000&lt;/code&gt; was copied to &lt;code&gt;0xf010000&lt;/code&gt;. But the real fact is that these pages are mapped to the same physical memory page.&lt;/p&gt;
&lt;p&gt;If the mapping failed, the jump up to the &lt;code&gt;KERNBASE&lt;/code&gt; would definitely fail.&lt;/p&gt;
&lt;p&gt;We can see that in picture. The program jumped to a null memory, then crashed.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;exercise-8&#34;&gt;Exercise 8&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;We have omitted a small fragment of code - the code necessary to print octal numbers using patterns of the form &amp;ldquo;%o&amp;rdquo;. Find and fill in this code fragment.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: Original file:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;...

&lt;span style=&#34;color:#75715e&#34;&gt;// (unsigned) octal
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
    &lt;span style=&#34;color:#75715e&#34;&gt;// Replace this with your code.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        putch(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;X&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;, putdat);
        putch(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;X&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;, putdat);
        putch(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;X&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;, putdat);
        &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;

...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;New file:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;...

&lt;span style=&#34;color:#75715e&#34;&gt;// (unsigned) octal
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
    &lt;span style=&#34;color:#75715e&#34;&gt;// My code
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        num &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; getuint(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;ap,lflag);
        base &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;goto&lt;/span&gt; number;

...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Be able to answer the following questions:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;Explain the interface between &lt;code&gt;printf.c&lt;/code&gt; and &lt;code&gt;console.c&lt;/code&gt;. Specifically, what function does &lt;code&gt;console.c&lt;/code&gt; export? How is this function used by printf.c?
&lt;strong&gt;Answer&lt;/strong&gt;: &lt;code&gt;console.c&lt;/code&gt; exports high-level I/O by providing three functions, &lt;code&gt;cputchar&lt;/code&gt; &lt;code&gt;getchar&lt;/code&gt; &lt;code&gt;iscons&lt;/code&gt;.
The &lt;code&gt;cputchar&lt;/code&gt; function is used for &lt;code&gt;printf.c&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;Explain the following from &lt;code&gt;console.c&lt;/code&gt;:&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (crt_pos &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CRT_SIZE) {
    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i;
    memmove(crt_buf, crt_buf &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; CRT_COLS, (CRT_SIZE &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; CRT_COLS) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(uint16_t));
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CRT_SIZE &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; CRT_COLS; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; CRT_SIZE; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
        crt_buf[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0700&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;;
    crt_pos &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CRT_COLS;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Prevent screen buffer overflow
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (crt_pos &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CRT_SIZE) {
    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i;
    &lt;span style=&#34;color:#75715e&#34;&gt;// Move all CRT content a column up, vacating the bottom column
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    memmove(crt_buf, crt_buf &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; CRT_COLS, (CRT_SIZE &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; CRT_COLS) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(uint16_t));
    &lt;span style=&#34;color:#75715e&#34;&gt;// Loop printing the bottom line with print attribute: &amp;#39;white on black&amp;#39;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CRT_SIZE &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; CRT_COLS; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; CRT_SIZE; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
        crt_buf[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0700&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;;
    crt_pos &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CRT_COLS;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;For the following questions you might wish to consult the notes for Lecture 2. These notes cover GCC&#39;s calling convention on the x86.
Trace the execution of the following code step-by-step:&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;In the call to cprintf(), to what does &lt;code&gt;fmt&lt;/code&gt; point? To what does &lt;code&gt;ap&lt;/code&gt; point?&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, z &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;;
cprintf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;x %d, y %x, z %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, x, y, z);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;I add this code in &lt;code&gt;init.c&lt;/code&gt;, right after the first &lt;code&gt;cprintf&lt;/code&gt;, seen below:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;i386_init&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
	&lt;span style=&#34;color:#66d9ef&#34;&gt;extern&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; edata[], end[];

	&lt;span style=&#34;color:#75715e&#34;&gt;// Before doing anything else, complete the ELF loading process.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Clear the uninitialized global data (BSS) section of our program.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// This ensures that all static/global variables start out zero.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	memset(edata, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, end &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; edata);

	&lt;span style=&#34;color:#75715e&#34;&gt;// Initialize the console.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Can&amp;#39;t call cprintf until after we do this!
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	cons_init();

	cprintf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;6828 decimal is %o octal!&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;6828&lt;/span&gt;);

	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, z &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;;
	cprintf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;x %d, y %x, z %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, x, y, z);

	&lt;span style=&#34;color:#75715e&#34;&gt;// Test the stack backtrace function (lab 1 only)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	test_backtrace(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;);

	&lt;span style=&#34;color:#75715e&#34;&gt;// Drop into the kernel monitor.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
		monitor(NULL);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;fmt&lt;/code&gt; points to a memory that is in &lt;code&gt;.rodata&lt;/code&gt; section. And the content is the format string &lt;code&gt;x %d, y %x, z %d\n\0&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;I disassembled the kernel and found out that &lt;code&gt;ap&lt;/code&gt; pointed to the args that had been pushed to stack before calling &lt;code&gt;vcprintf&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;+-------------+
| 00 00 00 04 |
+-------------+
| 00 00 00 03 |
+-------------+
| 00 00 00 01 |
+-------------+ &amp;lt;--- ap
| f0 10 1a 92 |
+-------------+ &amp;lt;--- fmt
| f0 10 00 fa |
+-------------+ 
|             |
+-------------+
|             | 
     STACK
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;List (in order of execution) each call to &lt;code&gt;cons_putc&lt;/code&gt;, &lt;code&gt;va_arg&lt;/code&gt;, and &lt;code&gt;vcprintf&lt;/code&gt;. For &lt;code&gt;cons_putc&lt;/code&gt;, list its argument as well. For &lt;code&gt;va_arg&lt;/code&gt;, list what &lt;code&gt;ap&lt;/code&gt; points to before and after the call. For &lt;code&gt;vcprintf&lt;/code&gt; list the values of its two arguments.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: List: After print &amp;ldquo;x &amp;ldquo;, &lt;code&gt;getint&lt;/code&gt; was called, in which &lt;code&gt;va_arg&lt;/code&gt; was called. Before the calling &lt;code&gt;ap = (va_list) 0xf010ffd4 &amp;quot;\001&amp;quot;&lt;/code&gt;, after the calling &lt;code&gt;ap = (va_list) 0xf010ffd8 &amp;quot;\003&amp;quot;&lt;/code&gt;. Then &lt;code&gt;cons_putc(c=49)&lt;/code&gt; was called, output changed to &amp;ldquo;x 1&amp;rdquo;. Then &lt;code&gt;cons_putc(c=44)&lt;/code&gt; was called, output changed to &amp;ldquo;x 1,&amp;quot;. Then &lt;code&gt;cons_putc(c=32)&lt;/code&gt; was called, output changed to &amp;ldquo;x 1, &amp;ldquo;. Then &lt;code&gt;cons_putc(c=121)&lt;/code&gt; was called, output changed to &amp;ldquo;x 1, y&amp;rdquo;&amp;hellip; It worked in this sequence till finishing printing.&lt;/p&gt;
&lt;p&gt;For two arguments of &lt;code&gt;vcprintf&lt;/code&gt; see picture above.&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;Run the following code.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00646c72&lt;/span&gt;;
    cprintf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;H%x Wo%s&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;57616&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;i);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;What is the output? Explain how this output is arrived at in the step-by-step manner of the previous exercise.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Output&lt;/strong&gt;: He110 World!&lt;/p&gt;
&lt;p&gt;Decimal 57616 equals hexadecimal number 0xe110, so the first number was &amp;ldquo;e110&amp;rdquo;. And because i386 use little-endian, &lt;code&gt;0x00646c7c&lt;/code&gt; in little-endian byte order was&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xf010ffec&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x72&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x6c&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x64&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can translate it into string: &lt;code&gt;rld/0&lt;/code&gt;&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;In the following code, what is going to be printed after &amp;lsquo;y=&amp;rsquo;? (note: the answer is not a specific value.) Why does this happen?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;    cprintf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;x=%d y=%d&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Because we use &lt;code&gt;va_list&lt;/code&gt; pointer &lt;code&gt;ap&lt;/code&gt; to run down stack to acquire args that were pushed beforehand in the order from right to left in &lt;code&gt;cprintf&lt;/code&gt;. When &amp;lsquo;3&amp;rsquo; was read by &lt;code&gt;getint&lt;/code&gt; function, &lt;code&gt;va_arg&lt;/code&gt; moves pointer &lt;code&gt;ap&lt;/code&gt; upwards for the next arg, whereas we do not have another arg, instead it is an &lt;code&gt;ret&lt;/code&gt; address for &lt;code&gt;call &amp;lt;i386_init&amp;gt;&lt;/code&gt;, so the next &lt;code&gt;%d&lt;/code&gt; prints an address value.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;+-------------+
| 00 00 00 00 |
+-------------+
| f0 10 ff ec |
+-------------+ &amp;lt;--- ap (y=0xf010ffec)
| 00 00 00 03 |
+-------------+ &amp;lt;--- ap (x=3)
| f0 10 1a ce |
+-------------+ &amp;lt;--- fmt
| f0 10 01 2a |
+-------------+
|             | 
     STACK
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;To confirm my speculation, I replaced the second &lt;code&gt;y=%d&lt;/code&gt; with &lt;code&gt;y=%x&lt;/code&gt;, and here it goes:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;p&gt;Just like above.&lt;/p&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;Let&#39;s say that GCC changed its calling convention so that it pushed arguments on the stack in declaration order, so that the last argument is pushed last. How would you have to change cprintf or its interface so that it would still be possible to pass it a variable number of arguments?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: We can make &lt;code&gt;va_list&lt;/code&gt; pointer &lt;code&gt;ap&lt;/code&gt; points to the highest arg on stack before entering &lt;code&gt;vcprintf&lt;/code&gt;, then modify &lt;code&gt;va_arg&lt;/code&gt; to decrease &lt;code&gt;ap&lt;/code&gt; instead of increase it.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Challenge&lt;/strong&gt; Enhance the console to allow text to be printed in different colors. The traditional way to do this is to make it interpret ANSI escape sequences embedded in the text strings printed to the console, but you may use any mechanism you like. There is plenty of information on the 6.828 reference page and elsewhere on the web on programming the VGA display hardware. If you&#39;re feeling really adventurous, you could try switching the VGA hardware into a graphics mode and making the console draw text onto the graphical frame buffer.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: &lt;em&gt;Too complex, to be solved.&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;the-stack&#34;&gt;The Stack&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Exercise 9&lt;/strong&gt;. Determine where the kernel initializes its stack, and exactly where in memory its stack is located. How does the kernel reserve space for its stack? And at which &amp;ldquo;end&amp;rdquo; of this reserved area is the stack pointer initialized to point to?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: In file &amp;ldquo;entry.S&amp;rdquo;,&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86_asm&#34; data-lang=&#34;x86_asm&#34;&gt;	# Set the stack pointer
	movl	$(bootstacktop),%esp
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;$(bootstacktop)&lt;/code&gt; is defined the end of &amp;ldquo;entry.S&amp;rdquo;, it is &lt;code&gt;KSTKSIZE&lt;/code&gt; away from the beginning of &lt;code&gt;.data&lt;/code&gt; section.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86_asm&#34; data-lang=&#34;x86_asm&#34;&gt;.data
###################################################################
# boot stack
###################################################################
	.p2align	PGSHIFT		# force page alignment
	.globl		bootstack
bootstack:
	.space		KSTKSIZE
	.globl		bootstacktop   
bootstacktop:
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Exercise 10&lt;/strong&gt;. To become familiar with the C calling conventions on the x86, find the address of the test_backtrace function in obj/kern/kernel.asm, set a breakpoint there, and examine what happens each time it gets called after the kernel starts. How many 32-bit words does each recursive nesting level of test_backtrace push on the stack, and what are those words?
Note that, for this exercise to work properly, you should be using the patched version of QEMU available on the tools page or on Athena. Otherwise, you&#39;ll have to manually translate all breakpoint and memory addresses to linear addresses.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: Every level of nesting, push 8 words on stack.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>xv6 Basics - Page Tables</title>
      <link>https://xiahualiu.github.io/posts/2019-02-06-xv6-paging-table/</link>
      <pubDate>Wed, 06 Feb 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-02-06-xv6-paging-table/</guid>
      <description>&lt;p&gt;&lt;strong&gt;Paging tables are the mechanism through which the operating system controls what memory address means.&lt;/strong&gt; They allow xv6 to multiplex the address spaces of different processes onto a single physical memory, and to protect the memories of different processes. The level of indirection provided by page tables allows many neat tricks. xv6 uses page tables primarily to multiplex address spaces and to protect memory.&lt;/p&gt;
&lt;p&gt;It also uses a few simple page-table tricks:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Mapping the same memory (the kernel) in several address spaces.&lt;/li&gt;
&lt;li&gt;Mapping the same memory more than once in one address space. (Each user page is also mapped into the kernel&#39;s physical view of memory)&lt;/li&gt;
&lt;li&gt;Guarding a user stack with an ummapped page.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;paging-hardware&#34;&gt;Paging hardware&lt;/h1&gt;
&lt;p&gt;As a reminder, x86 instructions (both user and kernel) manipulate virtual addresses. The mechine&#39;s RAM, or physical memory, is indexed with physical addresses.&lt;/p&gt;
&lt;p&gt;The x86 page table hardware connects these two kinds of addresses, by mapping each virtual address to a physical address.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;   10      10          12          |     PPN     | Offset |  
|-------|---------|----------|            ^
|  Dir  |  Table  |  Offset  |        20  |          12
|-------|----|----|----------|     |------|------|-------|
    |        |--------------------&amp;gt;|     PPN     | Flags |
    |                              |-------------|-------|
    |         20       10          |             |       |
    |     |---------|-------|      |-------------|-------|
    |     |         |       |      |             |       |
    |     |---------|-------|      |-------------|-------|
    |----&amp;gt;|   PPN   | Flags |-------&amp;gt;     Page Table
          |---------|-------|         2^10(1024) entries
          |         |       |              (PTEs)
          |---------|-------|
 |CR3|---&amp;gt;   Page Directory
           2^10(1024) entries
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;According to CSAPP, xv6 uses paging harware that support 2-level paging.&lt;/p&gt;
&lt;p&gt;We use first top 10 bits to index page directory, and fetch the 20 bits PPN to index the Page table, and use the second 10 bits to index PPN in page table.&lt;/p&gt;
&lt;p&gt;An x86 page table is logically an array of 2^20 (1,048,576) page table entries. Thus a page table gives table gives the operating system control over virtual-to-physical address translations at the granularity of aligned chunks of 4096 (2^12) bytes. Such a chunk is called a page.&lt;/p&gt;
&lt;p&gt;Each PTE contains &lt;strong&gt;flag bits&lt;/strong&gt; that tell the paging hardware how the associated virtual address is allowed to be used:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;|31                    |12   |8   |6  |5  |4   |3   |2  |1  |0  |
|----------------------|-----|----|---|---|----|----|---|---|---|
| Physical Page Number | AVL |    | D | A | CD | WT | U | W | P |
                          |         |   |   |    |    |    |   |---- P - Present
                          |         |   |   |    |    |    |-------- W - Writable
                          |         |   |   |    |    |------------- U - User
                          |         |   |   |    |----------------- WT - 1=Write-through, 0=Write-back
                          |         |   |   |---------------------- CD - Cache Disabled
                          |         |   |--------------------------- A - Accessed
                          |         |------------------------------- D - Dirty (0 in page directory)
                          |--------------------------------------- AVL - Available for system use

Page table and page directory entries are identical except for the D bits
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;PTE_P&lt;/code&gt; indicates whether the PTE is present: if it is not set, a reference to the page causes a fault.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PTE_W&lt;/code&gt; controls whether instructions are allows to issue writes to the page; if not set, only reads and instructions fetches are allowed.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PTE_U&lt;/code&gt; controls whether the user programs are allowed to use the page; if clear, only kernel is allowed to use the page.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The flags and all other page hardware related structures are defined in &lt;code&gt;mmu.h&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id=&#34;process-address-space&#34;&gt;Process address space&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://xiahua.blog/2019/01/29/2019-1-29-paging/&#34;&gt;The &lt;code&gt;entry.S&lt;/code&gt; provided a primal memory layout for the kernel&lt;/a&gt;. The two entries we created map virtual address &lt;code&gt;0:0x400000&lt;/code&gt; to physical address &lt;code&gt;0:0x400000&lt;/code&gt; as well as &lt;code&gt;KERNBASE:KERNBASE+0x400000&lt;/code&gt; to &lt;code&gt;0:0x400000&lt;/code&gt;. It is quite elaborately designed because the bootloader can only get access to physical addresses, whereas the kernel only uses virtual addresses. To prevent the &lt;code&gt;entry.S&lt;/code&gt; program breaking down, we assigned two different virtual address pages to the same physical address page. So the &lt;code&gt;jmp&lt;/code&gt; need to be an indirect jump.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;memory_layout.png&#34; alt=&#34;Figure 2-2. Layout of the virtual address space of a process and the layout of the physical address space. Note that if a machine has more than 2 Gbyte of physical memory, xv6 can use only the memory that fits between KERNBASE and 0xFE00000.&#34;&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define KERNBASE 0x80000000&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;But once we start the process, a more elaborate plan for describing process address space is required. And this turns to be the standard memory layout of the xv6 system. As we can see in the Figure 2-2.&lt;/p&gt;
&lt;h2 id=&#34;0kernbase&#34;&gt;0:KERNBASE&lt;/h2&gt;
&lt;p&gt;This area which addressed up to 2 gigabytes is reserved for the user process. That means one process can use 2 gigabytes of memory for the most. The structure of this area is familiar to the most programmers, including user text, user data, user stack, etc. The user programs use
them to do tasks on computer.&lt;/p&gt;
&lt;p&gt;This area is not mapped to physical memory at first because the entries are dynamically created, which means only when the program needs to use memory, the corresponding entries are created by kernel and linking the virtual pages with vacant physical pages. At first, there is no process being, so there is no entry in this area.&lt;/p&gt;
&lt;h2 id=&#34;kernbase0xffffffff&#34;&gt;KERNBASE:0xFFFFFFFF&lt;/h2&gt;
&lt;p&gt;Above &lt;code&gt;KERNBASE&lt;/code&gt; sits the kernel. And in this area, entries are all created with a simple mapping rule, which shown in &lt;code&gt;memlayout.h&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define V2P_WO(x) ((x) - KERNBASE)    &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// same as V2P, but without casts
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That means, in this area, virtual pages and physical pages are 1:1 mapped except for an offset &lt;code&gt;KERNBASE&lt;/code&gt;. Why?&lt;/p&gt;
&lt;p&gt;The advantage of this is that the kernel can manipulate the physical memory easily. The kernal can see the whole world including all processes&amp;rsquo; page tables.&lt;/p&gt;
&lt;p&gt;Xv6 does not set the PTE_U flag in the PTEs above KERNBASE, so only the kernel can use them.&lt;/p&gt;
&lt;p&gt;Having every processs page table contain mappings for both user memory and the entire kernel is convenient when switching from user code to kernel code during system calls and interrupts: such switches do not require page table switches. For the most part the kernel does not have its own page table; it is almost always borrowing some processs page table.&lt;/p&gt;
&lt;p&gt;To review, xv6 ensures that each process can use only its own memory. And, each process sees its memory as having contiguous virtual addresses starting at zero, while the processs physical memory can be non-contiguous. xv6 implements the first by setting the PTE_U bit only on PTEs of virtual addresses that refer to the processs own memory. It implements the second using the ability of page tables to translate successive virtual addresses to whatever physical pages happen to be allocated to the process.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;PHYSTOP&lt;/code&gt; in the physical memory show the maximum address of the physical address. However, the memory-mapped I/O devices occupy the addresses from &lt;code&gt;0xFE000000&lt;/code&gt; to &lt;code&gt;0xFFFFFFFF&lt;/code&gt;. Memory in between &lt;code&gt;PHYSTOP&lt;/code&gt; and &lt;code&gt;0xFE000000&lt;/code&gt; does not exist, and cannot be accessed.&lt;/p&gt;
&lt;h1 id=&#34;code-comments&#34;&gt;Code comments&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;main&lt;/code&gt; calls &lt;code&gt;kvmalloc&lt;/code&gt; to create and switch to a page table with the mappings above &lt;code&gt;KERNBASE&lt;/code&gt; required for the kernel to run.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Do remember the &lt;code&gt;%esp&lt;/code&gt; pointer is well prepared right a moment ago. In &lt;code&gt;entry.S&lt;/code&gt; we allocated a per-process kernel stack (4096 bytes) in the kernel. So the next call will store address in the kernel stack, just like an process that just has been trapped in the kernel.&lt;/p&gt;
&lt;p&gt;Jump into &lt;code&gt;kvmalloc&lt;/code&gt;: &lt;code&gt;vm.c.138:145&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Allocate one page table for the machine for the kernel address
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// space for scheduler processes.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;kvmalloc&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  kpgdir &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; setupkvm();
  switchkvm();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;kpgdir&lt;/code&gt; is the directory of kernel program pages. It is defined above in &lt;code&gt;vm.c&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; uint pde_t;
pde_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;kpgdir;  &lt;span style=&#34;color:#75715e&#34;&gt;// for use in scheduler()
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As far we don&#39;t know what is a &lt;code&gt;scheduler&lt;/code&gt;, but we just know &lt;code&gt;kpgdir&lt;/code&gt; is an entry pointer and  it is global in kernel.&lt;/p&gt;
&lt;p&gt;Jump into &lt;code&gt;setupkvm&lt;/code&gt;, where the most work is done.&lt;code&gt;vm.c.117:136&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Set up kernel part of a page table.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;pde_t&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;setupkvm&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  pde_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pgdir;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; kmap &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;k;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;((pgdir &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (pde_t&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)kalloc()) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
  memset(pgdir, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, PGSIZE);
  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (P2V(PHYSTOP) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)DEVSPACE)
    panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;PHYSTOP too high&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(k &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; kmap; k &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmap[NELEM(kmap)]; k&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(mappages(pgdir, k&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;virt, k&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;phys_end &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; k&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;phys_start,
                (uint)k&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;phys_start, k&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;perm) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) {
      freevm(pgdir);
      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    }
  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; pgdir;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;first we allocate a 4096 bytes page in physical memory, and clear it totally.&lt;/p&gt;
&lt;p&gt;Then xv6 uses a static &lt;code&gt;struct kmap&lt;/code&gt; array to represent the layout of the kernel virtual pages: &lt;code&gt;vm.c.103:115&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// This table defines the kernel&amp;#39;s mappings, which are present in
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// every process&amp;#39;s page table.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; kmap {
  &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;virt;
  uint phys_start;
  uint phys_end;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; perm;
} kmap[] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {
 { (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)KERNBASE, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,             EXTMEM,    PTE_W}, &lt;span style=&#34;color:#75715e&#34;&gt;// I/O space
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt; { (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)KERNLINK, V2P(KERNLINK), V2P(data), &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;},     &lt;span style=&#34;color:#75715e&#34;&gt;// kern text+rodata
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt; { (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)data,     V2P(data),     PHYSTOP,   PTE_W}, &lt;span style=&#34;color:#75715e&#34;&gt;// kern data+memory
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt; { (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)DEVSPACE, DEVSPACE,      &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,         PTE_W}, &lt;span style=&#34;color:#75715e&#34;&gt;// more devices
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;};
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The four entries in &lt;code&gt;kmap[]&lt;/code&gt; correspond to the 4 areas  above &lt;code&gt;KERNBASE&lt;/code&gt; in Figure 2.2.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mappages&lt;/code&gt; installs the translations that are described in &lt;code&gt;kmap&lt;/code&gt; array in page directory. &lt;code&gt;vm.c.57:80&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Create PTEs for virtual addresses starting at va that refer to
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// physical addresses starting at pa. va and size might not
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// be page-aligned.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;mappages&lt;/span&gt;(pde_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pgdir, &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;va, uint size, uint pa, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; perm)
{
  &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;a, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;last;
  pte_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pte;

  a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)PGROUNDDOWN((uint)va);
  last &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)PGROUNDDOWN(((uint)va) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; size &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(;;){
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;((pte &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; walkpgdir(pgdir, a, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pte &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; PTE_P)
      panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;remap&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pte &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pa &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; perm &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_P;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; last)
      &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
    a &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PGSIZE;
    pa &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PGSIZE;
  }
  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In &lt;code&gt;mappages&lt;/code&gt;, we use &lt;code&gt;walkpgdir&lt;/code&gt; function to find the right page of given virtual address (needs to be rounded down to page borders). &lt;code&gt;vm.c.32:55&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Return the address of the PTE in page table pgdir
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// that corresponds to virtual address va.  If alloc!=0,
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// create any required page table pages.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; pte_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;walkpgdir&lt;/span&gt;(pde_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pgdir, &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;va, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; alloc)
{
  pde_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pde;
  pte_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pgtab;

  pde &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;pgdir[PDX(va)];  &lt;span style=&#34;color:#75715e&#34;&gt;// Get first 10 bits of va, and index page directory entry
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pde &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; PTE_P){ &lt;span style=&#34;color:#75715e&#34;&gt;// If the page directory entry present
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    pgtab &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (pte_t&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)P2V(PTE_ADDR(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pde)); &lt;span style=&#34;color:#75715e&#34;&gt;// Get the first 20 bits of *pde, and index page table
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;alloc &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (pgtab &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (pte_t&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)kalloc()) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    &lt;span style=&#34;color:#75715e&#34;&gt;// Make sure all those PTE_P bits are zero.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    memset(pgtab, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, PGSIZE);
    &lt;span style=&#34;color:#75715e&#34;&gt;// The permissions here are overly generous, but they can
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// be further restricted by the permissions in the page table
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// entries, if necessary.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pde &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; V2P(pgtab) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_P &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_W &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_U;
  }
  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;pgtab[PTX(va)];
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The interesting part is in &lt;code&gt;walkpgdir&lt;/code&gt;, it mimics the actions of the x86 paging hardware as it looks up the PTE for a virtual address. walkpgdir uses the upper 10 bits of the virtual address to find the page directory entry. If the page directory entry isnt present, then the required page table page hasnt yet been allocated; if the &lt;code&gt;alloc&lt;/code&gt; argument is set, walkpgdir allocates it and puts its physical address in the page directory. Finally it uses the next 10 bits of the virtual address to find the address of the PTE in the page table page.&lt;/p&gt;
&lt;h1 id=&#34;physical-memory-allocation&#34;&gt;Physical memory allocation&lt;/h1&gt;
&lt;p&gt;We said &lt;code&gt;kalloc&lt;/code&gt; again and again. When the xv6 works, we need to allocate and free physical memory dynamically.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The kernel must allocate and free physical memory at run-time for page tables, process user memory, kernel stacks, and pipe buffers.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The way &lt;code&gt;kalloc&lt;/code&gt; manages memory does not involve with a lot of optimization here. There is a list of all the physical memory pages and &lt;code&gt;kalloc&lt;/code&gt; keeps track of them.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;There is a bootstrap problem: all of physical memory must be mapped in order for the allocator to initialize the free list, but creating a page table with those mappings involves allocating page-table pages. xv6 solves this problem by using a separate page allocator during entry, which allocates memory just after the end of the kernels data segment. This allocator does not support freeing and is limited by the 4 MB mapping in the &lt;code&gt;entrypgdir&lt;/code&gt;, but that is sufficient to allocate the first kernel page table.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;code-physical-memory-allocator&#34;&gt;Code: Physical memory allocator&lt;/h2&gt;
&lt;p&gt;This part is a little difficult to understand, xv6 use a &lt;em&gt;free list&lt;/em&gt; to implement allocation, which is the simplest way. &lt;code&gt;kalloc.c.79:95&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Allocate one 4096-byte page of physical memory.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Returns a pointer that the kernel can use.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Returns 0 if the memory cannot be allocated.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;kalloc&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; run &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;r;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(kmem.use_lock)
    acquire(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock);
  r &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; kmem.freelist;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(r)
    kmem.freelist &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; r&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;next;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(kmem.use_lock)
    release(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock);
  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)r;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Free list strategy does not have the best allocation performance, however it is the simplest way.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The function main calls &lt;code&gt;kinit1&lt;/code&gt; and &lt;code&gt;kinit2&lt;/code&gt; to initialize the allocator. The reason for having two calls is that for much of main one cannot use locks or memory above 4 megabytes. The call to &lt;code&gt;kinit1&lt;/code&gt; sets up for lock-less allocation in the first 4 megabytes, and the call to kinit2 enables locking and arranges for more memory to be allocatable. main ought to determine how much physical memory is available, but this turns out to be difficult on the x86. Instead it assumes that the machine has 224 megabytes (PHYSTOP) of physical memory, and uses all the memory between the end of the kernel and &lt;code&gt;PHYSTOP&lt;/code&gt; as the initial pool of free memory. &lt;code&gt;kinit1&lt;/code&gt; and &lt;code&gt;kinit2&lt;/code&gt; call &lt;code&gt;freerange&lt;/code&gt; to add memory to the free list via per-page calls to &lt;code&gt;kfree&lt;/code&gt;. A PTE can only refer to a physical address that is aligned on a 4096-byte boundary (is a multiple of 4096), so &lt;code&gt;freerange&lt;/code&gt; uses &lt;code&gt;PGROUNDUP&lt;/code&gt; to ensure that it frees only aligned physical addresses. The allocator starts with no memory; these calls to &lt;code&gt;kfree&lt;/code&gt; give it some to manage.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;kalloc.c.26:44&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Initialization happens in two phases.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 1. main() calls kinit1() while still using entrypgdir to place just
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// the pages mapped by entrypgdir on free list.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 2. main() calls kinit2() with the rest of the physical pages
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// after installing a full page table that maps them on all cores.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;kinit1&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;vstart, &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;vend)
{
  initlock(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock, &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;kmem&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
  kmem.use_lock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
  freerange(vstart, vend);
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;kinit2&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;vstart, &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;vend)
{
  freerange(vstart, vend);
  kmem.use_lock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The function &lt;code&gt;kfree&lt;/code&gt; begins by setting every byte in the memory being freed
to the value 1. This will cause code that uses memory after freeing it (uses dangling
references) to read garbage instead of the old valid contents; hopefully that will cause
such code to break faster. &lt;code&gt;kalloc.c.54:77&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//PAGEBREAK: 21
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Free the page of physical memory pointed at by v,
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// which normally should have been returned by a
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// call to kalloc().  (The exception is when
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// initializing the allocator; see kinit above.)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;kfree&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;v)
{
  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; run &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;r;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;((uint)v &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; PGSIZE &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; v &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; end &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; V2P(v) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PHYSTOP)
    panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;kfree&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);

  &lt;span style=&#34;color:#75715e&#34;&gt;// Fill with junk to catch dangling refs.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  memset(v, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, PGSIZE);

  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(kmem.use_lock)
    acquire(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock);
  r &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; run&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)v;
  r&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;next &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; kmem.freelist;
  kmem.freelist &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; r;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(kmem.use_lock)
    release(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;user-address-space&#34;&gt;User address space&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;user.png&#34; alt=&#34;Figure 2-3. Memory layout of a user process with its initial stack.&#34;&gt;&lt;/p&gt;
&lt;p&gt;The program text and data segment start at virtual address 0 and end with a guard page. The guard page is not mapped so when the stack runs out, the hardware will throw an exception.&lt;/p&gt;
&lt;p&gt;The initial content of stack is created by &lt;code&gt;exec&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id=&#34;code-sbrk&#34;&gt;Code: sbrk&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;sbrk&lt;/code&gt; is the system call for a process to shrink or grow its memory. The system call is implemented by the function &lt;code&gt;growproc&lt;/code&gt;. If &lt;code&gt;n&lt;/code&gt; is postive, &lt;code&gt;growproc&lt;/code&gt; allocates one or more physical pages and maps them at the top of the processs address space. If &lt;code&gt;n&lt;/code&gt; is negative, &lt;code&gt;growproc&lt;/code&gt; unmaps one or more pages from the processs address space and frees the corresponding physical pages. To make these changes, xv6 modifies the processs page table. The processs page table is stored in memory, and so the kernel can update the table with ordinary assignment statements, which is what &lt;code&gt;allocuvm&lt;/code&gt; and &lt;code&gt;deallocuvm&lt;/code&gt; do.&lt;/p&gt;
&lt;p&gt;The x86 hardware caches page table entries in a Translation Lookaside Buffer (TLB), and when xv6 changes the page tables, it must invalidate the cached entries. If it didnt invalidate the cached entries, then at some point later the TLB might use an old mapping, pointing to a physical page that in the mean time has been allocated to another process, and as a result, a process might be able to scribble on some other processs memory. Xv6 invalidates stale cached entries, by reloading &lt;code&gt;cr3&lt;/code&gt;, the register that holds the address of the current page table.&lt;/p&gt;
&lt;h1 id=&#34;code-exec&#34;&gt;Code: exec&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;exec&lt;/code&gt; allocates a new page table with no user mappings with &lt;code&gt;setupkvm&lt;/code&gt;, allocates memory for each ELF segment with &lt;code&gt;allocuvm&lt;/code&gt;, and loads each segment into
memory with &lt;code&gt;loaduvm&lt;/code&gt;. &lt;code&gt;allocuvm&lt;/code&gt; checks that the virtual addresses requested is
below &lt;code&gt;KERNBASE&lt;/code&gt;. &lt;code&gt;loaduvm&lt;/code&gt; uses &lt;code&gt;walkpgdir&lt;/code&gt; to find the physical address of the allocated memory at which to write each page of the ELF segment, and &lt;code&gt;readi&lt;/code&gt; to read
from the file.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;During the preparation of the new memory image, if exec detects an error like an invalid program segment, it jumps to the label bad, frees the new image, and returns 1. Exec must wait to free the old image until it is sure that the system call will succeed: if the old image is gone, the system call cannot return 1 to it. The only error cases in exec happen during the creation of the image. Once the image is complete, exec can install the new image (6701) and free the old one (6702). Finally, exec returns 0.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;real-world&#34;&gt;Real World&lt;/h1&gt;
&lt;p&gt;The following content come directly from xv6 textbook, which is worth reading.&lt;/p&gt;
&lt;p&gt;Like most operating systems, xv6 uses the paging hardware for memory protection and mapping. Most operating systems use x86s 64-bit paging hardware (which has 3 levels of translation). 64-bit address spaces allow for a less restrictive memory layout than xv6s; for example, it would be easy to remove xv6s limit of 2 gigabytes for physical memory. Most operating systems make far more sophisticated use of paging than xv6; for example, xv6 lacks demand paging from disk, copy-on-write fork, shared memory, lazily-allocated pages, and automatically extending stacks. The x86 supports address translation using segmentation (see Appendix B), but xv6 uses segments only for the common trick of implementing per-cpu variables such as proc that are at a fixed address but have different values on different CPUs (see seginit). Implementations of per-CPU (or per-thread) storage on non-segment architectures would dedicate a register to holding a pointer to the per-CPU data area, but the x86 has so few general registers that the extra effort required to use segmentation is worthwhile.&lt;/p&gt;
&lt;p&gt;Xv6 maps the kernel in the address space of each user process but sets it up so that the kernel part of the address space is inaccessible when the processor is in user mode. This setup is convenient because after a process switches from user space to kernel space, the kernel can easily access user memory by reading memory locations directly. It is probably better for security, however, to have a separate page table for the kernel and switch to that page table when entering the kernel from user mode, so that the kernel and user processes are more separated from each other. This design, for example, would help mitigating side-channels that are exposed by the Meltdown vulnerability and that allow a user process to read arbitrary kernel memory.&lt;/p&gt;
&lt;p&gt;On machines with lots of memory it might make sense to use the x86s 4-megabytes super pages. Small pages make sense when physical memory is small, to allow allocation and page-out to disk with fine granularity. For example, if a program uses only 8 kilobytes of memory, giving it a 4 megabytes physical page is wasteful. Larger pages make sense on machines with lots of RAM, and may reduce overhead for page-table manipulation. Xv6 uses super pages in one place: the initial page table. The array initialization sets two of the 1024 PDEs, at indices zero and 512 (&lt;code&gt;KERNBASE&amp;gt;&amp;gt;PDXSHIFT&lt;/code&gt;), leaving the other PDEs zero. Xv6 sets the PTE_PS bit in these two PDEs to mark them as super pages. The kernel also tells the paging hardware to allow super pages by setting the &lt;code&gt;CR_PSE&lt;/code&gt; bit (Page Size Extension) in &lt;code&gt;%cr4&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Xv6 should determine the actual RAM configuration, instead of assuming 224 MB. On the x86, there are at least three common algorithms: the first is to probe the physical address space looking for regions that behave like memory, preserving the values written to them; the second is to read the number of kilobytes of memory out of a known 16-bit location in the PCs non-volatile RAM; and the third is to look in BIOS memory for a memory layout table left as part of the multiprocessor tables. Reading the memory layout table is complicated.&lt;/p&gt;
&lt;p&gt;Memory allocation was a hot topic a long time ago, the basic problems being efficient use of limited memory and preparing for unknown future requests; see Knuth. Today people care more about speed than space-efficiency. In addition, a more elaborate kernel would likely allocate many different sizes of small blocks, rather than (as in xv6) just 4096-byte blocks; a real kernel allocator would need to handle small allocations as well as large ones.&lt;/p&gt;</description>
    </item>
    <item>
      <title>xv6 Chapter 4 - Creating the First Process</title>
      <link>https://xiahualiu.github.io/posts/2019-02-03-xv6-first-process/</link>
      <pubDate>Sun, 03 Feb 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-02-03-xv6-first-process/</guid>
      <description>&lt;p&gt;There goes the main part of xv6. Xv6 souce code provided a really clear view of each component of the kernel. All parts are shown below: &lt;code&gt;main.c:14-38&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;In this chapter, we will go through the sub-function &lt;code&gt;userinit&lt;/code&gt;, in which we initialize the memory for a user process, and create the first process.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Bootstrap processor starts running C code here.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Allocate a real stack and switch to it, first
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// doing some setup required for memory allocator to work.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  kinit1(end, P2V(&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;)); &lt;span style=&#34;color:#75715e&#34;&gt;// phys page allocator
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  kvmalloc();      &lt;span style=&#34;color:#75715e&#34;&gt;// kernel page table
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  mpinit();        &lt;span style=&#34;color:#75715e&#34;&gt;// detect other processors
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  lapicinit();     &lt;span style=&#34;color:#75715e&#34;&gt;// interrupt controller
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  seginit();       &lt;span style=&#34;color:#75715e&#34;&gt;// segment descriptors
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  picinit();       &lt;span style=&#34;color:#75715e&#34;&gt;// disable pic
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  ioapicinit();    &lt;span style=&#34;color:#75715e&#34;&gt;// another interrupt controller
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  consoleinit();   &lt;span style=&#34;color:#75715e&#34;&gt;// console hardware
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  uartinit();      &lt;span style=&#34;color:#75715e&#34;&gt;// serial port
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  pinit();         &lt;span style=&#34;color:#75715e&#34;&gt;// process table
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  tvinit();        &lt;span style=&#34;color:#75715e&#34;&gt;// trap vectors
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  binit();         &lt;span style=&#34;color:#75715e&#34;&gt;// buffer cache
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  fileinit();      &lt;span style=&#34;color:#75715e&#34;&gt;// file table
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  ideinit();       &lt;span style=&#34;color:#75715e&#34;&gt;// disk 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  startothers();   &lt;span style=&#34;color:#75715e&#34;&gt;// start other processors
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  kinit2(P2V(&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;), P2V(PHYSTOP)); &lt;span style=&#34;color:#75715e&#34;&gt;// must come after startothers()
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  userinit();      &lt;span style=&#34;color:#75715e&#34;&gt;// first user process
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  mpmain();        &lt;span style=&#34;color:#75715e&#34;&gt;// finish this processor&amp;#39;s setup
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;userinit&lt;/code&gt;&#39;s first action is to call &lt;code&gt;allocproc&lt;/code&gt;. Go to the definition of it, we can see &lt;code&gt;allocproc&lt;/code&gt; do several things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;allocating a slot (&lt;code&gt;struct proc&lt;/code&gt;) in process table. &lt;code&gt;allocproc&lt;/code&gt; scans the proc table for a slot with state &lt;code&gt;UNUSED&lt;/code&gt;. &lt;code&gt;proc.c:69-83&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Look in the process table for an UNUSED proc.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// If found, change state to EMBRYO and initialize
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// state required to run in the kernel.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Otherwise return 0.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; proc&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;allocproc&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; proc &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;p;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;sp;

  acquire(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;ptable.lock);

  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ptable.proc; p &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;ptable.proc[NPROC]; p&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;state &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; UNUSED)
      &lt;span style=&#34;color:#66d9ef&#34;&gt;goto&lt;/span&gt; found;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;initializing the parts of process&#39;s state required for its kernel thread to execute. It sets the state to &lt;code&gt;EMBRYO&lt;/code&gt; to mark it as used and give the process a unique pid. &lt;code&gt;proc.c:88-92&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;found:
  p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;state &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; EMBRYO;
  p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;pid &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nextpid&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;;

  release(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;ptable.lock);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;Next, it allocate a kernel stack for the process&#39;s kernel thread. If failed, labeled the &lt;code&gt;struct proc&lt;/code&gt; with &lt;code&gt;UNUSED&lt;/code&gt;, return 0. &lt;code&gt;proc.c:94-99&lt;/code&gt; (kernel thread is the thread when a process is trapped in kernel).&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// Allocate kernel stack.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;((p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;kstack &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; kalloc()) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;){
    p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;state &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; UNUSED;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
  }
  sp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;kstack &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; KSTACKSIZE;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here we meet a new function called &lt;code&gt;kalloc&lt;/code&gt;. Go to its definition, &lt;code&gt;kalloc.c:79-95&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Allocate one 4096-byte page of physical memory.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Returns a pointer that the kernel can use.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Returns 0 if the memory cannot be allocated.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;kalloc&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; run &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;r;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(kmem.use_lock)
    acquire(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock);
  r &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; kmem.freelist;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(r)
    kmem.freelist &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; r&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;next;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(kmem.use_lock)
    release(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock);
  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)r;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;kalloc&lt;/code&gt; is used to allocate one 4096-byte page physical memory. We can infer from the above usage that &lt;code&gt;kalloc&lt;/code&gt; return a pointer that can point to a stack space.&lt;/p&gt;
&lt;p&gt;In &lt;code&gt;allocproc&lt;/code&gt;, we assign &lt;code&gt;sp&lt;/code&gt; at the top of the kernel stack.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;kernel_stack.png&#34; alt=&#34;Figure 1-4. A new kernel stack&#34;&gt;&lt;/p&gt;
&lt;p&gt;Next &lt;code&gt;allocproc&lt;/code&gt; use &lt;code&gt;sp&lt;/code&gt; to form the stack like the picture above, and assign the various pointer like &lt;code&gt;p-&amp;gt;tf&lt;/code&gt; &lt;code&gt;p-&amp;gt;context&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;What is trapframe and context? Well, trapframe is used for the code to return from the kernel back to the process&#39;s user code. All the registers and the porgram counter value (in &lt;code&gt;%eip&lt;/code&gt;) are freezed before entering kernel and stored in trapframe through trap entry code. After exiting, all the registers are restored and the processor executes from the freezed program counter value. Then exit process is in &lt;code&gt;trapret&lt;/code&gt; function. &lt;code&gt;trapasm.S:23-32&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The trapframe structure is defined in &lt;code&gt;x86.h:148-183&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Layout of the trap frame built on the stack by the
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// hardware and by trapasm.S, and passed to trap().
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; trapframe {
  &lt;span style=&#34;color:#75715e&#34;&gt;// registers as pushed by pusha
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  uint edi;
  uint esi;
  uint ebp;
  uint oesp;      &lt;span style=&#34;color:#75715e&#34;&gt;// useless &amp;amp; ignored
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  uint ebx;
  uint edx;
  uint ecx;
  uint eax;

  &lt;span style=&#34;color:#75715e&#34;&gt;// rest of trap frame
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  ushort gs;
  ushort padding1;
  ushort fs;
  ushort padding2;
  ushort es;
  ushort padding3;
  ushort ds;
  ushort padding4;
  uint trapno;

  &lt;span style=&#34;color:#75715e&#34;&gt;// below here defined by x86 hardware
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  uint err;
  uint eip;
  ushort cs;
  ushort padding5;
  uint eflags;

  &lt;span style=&#34;color:#75715e&#34;&gt;// below here only when crossing rings, such as from user to kernel
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  uint esp;
  ushort ss;
  ushort padding6;
};
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The trapframe is built by hardware and by &lt;code&gt;trapasm.S&lt;/code&gt;: &lt;code&gt;trapasm.S:5-21&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;alltraps:
  # Build trap frame.
  pushl %ds
  pushl %es
  pushl %fs
  pushl %gs
  pushal
  
  # Set up data segments.
  movw $(SEG_KDATA&amp;lt;&amp;lt;3), %ax
  movw %ax, %ds
  movw %ax, %es

  # Call trap(tf), where tf=%esp
  pushl %esp
  call trap
  addl $4, %esp
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;trapret&lt;/code&gt; is also defined in &lt;code&gt;trapasm.S:23-32&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;  # Return falls through to trapret...
.globl trapret
trapret:
  popal
  popl %gs
  popl %fs
  popl %es
  popl %ds
  addl $0x8, %esp  # trapno and errcode
  iret
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The context works similar with trapframe, but it is used by context control system. The kernel switches processor from a process to another, so we also need to store the context frame into kernel stack for switching.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;allocproc&lt;/code&gt; function is called not only in &lt;code&gt;userinit&lt;/code&gt;, but also every time when a new process is forked. So it is delicately designed for both two conditions. It sets the context frame&#39;s &lt;code&gt;%eip&lt;/code&gt; value right at &lt;code&gt;forkret&lt;/code&gt;, so when the processor switches to this process, &lt;code&gt;forkret&lt;/code&gt; will be executed. Unlike &lt;code&gt;trapret&lt;/code&gt;, &lt;code&gt;forkret&lt;/code&gt; only does a simple thing, returning to whatever on the bottom of the kernel stack. At that time, the context frame has already poped, what at the stack bottom is the &lt;code&gt;trapret&lt;/code&gt; entrance. So the processor assumes the process just return from kernel, &lt;code&gt;trapret&lt;/code&gt; then restores the trapframe.&lt;/p&gt;
&lt;p&gt;However when the process was first allocated, we will deliberately set trapframe&#39;s &lt;code&gt;%eip&lt;/code&gt; to 0x0, so when &lt;code&gt;trapret&lt;/code&gt; returns, the user code will be executed at 0x0. &lt;code&gt;proc.c:101-106&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Leave room for trap frame.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  sp &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;tf;
  p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;tf &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; trapframe&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)sp;

  &lt;span style=&#34;color:#75715e&#34;&gt;// Set up new context to start executing at forkret,
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// which returns to trapret.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  sp &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;;
  &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;(uint&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)sp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (uint)trapret;

  sp &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;context;
  p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;context &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; context&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)sp;
  memset(p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;context, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;context);
  p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;context&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;eip &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (uint)forkret;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; p;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;When the &lt;code&gt;allocproc&lt;/code&gt; finish, we called &lt;code&gt;setupkvm&lt;/code&gt; to prepare the memory page for our first process code, and manipulate the trapframe to let it return right to the beginning of the user code. (&lt;code&gt;allocproc&lt;/code&gt; only modified the value of context and &lt;code&gt;forkret&lt;/code&gt; part) We will discuss &lt;code&gt;setupkvm&lt;/code&gt; in the near future, but at high level it creates a address space as the Figure 1-2.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;address_space.png&#34; alt=&#34;Figure 1-2. Layout of a virtual address space&#34;&gt;&lt;/p&gt;
&lt;p&gt;The initial contents of the first processs user-space memory are the compiled form of &lt;code&gt;initcode.S&lt;/code&gt;; as part of the kernel build process, the linker embeds that binary in the kernel and defines two special symbols, &lt;code&gt;_binary_initcode_start&lt;/code&gt; and &lt;code&gt;_binary_initcode_size&lt;/code&gt;, indicating the location and size of the binary. Userinit copies that binary into the new processs memory by calling inituvm, which allocates one page of physical memory, maps virtual address zero to that memory, and copies the binary to that page.&lt;/p&gt;
&lt;p&gt;Then userinit sets up the trap frame with the initial user mode state: the %cs register contains a segment selector for the &lt;code&gt;SEG_UCODE&lt;/code&gt; segment running at privilege level &lt;code&gt;DPL_USER&lt;/code&gt; (i.e., user mode rather than kernel mode), and similarly &lt;code&gt;%ds&lt;/code&gt;, &lt;code&gt;%es&lt;/code&gt;, and &lt;code&gt;%ss&lt;/code&gt; use &lt;code&gt;SEG_UDATA&lt;/code&gt; with privilege &lt;code&gt;DPL_USER&lt;/code&gt;. The &lt;code&gt;%eflags&lt;/code&gt; &lt;code&gt;FL_IF&lt;/code&gt; bit is set to allow hardware interrupts; we will re-examine this in Chapter 3.&lt;/p&gt;
&lt;p&gt;The stack pointer &lt;code&gt;%esp&lt;/code&gt; is set to the processs largest valid virtual address, &lt;code&gt;p-&amp;gt;sz&lt;/code&gt;. The instruction pointer is set to the entry point for the initcode, address 0. The function userinit sets &lt;code&gt;p-&amp;gt;name&lt;/code&gt; to initcode mainly for debugging. Setting &lt;code&gt;p-&amp;gt;cwd&lt;/code&gt; sets the processs current working directory; we will examine namei in detail in Chapter 6.&lt;/p&gt;
&lt;p&gt;Once the process is initialized, userinit marks it available for scheduling by setting &lt;code&gt;p-&amp;gt;state&lt;/code&gt; to &lt;code&gt;RUNNABLE&lt;/code&gt;.&lt;/p&gt;</description>
    </item>
    <item>
      <title>xv6 Chapter 3 - Turning on Paging</title>
      <link>https://xiahualiu.github.io/posts/2019-01-29-paging/</link>
      <pubDate>Tue, 29 Jan 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-01-29-paging/</guid>
      <description>&lt;p&gt;In the last post, we discussed about the C code part of the boot loader, namely &lt;code&gt;bootmain.c&lt;/code&gt;. It read 4096 bytes data from the beginning of the disk second sector into the physical address &lt;code&gt;0x10000&lt;/code&gt; then parsed the elf file header by a &lt;code&gt;struct elf&lt;/code&gt;, read specified fields of &lt;code&gt;struct elf&lt;/code&gt; in order to validate elf file and acquire information about the program table. After that our boot loader fetched every corresponding elf body segment (e.g. .text .data) defined by each entry in the program header table and placed them in the written physical address &lt;code&gt;p_addr&lt;/code&gt; By the end of boot loader it called &lt;code&gt;p-&amp;gt;entry&lt;/code&gt; which is the entry of the elf file, proceeding to the next program, which is &lt;code&gt;main&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The most difficult part of the boot loader is knowing how to parse the elf file structure. I assumed the reader was familiar with the virtual memory layout for a typical executable program, including what &lt;code&gt;.text&lt;/code&gt; &lt;code&gt;.data&lt;/code&gt; &lt;code&gt;.bss&lt;/code&gt; etc. are and where they locate at. If you cannot really catch that please refer to &lt;em&gt;CSAPP&lt;/em&gt; or other books. Back to the topic, an elf contains useful information that is necessary for an elf loader so our boot loader has actually performed a simple loading process in few lines.&lt;/p&gt;
&lt;p&gt;Here to remind you of the action sequence of the boot, we did not directly come from the very beginning to our boot loader program, because the machine need a tiny program (512 bytes), which was automatically imported from first sector on the disk since powered-up, that fact means the BIOS probably has the similar boot loader like bootmain.c, however this sneaky boot loader is stored in the mother-boards rom other than disks and we cannot touch this pre-prepared boot loader.&lt;/p&gt;
&lt;p&gt;When the BIOS boot loader finished its duty, it gave the power to our 512-byte boot program, our tiny boot program contains code that tweaked our cpu settings and the boot loader. In a word the solidified BIOS boot loader loaded our boot program, there are two boot programs in different places and work in sequence. Make sure you are clear before continue.&lt;/p&gt;
&lt;h1 id=&#34;abstract&#34;&gt;Abstract&lt;/h1&gt;
&lt;p&gt;In this chapter, the kernel has already been in the memory, but where is it? The kernel has been compiled and linked so that it expects to find itself at virtual addresses starting at &lt;code&gt;0x80100000&lt;/code&gt;. Thus, function call instructions must mention destination addresses that look like &lt;code&gt;0x801xxxxx&lt;/code&gt;; you can see examples in &lt;code&gt;kernel.asm&lt;/code&gt;. This address is configured in &lt;code&gt;kernel.ld&lt;/code&gt; (9311). &lt;code&gt;0x80100000&lt;/code&gt; is a relatively high address, towards the end of the 32-bit address space;  further chapters will explain the reasons for this choice. There may not be any physical memory at such a high address. Once the kernel starts executing, it will set up the paging hardware to map virtual addresses starting at &lt;code&gt;0x80100000&lt;/code&gt; to physical addresses starting at &lt;code&gt;0x00100000&lt;/code&gt;; the kernel assumes that there is physical memory at this lower address. At this point in the boot process, however, paging is not enabled. Instead, kernel.ld specifies that the ELF p_addr start at &lt;code&gt;0x00100000&lt;/code&gt;, which causes the boot loader to copy the kernel to the low physical addresses to which the paging hardware will eventually point.&lt;/p&gt;
&lt;p&gt;That is quite a big load of words, simply speaking:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The kernels entry is placed at physical address &lt;code&gt;0x00100000&lt;/code&gt;, because address &lt;code&gt;0xa00000&lt;/code&gt; to &lt;code&gt;0x100000&lt;/code&gt; is reserved by IO devices. (Plus we assigned address &lt;code&gt;0x0&lt;/code&gt; to &lt;code&gt;0x7c00&lt;/code&gt; used for stack in &lt;code&gt;bootasm.S&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;The kernel entry cannot be called directly since paging hardware is not enabled yet, and kernel uses virtual address for its functions. You can enter the kernel by &lt;code&gt;jmp&lt;/code&gt; instruction but once we were in the kernel, all functions, variables cannot be found.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Conclusion&lt;/strong&gt;: We need a transition program to set up the virtual map for the kernel. It is linked with the &lt;code&gt;main.c&lt;/code&gt; program, and where &lt;code&gt;p-&amp;gt;entry&lt;/code&gt; fell.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;turn-on-paging&#34;&gt;Turn on paging&lt;/h1&gt;
&lt;p&gt;We need to do 3 things to turn on paging:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Set the size for the virtual memory page, which also regarded as page size. By convention, it should be either 4K bytes or 4M bytes. Here we chose 4M bytes.&lt;/li&gt;
&lt;li&gt;We need to create the page table entries (PTE) for every page, currently we only need the one for &lt;code&gt;0x80100000&lt;/code&gt; (We must sure that the elf is smaller than 4M) and 0x0 the address where the &lt;code&gt;%eip&lt;/code&gt; is pointing at now. With 4M page, that number is 512 and 0 respectively.&lt;/li&gt;
&lt;li&gt;Set the entry for page table directory in &lt;code&gt;%cr3&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Turn on paging, by setting a specified bit in &lt;code&gt;%cr0&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The kernels physical address (&lt;code&gt;p_addr&lt;/code&gt;) is used for our boot loader, it tells to allocate the first program segment at physical address &lt;code&gt;0x10000&lt;/code&gt;. However, from the kernels perspective, it assumes itself locates at &lt;code&gt;v_addr&lt;/code&gt; &lt;code&gt;0x80100000&lt;/code&gt;. So we need to cast the virtual address &lt;code&gt;0x80000000&lt;/code&gt; to the physical address &lt;code&gt;0x0&lt;/code&gt;, thus entry 512 has the base address &lt;code&gt;0x0&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Here is a simple illustration of how mmu interprets virtual address:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Read &lt;code&gt;v_addr&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Calculate the index of PTE implicitly, because we chose 4M page size so the value of the segment register is &lt;code&gt;v_addr/4M&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Fetch page table entry 512. The address was calculated by step 2.&lt;/li&gt;
&lt;li&gt;Check whether the page is missing, and validate the operation (i.e writing to a read-only page is illegal).&lt;/li&gt;
&lt;li&gt;Add up offset and the base address of the page, return the result physical address to cpu. (In some processor like later the Core i7, there are several levels of PTE so we need more steps to get the physical address.)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In the transition program, we also created the entry 0 for our current program, it points to &lt;code&gt;0x0&lt;/code&gt;, where we are now and the same address as entry 512 does, otherwise the program will crash after we turn on the paging function in &lt;code&gt;%cr0&lt;/code&gt;, because cpu cannot find the next instruction.&lt;/p&gt;
&lt;p&gt;When we finished, we needed an indirect jump (fill the &lt;code&gt;%eip&lt;/code&gt; by hand), since the assembler would otherwise generate the PC-related version of jump, and the result address is a low address, which is invalid in virtual address system.&lt;/p&gt;
&lt;h1 id=&#34;code-notes&#34;&gt;Code notes&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;entry.S&lt;/code&gt; was linked with &lt;code&gt;main.c&lt;/code&gt;, so the elf contained them both. Let&#39;s first read the header notes of &lt;code&gt;entry.S&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;entry.S:1-3&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;# The xv6 kernel starts executing in this file. This file is linked with
# the kernel C code, so it can refer to kernel symbols such as main().
# The boot block (bootasm.S and bootmain.c) jumps to entry below.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;See? And there is the &lt;code&gt;_start&lt;/code&gt; convention: &lt;code&gt;entry.S:37-41&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;# By convention, the _start symbol specifies the ELF entry point.
# Since we havent set up virtual memory yet, our entry point is
# the physical address of entry.
.globl _start
_start = V2P_WO(entry)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The &lt;code&gt;_start&lt;/code&gt; labeled the first function of the elf when executed, because &lt;code&gt;entry.S&lt;/code&gt; and &lt;code&gt;main.c&lt;/code&gt; were linked together, They shared the same entry point. The linker we used assumed all the segments locate at virtual addresses starting from &lt;code&gt;0x80100000&lt;/code&gt; which includes &lt;code&gt;entry&lt;/code&gt;. That is why we need to use macro &lt;code&gt;V2P_WO()&lt;/code&gt; to change &lt;code&gt;entry&lt;/code&gt; address. Otherwise, in the last step: &lt;code&gt;entry()&lt;/code&gt; cannot be executed, since the  function pointer &lt;code&gt;p-&amp;gt;entry&lt;/code&gt; points to a high virtual address, and at that time we have not turned on paging yet.&lt;/p&gt;
&lt;p&gt;After called &lt;code&gt;p-&amp;gt;entry&lt;/code&gt;, we came here: &lt;code&gt;entry.S:43-56&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;# Entering xv6 on boot processor, with paging off.
.globl entry
entry:
  # Turn on page size extension for 4Mbyte pages
  movl    %cr4, %eax
  orl     $(CR4_PSE), %eax
  movl    %eax, %cr4
  # Set page directory
  movl    $(V2P_WO(entrypgdir)), %eax
  movl    %eax, %cr3
  # Turn on paging.
  movl    %cr0, %eax
  orl     $(CR0_PG|CR0_WP), %eax
  movl    %eax, %cr0
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;A series of operations to turn on paging. Please note that &lt;code&gt;entrypgdir&lt;/code&gt; must be physical address, it is required by MMU and the linker created the virtual version. Since different CPUs have different paging config registers, so I do not want to explain in details about &lt;code&gt;%cr0&lt;/code&gt; and &lt;code&gt;%cr3&lt;/code&gt; &lt;code&gt;%cr4&lt;/code&gt; registers. When you really need to write a OS, you have to refer to the corresponding processor manual. Different generations of CPU differ from each other on paging registers.&lt;/p&gt;
&lt;p&gt;However, please know the &lt;code&gt;entrypgdir&lt;/code&gt; structure is defined in &lt;code&gt;main.c:97-108&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// The boot page table used in entry.S and entryother.S.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Page directories (and page tables) must start on page boundaries,
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// hence the __aligned__ attribute.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// PTE_PS in a page directory entry enables 4Mbyte pages.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
__attribute__((__aligned__(PGSIZE)))
pde_t entrypgdir[NPDENTRIES] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {
  &lt;span style=&#34;color:#75715e&#34;&gt;// Map VA&amp;#39;s [0, 4MB) to PA&amp;#39;s [0, 4MB)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  [&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_P &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_W &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_PS,
  &lt;span style=&#34;color:#75715e&#34;&gt;// Map VA&amp;#39;s [KERNBASE, KERNBASE+4MB) to PA&amp;#39;s [0, 4MB)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  [KERNBASE&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDXSHIFT] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_P &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_W &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_PS,
};
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As I said above, the page table contains two entries, one for &lt;code&gt;0x0&lt;/code&gt; and one for &lt;code&gt;0x80000000&lt;/code&gt; and the page table is strictly aligned, it is a global variable, so it can be found in the elf&#39;s &lt;code&gt;.data&lt;/code&gt; segment.&lt;/p&gt;
&lt;p&gt;Next, prepare for calling &lt;code&gt;main()&lt;/code&gt;: &lt;code&gt;entry.S:58-68&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;  # Set up the stack pointer.
  movl $(stack + KSTACKSIZE), %esp

  # Jump to main(), and switch to executing at
  # high addresses. The indirect call is needed because
  # the assembler produces a PC-relative instruction
  # for a direct jump.
  mov $main, %eax
  jmp *%eax

.comm stack, KSTACKSIZE
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;When it comes to call a function, always remember to &lt;strong&gt;make sure the stack is available now&lt;/strong&gt;, we have changed address configuration so we want to change stack pointer.&lt;/p&gt;
&lt;p&gt;The final line has a strange command &lt;code&gt;.comm&lt;/code&gt;. Here is its usage:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt; .comm name, size, alignment
 # The .comm directive allocates storage in the data section. 
 # The storage is referenced by the identifier name. Size is 
 # measured in bytes and must be a positive integer. Name 
 # cannot be predefined. Alignment is optional. If alignment 
 # is specified, the address of name is aligned to a multiple 
 # of alignment.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;.comm stack, KSTACKSIZE&lt;/code&gt; allocated a storage &lt;code&gt;stack&lt;/code&gt; of size &lt;code&gt;KSTACKSIZE&lt;/code&gt; in &lt;code&gt;.data&lt;/code&gt; segment and can be linked by others (just like global variables), &lt;code&gt;KSTACKSIZE&lt;/code&gt; are defined in &lt;code&gt;param.h:2&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define KSTACKSIZE 4096  &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// size of per-process kernel stack
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Per-process kernel stack allows multiple processes trapped in the kernel at the same time. These stacks seem to be isolated, kernel knows which stack is for which process when switches to different processes.&lt;/p&gt;
&lt;p&gt;In the end, we use an indirect jump to transfer the processor to &lt;code&gt;main&lt;/code&gt; in &lt;code&gt;main.c&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;In this chapter, we talked about the process of turning on paging in xv6, the code implementation can be found in entry.S file. The code is pretty simple but has a lot important things in how to handle details of the P2V transition including indirect jump, and the PTE 0.&lt;/p&gt;
&lt;p&gt;In the next post we will discuss the details of the creating the first process in xv6.&lt;/p&gt;</description>
    </item>
    <item>
      <title>xv6 Chapter 1 - Bootstrap</title>
      <link>https://xiahualiu.github.io/posts/2019-01-26-xv6-boot1/</link>
      <pubDate>Sat, 26 Jan 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-01-26-xv6-boot1/</guid>
      <description>&lt;p&gt;The xv6 note collection is based on the textbook and source code provided by MIT class code 6.828,which also called the &lt;em&gt;xv6 a Unix-like operating system&lt;/em&gt;. All the materials including codes and scripts are under &lt;a href=&#34;https://mit-license.org/&#34;&gt;the MIT License&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This post is the first chapter in the collection, we will go through the basic knowledge of Intel 8088 processor and do the bootstrap work for xv6 kernel step by step.&lt;/p&gt;
&lt;p&gt;Xv6 provided official textbook &lt;a href=&#34;https://pdos.csail.mit.edu/6.828/2018/xv6/book-rev11.pdf&#34;&gt;xv6 book&lt;/a&gt; online to illustrate what the codes are trying to do. The text version of code can be downloaded here &lt;a href=&#34;https://pdos.csail.mit.edu/6.828/2018/xv6/xv6-rev11.pdf&#34;&gt;xv6 source&lt;/a&gt;.&lt;/p&gt;
&lt;h1 id=&#34;after-powering-up&#34;&gt;After powering up&lt;/h1&gt;
&lt;p&gt;After you powered up your processor, a small program would automatically executed. The program was not designed by us, instead it was burned in the rom. And it performed a very simple action, transferring the data on first sector of disk to the main memory address &lt;code&gt;0x7c00&lt;/code&gt; and jumped to that location. In order not to get confused about the boot loader in next chapter, we called the ex-factory boot loader &lt;em&gt;BIOS boot loader&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;After that, processor turned to our program, namely &lt;code&gt;bootasm.S&lt;/code&gt;. All the operations will performed in &lt;code&gt;bootasm.S&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Disable the BIOS interrupts&lt;/li&gt;
&lt;li&gt;Clear all segment registers including DS, ES, SS except CS, it can only be modified by &lt;code&gt;ljmp&lt;/code&gt; instruction.&lt;/li&gt;
&lt;li&gt;Open A20 Gate, make the 21st address line valid, or the 21st bit of address register will always be 0, the address is not consecutive.(It is also required by protected mode)&lt;/li&gt;
&lt;li&gt;Create GDT, here we choose GDT to be flat, the address is not changed and 1 to 1 mapped.&lt;/li&gt;
&lt;li&gt;Transform CPU from &lt;code&gt;Real Mode&lt;/code&gt; to &lt;code&gt;Protected Mode&lt;/code&gt;, enabling 32-bit addressing.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We will go through them one by one in the following.&lt;/p&gt;
&lt;p&gt;First we need to know what BIOS had done before our program &lt;code&gt;bootasm.S:3-6&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;# Start the first CPU: switch to 32-bit protected mode, jump into C.
# The BIOS loads this code from the first sector of the hard disk into
# memory at physical address 0x7c00 and starts executing in real mode
# with %cs=0 %ip=7c00.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We know that our program entry is at &lt;code&gt;0x7c00&lt;/code&gt;, and &lt;code&gt;%cs&lt;/code&gt; had been cleared . In the initial real mode, the CPU can only address in 16 bit mode.&lt;/p&gt;
&lt;h2 id=&#34;disable-bios-interrupts&#34;&gt;Disable BIOS interrupts&lt;/h2&gt;
&lt;p&gt;Let us focus on &lt;code&gt;bootasm.S:13&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;  cli                         # Disable interrupts
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;It is a convention for the programmer to disable BIOS interrupts, because in this period, the interrupt handlers are not available, so when an interrupt occurs, it will cause undefined behaviors.&lt;/p&gt;
&lt;p&gt;Please be advised about &lt;code&gt;.code16&lt;/code&gt;, it means until the next related symbols, the assembler will only generate 16-bit format machine code.&lt;/p&gt;
&lt;h2 id=&#34;clear-segment-registers&#34;&gt;Clear segment registers&lt;/h2&gt;
&lt;p&gt;Go to &lt;code&gt;bootasm.S:15-19&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;  # Zero data segment registers DS, ES, and SS.
  xorw    %ax,%ax             # Set %ax to zero
  movw    %ax,%ds             # -&amp;gt; Data Segment
  movw    %ax,%es             # -&amp;gt; Extra Segment
  movw    %ax,%ss             # -&amp;gt; Stack Segment
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;These segment registers are all of 16-bit width, besides there is another segment register named &lt;code&gt;CS&lt;/code&gt;, it cannot be modified by &lt;code&gt;mov&lt;/code&gt; or other math and logic instructions. The default value for &lt;code&gt;CS&lt;/code&gt; is zero, so there is no need to clear &lt;code&gt;CS&lt;/code&gt; register. We will discuss &lt;code&gt;CS&lt;/code&gt; later in the article.&lt;/p&gt;
&lt;p&gt;The three registers contains different types of addresses and they are chosen implicitly by processor. For example, when the instruction being executed consists instruction address, like &lt;code&gt;jmp foo&lt;/code&gt; processor will automatically fetch the value from &lt;code&gt;%cs&lt;/code&gt; which is the address of &lt;code&gt;foo&lt;/code&gt;. If the processor met &lt;code&gt;push %ax&lt;/code&gt;, it will automatically choose &lt;code&gt;%ss&lt;/code&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;%ds&lt;/code&gt; Data Segment Register.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%ss&lt;/code&gt; Stack Segment Register.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%cs&lt;/code&gt; Code Segment Register.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%es&lt;/code&gt; Extra Segment Register. Only used for duplicating and depositing value from other segment register.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The reason why called segment register is that, Intel processors use a special method to address variables in which the corresponding segment register is shifted to left 4 bits (equals x16) then added with a 16-bit offset register. This method allows the processor to do a 20-bit addressing with two 16-bit registers, however, it also caused another problem, putting forward the origin of A20 Gate.&lt;/p&gt;
&lt;h2 id=&#34;open-the-a20-gate&#34;&gt;Open the A20 Gate&lt;/h2&gt;
&lt;p&gt;As I said above, the final address that cpu fetches is calculated like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;final_address&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(seg_reg&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;offset_reg;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;What if we input &lt;code&gt;seg_reg=0xFFFF, offset_reg=0xFFFF&lt;/code&gt;?&lt;/p&gt;
&lt;p&gt;The result is &lt;code&gt;final_address=0x10FFEF&lt;/code&gt; which actually is a 21-bit value. Back to the days when Intel 8086 only had 20 address lines, the 21st bit was ignored.&lt;/p&gt;
&lt;p&gt;But after that Intel released processor with more than 20 address lines, however, Intel still wanted to make them backward compatible, so the 21st address line was ignored by default. IBM used a small tricks to solve this problem, it assigned a unused pin named A20 in the 8042 controller (PS/2 controller) to be the switch of 21st address line, that was, the origin of A20 Gate.&lt;/p&gt;
&lt;p&gt;What if we do not open the A20 Gate? Well, if we had an address like &lt;code&gt;0xFFFFFFFF&lt;/code&gt; which is longer than 20 bits, the 21st bit would always be 0, thus the memory space is not consecutive, we are only accessible to 0~1MB, 2~3MB, 4~5MB memory addresses. That was a definitely catastrophy for programmer. I have not try it, who knows lol.&lt;/p&gt;
&lt;p&gt;How to open A20 gate? The approach is simple, we just let the 2nd pin of 8042 controller output 1. But the operations are pretty complex, first we must know the mechanics of 8042 I/O.&lt;/p&gt;
&lt;p&gt;The related instructions can be found here &lt;code&gt;bootasm.S:21-37&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;  # Physical address line A20 is tied to zero so that the first PCs 
  # with 2 MB would run software that assumed 1 MB.  Undo that.
seta20.1:
  inb     $0x64,%al               # Wait for not busy
  testb   $0x2,%al
  jnz     seta20.1

  movb    $0xd1,%al               # 0xd1 -&amp;gt; port 0x64
  outb    %al,$0x64

seta20.2:
  inb     $0x64,%al               # Wait for not busy
  testb   $0x2,%al
  jnz     seta20.2

  movb    $0xdf,%al               # 0xdf -&amp;gt; port 0x60
  outb    %al,$0x60
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Intel CPU controls 8042 through I/O ports. As we know, cpu is not only made of cores, there are also many peripheral controllers on chip like ethernet, usb, PCI, etc. The processor addresses them from &lt;code&gt;0x0&lt;/code&gt; to &lt;code&gt;0xFF&lt;/code&gt;. As for 8042, its I/O number is &lt;code&gt;0x60&lt;/code&gt; and &lt;code&gt;0x64&lt;/code&gt;.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;IO Port&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Access Type&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Purpose&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x60&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;R/W&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Data Port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;R&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Status Register&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;W&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Command Register&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;code&gt;0x64&lt;/code&gt; port connects to different registers for different access types, which is pretty common in embedded system.&lt;/p&gt;
&lt;p&gt;The opening A20 gate contains following operations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Wait for not busy, by checking the status register. Loop while busy.&lt;/li&gt;
&lt;li&gt;Send command to 0x64, indicating an incoming output.&lt;/li&gt;
&lt;li&gt;Wait for not busy, by checking the status register. Loop while busy.&lt;/li&gt;
&lt;li&gt;Send data to 0x60, output 1 on 2nd pin.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Details on &lt;a href=&#34;https://wiki.osdev.org/%228042%22_PS/2_Controller&#34;&gt;8042 Controller&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;From now on, we can make 21-bit addressing (up to 2MB). It is slightly better than 20-bit version (up to 1MB) however we want 32-bit addressing (up to 4GB) in the end.&lt;/p&gt;
&lt;h2 id=&#34;turn-on-32-bit-addressing&#34;&gt;Turn on 32-bit addressing&lt;/h2&gt;
&lt;p&gt;By default, when CPU is powered up, it ran in Real Mode, where we can only do 21-bit address. We can change it into Protected Mode, in which 32-bit addressing is available.&lt;/p&gt;
&lt;p&gt;But to transform cpu into Protected Mode, we must create a table called GDT. Every entry in GDT contains:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a 32-bit base address field&lt;/li&gt;
&lt;li&gt;a 20-bit limit field&lt;/li&gt;
&lt;li&gt;a 12-bit flag field&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;What a GDT entry does? First, CPU no longer used segment registers to addressing anymore, instead, the segment registers are used as an index in GDT, each value from (0-65535) maps an entry in the table.&lt;/p&gt;
&lt;p&gt;CPU will fetch the 32-bit base address in the entry and add it with another register named &lt;code&gt;%eip&lt;/code&gt; which is familiar by most programmers. The result is a 32-bit address.&lt;/p&gt;
&lt;p&gt;Another advantage of using GDT is the high security, GDT is considered as the cpu&#39;s hardware mechanics to isolate the executable code from data if we set the flags in the flag field, it labels what memory is executable and cannot be modified, and what memory (i.e data) cannot be executed. It prevent the overflow attack from a hardware level.&lt;/p&gt;
&lt;p&gt;In x86 asm, GDT is loaded by &lt;code&gt;ldgt&lt;/code&gt; instruction, and GDT is defined in  &lt;code&gt;bootasm.S:78-87&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;# Bootstrap GDT
.p2align 2                                # force 4 byte alignment
gdt:
  SEG_NULLASM                             # null seg
  SEG_ASM(STA_X|STA_R, 0x0, 0xffffffff)   # code seg
  SEG_ASM(STA_W, 0x0, 0xffffffff)         # data seg

gdtdesc:
  .word   (gdtdesc - gdt - 1)             # sizeof(gdt) - 1
  .long   gdt                             # address gdt
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We fill three entries in GDT, they are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Null segment, this segment has no real function, but usually reserved for debug purpose.&lt;/li&gt;
&lt;li&gt;Code segment, labeled by the 12-bit flag. Base address is &lt;code&gt;0x00&lt;/code&gt;, maximum offset is &lt;code&gt;0xffffffff&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Data segment, labeled by the 12-bit flag. Base address is &lt;code&gt;0x00&lt;/code&gt;, maximum offset is &lt;code&gt;0xffffffff&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Per cpu data segment, I do not know nothing about it.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Want to know more about GDT, please refer to &lt;a href=&#34;https://wiki.osdev.org/Global_Descriptor_Table&#34;&gt;Global Descriptor Table - OSDev Wiki&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In the end, move 1 to &lt;code&gt;%cr0&lt;/code&gt; to open Protected Mode, we need to reload &lt;code&gt;%cs&lt;/code&gt; and &lt;code&gt;%eip&lt;/code&gt; registers. The only way to modify &lt;code&gt;%cs&lt;/code&gt; is by &lt;code&gt;ljmp&lt;/code&gt; to the other place, here we jumped to &lt;code&gt;start32&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Next, reload DS, ES, SS. &lt;code&gt;bootasm.S:54-62&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;start32:
  # Set up the protected-mode data segment registers
  movw    $(SEG_KDATA&amp;lt;&amp;lt;3), %ax    # Our data segment selector
  movw    %ax, %ds                # -&amp;gt; DS: Data Segment
  movw    %ax, %es                # -&amp;gt; ES: Extra Segment
  movw    %ax, %ss                # -&amp;gt; SS: Stack Segment
  movw    $0, %ax                 # Zero segments not ready for use
  movw    %ax, %fs                # -&amp;gt; FS
  movw    %ax, %gs                # -&amp;gt; GS
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Here we successfully bootstrap our xv6 system, including turning on A20 gate, open Protected Mode. After these, we need to transfer the processor to &lt;code&gt;bootmain.c&lt;/code&gt; which is our boot loader program.&lt;/p&gt;
&lt;p&gt;Before we proceed, we need to check the &lt;code&gt;%esp&lt;/code&gt;, because we cannot have the stack pointer points to &lt;code&gt;0x0&lt;/code&gt; before calling, the stack grow from up to down, &lt;code&gt;0x0&lt;/code&gt; means everything pushed into the stack will be lost. Since our boot program starts at &lt;code&gt;0x7c00&lt;/code&gt;, we assigned &lt;code&gt;%esp&lt;/code&gt; to &lt;code&gt;0x7c00&lt;/code&gt;, it is ok because we do not need a lot space on stack, and it is proper to use space from &lt;code&gt;0x0000&lt;/code&gt; to &lt;code&gt;0x7c00&lt;/code&gt;. &lt;code&gt;bootasm.S:64-66&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;  # Set up the stack pointer and call into C.
  movl    $start, %esp
  call    bootmain
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;review&#34;&gt;Review&lt;/h1&gt;
&lt;p&gt;We discussed about the hardware preparation for xv6, including:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Disable BIOS interrupts.&lt;/li&gt;
&lt;li&gt;Clear segment registers.&lt;/li&gt;
&lt;li&gt;Open A20 Gate.&lt;/li&gt;
&lt;li&gt;Create GDT.&lt;/li&gt;
&lt;li&gt;Transform CPU into Protected Mode&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In the next chapter, we proceed to the boot loader program, and please know it is different from the BIOS one.&lt;/p&gt;</description>
    </item>
    <item>
      <title>xv6 Chapter 2 - Boot Loader</title>
      <link>https://xiahualiu.github.io/posts/2019-01-26-xv6-boot2/</link>
      <pubDate>Sat, 26 Jan 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-01-26-xv6-boot2/</guid>
      <description>&lt;p&gt;This post is based on materials from MIT class code 6.828, namely xv6. In the &lt;a href=&#34;https://xiahua.blog/2019/01/25/2019-1-26-xv6-Boot1/&#34;&gt;last section&lt;/a&gt; we talked about the bootstrap for xv6, and after that we need to load the kernel into memory.&lt;/p&gt;
&lt;p&gt;Because the BIOS boot loader only loaded 512 bytes program on disk sector 1, we still need more program, to be read from disk, thus, we need a boot loader to call for this duty.&lt;/p&gt;
&lt;h1 id=&#34;what-is-a-boot-loader&#34;&gt;What is a boot loader&lt;/h1&gt;
&lt;p&gt;Boot loader do a simply task, transporting code from some place to main memory. In xv6, the boot loader read full elf of the kernel, then parsed the file, allocate different segments at different place in the memory. First thing, we need to know the elf file format that boot loader carried.&lt;/p&gt;
&lt;p&gt;Elf file consists a lot information that is not run by processor, including machine information, system information, and code segments. We can also check for this information to validate the elf file, whether it is executable.&lt;/p&gt;
&lt;h1 id=&#34;elf-file-structure&#34;&gt;ELF file structure&lt;/h1&gt;
&lt;p&gt;Elf files can be divided into two types, linkable elf files and executable elf files. They are of similar structure, except the second section, program header is optional in linkable elf and is necessary in executable elf.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;     Executable ELF
-----------------------
|     ELF header      |
-----------------------
|   Program header    | &amp;lt;-- *Optional in linkable ELF
|        table        |     *Necessary in executable ELF
-----------------------
|        .text        |
-----------------------
|        .data        |
-----------------------
|// .bss/.stab/etc. //|
-----------------------
|   Segment header    |
|        table        |
-----------------------
note: Program header table is called 
      Section header table in a linkable elf.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ELF header&lt;/strong&gt; stores the information about this elf file, it starts at offset 0 in elf.
| Position (32 bit) | Value                                                 |
| :&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;- | :&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;- |
| 0-3               | &lt;strong&gt;Magic number - 0x7F&lt;/strong&gt;, then &amp;lsquo;ELF&amp;rsquo; in ASCII          |
| 4                 | 1 = 32 bit, 2 = 64 bit                                |
| 5                 | 1 = little endian, 2 = big endian                     |
| 6                 | ELF Version                                           |
| 7                 | OS ABI - usually 0 for System V                       |
| 8-15              | Unused/padding                                        |
| 16-17             | 1 = relocatable, 2 = executable, 3 = shared, 4 = core |
| 18-19             | Instruction set - see table below                     |
| 20-23             | ELF Version                                           |
| 24-27             | Program entry position                                |
| 28-31             | Program header table position                         |
| 32-35             | Section header table position                         |
| 36-39             | Flags - architecture dependent; &lt;strong&gt;see note below&lt;/strong&gt;    |
| 40-41             | Header size                                           |
| 42-43             | &lt;strong&gt;Size of an entry in the program header table&lt;/strong&gt;      |
| 44-45             | &lt;strong&gt;Number of entries in the program header table&lt;/strong&gt;     |
| 46-47             | Size of an entry in the section header table          |
| 48-49             | Number of entries in the section header table         |
| 50-51             | Index in section header table with the section names  |&lt;/p&gt;
&lt;p&gt;Bold words are used later in the program, please take attention to them.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;Architecture&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;No Specific&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Sparc&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;x86&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;MIPS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;PowerPC&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0x14&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;ARM&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0x28&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;SuperH&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0x2A&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;IA-64&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0x32&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;x86-64&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0x3E&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;AArch64&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0xB7&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Program table is following ELF header, for each entry, the format below:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;Position&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;0-3&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Type of segment (see below)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;4-7&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;The offset in the file that the data for this segment can be found (p_offset)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;8-11&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Where you should start to put this segment in virtual memory (p_vaddr)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;12-15&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Undefined for the System V ABI&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;16-19&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Size of the segment in the file (p_filesz)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;20-23&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Size of the segment in memory (p_memsz)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;24-27&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Flags (see below)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;28-31&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;The required alignment for this section (must be a power of 2)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Segment types:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0 = null - ignore the entry;&lt;/li&gt;
&lt;li&gt;1 = load - clear p_memsz bytes at p_vaddr to 0, then copy p_filesz bytes from p_offset to p_vaddr;&lt;/li&gt;
&lt;li&gt;2 = dynamic - requires dynamic linking;&lt;/li&gt;
&lt;li&gt;3 = interp - contains a file path to an executable to use as an interpreter for the following segment;&lt;/li&gt;
&lt;li&gt;4 = note section.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There are more numbers for segment types, but most of them are related with operation system and processor architecture, mainstream segment types are above ones.&lt;/p&gt;
&lt;p&gt;Flags:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 = executable,&lt;/li&gt;
&lt;li&gt;2 = writable,&lt;/li&gt;
&lt;li&gt;4 = readable.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For our boot loader program, we care &lt;code&gt;.data&lt;/code&gt; and &lt;code&gt;.text&lt;/code&gt; segments most in elf file, so how to locate them in a elf file is the biggest problem for us.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://wiki.osdev.org/images/f/fe/Elfdiagram.png&#34; alt=&#34;ELF re-mapping&#34;&gt;&lt;/p&gt;
&lt;p&gt;The boot loader need first to read value from ELF header and get the information about program header table. We can see in the bytes definition of elf header that bytes &lt;strong&gt;42-45&lt;/strong&gt; is the size of program header table, so we search for every entry in the program header table, then get the information about every segment including offset and size. The final move is reading from the disk at specific offset and size and copy the segment into memory.&lt;/p&gt;
&lt;p&gt;Let us focusing on the codes.&lt;/p&gt;
&lt;h1 id=&#34;bootmainc-code-notes&#34;&gt;bootmain.c code notes&lt;/h1&gt;
&lt;p&gt;It is a good habit to start at reading the code header notes. &lt;code&gt;bootmain.c:1-6&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Boot loader.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Part of the boot sector, along with bootasm.S, which calls bootmain().
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// bootasm.S has put the processor into protected 32-bit mode.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// bootmain() loads an ELF kernel image from the disk starting at
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// sector 1 and then jumps to the kernel entry routine.
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;elf  &lt;code&gt;0x10000&lt;/code&gt;  elf  &lt;code&gt;0x10000&lt;/code&gt;  &lt;code&gt;bootmain.c:20-28&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; elfhdr &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;elf;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; proghdr &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ph, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;eph;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;entry)(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;);
  uchar&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; va;

  elf &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; elfhdr&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)&lt;span style=&#34;color:#ae81ff&#34;&gt;0x10000&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;// scratch space
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  
  &lt;span style=&#34;color:#75715e&#34;&gt;// Read 1st page off disk
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  readseg((uchar&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)elf, &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;These structs are defined in header file &lt;code&gt;elf.h&lt;/code&gt;. The destination address is &lt;code&gt;0x10000&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;There are two sub-functions that manage reading from disk, &lt;code&gt;readseg&lt;/code&gt; and &lt;code&gt;readsect&lt;/code&gt;. &lt;code&gt;bootmain.c:76-96&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Read &amp;#39;count&amp;#39; bytes at &amp;#39;offset&amp;#39; from kernel into virtual address &amp;#39;va&amp;#39;.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Might copy more than asked.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;readseg&lt;/span&gt;(uchar&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; va, uint count, uint offset)
{
  uchar&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; eva;

  eva &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; va &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; count;

  &lt;span style=&#34;color:#75715e&#34;&gt;// Round down to sector boundary.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  va &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; offset &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; SECTSIZE;

  &lt;span style=&#34;color:#75715e&#34;&gt;// Translate from bytes to sectors; kernel starts at sector 1.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  offset &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (offset &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; SECTSIZE) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;

  &lt;span style=&#34;color:#75715e&#34;&gt;// If this is too slow, we could read lots of sectors at a time.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// We&amp;#39;d write more to memory than asked, but it doesn&amp;#39;t matter --
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// we load in increasing order.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(; va &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; eva; va &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SECTSIZE, offset&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
    readsect(va, offset);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;readsect()&lt;/code&gt; is an low-level function, it reads a sector of given sector number. &lt;code&gt;SECTSIZE/4&lt;/code&gt; is because the asm &lt;code&gt;insl&lt;/code&gt; reads data in double words (4 bytes).&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;waitdisk&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  &lt;span style=&#34;color:#75715e&#34;&gt;// Wait for disk ready.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;((inb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F7&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xC0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x40&lt;/span&gt;)
    ;
}

&lt;span style=&#34;color:#75715e&#34;&gt;// Read a single sector at offset into dst.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;readsect&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dst, uint offset)
{
  &lt;span style=&#34;color:#75715e&#34;&gt;// Issue command.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  waitdisk();
  outb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F2&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);   &lt;span style=&#34;color:#75715e&#34;&gt;// count = 1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  outb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F3&lt;/span&gt;, offset);
  outb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F4&lt;/span&gt;, offset &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;);
  outb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F5&lt;/span&gt;, offset &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;);
  outb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F6&lt;/span&gt;, (offset &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;24&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xE0&lt;/span&gt;);
  outb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F7&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x20&lt;/span&gt;);  &lt;span style=&#34;color:#75715e&#34;&gt;// cmd 0x20 - read sectors
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;// Read data.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  waitdisk();
  insl(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F0&lt;/span&gt;, dst, SECTSIZE&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Because the mechanics of hard disk, we can only get access to a full sector once. When we want to get data from specified offset, we need to read all the sectors that contains the data. That means we have to read more data than we need, and the redundant data is trash data we need to sweep away.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Round down the offset to the sector beginning.&lt;/li&gt;
&lt;li&gt;Read until the end of the final sector.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The first elf header data comes from the beginning sector 2, so there will not be any round down, but after the first read,  there is no guarantee about segments always meet the boundaries of disk sectors.&lt;/p&gt;
&lt;p&gt;Magic number lies in the fixed offset in an elf, so we can check Magic number to validate the elf. &lt;code&gt;bootmain.c:30-32&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Is this an ELF executable?
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(elf&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;magic &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ELF_MAGIC)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;// let bootasm.S handle error
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;return&lt;/code&gt;? where does processor go? Actually it returns to &lt;code&gt;bootasm.S&lt;/code&gt; and execute the error handler, which will transmit an error to the virtual machine we are using through an special I/O port.&lt;/p&gt;
&lt;p&gt;Now we have checked the elf, next we start carrying things into memory. &lt;code&gt;bootmain.c:34-42&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Load each program segment (ignores ph flags).
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  ph &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; proghdr&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)((uchar&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)elf &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; elf&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;phoff);
  eph &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ph &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; elf&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;phnum;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(; ph &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; eph; ph&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {
    va &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (uchar&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)(ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;va &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xFFFFFF&lt;/span&gt;);
    readseg(va, ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;filesz, ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;offset);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;memsz &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;filesz)
      stosb(va &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;filesz, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;memsz &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;filesz);
  }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The first 4096 bytes was loaded, we assumed both the elf header and program header table are in the 4096 bytes. Next we checked the Magic number, then we searched for every entry in the program table and copy segments into memory.&lt;/p&gt;
&lt;p&gt;Here we used &lt;code&gt;stosb&lt;/code&gt; function to padding the segment, in fact, to clear the accompanying trash code between sectors and the code. &lt;code&gt;x86.h:42-49&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;inline&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// store some(cnt) bytes(data) to addr(addr)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;stosb(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;addr, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; data, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; cnt)
{
  &lt;span style=&#34;color:#66d9ef&#34;&gt;asm&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;volatile&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;cld; rep stosb&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
               &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;=D&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; (addr), &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;=c&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; (cnt) &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
               &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; (addr), &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; (cnt), &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;a&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; (data) &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
               &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;memory&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;cc&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In the end, we cast entry into a function pointer and call the function, all done!&lt;/p&gt;
&lt;h1 id=&#34;read-world&#34;&gt;Read World&lt;/h1&gt;
&lt;p&gt;The boot loader described in this chapter compiles to around 470 bytes of machine code, depending on the optimizations used when compiling the C code. In order to fit in that small amount of space, the xv6 boot loader makes a major simplifying assumption, that the kernel has been written to the boot disk contiguously starting at sector 1. More commonly, kernels are stored in ordinary file system, where they may not be contiguous, or are loaded over a network. These complications require the boot loader to be able to drive a variety of disk and network controllers and understand various file system and network protocols. In other words, the boot loader itself must be a small operation system. Since such complicated boot loader certainly won&#39;t fit in 512 bytes, most PC operating systems use a two-step boot process.&lt;/p&gt;
&lt;p&gt;First, a simple boot loader like the one in this appendix loads a full-featured boot loader from a known disk location, often relying on the less space-constrained BIOS for disk access rather than trying to drive the disk itself. The full loader, relieved of the 512-byte limit, can implement the complexity needed to locate, load, and execute the desired kernel. Modern PCs avoid many of the above complexities, because they support the Unified Extensible Firmware Interface (UEFI), which allows PC to read a larger boot loader from the disk (and start in protected and 32-bit mode).&lt;/p&gt;
&lt;p&gt;The Chapter 1 and Chapter 2 is written as if the only thing that happens between power on and the execution of boot loader is that the BIOS loads the boot sector. In fact the BIOS does a huge amount of initialization in order to make the complex hardware of a modern computer look like a traditional standard PC. The BIOS is really a small operating system embedded in the hardware, which is present after the computer has booted.&lt;/p&gt;
&lt;h1 id=&#34;exercises--answer&#34;&gt;Exercises &amp;amp; Answer&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;Due to sector granularity, the call to &lt;code&gt;readseg&lt;/code&gt; in the text is equivalent to &lt;code&gt;readseg((uchar*)0x100000, 0xb500, 0x1000)&lt;/code&gt;. In practice, this sloppy behavior turns out not to be a problem. Why doesn&#39;t the sloppy readsect cause problems?&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;Very easy if you carefully read the code, &lt;code&gt;readseg&lt;/code&gt; performs a offset round down before reading, so the actual offset transferred to &lt;code&gt;readsect&lt;/code&gt; is always aligned to the border of sectors.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Suppose you wanted &lt;code&gt;bootmain()&lt;/code&gt; to load the kernel at 0x20000 instead of 0x100000, and you did so by modifying &lt;code&gt;bootmain()&lt;/code&gt; to add 0x100000 to the va of each ELF section. Something would go wrong. What?&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;This question is tricky. It won&#39;t cause any problems until we call &lt;code&gt;p-&amp;gt;entry&lt;/code&gt;. The entry in memory has been move backwards by 0x100000, whereas the &lt;code&gt;p-&amp;gt;entry&lt;/code&gt; points to the original va.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;It seems potentially dangerous for the boot loader to copy the ELF header to memory at the arbitray location 0x10000. Why doesn&#39;t it call &lt;code&gt;malloc&lt;/code&gt; to obtain the memory it needs?&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;This question is stupid. &lt;code&gt;malloc&lt;/code&gt; need system call &lt;code&gt;sbrk()&lt;/code&gt; to implement. We cannot use &lt;code&gt;malloc&lt;/code&gt; because we haven&#39;t imported the kernel yet.&lt;/p&gt;
&lt;/blockquote&gt;</description>
    </item>
    <item>
      <title>RB-Tree - Reading STL Source Code</title>
      <link>https://xiahualiu.github.io/posts/2018-08-28-rb-tree/</link>
      <pubDate>Tue, 28 Aug 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-08-28-rb-tree/</guid>
      <description>&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;2-3 &lt;/strong&gt; 2-3  STL &lt;/p&gt;
&lt;p&gt; AA AVL  AVL &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;&lt;/h2&gt;
&lt;p&gt; O(N)&lt;/p&gt;
&lt;p&gt; AVL AVL  AVL  AVL &lt;/p&gt;
&lt;h2 id=&#34;2-3-&#34;&gt;2-3 &lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-28-RB-tree/2-3-1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;2-3  3  2 &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-28-RB-tree/2-3-2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; 2-3  2-3 
&lt;a href=&#34;https://en.wikipedia.org/wiki/2%E2%80%933_tree#Operations&#34;&gt;2-3 Tree Operation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2  3 3  4  2 2-3 &lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;&lt;/h2&gt;
&lt;p&gt; 2-3 2-3 &lt;/p&gt;
&lt;p&gt; 2-3 &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt; NULL &lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;&lt;/h2&gt;
&lt;p&gt; STL &lt;/p&gt;
&lt;h3 id=&#34;rb-tree-node&#34;&gt;RB-Tree Node&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; __rb_tree_color_type;
&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; __rb_tree_color_type __rb_tree_red &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; false;
&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; __rb_tree_color_type __rb_tree_red &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; true;

&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;__rb_tree_node_base&lt;/span&gt;
{
	&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; __rb_tree_color_type color_type;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; __rb_tree_node_base&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; base_ptr;

	color_type color; &lt;span style=&#34;color:#75715e&#34;&gt;// Color of the node, RED or BLACK
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	base_ptr parent; &lt;span style=&#34;color:#75715e&#34;&gt;// Child node can trace back to Root
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	base_ptr left; &lt;span style=&#34;color:#75715e&#34;&gt;// Left child ptr
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	base_ptr right; &lt;span style=&#34;color:#75715e&#34;&gt;// Right child ptr
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; base_ptr &lt;span style=&#34;color:#a6e22e&#34;&gt;minimum&lt;/span&gt;(base_ptr x)
	{   &lt;span style=&#34;color:#75715e&#34;&gt;// Find the smallest value 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (x&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;left &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;left; 
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; x;
	}

	&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; base_ptr &lt;span style=&#34;color:#a6e22e&#34;&gt;maximum&lt;/span&gt;(base_ptr x)
	{
		&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (x&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;right &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;right;
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; x;
	}
};

&lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;__rb_tree_node&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; __rb_tree_node_base 
{
	&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; __rb_tree_node&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; link_type;
	Value value_field;
};
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    <item>
      <title>FPGA EEPROM Communication</title>
      <link>https://xiahualiu.github.io/posts/2018-08-09-fpga-eeprom/</link>
      <pubDate>Thu, 09 Aug 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-08-09-fpga-eeprom/</guid>
      <description>&lt;p&gt; FPGA  I2C  EEPROM &lt;/p&gt;
&lt;h2 id=&#34;i2c-&#34;&gt;I2C &lt;/h2&gt;
&lt;p&gt;I2C  SCL  SDA SCL  SDA  SCL SDA  SCL SCL  SDA SCL  SDA  SCL  SDA &lt;/p&gt;
&lt;p&gt; 8 SDA &lt;/p&gt;
&lt;h2 id=&#34;eeprom-&#34;&gt;EEPROM &lt;/h2&gt;
&lt;p&gt; EEPROM  FPGA &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* This file is made by EggyCat to implement AT24C02 */&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;`timescale&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;ns&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;ns
&lt;span style=&#34;color:#75715e&#34;&gt;`define&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; timeslice 100&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; EEPROM(scl, sda);
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; scl;
&lt;span style=&#34;color:#66d9ef&#34;&gt;inout&lt;/span&gt; sda;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; out_flag;

&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] memory[&lt;span style=&#34;color:#ae81ff&#34;&gt;2047&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;];
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] address;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] memory_buf;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] sda_buf;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] shift;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] addr_byte;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] ctrl_byte;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] State;

&lt;span style=&#34;color:#66d9ef&#34;&gt;integer&lt;/span&gt; i;

&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r7&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101111&lt;/span&gt;, w7&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101110&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 7
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r6&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101101&lt;/span&gt;, w6&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 6
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r5&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101011&lt;/span&gt;, w5&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101010&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 5
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r4&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101001&lt;/span&gt;, w4&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 4
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r3&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100111&lt;/span&gt;, w3&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100110&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 3
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r2&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100101&lt;/span&gt;, w2&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 2
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100011&lt;/span&gt;, w1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100010&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r0&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100001&lt;/span&gt;, w0&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; sda&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;sda_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&amp;#39;bz; &lt;span style=&#34;color:#75715e&#34;&gt;//sda whether output
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;initial&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
    addr_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    sda_buf&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00&lt;/span&gt;;
    memory_buf&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    address&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    shift&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(i&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;i&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2047&lt;/span&gt;;i&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        memory[i]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; sda)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(scl&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
            State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;State&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b01&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//ModelSim6.0z1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b11&lt;/span&gt;)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;disable&lt;/span&gt; write_to_eeprom;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; sda)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(scl&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        stop_W_R; &lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;casex&lt;/span&gt;(State)
                &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b01&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; 
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    read_in;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w7 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w6 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w5 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w4 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w3 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w2 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w1 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w0)
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                        State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10&lt;/span&gt;;
                        write_to_eeprom;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
						  &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
							State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00&lt;/span&gt;;
					 &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b11&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
                read_from_eeprom;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
                State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00&lt;/span&gt;;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; stop_W_R;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt; 
        State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00&lt;/span&gt;;
        addr_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
        ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
        out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
        sda_buf&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; read_in;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        shift_in(ctrl_byte);
        shift_in(addr_byte);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; write_to_eeprom;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        shift_in(memory_buf);
        address&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{ctrl_byte[&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;], addr_byte};
        memory[address]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;memory_buf;
        $display(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;eeprom---memory[%0h]=%0h&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, address, memory[address]);
        State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00&lt;/span&gt;;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; read_from_eeprom;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        shift_in(ctrl_byte);
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r7 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r6 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r5 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r4 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r3 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r2 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r1 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r0)
            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                address&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{ctrl_byte[&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;], addr_byte};
                sda_buf&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;memory[address];
                shift_out;
                State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00&lt;/span&gt;;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; shift_in;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]shift;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; scl)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    #&lt;span style=&#34;color:#66d9ef&#34;&gt;`timeslice&lt;/span&gt;;
                    out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                    sda_buf&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; scl)
                #&lt;span style=&#34;color:#66d9ef&#34;&gt;`timeslice&lt;/span&gt; out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; shift_out;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(i&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;;i&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;i&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;i&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt; 
                @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; scl);
                #&lt;span style=&#34;color:#66d9ef&#34;&gt;`timeslice&lt;/span&gt;;
                sda_buf&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
        @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; scl) #&lt;span style=&#34;color:#66d9ef&#34;&gt;`timeslice&lt;/span&gt; sda_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
        @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; scl) #&lt;span style=&#34;color:#66d9ef&#34;&gt;`timeslice&lt;/span&gt; out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading&#34;&gt;&lt;/h2&gt;
&lt;p&gt; EEPROM &lt;code&gt;State&lt;/code&gt;  &lt;code&gt;State=2&#39;b00&lt;/code&gt;EEPROM &lt;code&gt;State=2&#39;b01&lt;/code&gt;EEPROM &lt;code&gt;State=2&#39;b11&lt;/code&gt;&lt;/p&gt;
&lt;p&gt; sda  scl  sda  scl  sda  scl  EEPROM  1 &lt;code&gt;read_in&lt;/code&gt;  scl  sda &lt;/p&gt;
&lt;p&gt; &lt;code&gt;out_flag&lt;/code&gt; sda  &lt;code&gt;out_flag==1&lt;/code&gt;  sda_buf[7]  scl  sda sda_buf  0 &lt;code&gt;out_flag&lt;/code&gt;  1  scl  &lt;code&gt;out_flag&lt;/code&gt;  0sda &lt;/p&gt;
&lt;p&gt;EEPROM  if &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt; sda_buf  sda
 sda_buf(&lt;code&gt;out_flag=1&lt;/code&gt;) read_in  scl  `timeslice  8  sda&lt;/p&gt;
&lt;p&gt; Quartus Prime Lite  &lt;code&gt;task shift_in&lt;/code&gt; &lt;/p&gt;
&lt;h2 id=&#34;-eeprom-&#34;&gt; EEPROM &lt;/h2&gt;
&lt;p&gt;FSM&lt;/p&gt;
&lt;p&gt; SDA  I2C  SDA  SCL  EEPROM &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-9-FPGA-EEPROM/struct.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-9-FPGA-EEPROM/FSM.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;`timescale&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;ns&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;ns

&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; EEPROM_WR(SDA, SCL, ACK, RESET, CLK, WR, RD, ADDR, DATA);
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; SCL;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; ACK;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; RESET;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; CLK;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; WR, RD;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] ADDR;
&lt;span style=&#34;color:#66d9ef&#34;&gt;inout&lt;/span&gt; SDA;
&lt;span style=&#34;color:#66d9ef&#34;&gt;inout&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] DATA;

&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; ACK;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; SCL;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; WF, RF;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; FF;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] head_buf;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] stop_buf;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] sh8out_buf;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] sh8out_state;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] sh8in_state;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] head_state;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] stop_state;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] main_state;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] data_from_rm;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; link_sda;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; link_read;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; link_head;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; link_write;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; link_stop;
&lt;span style=&#34;color:#66d9ef&#34;&gt;wire&lt;/span&gt; sda1, sda2, sda3, sda4;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Switch Signal */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; sda1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(link_head)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; head_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; sda2&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(link_write)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; sh8out_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; sda3&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(link_stop)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; stop_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; sda4&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(sda1&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;sda2&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;sda3);
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; SDA&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(link_sda)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; sda4: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&amp;#39;bz;
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; DATA&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(link_read)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; data_from_rm &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&amp;#39;hzz;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Main FSM State Definition */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt;
    IDLE        &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00000000001&lt;/span&gt;,
    Ready       &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00000000010&lt;/span&gt;,
    Write_start &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00000000100&lt;/span&gt;,
    Ctrl_write  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00000001000&lt;/span&gt;,
    Addr_write  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00000010000&lt;/span&gt;,
    Data_write  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00000100000&lt;/span&gt;,
    Read_start  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00001000000&lt;/span&gt;,
    Ctrl_read   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00010000000&lt;/span&gt;,
    Data_read   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00100000000&lt;/span&gt;,
    Stop        &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b01000000000&lt;/span&gt;,
    Ackn        &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10000000000&lt;/span&gt;,

&lt;span style=&#34;color:#75715e&#34;&gt;/* Parallel to Serial Output State Definition */&lt;/span&gt;
    sh8out_bit7 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b000000001&lt;/span&gt;,
    sh8out_bit6 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b000000010&lt;/span&gt;,
    sh8out_bit5 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b000000100&lt;/span&gt;,
    sh8out_bit4 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b000001000&lt;/span&gt;,
    sh8out_bit3 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b000010000&lt;/span&gt;,
    sh8out_bit2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b000100000&lt;/span&gt;,
    sh8out_bit1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b001000000&lt;/span&gt;,
    sh8out_bit0 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b010000000&lt;/span&gt;,
    sh8out_end  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b100000000&lt;/span&gt;,

&lt;span style=&#34;color:#75715e&#34;&gt;/* Serial to Parallel Output State Definition */&lt;/span&gt;
    sh8in_begin &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0000000001&lt;/span&gt;,
    sh8in_bit7  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0000000010&lt;/span&gt;,
    sh8in_bit6  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0000000100&lt;/span&gt;,
    sh8in_bit5  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0000001000&lt;/span&gt;,
    sh8in_bit4  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0000010000&lt;/span&gt;,
    sh8in_bit3  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0000100000&lt;/span&gt;,
    sh8in_bit2  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0001000000&lt;/span&gt;,
    sh8in_bit1  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0010000000&lt;/span&gt;,
    sh8in_bit0  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0100000000&lt;/span&gt;,
    sh8in_end   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1000000000&lt;/span&gt;,

&lt;span style=&#34;color:#75715e&#34;&gt;/* Start of Transmission */&lt;/span&gt;
    head_begin &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b01&lt;/span&gt;,
    head_bit   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10&lt;/span&gt;,

&lt;span style=&#34;color:#75715e&#34;&gt;/* End of Transmission */&lt;/span&gt;
    stop_begin &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b001&lt;/span&gt;,
    stop_bit   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b010&lt;/span&gt;,
    stop_end   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b100&lt;/span&gt;,

    YES &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;,
    NO  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Generate SCL (CLK divided by 2) */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; CLK)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(RESET)
        SCL&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
        SCL&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;SCL;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Main FSM Status */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; CLK)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(RESET) &lt;span style=&#34;color:#75715e&#34;&gt;// RESET
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
            link_read  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
            link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
            link_head  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
            link_stop  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
            link_sda   &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
            ACK        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
            RF         &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
            WF         &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
            FF         &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
            main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDLE;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;casex&lt;/span&gt;(main_state)
                IDLE:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                        link_read  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_head  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_stop  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_sda   &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(WR)
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                                WF&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                                main_state&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;Ready;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(RD)
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                                RF&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                                main_state&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;Ready;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                                WF&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                                RF&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                                main_state&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;IDLE;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Ready:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                        link_read  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_head  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                        link_stop  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_sda   &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                        head_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10&lt;/span&gt;;
                        stop_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b01&lt;/span&gt;;
                        head_state    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_begin;
                        FF  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                        ACK &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                        main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Write_start;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Write_start:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift_head;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            sh8out_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;, ADDR[&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;], &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;};
                            link_head &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                            link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                            sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit6;
                            main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Ctrl_write;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Ctrl_write:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift8_out;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(WF)
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit7;
                                    sh8out_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DATA;
                                    main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Data_write;
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(RF)
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                                    head_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10&lt;/span&gt;;
                                    head_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_begin;
                                    main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Read_start;
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Addr_write:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift8_out;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(WF)
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt; 
                                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit7;
                                    sh8out_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DATA;
                                    main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Data_write;
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(RF)
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                                    head_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10&lt;/span&gt;;
                                    head_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_begin;
                                    main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Read_start;
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Data_write:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift8_out;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_begin;
                            main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Stop;
                            link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                
                Read_start:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift_head;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;, ADDR[&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;], &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;};
                            link_head &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                            link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                            link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                            sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit6;
                            main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Ctrl_read;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Data_read:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift8in;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            link_stop &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                            link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                            stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_bit;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                            main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Stop;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                
                Stop:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift_stop;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            ACK &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                            main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Ackn;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Ackn:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                        ACK &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                        WF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                        RF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                        main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDLE;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; 
                    main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDLE;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Serial to Parallel Task */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; shift8in;
&lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;casex&lt;/span&gt;(sh8in_state)
        sh8in_begin:
            sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit7;
        sh8in_bit7:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit6;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit7;
        sh8in_bit6:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit5;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit6;
        sh8in_bit5:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit4;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit5;
        sh8in_bit4:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit3;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit4;
        sh8in_bit3:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit2;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit3;
        sh8in_bit2:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit1;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit2;
        sh8in_bit1:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit0;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit1;
        sh8in_bit0:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_end;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit0;
        sh8in_end:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_read &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit7;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_end;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                link_read &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit7;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Parallel to Serial Task */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; shift8_out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;casex&lt;/span&gt;(sh8out_state)
        sh8out_bit7:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit6;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit7;
        sh8out_bit6:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit5;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit6;
        sh8out_bit5:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit4;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit5;
        sh8out_bit4:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit3;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit4;
        sh8out_bit3:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit2;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit3;
        sh8out_bit2:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit1;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit2;
        sh8out_bit1:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit0;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit1;
        sh8out_bit0:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_end;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit0;
        sh8out_end:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                    link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                    FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_end;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Start of Transmission Task */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; shift_head;
&lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;casex&lt;/span&gt;(head_state)
        head_begin:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                    link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    link_head &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    head_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_bit;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                head_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_begin;
        head_bit:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                    head_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                    head_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_bit;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                head_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_bit;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;/* End of Transmission */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; shift_stop;
&lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;casex&lt;/span&gt;(stop_state)
        stop_begin:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                    link_stop &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_bit;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_begin;
        stop_bit:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    stop_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                    stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_end;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_bit;
        stop_end:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_head &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                    link_stop &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                    link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                    FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_end;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading-1&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt; SDA  &lt;code&gt;link_sda&lt;/code&gt; sda  &lt;code&gt;link_head&lt;/code&gt;/&lt;code&gt;link_write&lt;/code&gt;/&lt;code&gt;link_stop&lt;/code&gt;  sda  sda   &lt;/p&gt;
&lt;p&gt; &lt;strong&gt;&lt;/strong&gt; &lt;code&gt;shift8_out&lt;/code&gt; 8  7 &lt;/p&gt;
&lt;p&gt; &lt;code&gt;Write_start&lt;/code&gt;  &lt;code&gt;shift8_out&lt;/code&gt;  bit6  &lt;code&gt;Addr_write&lt;/code&gt;  bit7  SCL &lt;/p&gt;
&lt;h2 id=&#34;-rtl-&#34;&gt; RTL &lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-9-FPGA-EEPROM/Serial_Check_main_state.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;RTL &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-9-FPGA-EEPROM/RTL.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; EEPROM  EEPROM &lt;/p&gt;</description>
    </item>
    <item>
      <title>Some Verilog HDL Modules</title>
      <link>https://xiahualiu.github.io/posts/2018-08-08-verilog-example/</link>
      <pubDate>Wed, 08 Aug 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-08-08-verilog-example/</guid>
      <description>&lt;p&gt; Verilog HDL &lt;/p&gt;
&lt;p&gt;FPGA &lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;&lt;/h2&gt;
&lt;h3 id=&#34;8-&#34;&gt;8 &lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; adder_8(cout, sum, a, b, cin);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; cout;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] sum;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; cin;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] a, b;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; {cout, sum} &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; b &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; cin;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;always&#34;&gt;always&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;`define&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; plus 3&amp;#39;d0&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;`define&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; minus 3&amp;#39;d1&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;`define&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; band 3&amp;#39;d2&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;`define&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; bor 3&amp;#39;d3&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;`define&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; unegate 3&amp;#39;d4&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; alu(out, opcode, a, b);
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] opcode;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] a, b;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(opcode &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; a &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; b)
&lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt;(opcode)
        &lt;span style=&#34;color:#66d9ef&#34;&gt;`plus&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;b;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;`minus&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;b;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;`band&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;b;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;`bor&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;b;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;`unegate&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;a;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&amp;#39;hx;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;task--always&#34;&gt;task  always&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; sort4(ra, rb, rc, rd, a, b, c, d);
&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; t&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [t:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] ra, rb, rc, rd;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [t:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] a, b, c, d;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [t:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] ra, rb, rc, rd;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(a &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; b &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; c &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; d)
&lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; local &lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[t:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] va, vb, vc, vd;
    {va, vb, vc, vd}&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{a, b, c, d};

    sort2(va,vc);
    sort2(vb,vd);
    sort2(va,vb);
    sort2(vc,vd);
    sort2(vb,vc);

    {ra, rb, rc, rd}&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{va, vb, vc, vd};
&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; sort2;
&lt;span style=&#34;color:#66d9ef&#34;&gt;inout&lt;/span&gt; [t:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] x, y;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [t:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] tmp;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(x&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;y)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        tmp&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;x;
        x&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;y;
        t&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tmp;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-1&#34;&gt;&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; compare(equal, a, b);
&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; equal;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [size&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] a, b;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; equal&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(a&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;b)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;3-8-&#34;&gt;3-8 &lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; decoder(out, in);
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] in;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;in;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-2&#34;&gt;&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; emux1(out, a, b, sel);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; out;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; a, b, sel;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sel&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;a:b;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt; always case &lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; mux2(out, a, b, sel);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; out;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; a, b, sel;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; out;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(a &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; b &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; sel)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt;(sel)
            &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a;
            &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;b;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;#39;bx;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt; always if &lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; mux3(out, a, b, sel);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; out;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; a, b, sel;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; out;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(a &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; b &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; sel)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(sel)
            out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
            out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;b;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-3&#34;&gt;&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; parity(even_numbits, odd_numbits, input_bus);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; even_numbits, odd_numbits;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] input_bus;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; odd_numbits&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;^&lt;/span&gt;input_bus;
    &lt;span style=&#34;color:#75715e&#34;&gt;//assign b=^a; equals assign b=a[0]^a[1]^a[2]^a[3]^a[4]^a[5]^a[6]^a[7];
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; even_numbits&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;odd_numbits;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-4&#34;&gt;&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;1&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; trist1(out, in, enable);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; out;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; in, enable;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;enable&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;in:&amp;#39;bz;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;2&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; trist2(out, in, enable);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; out;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; in, enable;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;bufif1&lt;/span&gt; mubuf1(out, in, enable);
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-5&#34;&gt;&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; bidir(tri_inout, out, in, en, b);
&lt;span style=&#34;color:#66d9ef&#34;&gt;inout&lt;/span&gt; tri_out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; in, en, b;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; tri_inout&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;en&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;in:&amp;#39;bz;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tri_inout&lt;span style=&#34;color:#f92672&#34;&gt;^&lt;/span&gt;b;
    &lt;span style=&#34;color:#75715e&#34;&gt;//tri_inout  in  out
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading-6&#34;&gt;&lt;/h2&gt;
&lt;h3 id=&#34;d-&#34;&gt;D &lt;/h3&gt;
&lt;p&gt;D  JK  D D &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; dff(q, data, clk);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; q;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; data, clk;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; q;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; clk)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        q&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;data;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-7&#34;&gt;&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;1&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; latch1(q, data, clk);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; q;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; data, clk;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; q&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;clk&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;data:q;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;2&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; latch1(q, data, clk);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; q;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; data, clk;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; q; &lt;span style=&#34;color:#75715e&#34;&gt;// always 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(clk &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; data)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(clk)
        q&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;data;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-8&#34;&gt;&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; latch2(q, data, clk, set, reset);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; q;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; data, clk, set, reset;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; q&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;reset&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;(set&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;(clk&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;data:q));
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-9&#34;&gt;&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; shifter(din, clk, clr, dout);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; din, clk, clr;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] dout;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] dout;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(posegde clk)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(clr)
            dout&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
            dout&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;dout&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
            dout[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;din;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;8--1&#34;&gt;8 &lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;1&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; counter1(out, cout, data, load, cin, clk);
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; cout;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] data;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; load, cin, clk;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; clk)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(load)
            out&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;data;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
            out&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;out&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;cin;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; cout&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;out)&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;cin;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;2&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; counter2(out, cout, data, load, cin, clk);
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; cout;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] data;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; load, cin, clk;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; cout;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] preout;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(posegde clk)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        out&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;preout;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(out &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; data &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; load &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; cin)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        {cout, preout}&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;out&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;cin;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(load)
            preout&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;data;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    <item>
      <title>Adder and Multiplier in FPGA</title>
      <link>https://xiahualiu.github.io/posts/2018-08-07-claa/</link>
      <pubDate>Tue, 07 Aug 2018 10:48:30 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-08-07-claa/</guid>
      <description>&lt;p&gt; FPGA &lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;strong&gt;&lt;/strong&gt;  &lt;strong&gt;&lt;/strong&gt; 5  $XYC_{i-1}SC_i$$X$$Y$ $S_i$ $C_{i-1}$ $C_i$ &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;$X_i$&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;$Y_i$&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;$C_{i-1}$&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;$S_i$&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;$C_i$&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;$$C_i=X_iY_i+Y_iC_{i-1}+X_iC_{i-1}$$&lt;/p&gt;
&lt;p&gt;$$S_i=X_i\overline{C_i}+Y_i\overline{C_i}+C_{i-1}\overline{C_i}+X_iY_iC_{i-1}$$&lt;/p&gt;
&lt;p&gt; $P_i=X_i\oplus Y_i \quad G=X_i \cdot Y_i$ ,$S_i$ &lt;/p&gt;
&lt;p&gt;$$S_i=P_i \oplus C_{i-1}$$&lt;/p&gt;
&lt;p&gt;$$ C_i=P_i \cdot C_{i-1} + G_i$$
(Karnaugh Map)&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/Serial-Adder.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; $C_{out}$  $C_{in}$ &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/Full-Adder.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; 9 (Propagation Delay)(Gate Delay)Line Delay&lt;/p&gt;
&lt;p&gt;32bit (2n+1)T =(232+1)T =65TiPhone 5sA7 SoC28nm1.3GHz0.66ns T  0.02ns 32-bit 1.3ns  769MHz A7  32bit  RCA &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;Carry-Look-Ahead-AdderCLA&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;
$$ C_i=P_i \cdot C_{i-1} + G_i$$&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;$$
\begin{align}
C_{out} &amp;amp;=P_3 \cdot C_2 + G_3 \&lt;br&gt;
&amp;amp;=P_3 \cdot (P_2 \cdot C_1 +G_2)+G_3\&lt;br&gt;
&amp;amp;=G_3+P_3 \cdot G_2+P_3 \cdot P_2 \cdot G_1+P_3 \cdot P_2 \cdot P_1 \cdot G_0+ \&lt;br&gt;
&amp;amp;\ P_3 \cdot P_2 \cdot P_1 \cdot P_0 \cdot C_{in}
\end{align}
$$&lt;/p&gt;
&lt;p&gt;$P_3, G_3, P_2, G_2&amp;hellip;$ $C_{out}$ &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/CLAA.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; 3  $C_2, C_1,C_0$  72LS283 &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://gss1.bdstatic.com/9vo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike80%2C5%2C5%2C80%2C26/sign=e34dec20b27eca80060831b5f04afcb8/d53f8794a4c27d1e834771c719d5ad6eddc4384b.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; 4  32  16  4  4  4 &lt;/p&gt;
&lt;p&gt; $PX_0=P_3 \cdot P_2 \cdot P_1 \cdot P_0 \quad GX_0=G_3+P_3 \cdot G_2+P_3 \cdot P_2 \cdot G_1+P_3 \cdot P_2 \cdot P_1 \cdot G_0$&lt;/p&gt;
&lt;p&gt; $C_4=GX_0+PX_0 \cdot C_0$ ( $C_4$   $C_{out}$$C_0$  $C_{in}$)&lt;/p&gt;
&lt;p&gt; $PX_1=P_7 \cdot P_6 \cdot P_5 \cdot P_4 \quad GX_1=G_7+P_7 \cdot G_6+P_7 \cdot P_6 \cdot G_5+P_7 \cdot P_6 \cdot P_5 \cdot G_4$&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;$$
\begin{align}
C_8 &amp;amp;= GX_1+PX_1 \cdot C_4 \&lt;br&gt;
&amp;amp;= GX_1 + PX_1 \cdot (GX_0+PX_0 \cdot C_0)\&lt;br&gt;
&amp;amp;= GX_1 + PX_1 \cdot GX_0 + PX_1 \cdot PX_0 \cdot C_0
\end{align}
$$&lt;/p&gt;
&lt;p&gt; $PX_i$  $GX_i$  4 &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/16-bit.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; 3  6 &lt;/p&gt;
&lt;h3 id=&#34;-verilog-&#34;&gt; Verilog &lt;/h3&gt;
&lt;p&gt; FPGA  FPGA &lt;/p&gt;
&lt;p&gt; 4 &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; b4_adder(X, Y, sum, C);
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] X, Y;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] sum;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; C;

&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; {C, sum} &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; X &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; Y;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading-1&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;$$ 0 \times 0=0;\quad 1 \times 0=0;\quad 1 \times 1=1$$&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/times.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;MU(Multiplier Unit)&lt;/strong&gt;, &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/multiplier.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; MU  MU &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/new_m.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;-verilog--1&#34;&gt; Verilog &lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; b4_mult(X, Y, Z);
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] X, Y;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] Z;

&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; Z &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; X &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; Y;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; FPGA  ASIC &lt;/p&gt;
&lt;p&gt;Verilog  VHDL &lt;/p&gt;</description>
    </item>
    <item>
      <title>Sorting Algorithms</title>
      <link>https://xiahualiu.github.io/posts/2018-07-27-sorting/</link>
      <pubDate>Fri, 27 Jul 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-07-27-sorting/</guid>
      <description>&lt;p&gt;&lt;/p&gt;
&lt;p&gt; N 0 &lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;&lt;/h2&gt;
&lt;p&gt; N  N &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;InsertionSort&lt;/span&gt;(ElementType A[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; N) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; j, P;

	ElementType Tmp;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (P &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; P &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; N; P&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {
		Tmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[P];
		&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (j &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; P; j &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; A[j &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; Tmp; j&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;)
			A[j] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[j &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;];
		A[j] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Tmp;
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;34&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;8&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;64&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;51&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;32&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;21&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;p=1 &lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;51&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;p=2 &lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;51&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;p=3 &lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;51&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;p=4 &lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;51&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;p=5 &lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;51&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; &lt;em&gt;O(N^2)&lt;/em&gt; N^2 &lt;/p&gt;
&lt;p&gt; A i&amp;lt;j,  A[i]&amp;gt;A[j] 9  (34, 8), (34, 32), (34, 21), (64, 32), (64, 21), (51, 32), (51, 21)  (32, 21)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt; N  N(N-1)/4&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt; N N  N(N-1)/2 N(N-1)/4&lt;/p&gt;
&lt;p&gt; N(N-1)/4 = (N^2) &lt;/p&gt;
&lt;p&gt; N^2 &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;shellsort&#34;&gt;(Shellsort)&lt;/h2&gt;
&lt;p&gt; k  &lt;em&gt;hk&lt;/em&gt; iA[i]&amp;lt;=A[i+hk] hk- (hk-sorted) h(k-1)  hk hk-&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;81&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;94&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;11&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;96&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;12&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;35&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;17&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;95&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;28&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;58&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;41&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;75&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;15&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;28&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;41&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;75&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;96&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;58&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;81&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;94&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;95&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;28&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;41&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;58&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;94&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;75&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;81&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;96&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;95&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;28&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;41&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;58&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;75&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;81&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;94&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;95&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;96&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; hk  h  hk &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Shellsort&lt;/span&gt;(ElementType A[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; N) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i, j, Increment;
	ElementType Tmp;

	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (Increment &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; N &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;; Increment &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; Increment &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Increment; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; N; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {
			Tmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[i];
			&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (j &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; i; j &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Increment &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; A[j&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;Increment] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; Tmp; j &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Increment)
					A[j] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[j &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; Increment];
			A[j] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Tmp;
		}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; &lt;strong&gt;&lt;/strong&gt;  Increment  Increment  Increment &lt;/p&gt;
&lt;h3 id=&#34;-hk&#34;&gt; hk&lt;/h3&gt;
&lt;p&gt; hk  Hibbard Hibbard 137 &amp;hellip; 2^k-1  Hibbard  &lt;em&gt;O(N^(3/2))&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://eggycat.coding.me/2018/07/24/Priority_Queue/&#34;&gt;&lt;/a&gt; DeleteMin  &lt;em&gt;O(N*logN)&lt;/em&gt; logN N  &lt;em&gt;O(N)&lt;/em&gt;&lt;em&gt;O(N+N*logN)&lt;/em&gt; &lt;em&gt;O(N*logN)&lt;/em&gt;  &lt;em&gt;Sedgewick&lt;/em&gt; &lt;/p&gt;
&lt;p&gt; &lt;em&gt;O(N)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt; O(N) DeleteMax&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define LeftChild(i) (2 * (i) + 1)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PercDown&lt;/span&gt;(ElementType A[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; N) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Child;
	ElementType Tmp;

	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (Tmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[i]; LeftChild(i) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; N; i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Child) {
		Child &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LeftChild(i);
		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (Child &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; N &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; A[Child &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; A[Child])
			Child&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;;
		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (Tmp &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; A[Child])
			A[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[Child];
		&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
			&lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
	}
	A[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Tmp;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Heapsort&lt;/span&gt;(ElementType A[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; N) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i;

	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; N &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;/* Build Heap Question: WHY i=N/2 */&lt;/span&gt;
		PercDown(A, i, N);
	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; N &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;) { &lt;span style=&#34;color:#75715e&#34;&gt;/* DeleteMax */&lt;/span&gt;
		Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[i]);
		PercDown(A, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, i);
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;heading-2&#34;&gt;&lt;/h4&gt;
&lt;p&gt; 2N  2[logi] &lt;/p&gt;
&lt;h2 id=&#34;heading-3&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;em&gt;O(N*logN)&lt;/em&gt; &lt;/p&gt;
&lt;p&gt; A B C  Aptr  Bptr  C +1 C&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-27-Sorting/mergesort.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; N-1 &lt;/p&gt;
&lt;p&gt; N = 1 A B  C &lt;/p&gt;
&lt;p&gt; &lt;strong&gt;&lt;/strong&gt;  &lt;code&gt;TmpArray&lt;/code&gt;  Merge Merge &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MSort&lt;/span&gt;(ElementType A[], ElementType TmpArray[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Left, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Right) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Center;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (Left &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; Right) {
		Center &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (Left &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; Right) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;;
		MSort(A, TmpArray, Left, Center);
		MSort(A, TmpArray, Center &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, Right);
		Merge(A, TmpArray, Left, Center &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, Right);
	}
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Merge&lt;/span&gt;(ElementType A[], ElementType TmpArray[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Lpos, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Rpos, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; RightEnd) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i, LeftEnd, NumElements, TmpPos;
	LeftEnd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Rpos &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
	TmpPos &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Lpos;
	NumElements &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; RightEnd &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; Lpos &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;

	&lt;span style=&#34;color:#75715e&#34;&gt;/* Main Loop */&lt;/span&gt;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (Lpos &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LeftEnd&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;Rpos &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; RightEnd)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (A[Lpos] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[Rpos])
			TmpArray[TmpPos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[Lpos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;];
		&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
			TmpArray[TmpPos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[Rpos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;];

	&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (Lpos &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LeftEnd)
		TmpArray[TmpPos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[Lpos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;];
	&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (RightEnd &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; RightEnd)
		TmpArray[TmpPos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[Rpos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;];

	&lt;span style=&#34;color:#75715e&#34;&gt;/* Copy back */&lt;/span&gt;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; NumElements; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;, RightEnd&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;) {
		A[RightEnd] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Tmp[RightEnd];
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;heading-4&#34;&gt;&lt;/h4&gt;
&lt;p&gt; N  O(N)&lt;/p&gt;
&lt;p&gt; MathJax  JS  Math Setting-&amp;gt;Scale All Math &lt;/p&gt;
&lt;p&gt;$$ T(1)=1 $$&lt;/p&gt;
&lt;p&gt;$$ T(N)=2T(N/2)+N $$&lt;/p&gt;
&lt;p&gt; N&lt;/p&gt;
&lt;p&gt;$$ \frac{T(N)}{N}=\frac{T(N/2)}{N/2}+1 $$&lt;/p&gt;
&lt;p&gt; N  N/2, N/4&amp;hellip; &lt;/p&gt;
&lt;p&gt;$$ \frac{T(N)}{N} + \frac{T(N/2)}{N/2} + &amp;hellip; =\frac{T(N/2)}{N/2}+ 1 + \frac{T(N/4)}{N/4} + 1 +&amp;hellip; $$&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;$$ \frac{T(N)}{N}=\frac{T(1)}{1} + \log_2 N $$&lt;/p&gt;
&lt;p&gt;
$$T(N)=N\log_2N+N=O(N\log_{}N)$$&lt;/p&gt;
&lt;p&gt; &lt;em&gt;O(NlogN)&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-5&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;em&gt;O(NlogN)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-6&#34;&gt;&lt;/h2&gt;
&lt;h4 id=&#34;heading-7&#34;&gt;&lt;/h4&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h4 id=&#34;heading-8&#34;&gt;&lt;/h4&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;&lt;/strong&gt; &lt;/p&gt;
&lt;h2 id=&#34;heading-9&#34;&gt;&lt;/h2&gt;
&lt;h4 id=&#34;heading-10&#34;&gt;&lt;/h4&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h4 id=&#34;heading-11&#34;&gt;&lt;/h4&gt;
&lt;p&gt;N&amp;lt;20)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;ElementType &lt;span style=&#34;color:#a6e22e&#34;&gt;Median3&lt;/span&gt;(ElementType A[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Left, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Right) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Center &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (Left &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; Right) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (A[Left] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; A[Center])
		Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Left], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Center]);
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (A[Left] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; A[Right])
		Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Left], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Right]);
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (A[Center] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; A[Right])
		Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Center], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Right]);

	Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Center], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Right &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]);
	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; A[Right &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;];
}

&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define Cutoff(3)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Qsort&lt;/span&gt;(ElementType A[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Left, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Right) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i, j;
	ElementType Pivot;

	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (Left &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; Cutoff &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Right) {
		Pivot &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Median3(A, Left, Right);
		i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Left; j &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Right &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
		&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (;;) {
			&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (A[&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;j] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; Pivot) {}
			&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (A[&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;j] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; Pivot) {}
			&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; j)
				Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[i], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[j]);
			&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
				&lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
		}
		Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[i], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Right &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]);

		Qsort(A, Left, i &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
		Qsort(A, i &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, Right);
	}
	&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
		InsertSort(A &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; Left, Right &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; Left &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading-12&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-13&#34;&gt;&lt;/h2&gt;
&lt;p&gt; M  M  0  3,8,2,4,5,1,3  M=8  3  M[3]++ 8M[8]++&lt;/p&gt;
&lt;p&gt; &lt;em&gt;O(NlogN)&lt;/em&gt;  M- M &lt;/p&gt;
&lt;h2 id=&#34;heading-14&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h3 id=&#34;heading-15&#34;&gt;&lt;/h3&gt;
&lt;p&gt; Merge  M  M  &lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;heading-16&#34;&gt;&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-17&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>Priority Queue/Heap</title>
      <link>https://xiahualiu.github.io/posts/2018-07-24-priority_queue/</link>
      <pubDate>Tue, 24 Jul 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-07-24-priority_queue/</guid>
      <description>&lt;p&gt; &lt;strong&gt;Priority Queue&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; ADT &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;
&amp;mdash;&lt;em&gt;Data Structure and Algorithm Analysis in C&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Enqueue&lt;/strong&gt; &lt;strong&gt;Dequeue&lt;/strong&gt;0123&amp;hellip; &lt;strong&gt;DeleteMin&lt;/strong&gt; &lt;strong&gt;Insert&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-24-Priority_Queue/module.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;em&gt;O(1)&lt;/em&gt;  &lt;em&gt;O(n)&lt;/em&gt;  &lt;em&gt;O(n)&lt;/em&gt; &lt;em&gt;O(1)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt; &lt;em&gt;O(logN)&lt;/em&gt; &lt;em&gt;O(logN)&lt;/em&gt; &lt;/p&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;strong&gt;binary heap&lt;/strong&gt; &lt;strong&gt;heap&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;heading-3&#34;&gt;&lt;/h3&gt;
&lt;p&gt; 0 &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-24-Priority_Queue/binary_heap.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; i  i/2  2i  2i+1 &lt;/p&gt;
&lt;h3 id=&#34;heading-4&#34;&gt;&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define ElementType int&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define MinValue 0&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; HeapStruct {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Capacity;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Size;
	ElementType &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;Elements;
}&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;PriorityQueue;

&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;PriorityQueue &lt;span style=&#34;color:#a6e22e&#34;&gt;PQInitialize&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; MaxElements);
&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PQDestroy&lt;/span&gt;(PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MakeEmpty&lt;/span&gt;(PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Insert&lt;/span&gt;(ElementType X, PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PrintPQ&lt;/span&gt;(PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;ElementType &lt;span style=&#34;color:#a6e22e&#34;&gt;DeleteMin&lt;/span&gt;(PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;ElementType &lt;span style=&#34;color:#a6e22e&#34;&gt;FindMin&lt;/span&gt;(PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;IsEmpty&lt;/span&gt;(PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//()
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DecreaseKey&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; P,&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; delta,PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//()
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;IncreaseKey&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; P, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; delta, PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DeleteKey&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; P, PriorityQueue H);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; &lt;a href=&#34;https://git.coding.net/Eggycat/DSAA.git&#34;&gt;repo&lt;/a&gt;  &lt;code&gt;Priority_Queue&lt;/code&gt; &lt;/p&gt;
&lt;h2 id=&#34;d-&#34;&gt;d-&lt;/h2&gt;
&lt;p&gt;d- &lt;code&gt;Insert&lt;/code&gt;  &lt;code&gt;Insert&lt;/code&gt;  &lt;em&gt;O(logdN)&lt;/em&gt; &lt;code&gt;DeleteMin&lt;/code&gt;  &lt;em&gt;O(d&lt;/em&gt;logdN)*d  B &lt;/p&gt;
&lt;h2 id=&#34;heading-5&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt; X  &lt;strong&gt;NPL&lt;/strong&gt; &lt;em&gt;Npl(X)&lt;/em&gt;  &lt;em&gt;X&lt;/em&gt;  &lt;em&gt;Npl(X)&lt;/em&gt;  0 *Npl(NULL)*=-1&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt; r  2^r-1 &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-24-Priority_Queue/leftist_heap.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-6&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h4 id=&#34;heading-7&#34;&gt;&lt;/h4&gt;
&lt;p&gt; H1&amp;lt;-H2  H1  H2  H1 H1  H1  &lt;em&gt;Npl&lt;/em&gt;  0&lt;/p&gt;
&lt;p&gt; H1  H2  H1  H2 H1  H1  H1  H1  &lt;em&gt;Npl&lt;/em&gt; &lt;/p&gt;
&lt;p&gt;H1  H1  H1*  H1  H1*  H1*  H2  Npl &lt;/p&gt;
&lt;p&gt; H1  H1  H2  H1* H2  H1*&amp;lt;-H2  H2&amp;lt;-H1* H1  H2  H1  H2  H1  H1  H2 &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SwapChildren&lt;/span&gt;(PriorityQueue L) {
	PriorityQueue temp;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (L &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NULL)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;;
	temp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; L&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Left;
	L&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Left &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; L&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Right;
	L&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Right &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; temp;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; PriorityQueue &lt;span style=&#34;color:#a6e22e&#34;&gt;Merge1&lt;/span&gt;(PriorityQueue L1, PriorityQueue L2) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Left &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NULL)
		L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Left &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; L2;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
		L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Right &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Merge(L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Right, L2);
		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Left&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Npl &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Right&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Npl)
			SwapChildren(L1);

		L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Npl &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Right&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Npl &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
	}
	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; L1;
}

PriorityQueue &lt;span style=&#34;color:#a6e22e&#34;&gt;Merge&lt;/span&gt;(PriorityQueue L1, PriorityQueue L2) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (L1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NULL)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; L2;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (L2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NULL)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; L1;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Element &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; L2&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Element)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Merge1(L1, L2);
	&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Merge1(L2, L1);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading-8&#34;&gt;&lt;/h2&gt;
&lt;p&gt; AVL &lt;/p&gt;
&lt;p&gt; Npl &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-9&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;strong&gt;&lt;/strong&gt;  2  0  k  B&lt;em&gt;k&lt;/em&gt;  B&lt;em&gt;k-1&lt;/em&gt; &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-24-Priority_Queue/binomial_queue.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; 11 11=8+2+1=0b1011 B0B1B3 B2 0&lt;/p&gt;
&lt;p&gt; &lt;em&gt;O(logn)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;  &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-24-Priority_Queue/binomial_queue_new.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; BinNode{
	ElementType Element;
	Position Child;
	Position Sibling;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; B1  B2 B1  B2 B1&amp;lt;-B2 &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;BinTree &lt;span style=&#34;color:#a6e22e&#34;&gt;CombineTrees&lt;/span&gt;(BinTree T1, BinTree T2){
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(T1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Element &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; T2&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Element)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; CombineTrees(T2, T1);
	T2&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Sibling&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;T1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Child;
	T1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Child&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;T2;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; T1;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading-10&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;em&gt;logN&lt;/em&gt; &lt;em&gt;logN&lt;/em&gt; ( &lt;em&gt;O(logN)&lt;/em&gt;) &lt;em&gt;O(N)&lt;/em&gt; &lt;em&gt;O(logN)&lt;/em&gt; &lt;em&gt;O(logN)&lt;/em&gt; &lt;/p&gt;
&lt;p&gt;Peace out~&lt;/p&gt;</description>
    </item>
    <item>
      <title>Linking (CSAPP Reading Notes)</title>
      <link>https://xiahualiu.github.io/posts/2018-07-13-csapp-link/</link>
      <pubDate>Fri, 13 Jul 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-07-13-csapp-link/</guid>
      <description>&lt;h2 id=&#34;heading&#34;&gt;&lt;/h2&gt;
&lt;p&gt;Linux LD  &lt;strong&gt;static linker&lt;/strong&gt;  &lt;strong&gt;&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;symbol resolution&lt;/strong&gt; C  static &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;reallocation&lt;/strong&gt; 0  &lt;em&gt;&lt;/em&gt;  &lt;em&gt;relocation entry&lt;/em&gt; &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;****&lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;&lt;/h2&gt;
&lt;p&gt; ELF &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-13-CSAPP-link/ELF_structure.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ELF ELF header 16  &lt;strong&gt;&lt;/strong&gt;  &lt;strong&gt;&lt;/strong&gt; ELF  &lt;strong&gt;ELF &lt;/strong&gt;&lt;strong&gt;&lt;/strong&gt;&lt;strong&gt; x86-64&lt;/strong&gt;&lt;strong&gt;section header table&lt;/strong&gt;entry&lt;/p&gt;
&lt;p&gt; ELF  &lt;strong&gt;section&lt;/strong&gt; ELF &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;.text&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.rodata&lt;/code&gt; &lt;code&gt;printf&lt;/code&gt;  &lt;code&gt;switch case&lt;/code&gt; &lt;/li&gt;
&lt;li&gt;&lt;code&gt;.data&lt;/code&gt; C  C  .data  .bss &lt;/li&gt;
&lt;li&gt;&lt;code&gt;.bss&lt;/code&gt; C  0  0&lt;/li&gt;
&lt;li&gt;&lt;code&gt;symtab&lt;/code&gt; &lt;code&gt;-g&lt;/code&gt;  .symtab  STRIP .symtab &lt;/li&gt;
&lt;li&gt;&lt;code&gt;.rel.text&lt;/code&gt; .text  &lt;strong&gt;&lt;/strong&gt; &lt;/li&gt;
&lt;li&gt;&lt;code&gt;rel.data&lt;/code&gt; &lt;strong&gt;&lt;/strong&gt;  &lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.debug&lt;/code&gt; C  &lt;code&gt;-g&lt;/code&gt; &lt;/li&gt;
&lt;li&gt;&lt;code&gt;.line&lt;/code&gt; C  &lt;code&gt;.text&lt;/code&gt;  &lt;code&gt;-g&lt;/code&gt; &lt;/li&gt;
&lt;li&gt;&lt;code&gt;.strtab&lt;/code&gt; .symtab  .debug  null &lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;heading-3&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;/&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;Position-Independent CodePIC&lt;/strong&gt; GCC  -fpic  GNU  PIC &lt;/p&gt;
&lt;h4 id=&#34;pic-&#34;&gt;PIC &lt;/h4&gt;
&lt;p&gt; PIC &lt;/p&gt;
&lt;p&gt;PIC  &lt;strong&gt;Global Offset Table, GOT&lt;/strong&gt; GOT  8  GOT  GOT  GOT&lt;/p&gt;
&lt;p&gt; GOT  GOT  GOT  GOT  GOT &lt;/p&gt;
&lt;h4 id=&#34;pic--1&#34;&gt;PIC &lt;/h4&gt;
&lt;p&gt; &lt;em&gt;&lt;/em&gt;  PIC  GOT &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;GOT &lt;/strong&gt; &lt;strong&gt;procedure linkage table,PLT&lt;/strong&gt;GOT PLT &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PLT&lt;/strong&gt;PLT  16 PLT[0] &lt;code&gt;__libc_start_main&lt;/code&gt; &lt;code&gt;main&lt;/code&gt;  PLT[2] &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;GOT&lt;/strong&gt;GOT  8  PLT GOT[0]  GOT&lt;a href=&#34;https://xiahualiu.github.io/img/2018-7-13-CSAPP-link/ELF_structure.png&#34;&gt;1&lt;/a&gt;  PLT &lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    <item>
      <title>Program Low Level Optimization (CSAPP Reading Notes)</title>
      <link>https://xiahualiu.github.io/posts/2018-07-05-optimize-your-c-code/</link>
      <pubDate>Thu, 05 Jul 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-07-05-optimize-your-c-code/</guid>
      <description>&lt;p&gt;&lt;/p&gt;
&lt;p&gt; 20% &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt; C  &lt;em&gt;&lt;/em&gt;  &lt;strong&gt;&lt;/strong&gt; &lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;strong&gt;&lt;/strong&gt;  &lt;strong&gt;&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt; (instruction-level parallelism) &lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;twiddle1&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp, &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp)
{
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp;
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;twiddle2&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp, &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp)
{
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; &lt;code&gt;twiddle1()&lt;/code&gt;  yp xp xp yp xp xp &lt;code&gt;twiddle2()&lt;/code&gt;  3  yp xp xp  &lt;code&gt;twiddle1()&lt;/code&gt; &lt;code&gt;twiddle2()&lt;/code&gt; &lt;/p&gt;
&lt;p&gt; &lt;code&gt;xp&lt;/code&gt;  &lt;code&gt;yp&lt;/code&gt; &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;twiddle1&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp, &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp)
{
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp; &lt;span style=&#34;color:#75715e&#34;&gt;/* *xp=2* *xp */&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp; &lt;span style=&#34;color:#75715e&#34;&gt;/* *xp=2* 2* *xp=4* *xp */&lt;/span&gt;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;twiddle2&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp, &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp)
{
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp; &lt;span style=&#34;color:#75715e&#34;&gt;/* *xp=3* *xp */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; &lt;code&gt;*xp&lt;/code&gt;  4  3 &lt;/p&gt;
&lt;p&gt; &lt;strong&gt;memory aliasing&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;f&lt;/span&gt;();

&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func1&lt;/span&gt;(){
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; f()&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;f()&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;f()&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;f();
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func2&lt;/span&gt;(){
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;f();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; &lt;code&gt;func1()&lt;/code&gt;  &lt;code&gt;f()&lt;/code&gt; &lt;code&gt;func2()&lt;/code&gt;  2  &lt;code&gt;func2()&lt;/code&gt; &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;f&lt;/span&gt;();
 &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; counter&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; 

 &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;f&lt;/span&gt;(){
     &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; counter&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;;
 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; &lt;code&gt;f()&lt;/code&gt;  counter &lt;code&gt;f()&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;strong&gt;Cycles Per ElementCPE&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; &lt;code&gt;psum1&lt;/code&gt; &lt;code&gt;psum2&lt;/code&gt; n  CPE  CPE &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/*  n  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;psum1&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;float&lt;/span&gt; a[], &lt;span style=&#34;color:#66d9ef&#34;&gt;float&lt;/span&gt; p[], &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; n)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; i;
    p[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;];
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; n; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
        p[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; p[i&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; a[i];
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; psum2(&lt;span style=&#34;color:#66d9ef&#34;&gt;float&lt;/span&gt; a[]; &lt;span style=&#34;color:#66d9ef&#34;&gt;float&lt;/span&gt; p[]; &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; n)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; i;
    p[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;];
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; n&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) {
        &lt;span style=&#34;color:#66d9ef&#34;&gt;float&lt;/span&gt; mid_val &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; p[i&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; a[i];
        p[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mid_val;
        p[i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mid_val &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; a[i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;];
    }
    &lt;span style=&#34;color:#75715e&#34;&gt;/*  n  */&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; n)
        p[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; p[i&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; a[i];
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; n  n  &lt;strong&gt; - n&lt;/strong&gt; &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;psum1: 368 + 9.0n&lt;/li&gt;
&lt;li&gt;psum2: 368 + 6.0n&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;psum2&lt;/code&gt;  &lt;code&gt;psum1&lt;/code&gt; n &lt;code&gt;psum2&lt;/code&gt;  &lt;code&gt;psum1&lt;/code&gt; &lt;strong&gt;loop unrolling&lt;/strong&gt; &lt;/p&gt;
&lt;h3 id=&#34;heading-3&#34;&gt;&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; len;
    data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;data;
} vec_rec, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;vec_ptr;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; len  data_t &lt;/p&gt;
&lt;p&gt; get_vec_element&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
vec_ptr &lt;span style=&#34;color:#a6e22e&#34;&gt;new_vec&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; len)
{
    &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
    vec_ptr result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (vec_ptr) malloc(&lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(vec_rec));
    data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NULL;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;result)
        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; NULL; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
    result&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;len &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; len;
    &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (len &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) {
        data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)calloc(len, &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(data_t));
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;data) {
            free((&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;) result);
            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; NULL; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
        }
    }
    &lt;span style=&#34;color:#75715e&#34;&gt;/* data  */&lt;/span&gt;
    result&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; data;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; result;
}

&lt;span style=&#34;color:#75715e&#34;&gt;/*  dest *
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; *  0 1  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;get_vec_element&lt;/span&gt;(vec_ptr v, &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; index, data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (index &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; index &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; v&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;len)
        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; v&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;data[index];
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
}

&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;vec_length&lt;/span&gt;(vec_ptr v)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; v&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;len;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define IDENT 0&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define OP +&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;// #define IDENT 1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// #define OP *
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;combine1&lt;/span&gt;(vec_ptr, data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; i;

    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDENT;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; vec_length(v); i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {
        data_t val;
        get_vec_element(v, i, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;val);
        &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest OP val;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; Intel Core i7 Haswell  CPE &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; CPE&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; CPE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;22.68(+) 20.02(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;19.98(+) 20.18(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt; -O1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10.12(+) 10.12(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10.17(+) 11.14(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; &amp;ldquo;-O1&amp;rdquo; &lt;/p&gt;
&lt;h2 id=&#34;heading-4&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;code&gt;combine1&lt;/code&gt;  &lt;code&gt;vec_length&lt;/code&gt;  &lt;code&gt;for&lt;/code&gt;  &lt;code&gt;for&lt;/code&gt;  &lt;code&gt;vec_length&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; combine2(vec_ptr, data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; i;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; length &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; vec_length(v);

    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDENT;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; length; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {
        data_t val;
        get_vec_element(v, i, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;val);
        &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest OP val;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; CPE&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; CPE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt; -O1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10.12(+) 10.12(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10.17(+) 11.14(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt; vec_length&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.02(+) 9.03(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.02(+) 11.03(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; &lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-5&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;code&gt;combine2&lt;/code&gt;  &lt;code&gt;get_vec_element()&lt;/code&gt;  i  i &lt;/p&gt;
&lt;p&gt; &lt;code&gt;get_vec_start()&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;get_vec_start&lt;/span&gt;(vec_ptr v)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; v&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;data;
}
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;combine3&lt;/span&gt;(vec_ptr v,data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; i;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; length &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; vec_length(v);
    data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; get_vec_start(v);

    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDENT;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; length; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;){
        &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest OP data[i];
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; CPE&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; CPE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt; vec_length&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.02(+) 9.03(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.02(+) 11.03(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.17(+) 9.02(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.02(+) 11.04(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; &lt;code&gt;get_vec_element()&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-6&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;code&gt;combine3()&lt;/code&gt;  *dest &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;combine3 data_t OP = *
dest  %rbx data + i  %rdx data + length  %rax 

.L17:                           loop:
    vmovsd (%rbx), %xmm0            *dest -&amp;gt; %xmm0
    vmulsd (%rdx), %xmm0, %xmm0     data[i] * %xmm0 -&amp;gt; %xmm0
    vmovsd %xmm0, (%rbx)            %xmm0 -&amp;gt; *dest
    addq $8, %rdx                   i += 8
    cmpq %rax, %rdx                 if (!(%rdx - %rax)) set ZF
    jne .L17                        if (~ZF) loop:
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; &lt;code&gt;*dest -&amp;gt; %xmm0&lt;/code&gt;  &lt;code&gt;%xmm0 -&amp;gt; *dest&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;combine3 data_t OP = *
acc  %xmm0 data + i  %rdx data + length  %rax 
.L25:                           loop:
    vmulsd (%rdx), %xmm0, %xmm0     data[i] * %xmm0 -&amp;gt; %xmm0
    addq $8, %rdx                   i += 8
    cmpq %rax, %rdx                 if (!(%rdx - %rax)) set ZF
    jne .L25                        if (~ZF) loop:
&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;combine4&lt;/span&gt;(vec_ptr v, data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; i;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; length &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; vec_length(v);
    data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; get_vec_start(v);
    data_t acc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDENT;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; length; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {
        acc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; acc OP data[i];
    }
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; acc;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; acc &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; CPE&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; CPE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.17(+) 9.02(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.02(+) 11.04(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.27(+) 3.01(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.01(+) 5.01(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; &lt;code&gt;combine4&lt;/code&gt; dest &lt;/p&gt;
&lt;p&gt; &amp;lsquo;-O2&amp;rsquo;  &lt;code&gt;combine3&lt;/code&gt;  &lt;code&gt;combine4&lt;/code&gt; &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; CPE&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; CPE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-O1 &lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.17(+) 9.02(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.02(+) 11.04(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-O2 &lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.60(+) 3.01(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.01(+) 5.01(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.27(+) 3.01(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.01(+) 5.01(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;combine3  -O2 data_t OP = *
dest  %rbx data + i  %rdx data + length  %rax 

.L22:                           loop:
    vmulsd (%rdx), %xmm0, %xmm0     data[i] * %xmm0 -&amp;gt; %xmm0
    addq $8, %rdx                   i += 8
    cmpq %rax, %rdx                 if (!(%rdx - %rax)) set ZF
    vmovsd %xmm0, (%rbx)            %xmm0 -&amp;gt; *dest
    jne .L22                        if (~ZF) loop:
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-7&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;em&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt; &lt;em&gt;&lt;/em&gt;&lt;em&gt;&lt;/em&gt; &lt;/p&gt;
&lt;h2 id=&#34;heading-8&#34;&gt;&lt;/h2&gt;
&lt;p&gt; Intel  &lt;em&gt;&lt;/em&gt; &lt;strong&gt;&lt;/strong&gt;&lt;strong&gt;Instruction Control UnitICU&lt;/strong&gt;  &lt;strong&gt;Execution UnitEU&lt;/strong&gt; SEQ  PIPE &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-5-optimize-your-c-code/ooo_CPU.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; ICU  EU ICU  EU&lt;/p&gt;
&lt;p&gt;EU  x86 &lt;/p&gt;
&lt;p&gt;**retirement unit**&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt; Intel Core i7 Haswell  8 &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;heading-9&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;latency&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;issue time&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;capacity&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3~30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3~30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3~15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3~15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; &lt;em&gt;&lt;/em&gt; &lt;em&gt;C&lt;/em&gt; &lt;em&gt;I&lt;/em&gt;  &lt;em&gt;C/I&lt;/em&gt;  CPE  &lt;em&gt;I/C&lt;/em&gt;  CPE &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; CPE&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; CPE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.27(+) 3.01(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.01(+) 5.01(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.00(+) 3.00(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.00(+) 5.00(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.50(+) 1.00(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.00(+) 0.50(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; CPE &lt;/p&gt;
&lt;h4 id=&#34;heading-10&#34;&gt;&lt;/h4&gt;
&lt;p&gt; n  CPE &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;combine3 data_t OP = *
acc  %xmm0 data + i  %rdx data + length  %rax 
.L25:                           loop:
    vmulsd (%rdx), %xmm0, %xmm0     data[i] * %xmm0 -&amp;gt; %xmm0
    addq $8, %rdx                   i += 8
    cmpq %rax, %rdx                 if (!(%rdx - %rax)) set ZF
    jne .L25                        if (~ZF) loop:
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; &lt;code&gt;combine4&lt;/code&gt; %rax &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;cmp jne &lt;/li&gt;
&lt;li&gt; %rdx  %xmm0  &lt;code&gt;combine4&lt;/code&gt;  &lt;code&gt;data+i&lt;/code&gt;  &lt;code&gt;acc&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-5-optimize-your-c-code/combine4_data_flow.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; cmp  jne &lt;/p&gt;
&lt;p&gt;muladdload mul  3  5  &lt;strong&gt;Critical Path&lt;/strong&gt; mul load  mul  add  mul  CPE  3.00  5.00 mul  CPE &lt;/p&gt;
&lt;h2 id=&#34;heading-11&#34;&gt;&lt;/h2&gt;
&lt;p&gt; Intel  SSE  AVX &lt;/p&gt;
&lt;p&gt; CPE  CPE &lt;/p&gt;
&lt;h2 id=&#34;heading-12&#34;&gt;&lt;/h2&gt;
&lt;h4 id=&#34;heading-13&#34;&gt;&lt;/h4&gt;
&lt;p&gt; xmm  ymm  16  CPE &lt;/p&gt;
&lt;h4 id=&#34;heading-14&#34;&gt;&lt;/h4&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-15&#34;&gt;&lt;/h2&gt;</description>
    </item>
    <item>
      <title>CAN Protocol Tuturial</title>
      <link>https://xiahualiu.github.io/posts/2017-12-12-can_bus/</link>
      <pubDate>Tue, 12 Dec 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-12-12-can_bus/</guid>
      <description>&lt;p&gt; CAN  CAN  CAN &lt;/p&gt;
&lt;h1 id=&#34;heading&#34;&gt;&lt;/h1&gt;
&lt;p&gt;CAN  Controller Area Network protocol CAN  1986  ISO11898 CAN &lt;/p&gt;
&lt;h1 id=&#34;can-&#34;&gt;CAN &lt;/h1&gt;
&lt;p&gt;CAN  CAN  ECU  I/O  CAN  CAN  USB &lt;/p&gt;
&lt;p&gt; 120  &lt;strong&gt;ISO 11898-2&lt;/strong&gt;  CAN  120 &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_ISO11898-2_Network.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;CAN CAN High  CAN Low CAN_H  CAN_L&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; &lt;code&gt;0&lt;/code&gt; CAN_H  5VCAN_L  0V 2V  CAN_H  3.5VCAN_L  1.5V&lt;/li&gt;
&lt;li&gt; &lt;code&gt;1&lt;/code&gt; CAN_H  CAN_L  2.5V&lt;/li&gt;
&lt;li&gt; -12~+12V &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/ISO11898-2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt; CAN_H  CAN_L 
 CAN  &lt;code&gt;0&lt;/code&gt;  &lt;code&gt;0&lt;/code&gt;  &lt;code&gt;1&lt;/code&gt; &lt;code&gt;1&lt;/code&gt; &lt;code&gt;0&lt;/code&gt;  &lt;code&gt;1&lt;/code&gt;  &lt;code&gt;1&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ISO 11898-3&lt;/strong&gt;  CAN &lt;strong&gt; CAN &lt;/strong&gt; CAN  100  100&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_ISO11898-3_Network.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt; CAN  CAN_L  CAN_H &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/ISO11898-3_Waveform.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;CAN_H  CAN_L  2.3V 5V  VCC CAN_H  4.7V(VCC - 0.3V) CAN_L  0.3V(VCC + 0.3V)&lt;/p&gt;
&lt;p&gt; CAN  CAN_HCAN_L  CAN  CAN &lt;/p&gt;
&lt;p&gt; CAN  CAN  DB9&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CAN-Low(CAN_L)&lt;/li&gt;
&lt;li&gt;GND(Ground)&lt;/li&gt;
&lt;li&gt;CAN-High(CAN_H)&lt;/li&gt;
&lt;li&gt;CAN V+(Power)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/9_pin_d-sub_connector_male_closeup.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; DB9 &lt;/p&gt;
&lt;h2 id=&#34;can--1&#34;&gt;CAN &lt;/h2&gt;
&lt;p&gt; CAN &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; MCU
&lt;ul&gt;
&lt;li&gt; CAN  CAN &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;CAN  MCU 
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;CAN  ISO 11898-2/3 Medium Access Unit [MAU] 
&lt;ul&gt;
&lt;li&gt; CAN  1/0  CAN &lt;/li&gt;
&lt;li&gt; CAN &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_Node.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;CAN  CAN  CAN  1  0  1&lt;/p&gt;
&lt;h1 id=&#34;can--2&#34;&gt;CAN &lt;/h1&gt;
&lt;p&gt; 1  0 CAN I2C, SPI, UARTCAN  SPI  CAN &lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;&lt;/h2&gt;
&lt;p&gt;CAN  CAN &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_data_frame.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;0 &lt;strong&gt;/SOF(Start-of-Frame)&lt;/strong&gt; &lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;&lt;/strong&gt; CAN CAN  &lt;strong&gt;Lossless Bitwise Arbitration&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt; &lt;strong&gt;&lt;/strong&gt;  &lt;strong&gt;(Arbitration Field)&lt;/strong&gt;  11  &lt;strong&gt;CAN ID/CAN &lt;/strong&gt; CAN &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/arbitration_method.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;0 1 &lt;/p&gt;
&lt;p&gt; &lt;strong&gt;CAN ID&lt;/strong&gt;  &lt;strong&gt;RTR&lt;/strong&gt;(Remote Transmission Request) &lt;strong&gt;&lt;/strong&gt; 0 1&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(Arbitration Field)&lt;/strong&gt;  &lt;strong&gt;(Control Field)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;IDE(Identifier Extension Bit)&lt;/strong&gt; CAN  1  CAN  CAN  29  CAN ID  11  CAN2.0A  0CAN2.0B  1&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Reserved bit&lt;/strong&gt;  &lt;strong&gt;r1, r0&lt;/strong&gt;  &lt;strong&gt;r0&lt;/strong&gt; &lt;strong&gt;r1&lt;/strong&gt; &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DLC(Data length code)&lt;/strong&gt;  4  0-8 9-15  DLC&amp;gt;8  8 &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt; DLC  0-64bits  0-8bytes &lt;/p&gt;
&lt;p&gt; &lt;strong&gt;CRC &lt;/strong&gt; SOF  CRC  CRC  CRC  CRC  CRC  CRC  CRC &lt;/p&gt;
&lt;p&gt; &lt;strong&gt;ACK Field &lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;(ACK Slot)&lt;/strong&gt; I2C &lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;(ACK Delimiter)&lt;/strong&gt; &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt; &lt;strong&gt;/EOF(End-of-Frame)&lt;/strong&gt; 7  &lt;strong&gt;/IFS(Interframe Spacing)&lt;/strong&gt; IFS  3 &lt;/p&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_data_frame.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; CAN ID  29  CAN ID CAN ID  &lt;strong&gt;RTR&lt;/strong&gt;  &lt;strong&gt;SRR(Substitute Remote Request)&lt;/strong&gt; SRR  RTR  CAN ID B  CAN  SRR  18  CAN ID B &lt;/p&gt;
&lt;p&gt;CAN ID  CAN  CAN ID  CAN ID  CAN ID CAN ID  100  60 &lt;/p&gt;
&lt;p&gt; CAN  CAN2.0B  CAN  CAN2.0A  CAN &lt;/p&gt;
&lt;h2 id=&#34;heading-3&#34;&gt;&lt;/h2&gt;
&lt;p&gt; DLC DLC &lt;/p&gt;
&lt;p&gt; DLC  CRC &lt;/p&gt;
&lt;h2 id=&#34;heading-4&#34;&gt;&lt;/h2&gt;
&lt;p&gt; CAN &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;6-12bits&lt;/li&gt;
&lt;li&gt; 8 &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h4 id=&#34;heading-5&#34;&gt;&lt;/h4&gt;
&lt;p&gt; 6 &lt;/p&gt;
&lt;h4 id=&#34;heading-6&#34;&gt;&lt;/h4&gt;
&lt;p&gt; 6 &lt;/p&gt;
&lt;p&gt; CAN  CAN  &lt;strong&gt;(TEC)&lt;/strong&gt; &lt;strong&gt;(REC)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; TEC  REC  128&lt;/li&gt;
&lt;li&gt; TEC  REC  127  255&lt;/li&gt;
&lt;li&gt; TEC  255 Bus Off &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt; CAN &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; TEC  8&lt;/li&gt;
&lt;li&gt; REC  1&lt;/li&gt;
&lt;li&gt; TEC  REC  0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;CAN  MCU  Bus Off  Philips SJA1000&lt;/p&gt;
&lt;p&gt;
CAN  5  3 &lt;/p&gt;
&lt;h4 id=&#34;heading-7&#34;&gt;&lt;/h4&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h4 id=&#34;heading-8&#34;&gt;&lt;/h4&gt;
&lt;p&gt; CAN  &lt;strong&gt;(Bit stuffing)&lt;/strong&gt; CAN 0  1 CAN &lt;strong&gt; 5 &lt;/strong&gt; 0  1 &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;11111000011110000&amp;hellip;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;11111&lt;strong&gt;0&lt;/strong&gt;0000&lt;strong&gt;1&lt;/strong&gt;1111&lt;strong&gt;0&lt;/strong&gt;0000&lt;strong&gt;1&lt;/strong&gt;&amp;hellip;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt; 0  5 &lt;/p&gt;
&lt;p&gt; 5 &lt;/p&gt;
&lt;p&gt;CAN  CRC &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h4 id=&#34;crc-&#34;&gt;CRC &lt;/h4&gt;
&lt;p&gt;CRC &lt;/p&gt;
&lt;h4 id=&#34;heading-9&#34;&gt;&lt;/h4&gt;
&lt;p&gt;CAN &lt;/p&gt;
&lt;h4 id=&#34;heading-10&#34;&gt;&lt;/h4&gt;
&lt;p&gt; CRC  ACK EOF &lt;/p&gt;
&lt;h3 id=&#34;heading-11&#34;&gt;&lt;/h3&gt;
&lt;p&gt; 6 &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_error_frame.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;bus-failure-modes&#34;&gt;*(Bus Failure Modes)&lt;/h4&gt;
&lt;p&gt; CAN  ISO  ISO 11898 &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;CAN_H &lt;/li&gt;
&lt;li&gt;CAN_L &lt;/li&gt;
&lt;li&gt;CAN_H &lt;/li&gt;
&lt;li&gt;CAN_L &lt;/li&gt;
&lt;li&gt;CAN_H &lt;/li&gt;
&lt;li&gt;CAN_L &lt;/li&gt;
&lt;li&gt;CAN_L  CAN_H &lt;/li&gt;
&lt;li&gt;CAN_L  CAN_H &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt; CAN  TJA1053125bits/s)&lt;/p&gt;
&lt;h2 id=&#34;heading-12&#34;&gt;&lt;/h2&gt;
&lt;p&gt;CAN  3  IFS  IFS &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;6-7bits&lt;/li&gt;
&lt;li&gt; 8 &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; IFS &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt; IFS &lt;/li&gt;
&lt;li&gt; IFS &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_overload_frame.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt; CAN  CAN  CAN&lt;/p&gt;
&lt;h2 id=&#34;heading-13&#34;&gt;&lt;/h2&gt;
&lt;p&gt;CAN CAN &lt;/p&gt;
&lt;p&gt;CAN CAN &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_bit_time.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; 10  &lt;strong&gt;SYNCHRONIZATION&lt;/strong&gt; &lt;/p&gt;
&lt;h4 id=&#34;hard-synchronization--&#34;&gt;HARD SYNCHRONIZATION  &lt;/h4&gt;
&lt;p&gt; CAN  SOF  HARD SYNCHRONIZATION  SYNCHRONIZATION  CAN &lt;/p&gt;
&lt;p&gt; CAN  CAN -&amp;gt;&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;Propagation Segment&lt;/strong&gt;  &lt;strong&gt;Phase 1 Segment( 1)&lt;/strong&gt;  &lt;strong&gt;Phase 2 Segment( 2)&lt;/strong&gt;  3 3 3 &lt;/p&gt;
&lt;h4 id=&#34;heading-14&#34;&gt;&lt;/h4&gt;
&lt;p&gt; SYNC -&amp;gt; SYNC  Phase 2  SYNC  Propagation Segment  CAN  Phase 1 Segment( 1)  Phase 2 Segment( 2)  SYNC &lt;/p&gt;
&lt;p&gt;
&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_sync1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;-&amp;gt; Prop  Phase 1 &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_sync2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt; Phase 2 -&amp;gt; SYNC &lt;/p&gt;
&lt;p&gt; SYNC -&amp;gt;-&amp;gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h3 id=&#34;heading-15&#34;&gt;&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;DLC  0 &lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;DLC  0  DLC  0DLC  RTR  CAN ID  RTR  0 &lt;/p&gt;
&lt;/blockquote&gt;</description>
    </item>
    <item>
      <title>Deep Understanding of C pointers</title>
      <link>https://xiahualiu.github.io/posts/2017-12-07-c-pointer/</link>
      <pubDate>Thu, 07 Dec 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-12-07-c-pointer/</guid>
      <description>&lt;p&gt; C &lt;/p&gt;
&lt;p&gt; C  &lt;code&gt;malloc&lt;/code&gt; &lt;code&gt;calloc&lt;/code&gt; &lt;code&gt;realloc&lt;/code&gt;  C &lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt; 32  4  8 bits4 bytes = 32 bits 64  8 &lt;/p&gt;
&lt;p&gt;,  8  16  4 &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt; () {

   &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;  var1;
   &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; var2[&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;];

   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Address of var1 variable: %x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;var1  );
   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Address of var2 variable: %x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;var2  );

   &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$gcc -o main *.c
$main
Address of var1 variable: 9f98435c
Address of var2 variable: 9f984352
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;var1&lt;/code&gt;  &lt;code&gt;int&lt;/code&gt;   &lt;code&gt;var2&lt;/code&gt;  &lt;code&gt;char[10]&lt;/code&gt; &lt;strong&gt;&lt;/strong&gt; &lt;code&gt;var1&lt;/code&gt;  &lt;code&gt;int&lt;/code&gt;  4bytes&lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt; &lt;code&gt;&amp;amp;&lt;/code&gt; &lt;code&gt;*&lt;/code&gt; &lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;amp;&lt;/code&gt; &lt;/li&gt;
&lt;li&gt;&lt;code&gt;*&lt;/code&gt; &lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt; () {
   &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;  var &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;;   &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
   &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ip;        &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
   ip &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;var;  &lt;span style=&#34;color:#75715e&#34;&gt;/*  var  ip*/&lt;/span&gt;

   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;var : %x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;var  );
   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ip : %x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, ip );
   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; *ip : %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ip );
   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; var : %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, var );

   &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ip&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;;

   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;*ip : %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ip );
   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;var : %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, var );
   &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$gcc -o main *.c
$main
var : f977beb4
ip : f977beb4
 *ip : &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;
 var : &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;
*ip : &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
var : &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; &lt;code&gt;*ip&lt;/code&gt;  &lt;code&gt;var&lt;/code&gt;  &lt;code&gt;ip&lt;/code&gt; var  10  &lt;code&gt;var&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ip = (int)10;&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;warning: assignment makes pointer from integer without a cast &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;-Wint-conversion&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
    ip&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;int&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;10;
      ^
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E8%BF%B7%E9%80%94%E6%8C%87%E9%92%88&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;null-&#34;&gt;NULL &lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt; NULLNULL &lt;/p&gt;
&lt;p&gt; 4  00  NULL &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;++&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;+&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt; +/-  ++/&amp;ndash;  +1/-1 &lt;/p&gt;
&lt;p&gt; int 4  1&lt;/p&gt;
&lt;p&gt; 1 4 4  int &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt; int &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; MAX &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;;

&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt; () {

   &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;  var[] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;};
   &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;  i, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ptr;
    
   ptr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; var;

   &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ( i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; MAX; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {

      printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;var[%d]  = %x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, i, ptr );
      printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;var[%d]  = %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, i, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ptr );

      ptr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ptr&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;      &lt;span style=&#34;color:#75715e&#34;&gt;// ptr++
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;   }
	
   &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$gcc -o main *.c
$main
var&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;0&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 220fe454
var&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;0&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
var&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;1&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 220fe458
var&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;1&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;
var&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;2&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 220fe45c
var&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;2&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; 4&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;   ptr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; var;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; c  var  &lt;code&gt;int * const var_name = &amp;amp;var[0];&lt;/code&gt;  &lt;code&gt;var_name&lt;/code&gt; var[0] &lt;/p&gt;
&lt;p&gt; int :&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; var_name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;var[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;];
var_name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;error: assignment of read-only variable var_name
    var_name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;int *&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;10;
             ^
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; var =  &lt;code&gt;error: assignment to expression with array type&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; ch[&lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;hello world&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;};
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; 20  char  h e&amp;quot;hello world\0&amp;rdquo; &lt;code&gt;\0&lt;/code&gt; &lt;/p&gt;
&lt;p&gt; C &amp;ldquo;hello world&amp;rdquo; C &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; MAX &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;;

&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt; () {

   &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ptr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Hello world&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;;
   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,ptr);

   &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; Hello world&lt;/p&gt;
&lt;h2 id=&#34;heading-3&#34;&gt;&lt;/h2&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;var;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; &lt;code&gt;*&lt;/code&gt; &lt;/p&gt;
&lt;h2 id=&#34;heading-4&#34;&gt;&lt;/h2&gt;
&lt;p&gt; C &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;p)(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; int  const char *  C 99% &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;string_print&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;s){
    printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,s);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(){

    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; a;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;p)(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;);
    
    p&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;string_print;

    a&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;string_print(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;WINNER WINNER CHIKEN DINNER!&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
    a&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;p(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;WINNER WINNER CHIKEN DINNER!&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);

    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$gcc -o main *.c
$main
WINNER WINNER CHIKEN DINNER!
WINNER WINNER CHIKEN DINNER!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;    p&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;string_print;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; &lt;code&gt;*&lt;/code&gt;  C  &lt;code&gt;*&lt;/code&gt; &lt;code&gt;p=&amp;amp;string_print;&lt;/code&gt;  &lt;code&gt;p=string_print;&lt;/code&gt;  &lt;code&gt;*&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;string_print)(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;s){
    printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,s);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; &lt;code&gt;string_print&lt;/code&gt; &lt;/p&gt;
&lt;h2 id=&#34;heading-5&#34;&gt;&lt;/h2&gt;
&lt;p&gt; &lt;code&gt;p&lt;/code&gt;  &lt;code&gt;int&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;&lt;code&gt;int (*p)(const char *);&lt;/code&gt;,&lt;/p&gt;
&lt;p&gt; C  C &lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://zh.cppreference.com/w/cpp/language/operator_precedence&#34;&gt;C++ &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;int ptr;&lt;/code&gt; &lt;/li&gt;
&lt;li&gt;&lt;code&gt;int *ptr;&lt;/code&gt;  ptr  *  ptr  int  int  ptr &lt;/li&gt;
&lt;li&gt;&lt;code&gt;int ptr[3];&lt;/code&gt;   ptr  []  ptr  int  ptr &lt;/li&gt;
&lt;li&gt;&lt;code&gt;int *ptr[3];&lt;/code&gt;  ptr  *  []  []  *  []  ptr  *  int 
 ptr &lt;strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int (*ptr)[3];&lt;/code&gt;  ptr  * ()  *  []  ptr  []  ptr  int 
 ptr &lt;strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int **ptr;&lt;/code&gt;  ptr  *  ptr  *  int &lt;/li&gt;
&lt;li&gt;&lt;code&gt;int ptr(int);&lt;/code&gt;  ptr  ()  ptr  ()  int &lt;/li&gt;
&lt;li&gt;&lt;code&gt;int (*ptr)(int);&lt;/code&gt;  ptr  ptr  ()  ()  int  int  int ,
 ptr &lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int *ptr(int);&lt;/code&gt;  ptr  ()  ptr  *  int  int
 ptr &lt;strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int *(*ptr(int))[3];&lt;/code&gt;  MAX ptr  ()  ptr , ()  int  * 9 []  *  int 
 ptr &lt;strong&gt; int &lt;/strong&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt; &lt;strong&gt;4. 5.&lt;/strong&gt;  &lt;code&gt;int *ptr[3];&lt;/code&gt;  ptr  &lt;strong&gt;&lt;/strong&gt; &lt;code&gt;int (*ptr)[3];&lt;/code&gt;  ptr  &lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; 1  1  1  1 &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-7-C-pointer/ap&amp;amp;pa.png&#34; alt=&#34;ap&amp;pa.png&#34;&gt;&lt;/p&gt;
&lt;p&gt; p ptr 
&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h2 id=&#34;--&#34;&gt; &amp;amp; &lt;/h2&gt;
&lt;p&gt; &lt;code&gt;int * const var_name = &amp;amp;var[0];&lt;/code&gt; &lt;strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; c&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ptr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;c;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; c&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ptr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;c;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; ptr  c &lt;code&gt;*ptr=20;&lt;/code&gt;  c  &lt;code&gt;c=20;&lt;/code&gt;  c &lt;strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;/&lt;/strong&gt;  const  *  const &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;test)();
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;(*test)&lt;/code&gt;  test ()  test  * &lt;code&gt;(int * const)&lt;/code&gt;  const  &lt;code&gt;(int *)&lt;/code&gt;  int &lt;/p&gt;
&lt;p&gt; &lt;code&gt;test&lt;/code&gt;  int &lt;/p&gt;
&lt;p&gt;  &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; ptr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; &lt;code&gt;const char *&lt;/code&gt;  &lt;code&gt;&amp;quot;Hello world&amp;quot;&lt;/code&gt; &lt;code&gt;const char *&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt; test &lt;/p&gt;</description>
    </item>
    <item>
      <title>FT_Write Commands</title>
      <link>https://xiahualiu.github.io/posts/2017-11-28-ft232h-command/</link>
      <pubDate>Tue, 28 Nov 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-11-28-ft232h-command/</guid>
      <description>&lt;p&gt; &lt;code&gt;FT_Write&lt;/code&gt; OPCODE&lt;/p&gt;
&lt;h1 id=&#34;heading&#34;&gt;&lt;/h1&gt;
&lt;p&gt; MPSSE :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Bit 0 : &lt;/li&gt;
&lt;li&gt;Bit 1 : 1  bits  bytes &lt;/li&gt;
&lt;li&gt;Bit 2 : &lt;/li&gt;
&lt;li&gt;Bit 3 : 1LSB first,  MSB first&lt;/li&gt;
&lt;li&gt;Bit 4 :  TDI&lt;/li&gt;
&lt;li&gt;Bit 5 :  TDO&lt;/li&gt;
&lt;li&gt;Bit 6 :  TMS&lt;/li&gt;
&lt;li&gt;Bit 7 : 0&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;msb-&#34;&gt;MSB &lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;/&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x10&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x20&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x22&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x26&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x31&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x33&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;heading-1&#34;&gt;:&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;MSB:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;0x10,
LengthL,
LengthH,
Byte1
..
Byte65536 (max)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; &lt;code&gt;0x0000&lt;/code&gt;  1 &lt;code&gt;0xffff&lt;/code&gt;  65536  65536 64KB 7  TDI/DO &lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;MSB:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;0x20,
LengthL,
LengthH
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; TDO/DI  1 - 65536  MSB CLK &lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;MSB :&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;0x31,   // 
LengthL,
LengthH,
Byte1
..
Byte65536 (max)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;lsb-&#34;&gt;LSB &lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;/&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x18&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x19&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x1A&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x1B&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x28&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x2C&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x2A&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x2E&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x39&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x3C&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x3B&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x3E&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; MSB &lt;/p&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;&lt;/h2&gt;
&lt;p&gt; 8  8 &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; 8 &lt;/th&gt;
&lt;th align=&#34;center&#34;&gt; 8 &lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x80&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x82&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x81&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x83&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;heading-3&#34;&gt;&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;0x80,
0xValue,
0xDirection
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; 8 &lt;br&gt;
1 0 &lt;/p&gt;
&lt;h3 id=&#34;heading-4&#34;&gt;&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;0x81,
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-5&#34;&gt;&lt;/h2&gt;
&lt;p&gt; TDI/DO  TDO/DI&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x84&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x85&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;NO&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;heading-6&#34;&gt;&lt;/h2&gt;
&lt;p&gt; FT232H/FT2232H/FT4232H  &lt;code&gt;0x8A&lt;/code&gt;  5 &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;0x86,
0xValueL,
0xValueH,
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;TCK period = 60MHz / (( 1 +[ (0xValueH * 256) OR 0xValueL] ) * 2)&lt;/p&gt;
&lt;h2 id=&#34;ft232hft2232hft4232h-&#34;&gt;FT232H/FT2232H/FT4232H &lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x8A&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt; 5  60MHz&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x8B&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt; 5  FT2232D&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x8C&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;!-- raw HTML omitted --&gt; I2C &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x8D&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x8E&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;!-- raw HTML omitted --&gt; JTAG &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x8F&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;!-- raw HTML omitted --&gt; JTAG &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x94&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;!-- raw HTML omitted --&gt; GPIOL1  1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x95&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;!-- raw HTML omitted --&gt; GPIOL1  0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x96&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x97&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x9C&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;!-- raw HTML omitted --&gt; GPIOL1  1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x9C&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;!-- raw HTML omitted --&gt; GPIOL1  0 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;ftstatus-&#34;&gt;ftStatus &lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt; HANDLE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt; IO &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EEPROM &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EEPROM &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EEPROM &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;14&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EEPROM &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EEPROM &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;18&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</description>
    </item>
    <item>
      <title>FT232H Notes</title>
      <link>https://xiahualiu.github.io/posts/2017-11-13-ft232h-1/</link>
      <pubDate>Mon, 13 Nov 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-11-13-ft232h-1/</guid>
      <description>&lt;p&gt;&lt;/p&gt;
&lt;p&gt; S32K144  W5500  520KB/s  20MHz  LPSPI  1Mb/s  FTDI  FT232H  USB  SPI  30MHz SPI  SPI  FPGA  FIFO  USB  S32K144 2000 &lt;/p&gt;
&lt;h3 id=&#34;ft232h-&#34;&gt;FT232H &lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; USB to /&lt;/li&gt;
&lt;li&gt; USB &lt;/li&gt;
&lt;li&gt; USB2.0(480Mbits/s)  USB Full-Speed(8Mbits/s)&lt;/li&gt;
&lt;li&gt;MPSSE&lt;/li&gt;
&lt;li&gt;UART  12MbaudRS232 &lt;/li&gt;
&lt;li&gt;USB to  245 FIFO  8Mbytes/s &lt;/li&gt;
&lt;li&gt;USB to  245 FIFO  40Mbytes/s &lt;/li&gt;
&lt;li&gt; FT1248 (1, 2, 4 or 8 bits wide)&lt;/li&gt;
&lt;li&gt;CPU-style FIFO  CPU &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;FTDI VCPD2XX USB &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt; LED &lt;/li&gt;
&lt;li&gt;Bit-Bang  RD#  WR# &lt;/li&gt;
&lt;li&gt; 5V  3.3V  +1.8V  LDO  VCORE  POR &lt;/li&gt;
&lt;li&gt; UART &lt;/li&gt;
&lt;li&gt; X-ON  X-OFF &lt;/li&gt;
&lt;li&gt;UART  7/8 bits  1/2 bits //Mark&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;/Space&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;/ &lt;/li&gt;
&lt;li&gt; RS485  TXDEN &lt;/li&gt;
&lt;li&gt; USB  EEPROM  USB &lt;/li&gt;
&lt;li&gt; I/O 4, 8, 12 or 16mA&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;UHCI/OHCI/EHCI &lt;/li&gt;
&lt;li&gt;USB  512 &lt;/li&gt;
&lt;li&gt;+1.8V  3.3V I/O  5V&lt;/li&gt;
&lt;li&gt;-40C to 85C &lt;/li&gt;
&lt;li&gt; 48  LQFP  QFN &lt;/li&gt;
&lt;li&gt; ACBUS I/O &lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;heading&#34;&gt;&lt;/h3&gt;
&lt;p&gt;FT232H  USB  VCP  D2XX VCP D2XX  DLL  FT232H&lt;/p&gt;
&lt;h3 id=&#34;heading-1&#34;&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-11-13-FT232H_1/FT232H_Block.png&#34; alt=&#34;FT232H block diagram&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;mpsse&#34;&gt;MPSSE&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;MPSSE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TCK/SK&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;14&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDI/DO&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDO/DI&lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TMS/CS&lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOL0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;18&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOL1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;19&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOL2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;20&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOL3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;25&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;26&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;27&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;28&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;29&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;31&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH7&lt;sup id=&#34;fnref:7&#34;&gt;&lt;a href=&#34;#fn:7&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;7&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS8&lt;sup id=&#34;fnref:8&#34;&gt;&lt;a href=&#34;#fn:8&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;8&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;33&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS9&lt;sup id=&#34;fnref:9&#34;&gt;&lt;a href=&#34;#fn:9&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;9&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;mpsse-&#34;&gt;MPSSE &lt;/h3&gt;
&lt;p&gt;MPSSE  FT232H JTAG, I2C, SPI(MASTER)&lt;/p&gt;
&lt;p&gt;MPSSE MPSSE  30Mbits/s&lt;/p&gt;
&lt;p&gt; MPSSE  SPI FT232H &lt;/p&gt;
&lt;p&gt;FT232H  PC  USB  PC &lt;/p&gt;
&lt;h4 id=&#34;mpsse--1&#34;&gt;MPSSE &lt;/h4&gt;
&lt;p&gt;MPSSE 
&lt;img src=&#34;https://xiahualiu.github.io/img/2017-11-13-FT232H_1/MPSSE_Waveform.png&#34; alt=&#34;MPSSE_Waveform&#34;&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Min&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Typ&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Max&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Units&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Comments&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;t1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;15.15&lt;sup id=&#34;fnref:10&#34;&gt;&lt;a href=&#34;#fn:10&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;10&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;16.67&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ns&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLKOUT &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;t2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8.33&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ns&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLKOUT &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;t3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8.33&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ns&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLKOUT &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;t4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ns&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLKOUT to TDI/DO &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;t5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ns&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDI/DO &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;t6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8.33&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ns&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDI/DO &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;fine MPSSE  SPI &lt;/p&gt;
&lt;h3 id=&#34;mpsse--2&#34;&gt;MPSSE &lt;/h3&gt;
&lt;p&gt; MPSSE  GPIO  USB  PC  FT  &lt;strong&gt; D2XX API&lt;/strong&gt; MPSSE &lt;/p&gt;
&lt;p&gt; MPSSE &lt;/p&gt;
&lt;h4 id=&#34;msblsb--&#34;&gt;MSB/LSB  &lt;/h4&gt;
&lt;p&gt; MSB/LSB 
MPSSE  16  &lt;code&gt;0x00&lt;/code&gt;  &lt;code&gt;0x01&lt;/code&gt; MSB&lt;/p&gt;
&lt;h4 id=&#34;heading-2&#34;&gt;&lt;/h4&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h5 id=&#34;heading-3&#34;&gt;&lt;/h5&gt;
&lt;p&gt;$$Data Speed=\frac{60MHz}{((1+Divisor) \times 2)}$$&lt;/p&gt;
&lt;p&gt;FTx232H  &lt;code&gt;0x0000&lt;/code&gt;  &lt;code&gt;0xFFFF&lt;/code&gt;  30MHz  460Hz  FTx232H  5  &lt;code&gt;60MHz&lt;/code&gt;  &lt;code&gt;12MHz&lt;/code&gt; &lt;/p&gt;
&lt;h5 id=&#34;heading-4&#34;&gt;&lt;/h5&gt;
&lt;p&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Rising&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rising&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Not Valid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Rising&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Falling&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Low&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Falling&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rising&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;High&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Falling&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Falling&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Not Valid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Rising&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;No data transfer&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Low&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Falling&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;No data transfer&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;High&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;No data transfer&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rising&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Low&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;No data transfer&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Falling&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;High&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;heading-5&#34;&gt;&lt;/h4&gt;
&lt;h5 id=&#34;heading-6&#34;&gt;&lt;/h5&gt;
&lt;p&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt; SK &lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;--&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;--&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; MPSSE  GPIO &lt;/p&gt;
&lt;h5 id=&#34;buffer-sizes&#34;&gt;Buffer Sizes&lt;/h5&gt;
&lt;p&gt;MPSSE  Buffer  MPSSE  &lt;code&gt;FT_Write&lt;/code&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;bytes&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Command&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Data length&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Data payload&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1  65536&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;strong&gt;Total&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;strong&gt;4  65539&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; Buffer &lt;/p&gt;
&lt;h3 id=&#34;mpsse--3&#34;&gt;MPSSE &lt;/h3&gt;
&lt;p&gt; MPSSE  FTDI D2XX API  &lt;a href=&#34;http://www.ftdichip.com/Support/Documents/ProgramGuides/D2XX_Programmer&#39;s_Guide(FT_000071).pdf&#34;&gt;FTDI D2XX Programmers Guide&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-11-13-FT232H_1/MPSSE_Flow_Chart.png&#34; alt=&#34;MPSSE_Flow_Chart&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;heading-7&#34;&gt;&lt;/h4&gt;
&lt;p&gt; MPSSE  FT  D2XX API &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;FT_CreateDeviceInfoList&lt;/code&gt;  FT &lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_GetDeviceInfoList&lt;/code&gt;  &lt;code&gt;FT_GetDeviceInfoListDetail&lt;/code&gt;  FT2232H A  FT2232H B USB  IDUSB  &lt;strong&gt;USB Handle&lt;/strong&gt; &lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_Open&lt;/code&gt;  &lt;code&gt;FT_OpenEx&lt;/code&gt;  &lt;strong&gt;USB Handle&lt;/strong&gt; &lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;-ftdi--mpsse-&#34;&gt; FTDI  MPSSE &lt;/h4&gt;
&lt;p&gt; MPSSE&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;FT_ResetDevice&lt;/code&gt;  FTDI &lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetUSBParameters&lt;/code&gt;  USB  64 bytes  64 Kbytes&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetChars&lt;/code&gt; &lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetTimeouts&lt;/code&gt; &lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetLatencyTimer&lt;/code&gt;  USB &lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetFlowControl&lt;/code&gt;  RTS/CTS  IN  buffer &lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetBitMode&lt;/code&gt;  &lt;code&gt;mode = 0, mask = 0&lt;/code&gt;  MPSSE &lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetBitMode&lt;/code&gt;  &lt;code&gt;mode = 2, mask = 0&lt;/code&gt;  MPSSE  MPSSE &lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;-mpsse&#34;&gt; MPSSE&lt;/h4&gt;
&lt;p&gt;MPSSE MPSSE  op-code  &lt;a href=&#34;http://www.ftdichip.com/Support/Documents/ProgramGuides/D2XX_Programmer&#39;s_Guide(FT_000071).pdf&#34;&gt;FTDI D2XX Programmers Guide&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;&lt;code&gt;FT_Write&lt;/code&gt;  MPSSE  &lt;code&gt;FT_Read&lt;/code&gt; &lt;/p&gt;
&lt;h5 id=&#34;heading-8&#34;&gt;&lt;/h5&gt;
&lt;p&gt;MPSSE  &lt;code&gt;0xFA&lt;/code&gt; &lt;/p&gt;
&lt;p&gt; MPSSE  &lt;code&gt;0xFA&lt;/code&gt;  MPSSE &lt;/p&gt;
&lt;h5 id=&#34;mpsse--4&#34;&gt;MPSSE &lt;/h5&gt;
&lt;p&gt;MPSSE FTx232H  5 3  JTAG  op-code &lt;/p&gt;
&lt;h4 id=&#34;heading-9&#34;&gt;&lt;/h4&gt;
&lt;p&gt;MPSSE  loop-back  DO  DI &lt;/p&gt;
&lt;p&gt; 32   op-codee &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MSB  LSB  8-bits buffer &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt; &lt;code&gt;FT_Write&lt;/code&gt;  Buffer  &lt;code&gt;FT_GetStatus&lt;/code&gt;  &lt;code&gt;FT_Read&lt;/code&gt; &lt;/p&gt;
&lt;h4 id=&#34;gpio-&#34;&gt;GPIO &lt;/h4&gt;
&lt;p&gt; MPSSE  FTDI &lt;code&gt;FT_Write&lt;/code&gt;  MPSSE  MPSSE  &lt;code&gt;read GPIO&lt;/code&gt; &lt;code&gt;FT_Read&lt;/code&gt; &lt;/p&gt;
&lt;h4 id=&#34;heading-10&#34;&gt;&lt;/h4&gt;
&lt;p&gt; MPSSE &lt;/p&gt;
&lt;h4 id=&#34;heading-11&#34;&gt;&lt;/h4&gt;
&lt;h5 id=&#34;heading-12&#34;&gt;&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_tmain&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; argc, _TCHAR&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; argv[])
{
&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Variables
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;FT_HANDLE ftHandle; &lt;span style=&#34;color:#75715e&#34;&gt;/* FTDI device  */&lt;/span&gt;
FT_STATUS ftStatus; &lt;span style=&#34;color:#75715e&#34;&gt;/*  D2XX  */&lt;/span&gt;
DWORD dwNumDevs; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; uiDevIndex &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xF&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
BYTE byOutputBuffer[&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;]; &lt;span style=&#34;color:#75715e&#34;&gt;/* MPSSE  */&lt;/span&gt;
BYTE byInputBuffer[&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;]; &lt;span style=&#34;color:#75715e&#34;&gt;/* MPSSE  */&lt;/span&gt;
DWORD dwCount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
DWORD dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
DWORD dwNumBytesSent &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* FT_Write  */&lt;/span&gt;
DWORD dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
DWORD dwNumBytesRead &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* FT_Read  */&lt;/span&gt;
DWORD dwClockDivisor &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x05DB&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* , SCL Frequency = 60/((1+0x05DB)*2) (MHz) = 1Mhz */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;heading-13&#34;&gt;&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Does an FTDI device exist?
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Checking for FTDI devices...&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_CreateDeviceInfoList(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumDevs);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  FTDI  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_OK) &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error in getting the number of devices&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (dwNumDevs &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;There are no FTDI devices installed&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
}
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;%d FTDI devices found &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;- the count includes individual ports on a single chip&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, dwNumDevs);
&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//  -  FTx232H 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Assume first device has the MPSSE and open it...&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Open(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;ftHandle);
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_OK)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Open Failed with error %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, ftStatus);
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;-ftdi--mpsse&#34;&gt; FTDI  MPSSE&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Configuring port for MPSSE use...&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_ResetDevice(ftHandle);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  USB  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  FT232H  USB  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ((ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_OK) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; (dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;))
FT_Read(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;byInputBuffer, dwNumBytesToRead, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  FT232H  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetUSBParameters(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;65536&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;65535&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  USB  64KB */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetChars(ftHandle, false, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, false, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetTimeouts(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;5000&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetLatencyTimer(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  1ms */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetFlowControl(ftHandle, FT_FLOW_RTS_CTS, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  IN  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  MPSSE  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x02&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  MPSSE  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_OK)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error in initializing the MPSSE %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, ftStatus);
FT_Close(ftHandle);
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
}
Sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/*  USB  */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;/strong&gt; D2XX  &lt;code&gt;ftStatus&lt;/code&gt;  API &lt;code&gt;ftStatus&lt;/code&gt; &lt;/p&gt;
&lt;h5 id=&#34;-mpsse-1&#34;&gt; MPSSE&lt;/h5&gt;
&lt;p&gt; MPSSE  co-code  &lt;code&gt;FT_Write&lt;/code&gt;  &lt;code&gt;FT_Write&lt;/code&gt; &lt;/p&gt;
&lt;h6 id=&#34;heading-14&#34;&gt;&lt;/h6&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x84&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, \
dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error - MPSSE receive buffer should be empty&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, ftStatus);
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  MPSSE */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/*  USB  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
}
&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//  MPSSE  op-code  (0xAB),
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// MPSSE  &amp;#34;&amp;#34; (0xFA) 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//  op-code 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xAB&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  op-code  (0xAB)  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
{
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
} &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; ((dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; (ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_OK));
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; bCommandEchod &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; false;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Read(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;byInputBuffer, dwNumBytesToRead, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (dwCount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; dwCount &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; dwNumBytesRead &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; dwCount&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
{
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ((byInputBuffer[dwCount] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xFA&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; (byInputBuffer[dwCount&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xAB&lt;/span&gt;))
{
bCommandEchod &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; true;
&lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
}
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (bCommandEchod &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; false)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error in synchronizing the MPSSE&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
FT_Close(ftHandle);
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
}

&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x85&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer,\
dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  -  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error - MPSSE receive buffer should be empty&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, ftStatus);
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  MPSSE  */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/*  USB  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h6 id=&#34;mpsse--5&#34;&gt;MPSSE &lt;/h6&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//  MPSSE  JTAG
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//  FT_Write 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  FTx232H */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x8A&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  60MHz  -  5  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x97&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ( ARM ) */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x8D&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TCK = 60MHz /((1 + [(1 +0xValueH*256) OR 0xValueL])*2) */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;\x86&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dwClockDivisor &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xFF&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  0xValueL  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (dwClockDivisor &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xFF&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  0xValueH  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;//  MPSSE  - P1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// - , 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Pin name Signal Direction Config Initial State Config
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS0   TCK/SK output    1      high          1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS1   TDI/DO output    1      low           0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS2   TDO/DI input     0                    0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS3   TMS/CS output    1      high          1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS4   GPIOL0 output    1      low           0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS5   GPIOL1 output    1      low           0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS6   GPIOL2 output    1      high          1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS7   GPIOL3 output    1      high          1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x80&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  MPSSE  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xC9&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  Initial State  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xFB&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  Direction  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  -  -- */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;//  MPSSE  - P2
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// - , 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Pin name Signal Direction Config Initial State Config
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS0   GPIOH0 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS1   GPIOH1 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS2   GPIOH2 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS3   GPIOH3 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS4   GPIOH4 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS5   GPIOH5 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS6   GPIOH6 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS7   GPIOH7 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x82&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  MPSSE  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  Initial State  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  Direction  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(dwCount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; dwCount &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;; dwCount&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
{ &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
byInputBuffer[dwCount] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;;
byOutputBuffer[dwCount] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;heading-15&#34;&gt;&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x10&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MSB  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x01&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  -  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  -  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  = 0x0001+1 = 2 bytes */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xA5&lt;/span&gt;;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0F&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  = 0xA50F */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
Sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/*   */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  1ms  1ms */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  -  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  -  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
FT_Read(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;byInputBuffer, dwNumBytesToRead, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesRead);
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error - MPSSE receive buffer should be empty&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, ftStatus);
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  MPSSE  */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/*  USB  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
}

&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;

printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Press &amp;lt;Enter&amp;gt; to continue&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
getchar(); &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x34&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MSB  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x01&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  -  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  -  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  = 0x0001+1 = 2 bytes */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xA5&lt;/span&gt;;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0F&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  = 0xA50F */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
Sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/*   */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  1ms  1ms */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  -  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  -  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
FT_Read(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;byInputBuffer, dwNumBytesToRead, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error - MPSSE receive buffer should have the looped-back data&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  MPSSE  */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/*  USB  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
}
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;The correct number of bytes have been received&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(dwCount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; dwCount &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dwNumBytesRead &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; dwCount&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
{
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (byInputBuffer[dwCount] &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; byOutputBuffer[dwCount &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;])
&lt;span style=&#34;color:#75715e&#34;&gt;/*  3  */&lt;/span&gt;

{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error - Data received does not match data output&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  MPSSE  */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/*  USB  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
}
}
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;The input data matches the output data&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);

&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;

printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Press &amp;lt;Enter&amp;gt; to continue&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
getchar(); &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(dwCount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; dwCount &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;; dwCount&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
{ &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
byInputBuffer[dwCount] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;;
byOutputBuffer[dwCount] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;gpio--1&#34;&gt;GPIO &lt;/h4&gt;
&lt;p&gt; FTDI MPSSE  GPIO SPI  &lt;code&gt;FT_Write&lt;/code&gt;  GPIOGPIO  &lt;code&gt;FT_Write&lt;/code&gt; &lt;/p&gt;
&lt;p&gt; &lt;strong&gt;--&lt;/strong&gt;  GPIO &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Read From GPIO low byte
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// *************************************************
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Change scope trigger to channel 4 (TMS/CS) falling edge
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// *************************************************
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x81&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  -  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  GPIO */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  GPIO  */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
Sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/*   */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  1ms  1ms */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  FTx232H  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Read(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;byInputBuffer, dwNumBytesToRead, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesRead);
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ((ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_OK) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; (dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;))
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error - GPIO cannot be read&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  MPSSE  */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/*  USB  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
}
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;The GPIO low-byte = 0x%X&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, byInputBuffer[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Press &amp;lt;Enter&amp;gt; to continue&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
getchar(); &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  GPIO  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x80&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  GPIO  */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; byInputBuffer[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xF7&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  0 */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xFB&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  GPIO  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// Reset output buffer pointer
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;Sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/*   */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  1ms  1ms */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;heading-16&#34;&gt;&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Start closing everything down
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;AN_135 example program executed successfully.&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Press &amp;lt;Enter&amp;gt; to continue&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
getchar(); &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/*  MPSSE  */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/*  USB  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*  */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; FT232H  MPSSE &lt;/p&gt;
&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt; 1  &lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt; 0  &lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Clock Signal Output. &lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Serial Data Output. &lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:5&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Serial Data Input. &lt;a href=&#34;#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:6&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Output Signal Select. &lt;a href=&#34;#fnref:6&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:7&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt; GPIO  75K  EEPROM  USBVCC  GPIO  &lt;a href=&#34;#fnref:7&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:8&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt; 75K  VCCIO &lt;a href=&#34;#fnref:8&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:9&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt; 75K  VCCIO &lt;a href=&#34;#fnref:9&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:10&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt; t1  Max  typo  Min  &lt;a href=&#34;#fnref:10&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 8 Systick</title>
      <link>https://xiahualiu.github.io/posts/2017-10-26-s32k144_8/</link>
      <pubDate>Thu, 26 Oct 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-10-26-s32k144_8/</guid>
      <description>&lt;p&gt; Cortex M4F  SysTick  MCU OEM  Reference Manual &lt;/p&gt;
&lt;p&gt;SysTick SysTick  LPIT  4 &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** S32_SysTick - Register Layout Typedef */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
  __IO uint32_t CSR;                               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; SysTick Control and Status Register, offset: 0x0 */&lt;/span&gt;
  __IO uint32_t RVR;                               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; SysTick Reload Value Register, offset: 0x4 */&lt;/span&gt;
  __IO uint32_t CVR;                               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; SysTick Current Value Register, offset: 0x8 */&lt;/span&gt;
  __I  uint32_t CALIB;                             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; SysTick Calibration Value Register, offset: 0xC */&lt;/span&gt;
} S32_SysTick_Type, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;S32_SysTick_MemMapPtr;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; 4  32 &lt;/p&gt;
&lt;h3 id=&#34;systick-control-and-status-register-systick-csr&#34;&gt;SysTick Control and Status Register (SysTick_CSR)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;COUNTFLAG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SysTick &lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;SysTick 01&lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLKSOURCE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SysTick &lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TICKINT&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SysTick &lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ENABLE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SysTick &lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0  SysTick&lt;!-- raw HTML omitted --&gt;1  SysTick&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;systick-reload-value-register-systick-rvr&#34;&gt;SysTick Reload Value Register (SysTick_RVR)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;23-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RELOAD&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SysTick &lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; SysTick 0&lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;systick-current-value-register-systick-cvr&#34;&gt;SysTick Current Value Register (SysTick_CVR)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;23-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CURRENT&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SysTick &lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; COUNTFLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;systick-calibration-value-register-systick-calib&#34;&gt;SysTick Calibration Value Register (SysTick_CALIB)&lt;/h3&gt;
&lt;p&gt; 0&lt;/p&gt;
&lt;p&gt; 1&lt;/p&gt;
&lt;p&gt; &lt;code&gt;include&lt;/code&gt;  &lt;code&gt;delay_ms()&lt;/code&gt; &lt;em&gt;&amp;hellip;&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* delay.c              Eggycat
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; * Description:  Use SysTick function to perform millisecond-level (us-level also if you like) delay in S32K144 Landzo-FRDM
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; * 2017 10 25 initial version
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; */&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;delay.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
uint32_t Systok &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// declare Systok as an extern parameter
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; idle_counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SysTick_init&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){ &lt;span style=&#34;color:#75715e&#34;&gt;// clock frequency=80MHz,
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// configure NVIC register
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    S32_NVIC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;ICPR[&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;31&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* IRQ-1-SysTick: clr any pending IRQ*/&lt;/span&gt;
    S32_NVIC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;ISER[&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;31&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* IRQ-1-SysTick: enable IRQ */&lt;/span&gt;
    S32_NVIC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;IP[&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0A&lt;/span&gt;;

    S32_SysTick&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;RVR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;80000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// Reload 80000 = 1ms if you want a us change this value to 80.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    S32_SysTick&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CVR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// Initialize Current Value Register for a new reload on enable.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;delay_ms&lt;/span&gt;(uint32_t i){ &lt;span style=&#34;color:#75715e&#34;&gt;// delay_ms(time)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    Systok &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; i;
    S32_SysTick&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// TICKINT=1 enable SysTick interrupt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;                        &lt;span style=&#34;color:#75715e&#34;&gt;// Enable=1 enable SysTick;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;                        &lt;span style=&#34;color:#75715e&#34;&gt;// CLKSOURCE=1 SysTick clock rate=80MHz=10MHz
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(Systok&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;){    &lt;span style=&#34;color:#75715e&#34;&gt;// Loop till Systok=0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        idle_counter&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;; 
    }
    S32_SysTick&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// Disable SysTick interrupt.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    idle_counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; S32_SysTick&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CVR; &lt;span style=&#34;color:#75715e&#34;&gt;// Any reads from CVR clear both COUNTFLAG &amp;amp; CVR
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SysTick_Handler&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
    idle_counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; S32_SysTick&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CVR; &lt;span style=&#34;color:#75715e&#34;&gt;// Any reads from CVR clear both COUNTFLAG &amp;amp; CVR
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    Systok&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 7 SPI</title>
      <link>https://xiahualiu.github.io/posts/2017-10-20-s32k144_7/</link>
      <pubDate>Fri, 20 Oct 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-10-20-s32k144_7/</guid>
      <description>&lt;p&gt; SPI  SPI &lt;/p&gt;
&lt;p&gt; NXP  AN5413 Cookbook &lt;/p&gt;
&lt;h3 id=&#34;heading&#34;&gt;&lt;/h3&gt;
&lt;p&gt; LPSPI  FIFO  16-bit  1Mbps  DMA&lt;/p&gt;
&lt;p&gt;S32K144  LPSPI  LPSPI1  3 MC33903  UGA1169TK/F  SBC(System Basis Chip) () Reading Status Register  LPSPI  SBC  12V  EVB  1-2  J107  USB  EVB  EVB  SBC  LPSPI  0&lt;/p&gt;
&lt;p&gt; LPSPI1  PCC   LPSPI1  FIFO LPSPI  SBC  Slave  LPSPI1 &lt;/p&gt;
&lt;h3 id=&#34;heading-1&#34;&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt; SOSC  8MHz 80MHzRUN  80MHz&lt;/li&gt;
&lt;li&gt; LPSPI1
&lt;ul&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt; LPSPI1 (Master)&lt;/li&gt;
&lt;li&gt; 10MHz (100 )
&lt;ul&gt;
&lt;li&gt; =  /  = 40MHz/4 = 10MHz&lt;/li&gt;
&lt;li&gt;SCK  = (Functional clock / PRESCALE) / (SCKDIV+2) = (40 MHz / 4) / (8 + 2) = 10 MHz / 10 = 1 MHz&lt;/li&gt;
&lt;li&gt;SCK  PCS  = 5 prescaled functional clocks = 50 nesc&lt;/li&gt;
&lt;li&gt;PCS  CSK  = 10 prescaled functional clocks = 1 usec&lt;/li&gt;
&lt;li&gt; = 10 prescaled functional clocks = 1 usec&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;FIFO 
&lt;ul&gt;
&lt;li&gt;RxFIFO: Receive Data Flag (RDF)   FIFO&amp;gt;0&lt;/li&gt;
&lt;li&gt;TxFIFO: Transmit Data Flag (TDF)   FIFO&amp;lt;=3&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt; 8(80 MHz / 8 = 10 MHz )&lt;/li&gt;
&lt;li&gt; = 16 bits&lt;/li&gt;
&lt;li&gt;PCS3 &lt;/li&gt;
&lt;li&gt;SCK  Active Low&lt;/li&gt;
&lt;li&gt; SCK &lt;/li&gt;
&lt;li&gt;MSB &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt; FIFO  Rx FIFO Tx FIFO&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt; DOZE &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt; PORT  LPSPI1&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt; TDF  Tx FIFO  Tx FIFO  TDF&lt;/li&gt;
&lt;li&gt; RDF  RDF&lt;/li&gt;
&lt;li&gt; counter&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;heading-2&#34;&gt;&lt;/h3&gt;
&lt;p&gt; LPSPI &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PORT_init&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_PORTB_INDEX ]&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clock for PORTB */&lt;/span&gt;
PORTB&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;14&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;PORT_PCR_MUX(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Port B14: MUX = ALT3, LPSPI1_SCK */&lt;/span&gt;
PORTB&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;PORT_PCR_MUX(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Port B15: MUX = ALT3, LPSPI1_SIN */&lt;/span&gt;
PORTB&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;PORT_PCR_MUX(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Port B16: MUX = ALT3, LPSPI1_SOUT */&lt;/span&gt;
PORTB&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;17&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;PORT_PCR_MUX(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Port B17: MUX = ALT3, LPSPI1_PCS3 */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; PORT MUX  S32K  hello world &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LPSPI1_init_master&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_LPSPI1_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable clocks to modify PCS ( default) */&lt;/span&gt;
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_LPSPI1_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xC6000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable PCS=SPLL_DIV2 (40 MHz func&amp;#39;l clock) */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable module for configuration */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;IER &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Interrupts not used */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;DER &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* DMA not used */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CFGR0 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Defaults: */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* RDM0=0: rec&amp;#39;d data to FIFO as normal */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* CIRFIFO=0; Circular FIFO is disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* HRSEL, HRPOL, HREN=0: Host request disabled */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CFGR1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Configurations: master mode*/&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* PCSCFG=0: PCS[3:2] are enabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* OUTCFG=0: Output data retains last value when CS negated */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* PINCFG=0: SIN is input, SOUT is output */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MATCFG=0: Match disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* PCSPOL=0: PCS is active low */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* NOSTALL=0: Stall if Tx FIFO empty or Rx FIFO full */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* AUTOPCS=0: does not apply for master mode */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SAMPLE=0: input data sampled on SCK edge */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MASTER=1: Master mode */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x5300000F&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Transmit cmd: PCS3, 16bits, prescale func&amp;#39;l clk by 4. */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* CPOL=0: SCK inactive state is low */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* CPHA=1: Change data on SCK lead&amp;#39;g, capture on trail&amp;#39;g edge*/&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* PRESCALE=2: Functional clock divided by 2**2 = 4 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* PCS=3: Transfer using PCS3 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* LSBF=0: Data is transferred MSB first */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* BYSW=0: Byte swap disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* CONT, CONTC=0: Continuous transfer disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* RXMSK=0: Normal transfer: rx data stored in rx FIFO */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TXMSK=0: Normal transfer: data loaded from tx FIFO */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* WIDTH=0: Single bit transfer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* FRAMESZ=15: # bits in frame = 15+1=16 */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CCR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x04090808&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clk dividers based on prescaled func&amp;#39;l clk of 100 nsec */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SCKPCS=4: SCK to PCS delay = 4+1 = 5 (500 nsec) */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* PCSSCK=4: PCS to SCK delay = 9+1 = 10 (1 usec) */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* DBT=8: Delay between Transfers = 8+2 = 10 (1 usec) */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SCKDIV=8: SCK divider =8+2 = 10 (1 usec: 1 MHz baud rate) */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;FCR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000003&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* RXWATER=0: Rx flags set when Rx FIFO &amp;gt;0 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TXWATER=3: Tx flags set when Tx FIFO &amp;lt;= 3 */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000009&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable module for operation */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* DBGEN=1: module enabled in debug mode */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* DOZEN=0: module enabled in Doze mode */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* RST=0: Master logic not reset */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MEN=1: Module is enabled */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; LPSPI  SPI &lt;/p&gt;
&lt;p&gt; S32K144 LPSPI &lt;/p&gt;
&lt;h3 id=&#34;lpspi-&#34;&gt;LPSPI &lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Command/transmit FIFO  4  dwords (1 dword = 32 bits)&lt;/li&gt;
&lt;li&gt;Receive FIFO  4  words (1 dword = 32 bits)&lt;/li&gt;
&lt;li&gt;&amp;ldquo; (Host request input)&amp;rdquo;  SPI &lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;lpspi--1&#34;&gt;LPSPI &lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-20-S32K144_7/LPSPI.png&#34; alt=&#34;LPSPI.png&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;lpspi--2&#34;&gt;LPSPI &lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Chip Mode&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;LPSPI Operation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Run&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Stop/Wait&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt; &lt;code&gt;Doze Enable&lt;/code&gt;  0 &lt;!-- raw HTML omitted --&gt; LPSPI &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Low Leakage Stop&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;code&gt;Doze Enable&lt;/code&gt; LPSPI &lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Debug&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt; &lt;code&gt;Debug Enable&lt;/code&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;heading-3&#34;&gt;&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h3 id=&#34;control-register-lpspix-cr&#34;&gt;Control Register (LPSPIx_CR)&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RRF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Reset Receive FIFO&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 Rx FIFO &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RTF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Reset Transmit FIFO&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 Tx FIFO &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DBGEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Debug Enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0  Debug &lt;!-- raw HTML omitted --&gt;1  Debug &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DOZEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Doze mode enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0  Doze &lt;!-- raw HTML omitted --&gt;1  Doze &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RST&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Software Reset&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; SPI  CR&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Module Enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;status-register-lpspix-sr&#34;&gt;Status Register (LPSPIx_SR)&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MBF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Module Busy Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 LPSPI &lt;!-- raw HTML omitted --&gt;1 LPSPI &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DMF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Data Match Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; MATCFG &lt;!-- raw HTML omitted --&gt;0 LPSPI &lt;!-- raw HTML omitted --&gt;1 LPSPI &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;REF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Error Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; Rx FIFO overflow&lt;!-- raw HTML omitted --&gt;0 Rx FIFO &lt;!-- raw HTML omitted --&gt;1 Rx FIFO &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TEF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Error Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; Tx FIFO underrun&lt;!-- raw HTML omitted --&gt;0 Tx FIFO  underrun&lt;!-- raw HTML omitted --&gt;1 Rx FIFO  underrun&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TCF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transfer Complete Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FCF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Frame Complete Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 /&lt;!-- raw HTML omitted --&gt;1 /&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;WCF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Word Complete Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 /&lt;!-- raw HTML omitted --&gt;1 /&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RDF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Data Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; Rx FIFO RXWATER &lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Data Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; Tx FIFO TXWATER &lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;interrupt-enable-register-lpspix-ier&#34;&gt;Interrupt Enable Register (LPSPIx_IER)&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DMIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Data Match Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DMIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Error Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TEIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Error Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TCIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transfer Complete Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TEIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Error Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;WCIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Word Complete Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RDIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Data Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Data Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;dma-enable-register-lpspix-der&#34;&gt;DMA Enable Register (LPSPIx_DER)&lt;/h3&gt;
&lt;p&gt;DMA &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RDDE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Data DMA Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDDE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Data DMA Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;configuration-register-0-lpspix-cfgr0&#34;&gt;Configuration Register 0 (LPSPIx_CFGR0)&lt;/h3&gt;
&lt;p&gt; SPI  0 &amp;hellip;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RDMO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Data Match Only&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0  FIFO &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CIRFIFO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Circular FIFO Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; Tx FIFO &lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;HRSEL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Host Request Select&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 Host request  LPSPI_HREQ &lt;!-- raw HTML omitted --&gt;1 Host request &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;HRPOL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Host Request Polarity&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 Active low&lt;!-- raw HTML omitted --&gt;1 Active high&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;HREN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Host Request Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;LPSPI  host request &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;configuration-register-1-lpspix-cfgr1&#34;&gt;Configuration Register 1 (LPSPIx_CFGR1)&lt;/h3&gt;
&lt;p&gt; LPSPI &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;27&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PCSCFG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Peripheral Chip Select Configuration&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; 4-bit &lt;!-- raw HTML omitted --&gt;0 PCS[3:2]  &lt;!-- raw HTML omitted --&gt;1 PCS[3:2] &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;26&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;OUTCFG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Output Config&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;25-24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PINCFG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Pin Configuration&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;00 SIN  SOUT &lt;!-- raw HTML omitted --&gt;01 SOUT &lt;!-- raw HTML omitted --&gt;10 SDI &lt;!-- raw HTML omitted --&gt;11 SIN  SOUT &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;18-16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MATCFG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Match Configuration&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; DMF &lt;!-- raw HTML omitted --&gt;000 Match disabled&lt;!-- raw HTML omitted --&gt;010 Match  ( MATCH0  MATCH1 )&lt;!-- raw HTML omitted --&gt;011 Match  ( MATCH0  MATCH1 )&lt;!-- raw HTML omitted --&gt;100 Match  ( MATCH0   MATCH1 )&lt;!-- raw HTML omitted --&gt;101 Match  ( MATCH0   MATCH1 )&lt;!-- raw HTML omitted --&gt;110 Match  ( MATCH0   MATCH0  MATCH1 )&lt;!-- raw HTML omitted --&gt;111 Match  ( MATCH0   MATCH0  MATCH1 )&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;11-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PCSPOL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Peripheral Chip Select Polarity&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 PCSx active low&lt;!-- raw HTML omitted --&gt;1 PCSx active high&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;NOSTALL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;NO STALL&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; Tx FIFO  Rx FIFO &lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AUTOPCS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Automatic PCS&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SAMPLE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Sample Point&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 Input data sampled on SCK edge.&lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 Input data sampled on delayed SCK edge&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MASTER&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Master Mode&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 Slave mode&lt;!-- raw HTML omitted --&gt;1 Master mode&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;data-match-register-01-lpspix-dmr01&#34;&gt;Data Match Register 0/1 (LPSPIx_DMR0/1)&lt;/h3&gt;
&lt;p&gt;   0/1&lt;/p&gt;
&lt;h3 id=&#34;clock-configuration-register-lpspix-ccr&#34;&gt;Clock Configuration Register (LPSPIx_CCR)&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;31-24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SCKPCS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SCK to PCS Delay&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; SCK  PCS &lt;!-- raw HTML omitted --&gt;Delay=(SCKPCS+1)*&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;23-16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PCSSCK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;PCS to SCK Delay&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; PCS   SCK &lt;!-- raw HTML omitted --&gt;Delay=(PCSSCK+1)*&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DBT&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Delay Between Transfers&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;PCS &lt;!-- raw HTML omitted --&gt;Delay=(DBT+2)*&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SCKDIV&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SCK Divider&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; SCK &lt;!-- raw HTML omitted --&gt;Divider=(SCKDIV+2)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;fifo-control-register-lpspix-fcr&#34;&gt;FIFO Control Register (LPSPIx_FCR)&lt;/h3&gt;
&lt;p&gt; FIFO &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;23-16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RXWATER&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive FIFO Watermark&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; Rx FIFO  RDF(Receive Data Flag) &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TXWATER&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit FIFO Watermark&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; Tx FIFO  TDF(Transmit Data Flag) &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;transmit-command-register-lpspix-tcr&#34;&gt;Transmit Command Register (LPSPIx_TCR)&lt;/h3&gt;
&lt;p&gt; Tx FIFO FIFO  LPSPI &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;31&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CPOL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Clock Polarity&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0  SCK  low&lt;!-- raw HTML omitted --&gt;1  SCK  high&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CPHA&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Clock Phase&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;29-27&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PRESCALE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Prescaler Value&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;=2^(&lt;code&gt;PRESCALE&lt;/code&gt;+1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;25-24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PCS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Peripheral Chip Select&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; PCS[&lt;code&gt;PCS&lt;/code&gt;]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;23&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;LSBF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;LSB First&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0 MSB &lt;!-- raw HTML omitted --&gt;1 LSB &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;22&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYSW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Byte Swap&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;[31:24][7:0][23:16][15:8]&lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CONT&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Continuous Transfer&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; PCS &lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;20&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CONTC&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Continuing Command&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; &lt;code&gt;CONT=1&lt;/code&gt; &lt;!-- raw HTML omitted --&gt; 1&lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;19&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RXMSK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Data Mask&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;FIFO&lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;18&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TXMSK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Data Mask&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;17-16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;WIDTH&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transfer Width&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;00 &lt;!-- raw HTML omitted --&gt;01 &lt;!-- raw HTML omitted --&gt;10 &lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;11-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FRAMESZ&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Frame Size&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;=(&lt;code&gt;FRAMESZ&lt;/code&gt;+1)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;transmit-data-register-lpspix-tdr&#34;&gt;Transmit Data Register (LPSPIx_TDR)&lt;/h3&gt;
&lt;p&gt;32-bit  32  0 &lt;/p&gt;
&lt;p&gt; RDR &lt;/p&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 6 DMA</title>
      <link>https://xiahualiu.github.io/posts/2017-10-19-s32k144_6/</link>
      <pubDate>Thu, 19 Oct 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-10-19-s32k144_6/</guid>
      <description>&lt;p&gt; S32K  DMA &lt;/p&gt;
&lt;h3 id=&#34;heading&#34;&gt;:&lt;/h3&gt;
&lt;p&gt;DMA &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-19-S32K144_6/DMA_layout.png&#34; alt=&#34;DMA_layout.png&#34;&gt;&lt;/p&gt;
&lt;p&gt; eDMA  Transfer Control Descriptor (TCD)  &lt;code&gt;Hello world&lt;/code&gt;  SRAM  RAM  DMA  DMA &lt;/p&gt;
&lt;p&gt; DMA  DMA MUX RM  DMA MUX &lt;/p&gt;
&lt;p&gt; ADC  DMA DMA  SRAMDMA  CPU &lt;/p&gt;
&lt;p&gt; Channel linking  Scatter-Gather (SGA) DMA  TCD  DMA Minor loop mapping  MCU  45 &lt;/p&gt;
&lt;p&gt; DMA &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; DMA  START &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;START  DMA ACTIVE  DMA  START  ACTIVE &lt;/p&gt;
&lt;p&gt;TCD  &lt;code&gt;DOFF=1&lt;/code&gt; &lt;/p&gt;
&lt;p&gt; TCD(DMA Transfer Control Descriptor) TCD  DMA  TCD  8  32-bit &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-19-S32K144_6/TCD.png&#34; alt=&#34;TCD.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-19-S32K144_6/TCD_init.png&#34; alt=&#34;TCD_init.png&#34;&gt;&lt;/p&gt;
&lt;p&gt; DMA :sweat_smile:
 TCD  DMA &lt;/p&gt;
&lt;h3 id=&#34;heading-1&#34;&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt; SOSC 8MHzSYSCLK 80MHzRUN mode&lt;/li&gt;
&lt;li&gt; DMA 
&lt;ul&gt;
&lt;li&gt; DMA MUX  START &lt;/li&gt;
&lt;li&gt; START &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt; DMA TCD TCD0  0  TCD
&lt;ul&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;Source address (SADDR): Use address of a string Hello World&lt;/li&gt;
&lt;li&gt;Source offset (SOFF): Increment source address by 1 byte for each transfer&lt;/li&gt;
&lt;li&gt;Source modulo (SMOD): Feature not used here&lt;/li&gt;
&lt;li&gt;Source size (SSIZE): Read 1 byte at a time&lt;/li&gt;
&lt;li&gt;Source last address adjustment (SLAST): Decrement source address by 11 after major loop&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;Destination address (DADDR): Use address of a single byte&lt;/li&gt;
&lt;li&gt;Destination offset (DOFF): Do not add offset to destination address after minor loop&lt;/li&gt;
&lt;li&gt;Destination modulo (DMOD): Feature not used here&lt;/li&gt;
&lt;li&gt;Destination size (DSIZE): Write 1 byte at a time&lt;/li&gt;
&lt;li&gt;Destination last address adjustment (DLAST): Do not adjust address after major loop&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt; DMA minor lopps
&lt;ul&gt;
&lt;li&gt;Number of bytes to be transferred per DMA request (NBYTES): One byte&lt;/li&gt;
&lt;li&gt;Number of iterations/minor loops in major loop (CITER and BITER): 11&lt;/li&gt;
&lt;li&gt;Channel to channel linking for additional iterations after minor loop (BITER ELINK and CITER ELINK): Disabled&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;Disable channel after major loop completes (DREQ): Disable channel&lt;/li&gt;
&lt;li&gt;Generate interrupt request half way through major loop (INTHALF): Disabled&lt;/li&gt;
&lt;li&gt;Generate interrupt request after completing major loop (INTMAJOR): Disabled&lt;/li&gt;
&lt;li&gt;Enable Scatter-Gather (ESG): Disabled. No other TCDs loaded to channel&lt;/li&gt;
&lt;li&gt;Enable channel link after major loop (MAJORLINK): Disabled&lt;/li&gt;
&lt;li&gt;Channel link number after major loop (MAJORLINKCH): Null - feature disabled&lt;/li&gt;
&lt;li&gt;Band Width Control (BWC): Set to 0 so there are no stalls after R/W&lt;/li&gt;
&lt;li&gt;Clear initial values of status flags (START, ACTIVE, DONE): Set to zero&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt; START  1START=0ACTIVE=0&lt;/li&gt;
&lt;li&gt; DONE 
&lt;ul&gt;
&lt;li&gt; START  1START=0ACTIVE=0&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt; DONE &lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;heading-2&#34;&gt;&lt;/h3&gt;
&lt;h5 id=&#34;mainc&#34;&gt;main.c&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34; /* Include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;dma.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;clocks_and_modes.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WDOG_disable&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CNT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xD928C520&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Unlock watchdog */&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TOVAL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x0000FFFF&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Maximum timeout value */&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00002100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable watchdog */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
WDOG_disable();
SOSC_init_8MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize system oscillator for 8 MHz xtal */&lt;/span&gt;
SPLL_init_160MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize SPLL to 160 MHz with 8 MHz SOSC */&lt;/span&gt;
NormalRUNmode_80MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init clocks: 80 MHz SPLL &amp;amp; core, 40 MHz bus, 20 MHz flash */&lt;/span&gt;
DMA_init(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init DMA controller */&lt;/span&gt;
DMA_TCD_init(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init DMA Transfer Control Descriptor(s) */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SSRT &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Set chan 0 START bit to initiate first minor loop */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (((DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; DMA_TCD_CSR_START_SHIFT) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for START = 0 */&lt;/span&gt;
((DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; DMA_TCD_CSR_ACTIVE_SHIFT) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)) {} &lt;span style=&#34;color:#75715e&#34;&gt;/* and ACTIVE = 0 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* Now minor loop has completed */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;((DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; DMA_TCD_CSR_DONE_SHIFT) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) ) { &lt;span style=&#34;color:#75715e&#34;&gt;/* Loop till DONE = 1 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* Place breakpoint at next instruction &amp;amp; observe expressions TCD0_Source, TCD0_Dest */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SSRT &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Set chan 0 START bit to initiate next minor loop */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (((DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; DMA_TCD_CSR_START_SHIFT) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for START = 0 */&lt;/span&gt;
((DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; DMA_TCD_CSR_ACTIVE_SHIFT) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)) {} &lt;span style=&#34;color:#75715e&#34;&gt;/* and ACTIVE = 0 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* Now minor loop has completed */&lt;/span&gt;
}
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;(DMA_TCD_CSR_DONE_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear DONE bit */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) {} &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait forever */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;dmac&#34;&gt;DMA.c&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34; /* include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;dma.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;uint8_t TCD0_Source[] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Hello World&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;}; &lt;span style=&#34;color:#75715e&#34;&gt;/* TCD 0 source (11 byte string) */&lt;/span&gt;
uint8_t &lt;span style=&#34;color:#66d9ef&#34;&gt;volatile&lt;/span&gt; TCD0_Dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* TCD 0 destination (1 byte) */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DMA_init&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
&lt;span style=&#34;color:#75715e&#34;&gt;/* This is an initialization place holder for: */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* 1. Enabling DMA MUX clock PCC_PCCn[PCC_DMAMUX_INDEX] (not needed when START bit used) */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* 2. Enabling desired channels by setting ERQ bit (not needed when START bit used) */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DMA_TCD_init&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
&lt;span style=&#34;color:#75715e&#34;&gt;/* TCD0: Transfers string to a single memory location */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].SADDR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_SADDR_SADDR((uint32_t &lt;span style=&#34;color:#66d9ef&#34;&gt;volatile&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;TCD0_Source); &lt;span style=&#34;color:#75715e&#34;&gt;/* Src */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].SOFF &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_SOFF_SOFF(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Src addr add 1 byte after transfer*/&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].ATTR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_ATTR_SMOD(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Src modulo feature not used */&lt;/span&gt;
DMA_TCD_ATTR_SSIZE(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Src read 2**0 =1 byte per transfer*/&lt;/span&gt;
DMA_TCD_ATTR_DMOD(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Dest modulo feature not used */&lt;/span&gt;
DMA_TCD_ATTR_DSIZE(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Dest write 2**0 =1 byte per trans.*/&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].NBYTES.MLNO &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_NBYTES_MLNO_NBYTES(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Transfer 1 byte /minor loop*/&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].SLAST &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_SLAST_SLAST(&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Src addr change after major loop*/&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].DADDR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_DADDR_DADDR((uint32_t &lt;span style=&#34;color:#66d9ef&#34;&gt;volatile&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;TCD0_Dest);&lt;span style=&#34;color:#75715e&#34;&gt;/* Dest. */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].DOFF &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_DOFF_DOFF(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* No dest adr offset after transfer*/&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CITER.ELINKNO&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_CITER_ELINKNO_CITER(&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* 11 minor loop iterations*/&lt;/span&gt;
DMA_TCD_CITER_ELINKNO_ELINK(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* No minor loop chan link */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].DLASTSGA &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_DLASTSGA_DLASTSGA(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* No dest chg after major loop*/&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_CSR_START(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear START status flag */&lt;/span&gt;
DMA_TCD_CSR_INTMAJOR(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* No IRQ after major loop */&lt;/span&gt;
DMA_TCD_CSR_INTHALF(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* No IRQ after 1/2 major loop */&lt;/span&gt;
DMA_TCD_CSR_DREQ(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable chan after major loop*/&lt;/span&gt;
DMA_TCD_CSR_ESG(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable Scatter Gather */&lt;/span&gt;
DMA_TCD_CSR_MAJORELINK(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* No major loop chan link */&lt;/span&gt;
DMA_TCD_CSR_ACTIVE(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear ACTIVE status flag */&lt;/span&gt;
DMA_TCD_CSR_DONE(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear DONE status flag */&lt;/span&gt;
DMA_TCD_CSR_MAJORLINKCH(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Chan # if major loop ch link */&lt;/span&gt;
DMA_TCD_CSR_BWC(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* No eDMA stalls after R/W */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].BITER.ELINKNO&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_BITER_ELINKNO_BITER(&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Initial iteration count*/&lt;/span&gt;
DMA_TCD_BITER_ELINKNO_ELINK(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* No minor loop chan link */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
DMA CPU  DMA &lt;/p&gt;
&lt;p&gt;DMA &lt;/p&gt;
&lt;p&gt; DMA MUX DMA MUX  64  DMA  16  DMA  DMA  DMAMUX  16  DMA  DMA  DMAMUX DMA  DMA&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-19-S32K144_6/DMAMUX.png&#34; alt=&#34;DMAMUX.png&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;dmamux-&#34;&gt;DMAMUX &lt;/h3&gt;
&lt;h4 id=&#34;heading-3&#34;&gt;&lt;/h4&gt;
&lt;p&gt;DMA  DMA  DMA  DMA  DMA  DMA &lt;/p&gt;
&lt;h4 id=&#34;heading-4&#34;&gt;&lt;/h4&gt;
&lt;p&gt;DMA  DMA  DMA MUX &lt;/p&gt;
&lt;h4 id=&#34;heading-5&#34;&gt;&lt;/h4&gt;
&lt;p&gt;DMA  DMA  Buffer  Buffer &lt;/p&gt;
&lt;p&gt; LPIT  0-3 &lt;/p&gt;
&lt;h3 id=&#34;-dmamux&#34;&gt; DMAMUX&lt;/h3&gt;
&lt;h4 id=&#34;channel-configuration-register-dmamux-chcfgnn0-15&#34;&gt;Channel Configuration register (DMAMUX_CHCFGn)(n=0-15)&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt; DMA &lt;/strong&gt; CHCFG &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ENBL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;DMA Channel Enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0 1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TRIG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;DMA Channel Trigger Enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 DMA MUX &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOURCE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;heading-6&#34;&gt;&lt;/h3&gt;
&lt;p&gt;DMAMUX  DMA  DMA &lt;/p&gt;
&lt;p&gt;DMAMUX &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt; DMAMUX  GPIO  DMA  DMA &lt;/p&gt;
&lt;h3 id=&#34;-dma-&#34;&gt; DMA &lt;/h3&gt;
&lt;h4 id=&#34;heading-7&#34;&gt;&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt; DMA  4 &lt;/li&gt;
&lt;li&gt; &lt;code&gt;CHCFG[ENBL]&lt;/code&gt;  &lt;code&gt;CHCFG[TRIG]&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt; DMA  DMA &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt; DMA  &lt;code&gt;CHCFG[ENBL]&lt;/code&gt;  &lt;code&gt;CHCFG[TRIG]&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;heading-8&#34;&gt;&lt;/h5&gt;
&lt;p&gt; 5#  DMA  1&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt; &lt;code&gt;CHCFG1&lt;/code&gt;  0x00&lt;/li&gt;
&lt;li&gt; 1  DMA &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt; &lt;code&gt;CHCFG1&lt;/code&gt; &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt; DMAMUX &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DMAMUX_Init&lt;/span&gt; (uint8_t DMA_CH, uint8_t DMAMUX_SOURCE)
{
    DMAMUX_0.CHCFG[DMA_CH].B.SOURCE &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMAMUX_SOURCE;
    DMAMUX_0.CHCFG[DMA_CH].B.ENBL &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
    DMAMUX_0.CHCGF[DMA_CH].B.TRIG &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;heading-9&#34;&gt;&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt; DMA  4 &lt;/li&gt;
&lt;li&gt; &lt;code&gt;CHCFG[ENBL]&lt;/code&gt;  &lt;code&gt;CHCFG[TRIG]&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt; DMA  DMA &lt;/li&gt;
&lt;li&gt; DMA  &lt;code&gt;CHCFG[ENBL]&lt;/code&gt;  &lt;code&gt;CHCFG[TRIG]&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt; DMAMUX  DMA  eDMA(Enhanced Direct Memory Access) &lt;/p&gt;
&lt;h3 id=&#34;edma-&#34;&gt;eDMA &lt;/h3&gt;
&lt;p&gt;eDMA  eDMA  TCD&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-19-S32K144_6/DMA_module.png&#34; alt=&#34;DMA_module.png&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;edma--1&#34;&gt;eDMA &lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;16 &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; 16  32 &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Transfer control descriptor (TCD) &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; 32-byte TCD &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;dma-&#34;&gt;DMA &lt;/h1&gt;
&lt;p&gt; DMA  n  DMA  eDMA
 DMA  eDMA 
 DMA 
 TCD 
 TCD  eDMA &lt;/p&gt;
&lt;h3 id=&#34;edma--2&#34;&gt;eDMA &lt;/h3&gt;
&lt;p&gt; eDMA 
&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-19-S32K144_6/DMA_process.png&#34; alt=&#34;DMA_process.png&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;control-register-dma-cr&#34;&gt;Control Register (DMA_CR)&lt;/h4&gt;
&lt;p&gt; DMA &lt;/p&gt;
&lt;p&gt; DMA &lt;/p&gt;
&lt;p&gt;TCD  &lt;code&gt;TCDn_SADDR&lt;/code&gt;  &lt;code&gt;TCDn_DADDR&lt;/code&gt;  minor loop offset (MLOFF) &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt; 7-EMLM  1  Mapping &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CX&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Cancel Transfer&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 1 &lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ECX&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Error Cancel Transfer&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; CX &lt;!-- raw HTML omitted --&gt;DMA &lt;!-- raw HTML omitted --&gt;&lt;code&gt;Error Status register (DMAx_ES)&lt;/code&gt;  1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EMLM&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable Minor Loop Mapping&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; 1 TCDn.word2 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLM&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Continuous Link Mode&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;strong&gt;&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; 1 &lt;!-- raw HTML omitted --&gt; 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;HALT&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Halt DMA Operations&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 1 &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; 0 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;HOE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Halt On Error&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; HALT &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ERCA&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable Round Robin Channel Arbitration&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EDBG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable Debug&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 1  Debug &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;error-status-register-dma-es&#34;&gt;Error Status Register (DMA_ES)&lt;/h4&gt;
&lt;p&gt; DMA  OpenSDA   TCD&lt;/p&gt;
&lt;h4 id=&#34;enable-request-register-dma-erq&#34;&gt;Enable Request Register (DMA_ERQ)&lt;/h4&gt;
&lt;p&gt; 16  &lt;code&gt;DMA_SERQ&lt;/code&gt;  &lt;code&gt;DMA_CERQ&lt;/code&gt; &lt;/p&gt;
&lt;p&gt; DMA  DMA  DMA DMA &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ERQn&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable DMA Request n&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 1 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;enable-error-interrupt-register-dma-eei&#34;&gt;Enable Error Interrupt Register (DMA_EEI)&lt;/h4&gt;
&lt;p&gt; 16  &lt;code&gt;DMA_SEEI&lt;/code&gt;  &lt;code&gt;DMA_CEEI&lt;/code&gt; &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EEIn&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable Error Interrupt n&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 1 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id=&#34;interrupt-request-register-dma-int&#34;&gt;Interrupt Request Register (DMA_INT)&lt;/h5&gt;
&lt;p&gt; TCD  &lt;code&gt;CINT&lt;/code&gt; &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;n&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;INTn&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Interrupt Request n&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;1 &lt;!-- raw HTML omitted --&gt;0 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;channel-n-priority-register-dma-dchprin&#34;&gt;Channel n Priority Register (DMA_DCHPRIn)&lt;/h4&gt;
&lt;p&gt;DMA &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ECP&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable Channel Preemption&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DPA&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Disable Preempt Ability&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CHPRI&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Channel n Arbitration Priority&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h1 id=&#34;-dma--1&#34;&gt; DMA &lt;/h1&gt;
&lt;p&gt; Clear  Set&lt;/p&gt;
&lt;h4 id=&#34;clear-enable-error-interrupt-register-dma-ceei&#34;&gt;Clear Enable Error Interrupt Register (DMA_CEEI)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;NOP&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;No Op enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CAFE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Clear All Enable Error Interrupt&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 1 &lt;code&gt;DMA_EEI&lt;/code&gt;  EEI &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CEEI&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Clear Enable Error Interrupt&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0-15 EEIn &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;set-enable-error-interrupt-register-dma-seei&#34;&gt;Set Enable Error Interrupt Register (DMA_SEEI)&lt;/h4&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h4 id=&#34;clear-enable-request-register-dma-cerq&#34;&gt;Clear Enable Request Register (DMA_CERQ)&lt;/h4&gt;
&lt;p&gt; ERQ &lt;/p&gt;
&lt;h4 id=&#34;set-enable-request-register-dma-serq&#34;&gt;Set Enable Request Register (DMA_SERQ)&lt;/h4&gt;
&lt;p&gt; ERQ &lt;/p&gt;
&lt;h4 id=&#34;clear-done-status-bit-register-dma-cdne&#34;&gt;Clear DONE Status Bit Register (DMA_CDNE)&lt;/h4&gt;
&lt;p&gt; TCD  DONE &lt;/p&gt;
&lt;h4 id=&#34;set-start-bit-register-dma-ssrt&#34;&gt;Set START Bit Register (DMA_SSRT)&lt;/h4&gt;
&lt;p&gt; TCD  START &lt;/p&gt;
&lt;h4 id=&#34;clear-error-register-dma-cerr&#34;&gt;Clear Error Register (DMA_CERR)&lt;/h4&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h4 id=&#34;clear-interrupt-request-register-dma-cint&#34;&gt;Clear Interrupt Request Register (DMA_CINT)&lt;/h4&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h2 id=&#34;tcd&#34;&gt;TCD&lt;/h2&gt;
&lt;p&gt; 16  16 &lt;/p&gt;
&lt;h3 id=&#34;tcd-source-address-dma-tcdn-saddr&#34;&gt;TCD Source Address (DMA_TCDn_SADDR)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SADDR&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Source Address&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-signed-source-address-offset-dma-tcdn-soff&#34;&gt;TCD Signed Source Address Offset (DMA_TCDn_SOFF)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOFF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Source address signed offset&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-transfer-attributes-dma-tcdn-attr&#34;&gt;TCD Transfer Attributes (DMA_TCDn_ATTR)&lt;/h3&gt;
&lt;p&gt; 16-bit DMA  &lt;code&gt;NBYTES&lt;/code&gt; &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15-11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SMOD&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Source Address Modulo&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;SMOD  2^SMOD  &lt;!-- raw HTML omitted --&gt;/ &lt;!-- raw HTML omitted --&gt; SADDR+SOFF &lt;!-- raw HTML omitted --&gt; SMOD &lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SSIZE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Source data transfer size&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;000 - 8-bit&lt;!-- raw HTML omitted --&gt;001 - 16-bit&lt;!-- raw HTML omitted --&gt;010 - 32-bit &lt;!-- raw HTML omitted --&gt;011 - Reserved&lt;!-- raw HTML omitted --&gt;100 - 16-byte burst&lt;!-- raw HTML omitted --&gt;101 - 32-byte burst&lt;!-- raw HTML omitted --&gt;110 - Reserved&lt;!-- raw HTML omitted --&gt;111 - Reserved &lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7-3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DMOD&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Destination Address Modulo&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; SMOD&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DSIZE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Destination data transfer size&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; SSIZE&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-minor-byte-count-minor-loop-mapping-disabled-dma-tcdn-nbytes-mlno&#34;&gt;TCD Minor Byte Count (Minor Loop Mapping Disabled) (DMA_TCDn_NBYTES_MLNO)&lt;/h3&gt;
&lt;p&gt; &lt;code&gt;DMA_CR.MLME=1&lt;/code&gt;  TCDn.word2  &lt;code&gt;DMA_CR.MLME=0&lt;/code&gt; Minor Loop Mapping  NBYTES &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;NBYTES&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Minor Byte Transfer Count&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;  &lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;  DMA  &lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; DMA  TCD  eDMA &lt;!-- raw HTML omitted --&gt;/ NBYTES &lt;!-- raw HTML omitted --&gt;  TCD&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-signed-minor-loop-offset-minor-loop-mapping-enabled-and-offset-disabled-dma-tcdn-nbytes-mloffno&#34;&gt;TCD Signed Minor Loop Offset (Minor Loop Mapping Enabled and Offset Disabled) (DMA_TCDn_NBYTES_MLOFFNO)&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Minor loop mapping  (&lt;code&gt;CR[EMLM] = 1&lt;/code&gt;) &lt;/li&gt;
&lt;li&gt;&lt;code&gt;SMLOE = 0&lt;/code&gt; &lt;strong&gt;and&lt;/strong&gt; &lt;code&gt;DMLOE = 0&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;31&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SMLOE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Source Minor Loop Offset Enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DMLOE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Destination Minor Loop Offset enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;29-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;NBYTES&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Minor Byte Transfer Count&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;  &lt;strong&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-signed-minor-loop-offset-minor-loop-mapping-and-offset-enabled-dma-tcdn-nbytes-mloffyes&#34;&gt;TCD Signed Minor Loop Offset (Minor Loop Mapping and Offset Enabled) (DMA_TCDn_NBYTES_MLOFFYES)&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Minor loop mapping  (&lt;code&gt;CR[EMLM] = 1&lt;/code&gt;) &lt;/li&gt;
&lt;li&gt;&lt;code&gt;SMLOE = 1&lt;/code&gt; &lt;strong&gt;or&lt;/strong&gt; &lt;code&gt;DMLOE = 1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;31&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SMLOE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Source Minor Loop Offset Enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DMLOE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Destination Minor Loop Offset enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;29-10&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MLOFF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;NBYTES&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Minor Byte Transfer Count&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;  &lt;strong&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; MLOFF  SOFF DOFF  MLOFF &lt;/p&gt;
&lt;h3 id=&#34;tcd-last-source-address-adjustment-dma-tcdn-slast&#34;&gt;TCD Last Source Address Adjustment (DMA_TCDn_SLAST)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SLAST&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Last Source Address Adjustment&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;  &lt;!-- raw HTML omitted --&gt;  &lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-tcd-destination-address-dma-tcdn-daddr&#34;&gt;TCD TCD Destination Address (DMA_TCDn_DADDR)&lt;/h3&gt;
&lt;p&gt; SADDR &lt;/p&gt;
&lt;h3 id=&#34;tcd-signed-destination-address-offset-dma-tcdn-doff&#34;&gt;TCD Signed Destination Address Offset (DMA_TCDn_DOFF)&lt;/h3&gt;
&lt;p&gt;16-bit&lt;/p&gt;
&lt;h3 id=&#34;tcd-current-minor-loop-link-major-loop-count-dma-tcdn-citer-elinkyes&#34;&gt;TCD Current Minor Loop Link, Major Loop Count (DMA_TCDn_CITER_ELINKYES)&lt;/h3&gt;
&lt;p&gt; 16-bit&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ELINK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable channel-to-channel linking on minor-loop complete&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;  &lt;!-- raw HTML omitted --&gt;  1  &lt;code&gt;LINKCH&lt;/code&gt;  &lt;code&gt;TCDn_CSR[START]=1&lt;/code&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;12-9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;LINKCH&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Minor Loop Link Channel Number&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; &lt;code&gt;ELINK=1&lt;/code&gt;  &lt;!-- raw HTML omitted --&gt; &lt;code&gt;ELINK=0&lt;/code&gt;  &lt;code&gt;CITER&lt;/code&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;(14-0) or (8-0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CITER&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Current Major Iteration Count&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;  &lt;!-- raw HTML omitted --&gt; 15-bit  &lt;code&gt;ELINK=0&lt;/code&gt; &lt;!-- raw HTML omitted --&gt;  9-bit  &lt;code&gt;ELINK=1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-last-destination-address-adjustmentscatter-gather&#34;&gt;TCD Last Destination Address Adjustment/Scatter Gather&lt;/h3&gt;
&lt;p&gt;Address (DMA_TCDn_DLASTSGA)&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DLASTSGA&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;  &lt;code&gt;TCDn_CSR[ESG] = 0&lt;/code&gt;  &lt;!-- raw HTML omitted --&gt; &lt;code&gt;TCDn_CSR[ESG] != 0&lt;/code&gt;  TCD&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-control-and-status-dma-tcdn-csr&#34;&gt;TCD Control and Status (DMA_TCDn_CSR)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15-14&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BWC&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 00  eDMA  &lt;!-- raw HTML omitted --&gt;01 Reserved&lt;!-- raw HTML omitted --&gt;10 eDMA  4 &lt;!-- raw HTML omitted --&gt;11 eDMA  8 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;11-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MAJORLINKCH&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DONE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;  CITER &lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACTIVE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MAJORELINK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 0  &lt;!-- raw HTML omitted --&gt; 1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ESG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 0  TCD  &lt;!-- raw HTML omitted --&gt; 1  TCD.DLASTSGA  TCD&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DREQ&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 1  ERQ  &lt;!-- raw HTML omitted --&gt; 0  ERQ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;INTHALF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 0  &lt;!-- raw HTML omitted --&gt; 1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;INTMAJOR&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 0  &lt;!-- raw HTML omitted --&gt; 1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;START&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 0  &lt;!-- raw HTML omitted --&gt; 1  &lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; BITER  CITER  BITER  CITER  BITER  DMA &lt;/p&gt;
&lt;p&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 5 NVIC</title>
      <link>https://xiahualiu.github.io/posts/2017-10-17-s32k144_5/</link>
      <pubDate>Tue, 17 Oct 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-10-17-s32k144_5/</guid>
      <description>&lt;p&gt; S32K  ADC &lt;/p&gt;
&lt;h1 id=&#34;heading&#34;&gt;&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;SOSC 8MHzSPLL 160Mhz 80MHz RUN &lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt; PCC  Port D&lt;/li&gt;
&lt;li&gt;PTD0: GPIO output - connects to blue LED&lt;/li&gt;
&lt;li&gt;PTD15: GPIO output - connects to red LED&lt;/li&gt;
&lt;li&gt;PTD16: GPIO output - connects to green LED&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt; ADC
&lt;ul&gt;
&lt;li&gt; SOSCDIV2_CLK &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt; ADC  12  SOSCDIV_CLK,  1&lt;/li&gt;
&lt;li&gt; 13 ADCK &lt;/li&gt;
&lt;li&gt; DMA  -  $V_{REFH}$  $V_{REFL}$&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt; ADC   12 &lt;code&gt;ADC_SC1[0]&lt;/code&gt; &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; 0-5000mv  &lt;code&gt;ADC_R[0]&lt;/code&gt; &lt;/li&gt;
&lt;li&gt; LED&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt; ADC  ADC  &lt;code&gt;ADC_SC1[0]&lt;/code&gt; &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; 0-5000mv  &lt;code&gt;ADC_R[0]&lt;/code&gt; &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;heading-1&#34;&gt;&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34; /* include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;clocks_and_modes.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;ADC.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTD15 15 &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* RED LED*/&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTD16 16 &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* GREEN LED*/&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTD0 0 &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* BLUE LED */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PORT_init&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_PORTD_INDEX ]&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clock for PORTD */&lt;/span&gt;
PORTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[PTD0] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0: MUX = GPIO */&lt;/span&gt;
PORTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[PTD15] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D15: MUX = GPIO */&lt;/span&gt;
PORTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[PTD16] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D16: MUX = GPIO */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0: Data Direction= output */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD15; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D15: Data Direction= output */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD16; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D16: Data Direction= output */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WDOG_disable&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CNT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xD928C520&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Unlock watchdog */&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TOVAL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x0000FFFF&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Maximum timeout value */&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00002100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable watchdog */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
uint32_t adcResultInMv&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
WDOG_disable(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable WDOG*/&lt;/span&gt;
SOSC_init_8MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize system oscillator for 8 MHz xtal */&lt;/span&gt;
SPLL_init_160MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize SPLL to 160 MHz with 8 MHz SOSC */&lt;/span&gt;
NormalRUNmode_80MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init clocks: 80 MHz sysclk &amp;amp; core, 40 MHz bus, 20 MHz flash */&lt;/span&gt;
PORT_init(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init port clocks and gpio outputs */&lt;/span&gt;
ADC_init(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init ADC resolution 12 bit*/&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(;;) {
convertAdcChan(&lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Convert Channel AD12 to pot on EVB */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(adc_complete()&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;){} &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for conversion complete flag */&lt;/span&gt;
adcResultInMv &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; read_adc_chx(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Get channel&amp;#39;s conversion results in mv */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (adcResultInMv &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3750&lt;/span&gt;) { &lt;span style=&#34;color:#75715e&#34;&gt;/* If result &amp;gt; 3.75V */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PSOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD16; &lt;span style=&#34;color:#75715e&#34;&gt;/* turn off blue, green LEDs */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD15; &lt;span style=&#34;color:#75715e&#34;&gt;/* turn on red LED */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (adcResultInMv &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2500&lt;/span&gt;) { &lt;span style=&#34;color:#75715e&#34;&gt;/* If result &amp;gt; 3.75V */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PSOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD15; &lt;span style=&#34;color:#75715e&#34;&gt;/* turn off blue, red LEDs */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD16; &lt;span style=&#34;color:#75715e&#34;&gt;/* turn on green LED */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (adcResultInMv &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1250&lt;/span&gt;) { &lt;span style=&#34;color:#75715e&#34;&gt;/* If result &amp;gt; 3.75V */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PSOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD15 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD16; &lt;span style=&#34;color:#75715e&#34;&gt;/* turn off red, green LEDs */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0; &lt;span style=&#34;color:#75715e&#34;&gt;/* turn on blue LED */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PSOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; PTD15 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD16; &lt;span style=&#34;color:#75715e&#34;&gt;/* Turn off all LEDs */&lt;/span&gt;
}
convertAdcChan(&lt;span style=&#34;color:#ae81ff&#34;&gt;29&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Convert chan 29, Vrefsh */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(adc_complete()&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;){} &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for conversion complete flag */&lt;/span&gt;
adcResultInMv &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; read_adc_chx(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Get channel&amp;#39;s conversion results in mv */&lt;/span&gt;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ADC &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;ADC.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ADC_init&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_ADC0_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable clock to change PCS */&lt;/span&gt;
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_ADC0_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_PCS(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* PCS=1: Select SOSCDIV2 */&lt;/span&gt;
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_ADC0_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable bus clock in ADC */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SC1[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00001F&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* ADCH=1F: Module is disabled for conversions*/&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* AIEN=0: Interrupts are disabled */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CFG1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x000000004&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* ADICLK=0: Input clk=ALTCLK1=SOSCDIV2 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ADIV=0: Prescaler=1 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MODE=1: 12-bit conversion */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CFG2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000C&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* SMPLTS=12(default): sample time is 13 ADC clks */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SC2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* ADTRG=0: SW trigger */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ACFE,ACFGT,ACREN=0: Compare func disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* DMAEN=0: DMA disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* REFSEL=0: Voltage reference pins= VREFH, VREEFL */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SC3 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* CAL=0: Do not start calibration sequence */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ADCO=0: One conversion performed */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* AVGE,AVGS=0: HW average function disabled */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;convertAdcChan&lt;/span&gt;(uint16_t adcChan) { &lt;span style=&#34;color:#75715e&#34;&gt;/* For SW trigger mode, SC1[0] is used */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SC1[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;ADC_SC1_ADCH_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear prior ADCH bits */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SC1[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ADC_SC1_ADCH(adcChan); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initiate Conversion*/&lt;/span&gt;
}
uint8_t &lt;span style=&#34;color:#a6e22e&#34;&gt;adc_complete&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; ((ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SC1[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; ADC_SC1_COCO_MASK)&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;ADC_SC1_COCO_SHIFT); &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for completion */&lt;/span&gt;
}
uint32_t &lt;span style=&#34;color:#a6e22e&#34;&gt;read_adc_chx&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
uint16_t adc_result&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
adc_result&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;R[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]; &lt;span style=&#34;color:#75715e&#34;&gt;/* For SW trigger mode, R[0] is used */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; (uint32_t) ((&lt;span style=&#34;color:#ae81ff&#34;&gt;5000&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;adc_result)&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xFFF&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Convert result to mv for 0-5V range */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; ADC &lt;/p&gt;
&lt;h3 id=&#34;adc-status-and-control-registers-1-adc1-sc1n&#34;&gt;ADC Status and Control Registers 1 (ADC1_SC1n)&lt;/h3&gt;
&lt;p&gt; &lt;code&gt;ADC0-&amp;gt;SC1[n]&lt;/code&gt; n  ABCDEFG&amp;hellip;P&lt;/p&gt;
&lt;p&gt; 16  ADC1_SC1(A-P),  16  16  16  ADC  16 ADC trigger  pre-trigger ADC &lt;/p&gt;
&lt;p&gt; 16  A-P  0  A 
 Reserved &lt;/p&gt;
&lt;h5 id=&#34;7---cococonversion-complete-flag&#34;&gt;7 - COCO(Conversion Complete Flag):&lt;/h5&gt;
&lt;p&gt; 1&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SC2[ACFE]=0&lt;/code&gt; &lt;/li&gt;
&lt;li&gt;&lt;code&gt;SC3[AVGE]=0&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;COCO  1&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SC2[ACFE]=1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;COCO  &lt;code&gt;AVGS&lt;/code&gt; :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SC3[AVGE]=1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt; &lt;code&gt;SC1A&lt;/code&gt;  COCO &lt;/p&gt;
&lt;p&gt;COCO &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; &lt;code&gt;SC1n&lt;/code&gt; &lt;/li&gt;
&lt;li&gt; &lt;code&gt;Rn&lt;/code&gt; &lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;6---aieninterrupt-enable&#34;&gt;6 - AIEN(Interrupt Enable)&lt;/h5&gt;
&lt;p&gt; 1 COCO  1 &lt;/p&gt;
&lt;h5 id=&#34;4-0---adchinput-channel-select&#34;&gt;(4-0) - ADCH(Input channel select)&lt;/h5&gt;
&lt;p&gt; 6  RM  5  4  RM &lt;br&gt;
&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define ADC_SC1_ADCH_WIDTH    5u&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; 5  RM &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;00000 AD0 is selected as input.&lt;/li&gt;
&lt;li&gt;00001 AD1 is selected as input.&lt;/li&gt;
&lt;li&gt;00010 AD2 is selected as input.&lt;/li&gt;
&lt;li&gt;00011 AD3 is selected as input.&lt;/li&gt;
&lt;li&gt;00100 AD4 is selected as input.&lt;/li&gt;
&lt;li&gt;00101 AD5 is selected as input.&lt;/li&gt;
&lt;li&gt;00110 AD6 is selected as input.&lt;/li&gt;
&lt;li&gt;00111 AD7 is selected as input.&lt;/li&gt;
&lt;li&gt;01000 AD8 is selected as input.&lt;/li&gt;
&lt;li&gt;01001 AD9 is selected as input.&lt;/li&gt;
&lt;li&gt;01010 AD10 is selected as input.&lt;/li&gt;
&lt;li&gt;01011 AD11 is selected as input.&lt;/li&gt;
&lt;li&gt;01100 AD12 is selected as input.&lt;/li&gt;
&lt;li&gt;01101 AD13 is selected as input.&lt;/li&gt;
&lt;li&gt;01110 AD14 is selected as input.&lt;/li&gt;
&lt;li&gt;01111 AD15 is selected as input.&lt;/li&gt;
&lt;li&gt;10000 Reserved.&lt;/li&gt;
&lt;li&gt;10001 Reserved.&lt;/li&gt;
&lt;li&gt;10010 AD18 is selected as input.&lt;/li&gt;
&lt;li&gt;10011 AD19 is selected as input.&lt;/li&gt;
&lt;li&gt;10100 Reserved.&lt;/li&gt;
&lt;li&gt;10101 AD21 is selected as input.&lt;/li&gt;
&lt;li&gt;10110 AD22 is selected as input.&lt;/li&gt;
&lt;li&gt;10111 AD23 is selected as input.&lt;/li&gt;
&lt;li&gt;11000 ATX Force&lt;/li&gt;
&lt;li&gt;11001 ATX Sense&lt;/li&gt;
&lt;li&gt;11010 Temp Sensor&lt;/li&gt;
&lt;li&gt;11011 Band Gap&lt;/li&gt;
&lt;li&gt;11100 AD28 is selected as input.&lt;/li&gt;
&lt;li&gt;11101 VREFSH is selected as input. Voltage reference selected is determined by SC2[REFSEL].&lt;/li&gt;
&lt;li&gt;11110 VREFSL is selected as input. Voltage reference selected is determined by SC2[REFSEL].&lt;/li&gt;
&lt;li&gt;11111 Module is disabled.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt; 1  ADC  &lt;code&gt;ADC_SC1_ADCH(x)&lt;/code&gt;  ADCH &lt;/p&gt;
&lt;h3 id=&#34;adc-configuration-register-1-adcx-cfg1&#34;&gt;ADC Configuration Register 1 (ADCx_CFG1)&lt;/h3&gt;
&lt;p&gt; &lt;code&gt;ADC0-&amp;gt;CFG1&lt;/code&gt; ADC &lt;/p&gt;
&lt;p&gt; 0 &lt;/p&gt;
&lt;h5 id=&#34;6-5---adivclock-divide-select&#34;&gt;(6-5) - ADIV(Clock Divide Select)&lt;/h5&gt;
&lt;p&gt; ADC  ADCK &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;00  1 &lt;/li&gt;
&lt;li&gt;01  2  1/2&lt;/li&gt;
&lt;li&gt;10  4  1/4&lt;/li&gt;
&lt;li&gt;11  8  1/8&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;3-2---modeconversion-mode-selection&#34;&gt;(3-2) - MODE(Conversion mode selection)&lt;/h5&gt;
&lt;p&gt; ADC &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;00 8-bit &lt;/li&gt;
&lt;li&gt;01 12-bit &lt;/li&gt;
&lt;li&gt;10 10-bit &lt;/li&gt;
&lt;li&gt;11 Reserved&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;1-0---adiclkinput-clock-select&#34;&gt;(1-0) - ADICLK(Input Clock Select)&lt;/h5&gt;
&lt;p&gt; ADCK&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;00 Alternate clock 1 (ADC_ALTCLK1)&lt;/li&gt;
&lt;li&gt;01 Alternate clock 2 (ADC_ALTCLK2)&lt;/li&gt;
&lt;li&gt;10 Alternate clock 3 (ADC_ALTCLK3)&lt;/li&gt;
&lt;li&gt;11 Alternate clock 4 (ADC_ALTCLK4)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;adc-configuration-register-2-adcx-cfg2&#34;&gt;ADC Configuration Register 2 (ADCx_CFG2)&lt;/h3&gt;
&lt;p&gt; &lt;code&gt;ADC0-&amp;gt;CFG2&lt;/code&gt;  &lt;/p&gt;
&lt;h5 id=&#34;7-0-smpltssample-time-select&#34;&gt;(7-0) SMPLTS(Sample Time Select)&lt;/h5&gt;
&lt;p&gt; 2-256  ADCK  8 &lt;/p&gt;
&lt;h3 id=&#34;adc-data-result-register-adcx-rn&#34;&gt;ADC Data Result Register (ADCx_Rn)&lt;/h3&gt;
&lt;p&gt; &lt;code&gt;ADC0-&amp;gt;R[n]&lt;/code&gt; 
 ADC  &lt;code&gt;SC[n]&lt;/code&gt;,   &lt;code&gt;R[n]&lt;/code&gt;&lt;/p&gt;
&lt;h5 id=&#34;11-0-data-result-d&#34;&gt;(11-0) Data result (D)&lt;/h5&gt;
&lt;p&gt; 12  12-bit  10-bit  8-bit  10,8 &lt;/p&gt;
&lt;h3 id=&#34;compare-value-registers-adcx-cvn&#34;&gt;Compare Value Registers (ADCx_CVn)&lt;/h3&gt;
&lt;p&gt; Rn  ADC  &lt;code&gt;SC2[ACREN]=1&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;status-and-control-register-2-adcx-sc2&#34;&gt;Status and Control Register 2 (ADCx_SC2)&lt;/h3&gt;
&lt;p&gt; &lt;code&gt;ADC0-&amp;gt;SC2&lt;/code&gt; 
 SC2 SC1  ADC  1 /DMA &lt;/p&gt;
&lt;p&gt; RM&lt;/p&gt;
&lt;h3 id=&#34;status-and-control-register-3-adcx-sc3&#34;&gt;Status and Control Register 3 (ADCx_SC3)&lt;/h3&gt;
&lt;p&gt; &lt;code&gt;ADC0-&amp;gt;SC3&lt;/code&gt; 
&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt; &lt;code&gt;SC1A&lt;/code&gt;  &lt;code&gt;SC1A&lt;/code&gt;  ADC &lt;/p&gt;
&lt;p&gt; ADC  COCO  1  &lt;code&gt;R[n]&lt;/code&gt;  &lt;code&gt;R[n]&lt;/code&gt; &lt;/p&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 4</title>
      <link>https://xiahualiu.github.io/posts/2017-10-16-s32k144_4/</link>
      <pubDate>Mon, 16 Oct 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-10-16-s32k144_4/</guid>
      <description>&lt;p&gt; NVIC &lt;/p&gt;
&lt;h1 id=&#34;heading&#34;&gt;&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt; NVIC &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;,  1  ICPR(Interrupt Clear Pending Register)&lt;/li&gt;
&lt;li&gt;,  1  ISER(Interrupt Set Enable Register) &lt;/li&gt;
&lt;li&gt;,  IP(Interrupt Priority register)  0 - 15 IP&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt; PORT D  GPIO output &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt; SOSC  8MHz
- SOSC &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt; SOSC &lt;/li&gt;
&lt;li&gt; SOSCCSR &lt;/li&gt;
&lt;li&gt; SOSCCSR_SOSCVLD  1&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt; SPLL  160MHz  8MHz  SOSC&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; SPLL &lt;/li&gt;
&lt;li&gt; SPLL &lt;/li&gt;
&lt;li&gt; SPLL Pef  SPLL &lt;/li&gt;
&lt;li&gt; SPLLCSR &lt;/li&gt;
&lt;li&gt; SPLL&lt;/li&gt;
&lt;li&gt; SPLL &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt; LPIT0  0:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; PCC  SPLL_DIV2_CLK&lt;/li&gt;
&lt;li&gt; PCC  LPIT0 Gate&lt;/li&gt;
&lt;li&gt; MCR  M_EN  LPIT0 &lt;/li&gt;
&lt;li&gt; MIER &lt;/li&gt;
&lt;li&gt; TMR[n].TVAL  TMR[n].TCTRL ( TVAL0  TCTRL0) T_EN&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt; RUN  SPLL&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; COREDIV, BUSDIV, SLOWDIV &lt;/li&gt;
&lt;li&gt; SPLL&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;LPIT_0  0 NVIC &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt; GPIO PTD0 &lt;/li&gt;
&lt;li&gt; MSR  TIF0 &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;heading-1&#34;&gt;:&lt;/h1&gt;
&lt;h3 id=&#34;heading-2&#34;&gt;&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34; /* include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;clocks_and_modes.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; idle_counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* main loop idle counter */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; lpit0_ch0_flag_counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* LPIT0 chan 0 timeout counter */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NVIC_init_IRQs&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
FSL_NVIC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;ICPR[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;48&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* IRQ48-LPIT0 ch0: clr any pending IRQ*/&lt;/span&gt;
FSL_NVIC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;ISER[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;48&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* IRQ48-LPIT0 ch0: enable IRQ */&lt;/span&gt;
FSL_NVIC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;IP[&lt;span style=&#34;color:#ae81ff&#34;&gt;48&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x0A&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* IRQ48-LPIT0 ch0: priority 10 of 0-15*/&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PORT_init&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; PCCn[PCC_PORTD_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clock for PORT D */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0: Data Direction= output */&lt;/span&gt;
PORTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0: MUX = ALT1, GPIO (to blue LED on EVB) */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LPIT0_init&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_LPIT0_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_PCS(&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Clock Src = 6 (SPLL2_DIV2_CLK)*/&lt;/span&gt;
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_LPIT0_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clk to LPIT0 regs */&lt;/span&gt;
LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;MCR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* DBG_EN-0: Timer chans stop in Debug mode */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* DOZE_EN=0: Timer chans are stopped in DOZE mode */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SW_RST=0: SW reset does not reset timer chans, regs */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* M_CEN=1: enable module clk (allow writing other LPIT0 regs) */&lt;/span&gt;
LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;MIER &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* TIE0=1: Timer Interrupt Enabled fot Chan 0 */&lt;/span&gt;
LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TVAL0 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;80000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Chan 0 Timeout period: 80M clocks */&lt;/span&gt;
LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCTRL0 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* T_EN=1: Timer channel is enabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* CHAIN=0: channel chaining is disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MODE=0: 32 periodic counter mode */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TSOT=0: Timer decrements immediately based on restart */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TSOI=0: Timer does not stop after timeout */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TROT=0 Timer will not reload on trigger */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TRG_SRC=0: External trigger source */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TRG_SEL=0: Timer chan 0 trigger source is selected*/&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WDOG_disable&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CNT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xD928C520&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Unlock watchdog*/&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TOVAL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x0000FFFF&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Maximum timeout value*/&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00002100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Disable watchdog*/&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
WDOG_disable();
PORT_init(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Configure ports */&lt;/span&gt;
SOSC_init_8MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize system oscillator for 8 MHz xtal */&lt;/span&gt;
SPLL_init_160MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize SPLL to 160 MHz with 8 MHz SOSC */&lt;/span&gt;
NormalRUNmode_80MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init clocks: 80 MHz sysclk &amp;amp; core, 40 MHz bus, 20 MHz flash */&lt;/span&gt;
NVIC_init_IRQs(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable desired interrupts and priorities */&lt;/span&gt;
LPIT0_init(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize PIT0 for 1 second timeout */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (;;) {
idle_counter&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;;
}
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LPIT0_Ch0_IRQHandler&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
lpit0_ch0_flag_counter&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Increment LPIT0 timeout counter */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PTOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Toggle output on port D0 (blue LED) */&lt;/span&gt;
LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;MSR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LPIT_MSR_TIF0_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear LPIT0 timer flag 0 */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-3&#34;&gt;&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34; /* include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;clocks_and_modes.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SOSC_init_8MHz&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCDIV&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000101&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCDIV1 &amp;amp; SOSCDIV2 =1: divide by 1 */&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCFG&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000024&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Range=2: Medium freq (SOSC between 1MHz-8MHz)*/&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* HGO=0: Config xtal osc for low power */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* EREFS=1: Input is external XTAL */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SOSCCSR_LK_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Ensure SOSCCSR unlocked */&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCSR&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* LK=0: SOSCCSR can be written */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCCMRE=0: OSC CLK monitor IRQ if enabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCCM=0: OSC CLK monitor disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCERCLKEN=0: Sys OSC 3V ERCLK output clk disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCLPEN=0: Sys OSC disabled in VLP modes */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCSTEN=0: Sys OSC disabled in Stop modes */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCEN=1: Enable oscillator */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SOSCCSR_SOSCVLD_MASK)); &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for sys OSC clk valid */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SPLL_init_160MHz&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SPLLCSR_LK_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Ensure SPLLCSR unlocked */&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLEN=0: SPLL is disabled (default) */&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLDIV &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000302&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLDIV1 divide by 2; SPLLDIV2 divide by 4 */&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCFG &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00180000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* PREDIV=0: Divide SOSC_CLK by 0+1=1 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MULT=24: Multiply sys pll by 4+24=40 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SPLL_CLK = 8MHz / 1 * 40 / 2 = 160 MHz */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SPLLCSR_LK_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Ensure SPLLCSR unlocked */&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* LK=0: SPLLCSR can be written */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLCMRE=0: SPLL CLK monitor IRQ if enabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLCM=0: SPLL CLK monitor disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLSTEN=0: SPLL disabled in Stop modes */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLEN=1: Enable SPLL */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SPLLCSR_SPLLVLD_MASK)); &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for SPLL valid */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NormalRUNmode_80MHz&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) { &lt;span style=&#34;color:#75715e&#34;&gt;/* Change to normal RUN mode with 8MHz SOSC, 80 MHz PLL*/&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;RCCR&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;SCG_RCCR_SCS(&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;/* PLL as clock source*/&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;SCG_RCCR_DIVCORE(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;b01) &lt;span style=&#34;color:#75715e&#34;&gt;/* DIVCORE=1, div. by 2: Core clock = 160/2 MHz = 80 MHz*/&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;SCG_RCCR_DIVBUS(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;b01) &lt;span style=&#34;color:#75715e&#34;&gt;/* DIVBUS=1, div. by 2: bus clock = 40 MHz*/&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;SCG_RCCR_DIVSLOW(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;b10); &lt;span style=&#34;color:#75715e&#34;&gt;/* DIVSLOW=2, div. by 3: SCG slow, flash clock= 26 2/3 MHz*/&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (((SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_CSR_SCS_MASK) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; SCG_CSR_SCS_SHIFT ) &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;) {}
&lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for sys clk src = SPLL */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-4&#34;&gt;&lt;/h3&gt;
&lt;p&gt; LPIT0  MIER  NVIC  IRQ Handler &lt;/p&gt;
&lt;p&gt; &lt;strong&gt;NVIC&lt;/strong&gt;(Nested Vectored Interrupt Controller)  S32K &lt;/p&gt;
&lt;p&gt;NVIC &lt;strong&gt;&lt;/strong&gt; ARM Cortex M4 NVIC  256  256  S32K  123  IRQ  IP  IRQ  IPR  16 0 - 15&lt;/p&gt;
&lt;p&gt; S32K  IPR  S32 IDE  IPR  0 - 15&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; IPR  &lt;strong&gt;8&lt;/strong&gt;  8 &lt;strong&gt;&lt;/strong&gt;[1;7][2;6][3;5][4;4][7;1]&lt;strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;/strong&gt; S32K 4 4  &lt;strong&gt;16  16 &lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-02-S32K144_4/ipr.png&#34; alt=&#34;ipr.png&#34;&gt;&lt;/p&gt;
&lt;h5 id=&#34;heading-5&#34;&gt;&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;nvic-&#34;&gt;NVIC &lt;/h5&gt;
&lt;p&gt;NVIC  IRQ  IRQ  16  IDE  &lt;code&gt;ICPR&lt;/code&gt; &lt;code&gt;ISER&lt;/code&gt;  32  4  128  IRQ  48  LPIT Channel 0  &lt;code&gt;FSL_NVIC-&amp;gt;ISER[1] |= 1&amp;lt;&amp;lt; (48 % 32);&lt;/code&gt; &lt;/p&gt;
&lt;p&gt; IRQ  16  IRQ IRQ  Systick  IRQ  -1&lt;/p&gt;
&lt;p&gt; NVIC &lt;/p&gt;
&lt;h3 id=&#34;-s32k144--irq-&#34;&gt;: S32K144  IRQ &lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; * @brief Defines the Interrupt Numbers definitions
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; *
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; * This enumeration is used to configure the interrupts.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; *
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; * Implements : IRQn_Type_Class
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt;
{
  &lt;span style=&#34;color:#75715e&#34;&gt;/* Auxiliary constants */&lt;/span&gt;
  NotAvail_IRQn                &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Not available device specific interrupt */&lt;/span&gt;

  &lt;span style=&#34;color:#75715e&#34;&gt;/* Core interrupts */&lt;/span&gt;
  NonMaskableInt_IRQn          &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;14&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Non Maskable Interrupt */&lt;/span&gt;
  HardFault_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;13&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 SV Hard Fault Interrupt */&lt;/span&gt;
  MemoryManagement_IRQn        &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 Memory Management Interrupt */&lt;/span&gt;
  BusFault_IRQn                &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 Bus Fault Interrupt */&lt;/span&gt;
  UsageFault_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 Usage Fault Interrupt */&lt;/span&gt;
  SVCall_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 SV Call Interrupt */&lt;/span&gt;
  DebugMonitor_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 Debug Monitor Interrupt */&lt;/span&gt;
  PendSV_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 Pend SV Interrupt */&lt;/span&gt;
  SysTick_IRQn                 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 System Tick Interrupt */&lt;/span&gt;

  &lt;span style=&#34;color:#75715e&#34;&gt;/* Device specific interrupts */&lt;/span&gt;
  DMA0_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 0 transfer complete */&lt;/span&gt;
  DMA1_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 1 transfer complete */&lt;/span&gt;
  DMA2_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 2 transfer complete */&lt;/span&gt;
  DMA3_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 3 transfer complete */&lt;/span&gt;
  DMA4_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 4 transfer complete */&lt;/span&gt;
  DMA5_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 5 transfer complete */&lt;/span&gt;
  DMA6_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 6 transfer complete */&lt;/span&gt;
  DMA7_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 7 transfer complete */&lt;/span&gt;
  DMA8_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 8 transfer complete */&lt;/span&gt;
  DMA9_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 9 transfer complete */&lt;/span&gt;
  DMA10_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 10 transfer complete */&lt;/span&gt;
  DMA11_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 11 transfer complete */&lt;/span&gt;
  DMA12_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;12u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 12 transfer complete */&lt;/span&gt;
  DMA13_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;13u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 13 transfer complete */&lt;/span&gt;
  DMA14_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;14u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 14 transfer complete */&lt;/span&gt;
  DMA15_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;15u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 15 transfer complete */&lt;/span&gt;
  DMA_Error_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA error interrupt channels 0-15 */&lt;/span&gt;
  MCM_IRQn                     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;17u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FPU sources */&lt;/span&gt;
  FTFC_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTFC Command complete */&lt;/span&gt;
  Read_Collision_IRQn          &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;19u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTFC Read collision */&lt;/span&gt;
  LVD_LVW_IRQn                 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;20u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; PMC Low voltage detect interrupt */&lt;/span&gt;
  FTFC_Fault_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;21u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTFC Double bit fault detect */&lt;/span&gt;
  WDOG_EWM_IRQn                &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;22u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Single interrupt vector for WDOG and EWM */&lt;/span&gt;
  RCM_IRQn                     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;23u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; RCM Asynchronous Interrupt */&lt;/span&gt;
  LPI2C0_Master_IRQn           &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;24u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPI2C0 Master Interrupt */&lt;/span&gt;
  LPI2C0_Slave_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPI2C0 Slave Interrupt */&lt;/span&gt;
  LPSPI0_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;26u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPSPI0 Interrupt */&lt;/span&gt;
  LPSPI1_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;27u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPSPI1 Interrupt */&lt;/span&gt;
  LPSPI2_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;28u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPSPI2 Interrupt */&lt;/span&gt;
  LPUART0_RxTx_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;31u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPUART0 Transmit / Receive Interrupt */&lt;/span&gt;
  LPUART1_RxTx_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;33u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPUART1 Transmit / Receive  Interrupt */&lt;/span&gt;
  LPUART2_RxTx_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;35u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPUART2 Transmit / Receive  Interrupt */&lt;/span&gt;
  ADC0_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;39u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; ADC0 interrupt request. */&lt;/span&gt;
  ADC1_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;40u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; ADC1 interrupt request. */&lt;/span&gt;
  CMP0_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;41u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CMP0 interrupt request */&lt;/span&gt;
  ERM_single_fault_IRQn        &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;44u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; ERM single bit error correction */&lt;/span&gt;
  ERM_double_fault_IRQn        &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;45u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; ERM double bit error non-correctable */&lt;/span&gt;
  RTC_IRQn                     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;46u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; RTC alarm interrupt */&lt;/span&gt;
  RTC_Seconds_IRQn             &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;47u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; RTC seconds interrupt */&lt;/span&gt;
  LPIT0_Ch0_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;48u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPIT0 channel 0 overflow interrupt */&lt;/span&gt;
  LPIT0_Ch1_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;49u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPIT0 channel 1 overflow interrupt */&lt;/span&gt;
  LPIT0_Ch2_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;50u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPIT0 channel 2 overflow interrupt */&lt;/span&gt;
  LPIT0_Ch3_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;51u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPIT0 channel 3 overflow interrupt */&lt;/span&gt;
  PDB0_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;52u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; PDB0 interrupt */&lt;/span&gt;
  SCG_IRQn                     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;57u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; SCG bus interrupt request */&lt;/span&gt;
  LPTMR0_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;58u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPTIMER interrupt request */&lt;/span&gt;
  PORTA_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;59u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port A pin detect interrupt */&lt;/span&gt;
  PORTB_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;60u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port B pin detect interrupt */&lt;/span&gt;
  PORTC_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;61u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port C pin detect interrupt */&lt;/span&gt;
  PORTD_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;62u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port D pin detect interrupt */&lt;/span&gt;
  PORTE_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;63u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port E pin detect interrupt */&lt;/span&gt;
  SWI_IRQn                     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;64u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Software interrupt */&lt;/span&gt;
  PDB1_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;68u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; PDB1 interrupt */&lt;/span&gt;
  FLEXIO_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;69u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FlexIO Interrupt */&lt;/span&gt;
  CAN0_ORed_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;78u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN0 OR&amp;#39;ed [Bus Off OR Transmit Warning OR Receive Warning] */&lt;/span&gt;
  CAN0_Error_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;79u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN0 Interrupt indicating that errors were detected on the CAN bus */&lt;/span&gt;
  CAN0_Wake_Up_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;80u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN0 Interrupt asserted when Pretended Networking operation is enabled, and a valid message matches the selected filter criteria during Low Power mode */&lt;/span&gt;
  CAN0_ORed_0_15_MB_IRQn       &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;81u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN0 OR&amp;#39;ed Message buffer (0-15) */&lt;/span&gt;
  CAN0_ORed_16_31_MB_IRQn      &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;82u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN0 OR&amp;#39;ed Message buffer (16-31) */&lt;/span&gt;
  CAN1_ORed_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;85u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN1 OR&amp;#39;ed [Bus Off OR Transmit Warning OR Receive Warning] */&lt;/span&gt;
  CAN1_Error_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;86u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN1 Interrupt indicating that errors were detected on the CAN bus */&lt;/span&gt;
  CAN1_ORed_0_15_MB_IRQn       &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;88u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN1 OR&amp;#39;ed Interrupt for Message buffer (0-15) */&lt;/span&gt;
  CAN2_ORed_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;92u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN2 OR&amp;#39;ed [Bus Off OR Transmit Warning OR Receive Warning] */&lt;/span&gt;
  CAN2_Error_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;93u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN2 Interrupt indicating that errors were detected on the CAN bus */&lt;/span&gt;
  CAN2_ORed_0_15_MB_IRQn       &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;95u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN2 OR&amp;#39;ed Message buffer (0-15) */&lt;/span&gt;
  FTM0_Ch0_Ch1_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;99u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM0 Channel 0 and 1 interrupt */&lt;/span&gt;
  FTM0_Ch2_Ch3_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM0 Channel 2 and 3 interrupt */&lt;/span&gt;
  FTM0_Ch4_Ch5_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;101u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM0 Channel 4 and 5 interrupt */&lt;/span&gt;
  FTM0_Ch6_Ch7_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;102u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM0 Channel 6 and 7 interrupt */&lt;/span&gt;
  FTM0_Fault_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;103u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM0 Fault interrupt */&lt;/span&gt;
  FTM0_Ovf_Reload_IRQn         &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;104u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM0 Counter overflow and Reload interrupt */&lt;/span&gt;
  FTM1_Ch0_Ch1_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;105u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM1 Channel 0 and 1 interrupt */&lt;/span&gt;
  FTM1_Ch2_Ch3_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;106u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM1 Channel 2 and 3 interrupt */&lt;/span&gt;
  FTM1_Ch4_Ch5_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;107u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM1 Channel 4 and 5 interrupt */&lt;/span&gt;
  FTM1_Ch6_Ch7_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;108u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM1 Channel 6 and 7 interrupt */&lt;/span&gt;
  FTM1_Fault_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;109u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM1 Fault interrupt */&lt;/span&gt;
  FTM1_Ovf_Reload_IRQn         &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;110u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM1 Counter overflow and Reload interrupt */&lt;/span&gt;
  FTM2_Ch0_Ch1_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;111u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM2 Channel 0 and 1 interrupt */&lt;/span&gt;
  FTM2_Ch2_Ch3_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;112u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM2 Channel 2 and 3 interrupt */&lt;/span&gt;
  FTM2_Ch4_Ch5_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;113u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM2 Channel 4 and 5 interrupt */&lt;/span&gt;
  FTM2_Ch6_Ch7_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;114u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM2 Channel 6 and 7 interrupt */&lt;/span&gt;
  FTM2_Fault_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;115u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM2 Fault interrupt */&lt;/span&gt;
  FTM2_Ovf_Reload_IRQn         &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;116u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM2 Counter overflow and Reload interrupt */&lt;/span&gt;
  FTM3_Ch0_Ch1_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;117u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM3 Channel 0 and 1 interrupt */&lt;/span&gt;
  FTM3_Ch2_Ch3_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;118u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM3 Channel 2 and 3 interrupt */&lt;/span&gt;
  FTM3_Ch4_Ch5_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;119u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM3 Channel 4 and 5 interrupt */&lt;/span&gt;
  FTM3_Ch6_Ch7_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;120u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM3 Channel 6 and 7 interrupt */&lt;/span&gt;
  FTM3_Fault_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;121u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM3 Fault interrupt */&lt;/span&gt;
  FTM3_Ovf_Reload_IRQn         &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;122u&lt;/span&gt;              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM3 Counter overflow and Reload interrupt */&lt;/span&gt;
} IRQn_Type;

&lt;span style=&#34;color:#75715e&#34;&gt;/*!
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; * @}
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; */&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* end of group Interrupt_vector_numbers_S32K144 */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; IRQn &lt;/p&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 3 Clock Configuration Continue</title>
      <link>https://xiahualiu.github.io/posts/2017-10-02-s32k144_3/</link>
      <pubDate>Mon, 02 Oct 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-10-02-s32k144_3/</guid>
      <description>&lt;p&gt;&lt;/p&gt;
&lt;h3 id=&#34;fast-irc-control-status-register-scg-firccsr&#34;&gt;Fast IRC Control Status Register (SCG_FIRCCSR)&lt;/h3&gt;
&lt;p&gt; FIRC &lt;/p&gt;
&lt;h3 id=&#34;fast-irc-divide-register-scg-fircdiv&#34;&gt;Fast IRC Divide Register (SCG_FIRCDIV)&lt;/h3&gt;
&lt;p&gt; FIRC &lt;/p&gt;
&lt;h3 id=&#34;fast-irc-configuration-register-scg-firccfg&#34;&gt;Fast IRC Configuration Register (SCG_FIRCCFG)&lt;/h3&gt;
&lt;p&gt; FIRC  FIRC &lt;/p&gt;
&lt;h3 id=&#34;system-pll-control-status-register-scg-spllcsr&#34;&gt;System PLL Control Status Register (SCG_SPLLCSR)&lt;/h3&gt;
&lt;h3 id=&#34;system-pll-divide-register-scg-splldiv&#34;&gt;System PLL Divide Register (SCG_SPLLDIV)&lt;/h3&gt;
&lt;h3 id=&#34;system-pll-configuration-register-scg-spllcfg&#34;&gt;System PLL Configuration Register (SCG_SPLLCFG)&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h2 id=&#34;-scg-&#34;&gt; SCG &lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Reset  Run  FIRCRun  FIRCSOSCSPLLSIRC &lt;/li&gt;
&lt;li&gt; &lt;strong&gt;High Speed Mode&lt;/strong&gt;  FIRC  SPLL &lt;/li&gt;
&lt;li&gt; &lt;strong&gt;Very Slow Power Mode&lt;/strong&gt;  SIRC &lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;heading&#34;&gt;&lt;/h1&gt;
&lt;h4 id=&#34;void-sosc-init-8mhzvoid-&#34;&gt;&lt;code&gt;void SOSC_init_8MHz(void)&lt;/code&gt; :&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;SCG-&amp;gt;SOSCDIV=0x00000101;&lt;/code&gt;  DIV&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SCG-&amp;gt;SOSCCFG=0x00000024;&lt;/code&gt; SOSC 1MHz ~ 8Mhz  Reference Manual HGO &lt;/li&gt;
&lt;li&gt; &lt;code&gt;SOSCCSR&lt;/code&gt; &lt;/li&gt;
&lt;li&gt; &lt;code&gt;SOSCCSR&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt; &lt;code&gt;SOSCCSR&lt;/code&gt; &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt; &lt;strong&gt;&lt;/strong&gt; &lt;/p&gt;
&lt;h4 id=&#34;void-spll-init-160mhzvoid-&#34;&gt;&lt;code&gt;void SPLL_init_160MHz(void)&lt;/code&gt; :&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt; &lt;code&gt;SPLLCSR&lt;/code&gt; &lt;/li&gt;
&lt;li&gt; &lt;code&gt;SPLLCSR&lt;/code&gt; &lt;code&gt;SPLLDIV&lt;/code&gt;  DIV&lt;code&gt;SPLLCFG&lt;/code&gt;  MULT  PREDIV &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-02-S32K144_3/SPLLCalculation.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; &lt;code&gt;SPLLCSR&lt;/code&gt;  &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;void-normalrunmode-80mhz-void-&#34;&gt;&lt;code&gt;void NormalRUNmode_80MHz (void)&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt; SCG_RCCR  RUN &lt;code&gt;DIVSLOW&lt;/code&gt; &lt;code&gt;DIVBUS&lt;/code&gt; &lt;code&gt;DIVCORE&lt;/code&gt; &lt;code&gt;SCS&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;lpit&#34;&gt;LPIT&lt;/h1&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;S32K144 LPIT  &lt;code&gt;LPIT0&lt;/code&gt;  LPIT &lt;/li&gt;
&lt;li&gt;LPIT  DMAMUX &lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;LPIT  10  LPIT &lt;/p&gt;
&lt;h3 id=&#34;tval-&#34;&gt;TVAL &lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt; LPIT &lt;/strong&gt; 0 TCRTL &lt;/li&gt;
&lt;li&gt;&lt;strong&gt; LPIT &lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;tctrl-&#34;&gt;TCTRL &lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;32-bit &lt;/li&gt;
&lt;li&gt; 16-bit &lt;/li&gt;
&lt;li&gt;32-bit &lt;/li&gt;
&lt;li&gt;32-bit &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;TSOTTimer Start On TriggerTROTTimer Reset On Trigger  TSOITimer Stop On Interrupt CHAIN  Reference Manual&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;lpit-&#34;&gt;LPIT &lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;PCC  LPIT  &lt;code&gt;PCC_PCCn_CGC_MASK&lt;/code&gt;  LPIT &lt;/li&gt;
&lt;li&gt; LPIT0  MCR  &lt;code&gt;0x00000001&lt;/code&gt;  &lt;code&gt;M_CEN&lt;/code&gt; &lt;/li&gt;
&lt;li&gt;LPIT0  &lt;code&gt;TMR[n].TVAL&lt;/code&gt;  &lt;code&gt;TMR[n].TCTRL&lt;/code&gt;, TVAL  timeout TCTRL &lt;/li&gt;
&lt;li&gt; MSR  TIFn  flag1&lt;/li&gt;
&lt;/ol&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 2 Clock Configurations</title>
      <link>https://xiahualiu.github.io/posts/2017-09-29-s32k144_2/</link>
      <pubDate>Fri, 29 Sep 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-09-29-s32k144_2/</guid>
      <description>&lt;h1 id=&#34;heading&#34;&gt;&lt;/h1&gt;
&lt;p&gt; S32K144 &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;LPIT &lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;heading-1&#34;&gt;&lt;/h1&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-9-29-S32K144_2/hello_clock.png&#34; alt=&#34;hello_clock.png&#34;&gt;&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;XTAL(External Crystal Oscillator)&lt;/strong&gt;  &lt;strong&gt;OSC(System Oscillator)&lt;/strong&gt;  &lt;strong&gt;SOSC_CLK&lt;/strong&gt;  &lt;strong&gt;SCG_SOSCDIV&lt;/strong&gt;  &lt;strong&gt;SOSC_DIV1_CLK&lt;/strong&gt;  &lt;strong&gt;SOSC_DIV2_CLK&lt;/strong&gt; &lt;strong&gt;SOSC_CLK&lt;/strong&gt;  &lt;strong&gt;PLL&lt;/strong&gt;  &lt;strong&gt;SPLL_CLK&lt;/strong&gt; &lt;strong&gt;SPLL_CLK&lt;/strong&gt;  &lt;strong&gt;SCG_SPLLDIV&lt;/strong&gt;  &lt;strong&gt;SPLL_DIV1_CLK&lt;/strong&gt;  &lt;strong&gt;SPLL_DIV2_CLK&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;FIRC(Fast Internal Reference Clock)&lt;/strong&gt;  48HMz  &lt;strong&gt;FIRC_CLK&lt;/strong&gt;, &lt;strong&gt;SIRC(Slow Internal Reference Clock)&lt;/strong&gt;  8MHz  &lt;strong&gt;SIRC_SLK&lt;/strong&gt;, &lt;strong&gt;FIRC_CLK&lt;/strong&gt;  &lt;strong&gt;SIRC_SLK&lt;/strong&gt;  &lt;strong&gt;SPLL_CLK&lt;/strong&gt;  &lt;strong&gt;SOSC_CLK&lt;/strong&gt;  &lt;strong&gt;SCG_RCCR[SCS]&lt;/strong&gt;  &lt;strong&gt;DIVCORE&lt;/strong&gt;  &lt;strong&gt;CORE_CLK&lt;/strong&gt;,&lt;strong&gt;SYSCLK&lt;/strong&gt;  &lt;strong&gt;DIVBUS&lt;/strong&gt;  &lt;strong&gt;BUS_CLK&lt;/strong&gt;  &lt;strong&gt;DIVSLOW&lt;/strong&gt;  &lt;strong&gt;FLASH_CLK&lt;/strong&gt;  &lt;strong&gt;SCG_SLOW_CLK&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-9-29-S32K144_2/DIV_Requirement.png&#34; alt=&#34;DIV_Requirement.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;Manual&lt;/p&gt;
&lt;h3 id=&#34;1--system-clock-generator-scg&#34;&gt;1.  System clock generator (SCG)&lt;/h3&gt;
&lt;p&gt; SCG &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SPLL(System Phase-locked Loop)&lt;/strong&gt;  &lt;strong&gt;PLL&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt; VCO(Voltage-controlled oscillator)&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt; VCO &lt;/li&gt;
&lt;li&gt;/&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FIRC/SIRC(Fast/Slow Internal Reference Clock)&lt;/strong&gt;  IRC 
&lt;ul&gt;
&lt;li&gt; FIRC /,  48Mhz&lt;/li&gt;
&lt;li&gt; FIRC  SIRC &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SOSC(System Crystal Oscillator)&lt;/strong&gt;  &lt;strong&gt;OSC&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt; PLL &lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;heading-2&#34;&gt;&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;SPLLSOSC &lt;/li&gt;
&lt;li&gt;SPLL &lt;/li&gt;
&lt;li&gt; DIV 
&lt;ul&gt;
&lt;li&gt;SPLLDIV1_CLK / SPLLDIV2_CLK&lt;/li&gt;
&lt;li&gt;FIRCDIV1_CLK / SCG_FIRCDIV2_CLK&lt;/li&gt;
&lt;li&gt;SIRCDIV1_CLK / SIRCDIV2_CLK&lt;/li&gt;
&lt;li&gt;SOSCDIV1_CLK / SOSCDIV2_CLK&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;2--low-power-oscillator-lpo&#34;&gt;2.  Low Power Oscillator (LPO)&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h3 id=&#34;3--peripheral-clock-control-pcc&#34;&gt;3.  Peripheral Clock Control (PCC)&lt;/h3&gt;
&lt;p&gt;&lt;/p&gt;
&lt;h1 id=&#34;heading-3&#34;&gt;&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; hello_clocks.c              Copyright NXP &lt;span style=&#34;color:#ae81ff&#34;&gt;2016&lt;/span&gt;
 &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; Description: Example clock and LPIT channel initializations
 &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2016&lt;/span&gt; Mar &lt;span style=&#34;color:#ae81ff&#34;&gt;04&lt;/span&gt; S Mihalik &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; Initial version
 &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2016&lt;/span&gt; Oct &lt;span style=&#34;color:#ae81ff&#34;&gt;27&lt;/span&gt; SM &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; Updated &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; new header files in S32DS v &lt;span style=&#34;color:#ae81ff&#34;&gt;1.3&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34;            /* include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;clocks_and_modes.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; lpit0_ch0_flag_counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* LPIT0 timeout counter */&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PORT_init&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
  PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; PCCn[PCC_PORTD_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clock for PORT D */&lt;/span&gt;
  PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;            &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0:  Data Direction= output */&lt;/span&gt;
  PORTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;  &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000100&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0:  MUX = ALT1, GPIO (to blue LED on EVB) */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LPIT0_init&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
  PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_LPIT_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_PCS(&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;);    &lt;span style=&#34;color:#75715e&#34;&gt;/* Clock Src = 6 (SPLL2_DIV2_CLK)*/&lt;/span&gt;
  PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_LPIT_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clk to LPIT0 regs */&lt;/span&gt;
  LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;MCR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;;    &lt;span style=&#34;color:#75715e&#34;&gt;/* DBG_EN-0: Timer chans stop in Debug mode */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* DOZE_EN=0: Timer chans are stopped in DOZE mode */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* SW_RST=0: SW reset does not reset timer chans, regs */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* M_CEN=1: enable module clk (allows writing other LPIT0 regs) */&lt;/span&gt;
  LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TMR[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].TVAL &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;40000000&lt;/span&gt;;    &lt;span style=&#34;color:#75715e&#34;&gt;/* Chan 0 Timeout period: 40M clocks */&lt;/span&gt;
  LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TMR[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].TCTRL &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* T_EN=1: Timer channel is enabled */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* CHAIN=0: channel chaining is disabled */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* MODE=0: 32 periodic counter mode */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* TSOT=0: Timer decrements immediately based on restart */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* TSOI=0: Timer does not stop after timeout */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* TROT=0 Timer will not reload on trigger */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* TRG_SRC=0: External trigger soruce */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* TRG_SEL=0: Timer chan 0 trigger source is selected*/&lt;/span&gt;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SOSC_init_8MHz&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCDIV&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000101&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCDIV1 &amp;amp; SOSCDIV2 =1: divide by 1 */&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCFG&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000024&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* Range=2: Medium freq (SOSC betw 1MHz-8MHz)*/&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* HGO=0:   Config xtal osc for low power */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* EREFS=1: Input is external XTAL */&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SOSCCSR_LK_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Ensure SOSCCSR unlocked */&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCSR&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* LK=0:          SOSCCSR can be written */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCCMRE=0:    OSC CLK monitor IRQ if enabled */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCCM=0:      OSC CLK monitor disabled */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCERCLKEN=0: Sys OSC 3V ERCLK output clk disabled */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCLPEN=0:    Sys OSC disabled in VLP modes */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCSTEN=0:    Sys OSC disabled in Stop modes */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCEN=1:      Enable oscillator */&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SOSCCSR_SOSCVLD_MASK)); &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for sys OSC clk valid */&lt;/span&gt;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SPLL_init_160MHz&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SPLLCSR_LK_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Ensure SPLLCSR unlocked */&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLEN=0: SPLL is disabled (default) */&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLDIV &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000302&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLDIV1 divide by 2; SPLLDIV2 divide by 4 */&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCFG &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00180000&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* PREDIV=0: Divide SOSC_CLK by 0+1=1 */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* MULT=24:  Multiply sys pll by 4+24=40 */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLL_CLK = 8MHz / 1 * 40 / 2 = 160 MHz */&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SPLLCSR_LK_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Ensure SPLLCSR unlocked */&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* LK=0:        SPLLCSR can be written */&lt;/span&gt;
                             &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLCMRE=0:  SPLL CLK monitor IRQ if enabled */&lt;/span&gt;
                             &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLCM=0:    SPLL CLK monitor disabled */&lt;/span&gt;
                             &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLSTEN=0:  SPLL disabled in Stop modes */&lt;/span&gt;
                             &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLEN=1:    Enable SPLL */&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SPLLCSR_SPLLVLD_MASK)); &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for SPLL valid */&lt;/span&gt;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NormalRUNmode_80MHz&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {  &lt;span style=&#34;color:#75715e&#34;&gt;/* Change to normal RUN mode with 8MHz SOSC, 80 MHz PLL*/&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;RCCR&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;SCG_RCCR_SCS(&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;)      &lt;span style=&#34;color:#75715e&#34;&gt;/* PLL as clock source*/&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;SCG_RCCR_DIVCORE(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;b01)      &lt;span style=&#34;color:#75715e&#34;&gt;/* DIVCORE=1, div. by 2: Core clock = 160/2 MHz = 80 MHz*/&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;SCG_RCCR_DIVBUS(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;b01)       &lt;span style=&#34;color:#75715e&#34;&gt;/* DIVBUS=1, div. by 2: bus clock = 40 MHz*/&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;SCG_RCCR_DIVSLOW(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;b10);     &lt;span style=&#34;color:#75715e&#34;&gt;/* DIVSLOW=2, div. by 2: SCG slow, flash clock= 26 2/3 MHz*/&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (((SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_CSR_SCS_MASK) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; SCG_CSR_SCS_SHIFT ) &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;) {}
                                 &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for sys clk src = SPLL */&lt;/span&gt;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WDOG_disable&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
    WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CNT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xD928C520&lt;/span&gt;;   &lt;span style=&#34;color:#75715e&#34;&gt;/*Unlock watchdog*/&lt;/span&gt;
    WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TOVAL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x0000FFFF&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Maximum timeout value*/&lt;/span&gt;
    WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00002100&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/*Disable watchdog*/&lt;/span&gt;
}


&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
  WDOG_disable();
  PORT_init();            &lt;span style=&#34;color:#75715e&#34;&gt;/* Configure ports */&lt;/span&gt;
  SOSC_init_8MHz();       &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize system oscilator for 8 MHz xtal */&lt;/span&gt;
  SPLL_init_160MHz();     &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize SPLL to 160 MHz with 8 MHz SOSC */&lt;/span&gt;
  NormalRUNmode_80MHz();  &lt;span style=&#34;color:#75715e&#34;&gt;/* Init clocks: 80 MHz sysclk &amp;amp; core, 40 MHz bus, 20 MHz flash */&lt;/span&gt;
  LPIT0_init();           &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize PIT0 for 1 second timeout  */&lt;/span&gt;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (;;) {                     &lt;span style=&#34;color:#75715e&#34;&gt;/* Toggle output to LED every LPIT0 timeout */&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;MSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; LPIT_MSR_TIF0_MASK)) {} &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for LPIT0 CH0 Flag */&lt;/span&gt;
    lpit0_ch0_flag_counter&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;;         &lt;span style=&#34;color:#75715e&#34;&gt;/* Increment LPIT0 timeout counter */&lt;/span&gt;
    PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PTOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;                &lt;span style=&#34;color:#75715e&#34;&gt;/* Toggle output on port D0 (blue LED) */&lt;/span&gt;
    LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;MSR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LPIT_MSR_TIF0_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear LPIT0 timer flag 0 */&lt;/span&gt;
  }
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;heading-4&#34;&gt;&lt;/h1&gt;
&lt;p&gt; &lt;code&gt;main()&lt;/code&gt; &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;PORT_init();    &lt;span style=&#34;color:#75715e&#34;&gt;/* Configure ports */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; CGC GPIO , PCR MUX &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;SOSC_init_8MHz();   &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize system oscilator for 8 MHz xtal */&lt;/span&gt;
SPLL_init_160MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize SPLL to 160 MHz with 8 MHz SOSC */&lt;/span&gt;
NormalRUNmode_80MHz();  &lt;span style=&#34;color:#75715e&#34;&gt;/* Init clocks: 80 MHz sysclk &amp;amp; core, 40 MHz bus, 20 MHz flash */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; &lt;code&gt;SCG&lt;/code&gt; ,  &lt;code&gt;SCG&lt;/code&gt; &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** SCG - Register Layout Typedef */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
  __I  uint32_t VERID;                             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Version ID Register, offset: 0x0 */&lt;/span&gt;
  __I  uint32_t PARAM;                             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Parameter Register, offset: 0x4 */&lt;/span&gt;
       uint8_t RESERVED_0[&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;];
  __I  uint32_t CSR;                               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Clock Status Register, offset: 0x10 */&lt;/span&gt;
  __IO uint32_t RCCR;                              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Run Clock Control Register, offset: 0x14 */&lt;/span&gt;
  __IO uint32_t VCCR;                              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; VLPR Clock Control Register, offset: 0x18 */&lt;/span&gt;
  __IO uint32_t HCCR;                              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; HSRUN Clock Control Register, offset: 0x1C */&lt;/span&gt;
  __IO uint32_t CLKOUTCNFG;                        &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; SCG CLKOUT Configuration Register, offset: 0x20 */&lt;/span&gt;
       uint8_t RESERVED_1[&lt;span style=&#34;color:#ae81ff&#34;&gt;220&lt;/span&gt;];
  __IO uint32_t SOSCCSR;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; System OSC Control Status Register, offset: 0x100 */&lt;/span&gt;
  __IO uint32_t SOSCDIV;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; System OSC Divide Register, offset: 0x104 */&lt;/span&gt;
  __IO uint32_t SOSCCFG;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; System Oscillator Configuration Register, offset: 0x108 */&lt;/span&gt;
       uint8_t RESERVED_2[&lt;span style=&#34;color:#ae81ff&#34;&gt;244&lt;/span&gt;];
  __IO uint32_t SIRCCSR;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Slow IRC Control Status Register, offset: 0x200 */&lt;/span&gt;
  __IO uint32_t SIRCDIV;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Slow IRC Divide Register, offset: 0x204 */&lt;/span&gt;
  __IO uint32_t SIRCCFG;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Slow IRC Configuration Register, offset: 0x208 */&lt;/span&gt;
       uint8_t RESERVED_3[&lt;span style=&#34;color:#ae81ff&#34;&gt;244&lt;/span&gt;];
  __IO uint32_t FIRCCSR;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Fast IRC Control Status Register, offset: 0x300 */&lt;/span&gt;
  __IO uint32_t FIRCDIV;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Fast IRC Divide Register, offset: 0x304 */&lt;/span&gt;
  __IO uint32_t FIRCCFG;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Fast IRC Configuration Register, offset: 0x308 */&lt;/span&gt;
       uint8_t RESERVED_4[&lt;span style=&#34;color:#ae81ff&#34;&gt;756&lt;/span&gt;];
  __IO uint32_t SPLLCSR;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; System PLL Control Status Register, offset: 0x600 */&lt;/span&gt;
  __IO uint32_t SPLLDIV;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; System PLL Divide Register, offset: 0x604 */&lt;/span&gt;
  __IO uint32_t SPLLCFG;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; System PLL Configuration Register, offset: 0x608 */&lt;/span&gt;
} SCG_Type, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;SCG_MemMapPtr;

&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral SCG base address */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define SCG_BASE    (0x40064000u)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral SCG base pointer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define SCG    ((SCG_Type *)SCG_BASE)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; Manual &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;Register name&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Width&lt;!-- raw HTML omitted --&gt;(in bits)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Access&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Version ID Register (SCG_VERID)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;R&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Parameter Register (SCG_PARAM)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;R&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Clock Status Register (SCG_CSR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;R&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Run Clock Control Register (SCG_RCCR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;VLPR Clock Control Register (SCG_VCCR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;HSRUN Clock Control Register (SCG_HCCR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;SCG CLKOUT Configuration Register (SCG_CLKOUTCNFG)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;System OSC Control Status Register (SCG_SOSCCSR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;System OSC Divide Register (SCG_SOSCDIV)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;System Oscillator Configuration Register (SCG_SOSCCFG)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Slow IRC Control Status Register (SCG_SIRCCSR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Slow IRC Divide Register (SCG_SIRCDIV)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Slow IRC Configuration Register (SCG_SIRCCFG)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Fast IRC Control Status Register (SCG_FIRCCSR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Fast IRC Divide Register (SCG_FIRCDIV)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Fast IRC Configuration Register (SCG_FIRCCFG)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;System PLL Control Status Register (SCG_SPLLCSR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;System PLL Divide Register (SCG_SPLLDIV)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;System PLL Configuration Register (SCG_SPLLCFG)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;version-id-register-scg-verid&#34;&gt;Version ID Register (SCG_VERID)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;VERSION&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SCG Version Number&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;SCG &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;parameter-register-scg-param&#34;&gt;Parameter Register (SCG_PARAM)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt; 32 &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;31-27&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DIVPRES&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt; SCG &lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;&lt;code&gt;DIVPRES[27]=1&lt;/code&gt; DIVSLOW &lt;!-- raw HTML omitted --&gt;&lt;code&gt;DIVPRES[28]=1&lt;/code&gt; DIVBUS &lt;!-- raw HTML omitted --&gt;&lt;code&gt;DIVPRES[31]=1&lt;/code&gt; DIVCORE &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLKPRES&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt; SCG &lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;CLKPRES[0] Reserved&lt;!-- raw HTML omitted --&gt;CLKPRES&lt;a href=&#34;https://xiahualiu.github.io/img/2017-9-29-S32K144_2/hello_clock.png&#34;&gt;1&lt;/a&gt;=1 System OSC (SOSC) &lt;!-- raw HTML omitted --&gt;CLKPRES&lt;a href=&#34;https://xiahualiu.github.io/img/2017-9-29-S32K144_2/DIV_Requirement.png&#34;&gt;2&lt;/a&gt;=1 Slow IRC (SIRC) &lt;!-- raw HTML omitted --&gt;CLKPRES[3]=1 Fast IRC (FIRC) &lt;!-- raw HTML omitted --&gt;CLKPRES[6]=1 System PLL (SPLL) &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;clock-status-register-scg-csr&#34;&gt;Clock Status Register (SCG_CSR)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt; SCG_RCCR, SCG_VCCR, SCG_HCCR &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;27-24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SCS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0001 System OSC (SOSC_CLK)&lt;!-- raw HTML omitted --&gt;0010 Slow IRC (SIRC_CLK)&lt;!-- raw HTML omitted --&gt;0011 Fast IRC (FIRC_CLK)&lt;!-- raw HTML omitted --&gt;0110 System PLL (SPLL_CLK)&lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;19-16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DIVCORE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;*  SPLL  4&lt;!-- raw HTML omitted --&gt;  = &lt;code&gt;DIVCORE+1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7-4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DIVBUS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;BUS&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; = &lt;code&gt;DIVBUS+1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DIVSLOW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; = &lt;code&gt;DIVSLOW+1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;run-clock-control-register-scg-rccr&#34;&gt;Run Clock Control Register (SCG_RCCR)&lt;/h3&gt;
&lt;p&gt; Run  32  Run &lt;/p&gt;
&lt;p&gt; &lt;code&gt;SCG_CSR&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;vlpr-clock-control-register-scg-vccr&#34;&gt;VLPR Clock Control Register (SCG_VCCR)&lt;/h3&gt;
&lt;p&gt;SCG_VCCR  VLPR  Run  SCG_RCCR  32 &lt;/p&gt;
&lt;p&gt; &lt;code&gt;SCG_CSR&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;hsrun-clock-control-register-scg-hccr&#34;&gt;HSRUN Clock Control Register (SCG_HCCR)&lt;/h3&gt;
&lt;p&gt; HSRUN &lt;/p&gt;
&lt;p&gt; &lt;code&gt;SCG_CSR&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;scg-clkout-configuration-register-scg-clkoutcnfg&#34;&gt;SCG CLKOUT Configuration Register (SCG_CLKOUTCNFG)&lt;/h3&gt;
&lt;p&gt; SCG  &lt;strong&gt;CLKOUT&lt;/strong&gt; &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;27-24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SCS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt; SCG  CLKOUT&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0001 System OSC (SOSC_CLK)&lt;!-- raw HTML omitted --&gt;0010 Slow IRC (SIRC_CLK)&lt;!-- raw HTML omitted --&gt;0011 Fast IRC (FIRC_CLK)&lt;!-- raw HTML omitted --&gt;0110 System PLL (SPLL_CLK)&lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;system-osc-control-status-register-scg-sosccsr&#34;&gt;System OSC Control Status Register (SCG_SOSCCSR)&lt;/h3&gt;
&lt;p&gt; SCG  SOSC &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;26&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCERR&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Clock Error&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; 1 &lt;!-- raw HTML omitted --&gt;0 SOSC &lt;!-- raw HTML omitted --&gt;1 SOSC  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;25&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCSEL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Selected &lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 SOSC &lt;!-- raw HTML omitted --&gt;1 SOSC &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCVLD&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Valid &lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 SOSC &lt;!-- raw HTML omitted --&gt;1 SOSC &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;23&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;LK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Lock Register&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; 1 &lt;!-- raw HTML omitted --&gt;0 CSR &lt;!-- raw HTML omitted --&gt;1 CSR &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCCMRE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Clock Monitor Reset Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;SOSC /&lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCCM&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Clock Monitor&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;SOSC &lt;!-- raw HTML omitted --&gt;0 SOSC &lt;!-- raw HTML omitted --&gt;1 SOSC &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;SOSC &lt;!-- raw HTML omitted --&gt;0 SOSC &lt;!-- raw HTML omitted --&gt;1 SOSC &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;system-osc-divide-register-scg-soscdiv&#34;&gt;System OSC Divide Register (SCG_SOSCDIV)&lt;/h3&gt;
&lt;p&gt; SOSC &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCDIV2&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Clock Divide 2&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; SOSC &lt;!-- raw HTML omitted --&gt; = &lt;code&gt;2^(SOSCDIV2-1)&lt;/code&gt; &lt;!-- raw HTML omitted --&gt; 0 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2-1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCDIV1&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Clock Divide 1&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; SOSC &lt;!-- raw HTML omitted --&gt; = &lt;code&gt;2^(SOSCDIV1-1)&lt;/code&gt; &lt;!-- raw HTML omitted --&gt; 0 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;system-oscillator-configuration-register-scg-sosccfg&#34;&gt;System Oscillator Configuration Register (SCG_SOSCCFG)&lt;/h3&gt;
&lt;p&gt; SOSC &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5-4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RANGE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Range Select&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; SOSC &lt;!-- raw HTML omitted --&gt;10  (4 MHz to 8MHz)&lt;!-- raw HTML omitted --&gt;11  (8 MHz to 40 MHz)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;HGO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;High Gain Oscillator Select&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EREFS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;External Reference Select&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 SOSC &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;slow-irc-control-status-register-scg-sirccsr&#34;&gt;Slow IRC Control Status Register (SCG_SIRCCSR)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;25&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCSEL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Selected&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; SIRC &lt;!-- raw HTML omitted --&gt;0 Slow IRC &lt;!-- raw HTML omitted --&gt;1 Slow IRC &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCVLD&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Valid&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;Slow IRC &lt;!-- raw HTML omitted --&gt;0 Slow IRC &lt;!-- raw HTML omitted --&gt;1 Slow IRC &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCLPEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Low Power Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;Slow IRC &lt;!-- raw HTML omitted --&gt;0 Slow IRC  VLP &lt;!-- raw HTML omitted --&gt;1 Slow IRC  VLP &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCSTEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Stop Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;Slow IRC &lt;!-- raw HTML omitted --&gt;0 Slow IRC  Stop modes &lt;!-- raw HTML omitted --&gt;1 Slow IRC  Stop modes &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;Slow IRC &lt;!-- raw HTML omitted --&gt;0 Slow IRC &lt;!-- raw HTML omitted --&gt;1 Slow IRC &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;slow-irc-divide-register-scg-sircdiv&#34;&gt;Slow IRC Divide Register (SCG_SIRCDIV)&lt;/h3&gt;
&lt;p&gt; SIRC SIRC &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCDIV2&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Clock Divide 2&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; 2&lt;!-- raw HTML omitted --&gt; = &lt;code&gt;2^(SIRCDIV2-1)&lt;/code&gt; &lt;!-- raw HTML omitted --&gt; 0 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCDIV1&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Clock Divide 1&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt; 1&lt;!-- raw HTML omitted --&gt; = &lt;code&gt;2^(SIRCDIV1-1)&lt;/code&gt; &lt;!-- raw HTML omitted --&gt; 0 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;slow-irc-configuration-register-scg-sirccfg&#34;&gt;Slow IRC Configuration Register (SCG_SIRCCFG)&lt;/h3&gt;
&lt;p&gt; SIRC &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RANGE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Frequency Range&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0 Slow IRC low range clock (2 MHz)&lt;!-- raw HTML omitted --&gt;1 Slow IRC high range clock (8 MHz)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; FIRC &lt;/p&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 1 GPIO</title>
      <link>https://xiahualiu.github.io/posts/2017-09-28-s32k144_1/</link>
      <pubDate>Thu, 28 Sep 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-09-28-s32k144_1/</guid>
      <description>&lt;h1 id=&#34;heading&#34;&gt;&lt;/h1&gt;
&lt;p&gt; &lt;a href=&#34;https://www.nxp.com/cn/products/microcontrollers-and-processors/arm-processors/s32-arm-processors-microcontrollers/32-bit-automotive-general-purpose-microcontrollers:S32K#overviewExpand?cid=ps_cn_baidu_cpc_B_AUTO_S32K_Phrase_bd20170620002&#34;&gt;S32K144EVB&lt;/a&gt; &lt;a href=&#34;https://www.nxp.com/&#34;&gt;NXP&lt;/a&gt;( freescale)  ARM M4F 32  Reference Manual  IDE  cookbook &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt; C 51 freescale  HC08GP32 &lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt; Manual  1929 &lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt; S32K144EVB-Q100X &lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;hello-world&#34;&gt;Hello World&lt;/h1&gt;
&lt;h2 id=&#34;1-&#34;&gt;1. &lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt; GPIO&lt;/li&gt;
&lt;li&gt; LED &lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2-&#34;&gt;2. &lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-09-28-S32K144_1/helloworld1.png&#34; alt=&#34;Hello World block diagram&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;3-&#34;&gt;3. &lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34; /* include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTD0 0 &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* Port PTD0, bit 0: FRDM EVB output to blue LED */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTC12 12 &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* Port PTC12, bit 12: FRDM EVB input from BTN0 [SW2] */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WDOG_disable&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CNT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xD928C520&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Unlock watchdog*/&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TOVAL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x0000FFFF&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Maximum timeout value*/&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00002100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Disable watchdog*/&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
WDOG_disable();
&lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clocks to peripherals (PORT modules) */&lt;/span&gt;
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; PCCn[PCC_PORTC_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clock to PORT C */&lt;/span&gt;
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; PCCn[PCC_PORTD_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clock to PORT D */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* Configure port C12 as GPIO input (BTN 0 [SW2] on EVB) */&lt;/span&gt;
PTC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTC12); &lt;span style=&#34;color:#75715e&#34;&gt;/* Port C12: Data Direction= input (default) */&lt;/span&gt;
PORTC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000110&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port C12: MUX = GPIO, input filter enabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* Configure port D0 as GPIO output (LED on EVB) */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0: Data Direction= output */&lt;/span&gt;
PORTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0: MUX = GPIO */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(;;) {
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (PTC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDIR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTC12)) { &lt;span style=&#34;color:#75715e&#34;&gt;/* If Pad Data Input = 1 (BTN0 [SW2] pushed) */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; PCOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear Output on port D0 (LED on) */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;/* If BTN0 was not pushed */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; PSOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0; &lt;span style=&#34;color:#75715e&#34;&gt;/* Set Output on port D0 (LED off) */&lt;/span&gt;
}
counter&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;4-&#34;&gt;4. &lt;/h2&gt;
&lt;p&gt; main() &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;PCC-&amp;gt; PCCn[PCC_PORTC_INDEX] = PCC_PCCn_CGC_MASK; /* Enable clock to PORT C */
PCC-&amp;gt; PCCn[PCC_PORTD_INDEX] = PCC_PCCn_CGC_MASK; /* Enable clock to PORT D */
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; &lt;code&gt;PCC&lt;/code&gt;  &lt;code&gt;&amp;quot;S32K144.h&amp;quot;&lt;/code&gt; &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** PCC - Size of Registers Arrays */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PCCn_COUNT 116u&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/** PCC - Register Layout Typedef */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
  __IO uint32_t PCCn[PCC_PCCn_COUNT];   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; PCC Reserved Register 0..PCC CMP0 Register, array offset: 0x0, array step: 0x4 */&lt;/span&gt;
} PCC_Type, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;PCC_MemMapPtr;

&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PCC base address */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_BASE (0x40065000u)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PCC base pointer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC ((PCC_Type *)PCC_BASE)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;PCC&lt;/code&gt;  &lt;code&gt;PCC_Type&lt;/code&gt; &lt;code&gt;(0x40065000u)&lt;/code&gt;  &lt;code&gt;PCC_Type&lt;/code&gt; 116 &lt;code&gt;PCCn&lt;/code&gt;&lt;/p&gt;
&lt;p&gt; PCC (Peripheral Clock Controller) PCC PCC &lt;br&gt;
 Reference Manual PCC &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt; CGC (Clock Gating Controller)&lt;/li&gt;
&lt;li&gt;*&lt;/li&gt;
&lt;li&gt;*&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt; PCC 
PCC  PCC PCC  (CGC)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CGC (CGC = 1)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; &lt;code&gt;&amp;quot;S32K144.h&amp;quot;&lt;/code&gt;  PCC &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* PCC index offsets */&lt;/span&gt;
...
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PORTA_INDEX 73&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PORTB_INDEX 74&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PORTC_INDEX 75&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PORTD_INDEX 76&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PORTE_INDEX 77&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; GPIO A/B/C/D/E  &lt;code&gt;PCC_PCCn_CGC_MASK&lt;/code&gt;  CGC&lt;code&gt;PCC_PCCn_CGC_MASK&lt;/code&gt; &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PCCn_CGC_MASK 0x40000000u&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; GPIO  PCC  PTC  PTD  &lt;code&gt;GPIO_Type&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** GPIO - Register Layout Typedef */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
  __IO uint32_t PDOR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Data Output Register, offset: 0x0 */&lt;/span&gt;
  __O  uint32_t PSOR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Set Output Register, offset: 0x4 */&lt;/span&gt;
  __O  uint32_t PCOR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Clear Output Register, offset: 0x8 */&lt;/span&gt;
  __O  uint32_t PTOR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Toggle Output Register, offset: 0xC */&lt;/span&gt;
  __I  uint32_t PDIR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Data Input Register, offset: 0x10 */&lt;/span&gt;
  __IO uint32_t PDDR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Data Direction Register, offset: 0x14 */&lt;/span&gt;
  __IO uint32_t PIDR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Input Disable Register, offset: 0x18 */&lt;/span&gt;
} GPIO_Type, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;GPIO_MemMapPtr;

&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PTC base address */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTC_BASE (0x400FF080u)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PTC base pointer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTC ((GPIO_Type *)PTC_BASE)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PTD base address */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTD_BASE (0x400FF0C0u)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PTD base pointer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTD ((GPIO_Type *)PTD_BASE)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;gpio-&#34;&gt;GPIO &lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Width&lt;!-- raw HTML omitted --&gt;(in bits)&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Access&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Data Output Register (PDOR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Set Output Register (PSOR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;W&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Clear Output Register (PCOR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;W&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Toggle Output Register (PTOR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;W&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Data Input Register (PDIR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;R&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Data Direction Register (PDDR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Input Disable Register (PIDR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-data-output-register-pdor&#34;&gt;Port Data Output Register (PDOR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PDO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Data Output&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-set-output-register-psor&#34;&gt;Port Set Output Register (PSOR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PTSO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Set Output&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 1&lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-clear-output-register-pcor&#34;&gt;Port Clear Output Register (PCOR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PTCO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Clear Output&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 0&lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-toggle-output-register-ptor&#34;&gt;Port Toggle Output Register (PTOR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PTTO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Toggle Output&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-data-input-register-pdir&#34;&gt;Port Data Input Register (PDIR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PDI&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Data Input&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-data-direction-register-pddr&#34;&gt;Port Data Direction Register (PDDR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PDD&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Data Direction&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 Input&lt;!-- raw HTML omitted --&gt;1 Output&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-input-disable-register-pidr&#34;&gt;Port Input Disable Register (PIDR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PID&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Input Disable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 &lt;!-- raw HTML omitted --&gt;1 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;-port-controller-register&#34;&gt; PORT Controller Register&lt;/h3&gt;
&lt;p&gt; ARM ARM PWMGPIOUARTSPII2CCAN &lt;strong&gt;&lt;/strong&gt; &lt;strong&gt;PCR(Pin Controller Register)&lt;/strong&gt; &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** PORT - Register Layout Typedef */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
  __IO uint32_t PCR[PORT_PCR_COUNT];    &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Pin Control Register n, array offset: 0x0, array step: 0x4 */&lt;/span&gt;
  __O  uint32_t GPCLR;  &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Global Pin Control Low Register, offset: 0x80 */&lt;/span&gt;
  __O  uint32_t GPCHR;  &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Global Pin Control High Register, offset: 0x84 */&lt;/span&gt;
       uint8_t RESERVED_0[&lt;span style=&#34;color:#ae81ff&#34;&gt;24&lt;/span&gt;];
  __IO uint32_t ISFR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Interrupt Status Flag Register, offset: 0xA0 */&lt;/span&gt;
       uint8_t RESERVED_1[&lt;span style=&#34;color:#ae81ff&#34;&gt;28&lt;/span&gt;];
  __IO uint32_t DFER;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Digital Filter Enable Register, offset: 0xC0 */&lt;/span&gt;
  __IO uint32_t DFCR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Digital Filter Clock Register, offset: 0xC4 */&lt;/span&gt;
  __IO uint32_t DFWR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Digital Filter Width Register, offset: 0xC8 */&lt;/span&gt;
} PORT_Type, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;PORT_MemMapPtr;

&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PORTC base address */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PORTC_BASE (0x4004B000u)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PORTC base pointer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PORTC ((PORT_Type *)PORTC_BASE)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PORTD base address */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PORTD_BASE (0x4004C000u)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PORTD base pointer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PORTD ((PORT_Type *)PORTD_BASE)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt; PCR  32  32  32  32 &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ISF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Interrupt Status Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;19-16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;IRQC&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Interrupt Configuration&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0000&lt;!-- raw HTML omitted --&gt; ISF &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0001&lt;!-- raw HTML omitted --&gt; ISF  DMA &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0010&lt;!-- raw HTML omitted --&gt; ISF  DMA &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0011&lt;!-- raw HTML omitted --&gt; ISF  DMA &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0100&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0101&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0110&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0111&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1000&lt;!-- raw HTML omitted --&gt; ISF  0&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1001&lt;!-- raw HTML omitted --&gt; ISF &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1010&lt;!-- raw HTML omitted --&gt; ISF &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1100&lt;!-- raw HTML omitted --&gt; ISF &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1100&lt;!-- raw HTML omitted --&gt; ISF  1&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1101&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1110&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1111&lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;LK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Lock Register&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; PCR  0  15 &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; PCR  0 - 15 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MUX&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Pin Mux Control&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;000&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;001&lt;!-- raw HTML omitted --&gt;  1 GPIO&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;010&lt;!-- raw HTML omitted --&gt;  2 &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;011&lt;!-- raw HTML omitted --&gt;  3 &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;100&lt;!-- raw HTML omitted --&gt;  4 &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;101&lt;!-- raw HTML omitted --&gt;  5 &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;110&lt;!-- raw HTML omitted --&gt;  6 &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;111&lt;!-- raw HTML omitted --&gt;  7 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DSE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Drive Strength Enable&lt;/strong&gt; DSE &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PFE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Passive Filter Enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Pull Enable&lt;/strong&gt; PE &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Pull Select&lt;/strong&gt; PE &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;heading-1&#34;&gt;&lt;/h1&gt;
&lt;p&gt; GPIO &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt; PCC  PCCn[] CGC PCCn PCC 116 uint32  &lt;code&gt;PCC_PCCn_CGC_MASK&lt;/code&gt;  CGC = 1 &lt;/li&gt;
&lt;li&gt; GPIO  PDDR / &lt;code&gt;GPIO_Type&lt;/code&gt;  5  PTA/PTB/PTC/PTD/PTE &lt;/li&gt;
&lt;li&gt; PORT.PCR MUX  &lt;strong&gt;001&lt;/strong&gt; PORTA/PORTB/PORTC/PORTD/PORTE &lt;/li&gt;
&lt;li&gt; PDIR  PDOR   PTA/PTB/PTC/PTD/PTE &lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h1 id=&#34;pcc-&#34;&gt;PCC &lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;/ (bit)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;80h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTFC Register (PCC_FTFC)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;C000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;84h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC DMAMUX Register (PCC_DMAMUX)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;90h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FlexCAN0 Register (PCC_FlexCAN0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;94h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FlexCAN1 Register (PCC_FlexCAN1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;98h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM3 Register (PCC_FTM3)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9Ch&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC ADC1 Register (PCC_ADC1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;ACh&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FlexCAN2 Register (PCC_FlexCAN2)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;B0h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPSPI0 Register (PCC_LPSPI0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;B4h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPSPI1 Register (PCC_LPSPI1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;B8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPSPI2 Register (PCC_LPSPI2)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;C4h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PDB1 Register (PCC_PDB1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;C8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC CRC Register (PCC_CRC)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;D8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PDB0 Register (PCC_PDB0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;DCh&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPIT Register (PCC_LPIT)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;E0h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM0 Register (PCC_FTM0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;E4h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM1 Register (PCC_FTM1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;E8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM2 Register (PCC_FTM2)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;ECh&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC ADC0 Register (PCC_ADC0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;F4h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC RTC Register (PCC_RTC)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;100h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPTMR0 Register (PCC_LPTMR0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;124h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PORTA Register (PCC_PORTA)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;128h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PORTB Register (PCC_PORTB)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;12Ch&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PORTC Register (PCC_PORTC)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;130h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PORTD Register (PCC_PORTD)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;134h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PORTE Register (PCC_PORTE)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;150h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC SAI0 Register (PCC_SAI0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;154h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC SAI1 Register (PCC_SAI1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;168h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FlexIO Register (PCC_FlexIO)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;184h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC EWM Register (PCC_EWM)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;198h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPI2C0 Register (PCC_LPI2C0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;19Ch&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPI2C1 Register (PCC_LPI2C1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1A8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPUART0 Register (PCC_LPUART0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1ACh&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPUART1 Register (PCC_LPUART1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1B0h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPUART2 Register (PCC_LPUART2)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1B8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM4 Register (PCC_FTM4)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1BCh&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM5 Register (PCC_FTM5)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1C0h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM6 Register (PCC_FTM6)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1C4h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM7 Register (PCC_FTM7)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1CCh&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC CMP0 Register (PCC_CMP0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1D8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC QSPI Register (PCC_QSPI)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1E4h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC ENET Register (PCC_ENET)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</description>
    </item>
  </channel>
</rss>
