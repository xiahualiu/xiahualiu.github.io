<?xml version="1.0" encoding="utf-8" ?>
<?xml-stylesheet type="text/xsl" href="https://xiahualiu.github.io/xml/base.min.xml" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on Xiahua</title>
    <link>https://xiahualiu.github.io/posts/</link>
    <description>Recent content in Posts on Xiahua</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Tue, 11 Feb 2020 13:17:03 -0500</lastBuildDate>
    <atom:link href="https://xiahualiu.github.io/posts/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>ä½¿ç”¨ VS Code ç¼–è¾‘å¹¶é¢„è§ˆ LaTeX æ–‡ä»¶</title>
      <link>https://xiahualiu.github.io/posts/2020-02-11-tex-on-vscode/</link>
      <pubDate>Tue, 11 Feb 2020 13:17:03 -0500</pubDate>
      <guid>https://xiahualiu.github.io/posts/2020-02-11-tex-on-vscode/</guid>
      <description>&lt;p&gt;ä»Šå¤©è¿™ç¯‡åšæ–‡ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨ Visual Studio Code æ¥ç¼–è¾‘å’Œé¢„è§ˆ LaTeX è®ºæ–‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;å‰ç½®éœ€æ±‚&lt;/h2&gt;
&lt;p&gt;åœ¨è¿›å…¥æ•™ç¨‹ä¹‹å‰ï¼Œé¦–å…ˆè¦ç¡®è®¤ä½ å®‰è£…äº†å¦‚ä¸‹çš„ç¨‹åºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;TeXlive 2019&lt;/li&gt;
&lt;li&gt;Visual Studio Code&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡ä»¥ä¸‹ CMD å‘½ä»¤ç¡®è®¤ä»¥ä¸Šç¨‹åºå·²ç»å®‰è£…ï¼Œï¼ˆæŒ‰ Win+R ç»„åˆé”®å”¤èµ·è¿è¡Œçª—å£è¾“å…¥ cmd å³å¯æ‰“å¼€å‘½ä»¤è¡Œç•Œé¢ï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;xelatex -v
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæ˜¾ç¤º &lt;code&gt;not recognized&lt;/code&gt; æˆ–è€…æ‰¾ä¸åˆ°ï¼Œå°±ä»£è¡¨ä½ æ²¡æœ‰å®‰è£…å¥½ TeXliveï¼Œæ€ä¹ˆå®‰è£… TeXlive ä¸åœ¨è¿™é‡Œä»‹ç»äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;ç¬¬ä¸€æ­¥&lt;/h2&gt;
&lt;p&gt;ç¡®ä¿äº†ä½ å®‰è£…å¥½äº†è¿™ä¸¤ä¸ªè½¯ä»¶åå°±å¯ä»¥è¿›å…¥ä¸‹ä¸€æ­¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ­¥æˆ‘ä»¬è¦æ‰“å¼€å®‰è£…åçš„ VS Codeï¼Œåœ¨å·¦ä¾§çš„ä¾§è¾¹æ é€‰æ‹©æ’ä»¶é€‰é¡¹ï¼Œå°±æ˜¯å°çˆ¬è™«ä¸‹é¢å“ªä¸€ä¸ªé€‰é¡¹ï¼Œå››ä¸ªå°æ–¹å—ï¼Œç„¶ååœ¨æ’ä»¶æœç´¢æ é‡Œé¢è¾“å…¥ latexã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£…ç¬¬ä¸€ä¸ªåå­—ä¸º &amp;ldquo;LaTeX Workshop&amp;rdquo; çš„æ’ä»¶ï¼Œå®‰è£…å®ŒæˆåæŒ‰ç…§æŒ‡ç¤º &amp;ldquo;Reload&amp;rdquo; å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;ç¬¬äºŒæ­¥&lt;/h2&gt;
&lt;p&gt;ç¡®è®¤äº†ç¬¬ä¸€æ­¥å®Œæˆåï¼Œåœ¨æ’ä»¶æ é‡Œé¢èƒ½å¤Ÿæ‰¾åˆ°æ–°å®‰è£…çš„ &amp;ldquo;LaTeX Workshop&amp;rdquo; æ’ä»¶å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç›´åˆ°ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ’ä»¶æ¥è¿›è¡Œè‹±æ–‡è®ºæ–‡çš„ä¹¦å†™äº†ï¼Œä½†æ˜¯è¿˜ä¸èƒ½ç¼–è¯‘ä¸­æ–‡ tex æ–‡ä»¶ã€‚ä¸ºäº†èƒ½å¤Ÿé¡ºåˆ©çš„ç¼–è¯‘ä¸­æ–‡ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹é»˜è®¤ç¼–è¯‘é“¾ä½¿ç”¨ XeLaTeX ç¼–è¯‘å™¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹ä¸€æ­¥æ¯”è¾ƒéº»çƒ¦ï¼Œé¦–å…ˆæ‰“å¼€ä»»æ„ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶åç‚¹å‡»æ–‡ä»¶è·¯å¾„æ ï¼Œåœ¨æ é‡Œé¢è¾“å…¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;%APPDATA%\Code\User\
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå›è½¦ï¼Œè·³è½¬åˆ°è®¾ç½®æ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ° &lt;code&gt;settings.json&lt;/code&gt; æ–‡ä»¶ (å¦‚æœæ²¡æœ‰å°±è‡ªå·±åˆ›å»ºä¸€ä¸ª)ï¼Œä½¿ç”¨æˆ‘ä»¬å®‰è£…çš„ VS Code æ‰“å¼€ï¼Œç„¶åç”¨ä»¥ä¸‹çš„å†…å®¹è¦†ç›–ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;latex-workshop.latex.tools&amp;#34;&lt;/span&gt;: [
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;xelatex-no-pdf&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;command&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;xelatex&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;args&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-no-pdf&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-interaction=nonstopmode&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-file-line-error&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;%DOC%&amp;#34;&lt;/span&gt;
            ]
        },
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;xelatex-pdf&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;command&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;xelatex&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;args&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-synctex=1&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-interaction=nonstopmode&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-file-line-error&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;%DOC%&amp;#34;&lt;/span&gt;
            ]

        },
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;latexmk&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;command&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;latexmk&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;args&amp;#34;&lt;/span&gt;: [
              &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-synctex=1&amp;#34;&lt;/span&gt;,
              &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-interaction=nonstopmode&amp;#34;&lt;/span&gt;,
              &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-file-line-error&amp;#34;&lt;/span&gt;,
              &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-pdf&amp;#34;&lt;/span&gt;,
              &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-outdir=%OUTDIR%&amp;#34;&lt;/span&gt;,
              &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;%DOC%&amp;#34;&lt;/span&gt;
            ],
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;env&amp;#34;&lt;/span&gt;: {}
          },
          {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pdflatex&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;command&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pdflatex&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;args&amp;#34;&lt;/span&gt;: [
              &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-synctex=1&amp;#34;&lt;/span&gt;,
              &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-interaction=nonstopmode&amp;#34;&lt;/span&gt;,
              &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-file-line-error&amp;#34;&lt;/span&gt;,
              &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;%DOC%&amp;#34;&lt;/span&gt;
            ],
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;env&amp;#34;&lt;/span&gt;: {}
          },
          {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bibtex&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;command&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bibtex&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;args&amp;#34;&lt;/span&gt;: [
              &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;%DOCFILE%&amp;#34;&lt;/span&gt;
            ],
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;env&amp;#34;&lt;/span&gt;: {}
          }
    ],
    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;latex-workshop.latex.recipes&amp;#34;&lt;/span&gt;:[
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;xelatex-single-run&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tools&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;xelatex-pdf&amp;#34;&lt;/span&gt;,
            ]
        },
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;xelatex â bibtex â xelatexâ€ŠÃ—â€Š2&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tools&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;xelatex-no-pdf&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bibtex&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;xelatex-no-pdf&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;xelatex-pdf&amp;#34;&lt;/span&gt;
            ]
        },
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;latexmk ğŸ”ƒ&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tools&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;latexmk&amp;#34;&lt;/span&gt;
            ]
        },
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;latexmk (latexmkrc)&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tools&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;latexmk_rconly&amp;#34;&lt;/span&gt;
            ]
        },
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;latexmk (lualatex)&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tools&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lualatexmk&amp;#34;&lt;/span&gt;
            ]
        },
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pdflatex â bibtex â pdflatexâ€ŠÃ—â€Š2&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tools&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pdflatex&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bibtex&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pdflatex&amp;#34;&lt;/span&gt;,
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pdflatex&amp;#34;&lt;/span&gt;
            ]
        },
        {
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Compile Rnw files&amp;#34;&lt;/span&gt;,
            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;tools&amp;#34;&lt;/span&gt;: [
                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;rnw2pdf&amp;#34;&lt;/span&gt;
            ]
        }
    ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰ç‚¹é•¿å“ˆï¼Œæ˜¯æˆ‘è‡ªå·±å†™çš„ï¼Œä¸€å®šè¦æŠŠè¿™ä¸ªåŸå°ä¸åŠ¨çš„å†™å…¥ &lt;code&gt;settings.json&lt;/code&gt; æ–‡ä»¶ã€‚æ‹·è´è¦†ç›–äº†ä¹‹åï¼Œä¿å­˜ï¼Œé‡å¯ VS Code å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;è‡³æ­¤æˆ‘ä»¬å·²ç»å®Œæˆäº†æ‰€æœ‰çš„è®¾ç½®ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ä½¿ç”¨å•¦ï¼&lt;/p&gt;
&lt;h2 id=&#34;heading-3&#34;&gt;ç¬¬ä¸‰æ­¥&lt;/h2&gt;
&lt;p&gt;Visual Studio Code æ˜¯ä¸€æ¬¾ååˆ†å¼ºå¤§çš„é€šç”¨ç¼–è¾‘å™¨ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„çš„æ–‡ä»¶ç±»å‹éƒ½å¯ä»¥ç¼–è¾‘ï¼Œè€Œä¸”æœ¬èº«ç”±å¾®è½¯å‡ºå“ï¼Œæ›´æ–°ååˆ†å¿«ï¼Œéå¸¸ç¨³å®šï¼Œæ˜¯ Windows å¹³å°é¦–é€‰çš„ç¼–è¾‘å™¨ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆè¦é€‰æ‹©æ‰“å¼€æ–‡ä»¶å¤¹ï¼Œç„¶åé€‰æ‹©è®ºæ–‡çš„æ ¹ç›®å½•ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å·¦è¾¹çš„æ–‡ä»¶æµè§ˆå™¨çœ‹åˆ°æ‰€æœ‰çš„æ–‡ä»¶å•¦ï¼Œé€‰æ‹© &lt;code&gt;*.tex&lt;/code&gt; ç»“å°¾çš„æ–‡ä»¶æ‰“å¼€ï¼Œå·¦è¾¹çš„ä¾§è¾¹æ å°±ä¼šå¤šå‡ºä¸€ä¸ª TeX é€‰é¡¹ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ–°å®‰è£…çš„æ’ä»¶å•¦ã€‚è¿›å…¥è¿™ä¸ªé€‰é¡¹å¯ä»¥çœ‹åˆ°å¾ˆå¤šç›¸å…³çš„å‘½ä»¤ï¼Œå…¶ä¸­é»˜è®¤çš„ç¼–è¯‘é“¾å¯ä»¥é€‚ç”¨äºä¸­æ–‡è®ºæ–‡çš„ç¼–è¯‘ã€‚é€‰æ‹© &amp;ldquo;View LaTeX PDF - View in VSCode tab&amp;rdquo; å°±å¯åœ¨ä¾§è¾¹æ é¢„è§ˆ PDF å•¦ï¼Œæ³¨æ„åªæœ‰ç¼–è¯‘ä¸€éæ‰æœ‰é¢„è§ˆç•Œé¢å“¦ã€‚&lt;/p&gt;
&lt;h3 id=&#34;heading-4&#34;&gt;å¦‚ä½•ç¼–è¯‘&lt;/h3&gt;
&lt;p&gt;é€‰æ‹© &amp;ldquo;Build LaTeX project&amp;rdquo; è¿›å…¥ï¼Œå†ç‚¹å‡»ä¸‹é¢å«æœ‰ &amp;ldquo;xelatex&amp;rdquo; çš„é…æ–¹å°±å¯ä»¥å•¦ï¼Œä¸€å…±æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªæ˜¯å½“ä½ ä¿å­˜æ—¶è‡ªåŠ¨è¿›è¡Œçš„ &amp;ldquo;xelatex-single-run&amp;rdquo; åªç¼–è¯‘ä¸€éï¼Œä½†æ˜¯ä¸ä¼šæ›´æ–° bibtex çš„å†…å®¹ï¼Œå¦ä¸€ä¸ªæ˜¯å®Œæ•´çš„ç¼–è¯‘è¿‡ç¨‹&amp;quot;xelatex-&amp;gt;bibtex-&amp;gt;xelatex x 2&amp;rdquo;ï¼Œæˆ‘ä»¬éœ€è¦&lt;strong&gt;åœ¨ç¬¬ä¸€æ¬¡æ‰“å¼€&lt;/strong&gt;é¡¹ç›®çš„æ—¶å€™é€‰æ‹©è¿™ä¸ªè¿›è¡Œä¸€éå®Œæ•´ç¼–è¯‘ï¼Œå®ƒä¼šæ›´æ–° bib çš„å†…å®¹ï¼Œä½†æ˜¯å¤ªæ…¢ã€‚å¦å¤–å½“ä½ æ›´æ–°äº† bib æ–‡ä»¶çš„æ—¶å€™ä¹Ÿè¦ç”¨è¿™ä¸ªå®Œæ•´çš„ç¼–è¯‘é“¾å®Œæˆå¼•ç”¨çš„æ›´æ–°å“¦ï¼Œä¸ç„¶ä¼šå‡ºé”™çš„ã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>Matrix Calculus</title>
      <link>https://xiahualiu.github.io/posts/2020-01-30-matrix-multiplication/</link>
      <pubDate>Thu, 30 Jan 2020 20:17:54 -0500</pubDate>
      <guid>https://xiahualiu.github.io/posts/2020-01-30-matrix-multiplication/</guid>
      <description>&lt;p&gt;Matrix calculus is very important in machine learning and control theories. However there are all kinds of rules making it hard to remember and use. In this post, I summarize some basic rules and an important proof in machine learning theory, which includes the famous &amp;quot;Trace Trick&amp;quot;! This trick is super useful and super hard as well! Haha, this is the reason why we always explore new things, because it is hard!&lt;/p&gt;

&lt;h2 id=&#34;differentiation&#34;&gt;Differentiation&lt;/h2&gt;

&lt;p&gt;For the rules of matrix differentiation, all we need to remember are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Gradient&lt;/li&gt;
&lt;li&gt;The Jacobian matrix&lt;/li&gt;
&lt;li&gt;The Hessian matrix&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;* All vectors in this post refer to column vectors with dimension &lt;span  class=&#34;math&#34;&gt;\(N\)&lt;/span&gt;.&lt;/p&gt;

&lt;h3 id=&#34;getting-started&#34;&gt;Getting started&lt;/h3&gt;

&lt;p&gt;To start with the concept, we differentiate a matrix with respect to a scalar variable, the result is pretty intuitive and natural:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\dot{A}=\begin{bmatrix}
\dot{A}_{11} &amp; \cdots &amp; \dot{A}_{1n} \\
\vdots &amp; \ddots &amp; \vdots \\
\dot{A}_{n1} &amp; \cdots &amp; \dot{A}_{nn} 
\end{bmatrix}\]&lt;/span&gt;&lt;/p&gt;

&lt;h3 id=&#34;gradient&#34;&gt;Gradient&lt;/h3&gt;

&lt;p&gt;The gradient of a scalar function can be visualized as the changes in different directions.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\nabla f(\textbf{x})=\begin{bmatrix}
\frac{\partial f}{\partial x_1} \\
\frac{\partial f}{\partial x_2} \\
\vdots \\
\frac{\partial f}{\partial x_n} \\
\end{bmatrix}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;It is the most simplifed case, remember it returns a vector that&#39;s in the same shape as the input vector variable.&lt;/p&gt;

&lt;h3 id=&#34;jacobian-matrix&#34;&gt;Jacobian Matrix&lt;/h3&gt;

&lt;p&gt;Jacobian matrix is the first-order derivative of a &lt;strong&gt;vector function&lt;/strong&gt;, a vector function is a function that &lt;strong&gt;receives a vector value and returns a vector value&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Jacobian matrix is obtained from &lt;span  class=&#34;math&#34;&gt;\((\nabla \textbf{f})^{\top}\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[(\nabla \textbf{f})^{\top}=[\frac{\partial \textbf{f}}{\partial x_1} \cdots \frac{\partial \textbf{f}}{\partial x_n}]=\begin{bmatrix}
\frac{\partial f_1}{\partial x_1}  &amp; \cdots &amp; \frac{\partial f_1}{\partial x_n} \\
\vdots &amp; \ddots &amp; \vdots \\
\frac{\partial f_n}{\partial x_1} &amp; \cdots &amp; \frac{\partial f_n}{\partial x_n}
\end{bmatrix}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;We did gradient operation at first, transposed the result, then applied the simple first derivative expansion as discussed in the warm up section.&lt;/p&gt;

&lt;h2 id=&#34;hessian-matrix&#34;&gt;Hessian Matrix&lt;/h2&gt;

&lt;p&gt;Hessian matrix is the second-order partial derivatives of a &lt;strong&gt;scalar-valued&lt;/strong&gt; function. A scalar-valued function is a function that &lt;strong&gt;receives a scalar or vector and returns a scalar&lt;/strong&gt;. Here we assume it the function receives a vector.&lt;/p&gt;

&lt;p&gt;Since it is a scalar function, first we find the gradient:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\frac{\partial y}{\partial \textbf{x}}=\begin{bmatrix} \frac{\partial y}{\partial x_1} \\
\vdots \\
\frac{\partial y}{\partial x_n} \\
\end{bmatrix}=\nabla \textbf{f}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;And we need to do this one more time.A sharp eye reader may notice the second derivative is the Jacobian matrix of the gradient, which is:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\textbf{J}(\nabla \textbf{f})\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;However, &lt;strong&gt;Hessian matrix is defined with an extra tranpose operation&lt;/strong&gt;, so it is actually:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\textbf{J}(\nabla \textbf{f})^{\top}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\mathbf{H}=\left[\begin{array}{cccc}
{\frac{\partial^{2} f}{\partial x_{1}^{2}}} &amp; {\frac{\partial^{2} f}{\partial x_{1} \partial x_{2}}} &amp; {\cdots} &amp; {\frac{\partial^{2} f}{\partial x_{1} \partial x_{n}}} \\
{\frac{\partial^{2} f}{\partial x_{2} \partial x_{1}}} &amp; {\frac{\partial^{2} f}{\partial x_{2}^{2}}} &amp; {\cdots} &amp; {\frac{\partial^{2} f}{\partial x_{2} \partial x_{n}}} \\
{\vdots} &amp; {\vdots} &amp; {\ddots} &amp; {\vdots} \\
{\frac{\partial^{2} f}{\partial x_{n} \partial x_{1}}} &amp; {\frac{\partial^{2} f}{\partial x_{n} \partial x_{2}}} &amp; {\cdots} &amp; {\frac{\partial^{2} f}{\partial x_{n}^{2}}}
\end{array}\right]\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Till now I hope you can understand what Jacobian matrix and Hessian matrix are, and be able to write the steps how we get Jacobian and Hessian matrix.&lt;/p&gt;

&lt;h2 id=&#34;integral&#34;&gt;Integral&lt;/h2&gt;

&lt;p&gt;Calculating the integral of the whole matrix is as simple as the warm up part.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\int A(t) {\rm d}t=\begin{bmatrix}
\int A_{11}{\rm d}t &amp; \cdots &amp; \int A_{1n}(t){\rm d}t \\
\vdots &amp; \ddots &amp; \vdots \\
\int A_{n1}(t){\rm d}t &amp; \cdots &amp; \int A_{nn}(t){\rm d}t
\end{bmatrix}\]&lt;/span&gt;&lt;/p&gt;

&lt;h2 id=&#34;trace-trick&#34;&gt;Trace trick&lt;/h2&gt;

&lt;p&gt;In this section, we will teach you what trace trick is. As usual, we start with a simple case:&lt;/p&gt;

&lt;h3 id=&#34;derivative-of-a-quadratic-form&#34;&gt;Derivative of a quadratic form&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;If you have no idea what a quadratic form is, I suggest you stop reading downwards&lt;/strong&gt;, because you have to have a good understanding of it, otherwise you cannot realize why we want to find its derivative.&lt;/p&gt;

&lt;p&gt;I also suggest a wonderful book for that foundation, &lt;em&gt;Linear Algebra and its Applications&lt;/em&gt;, this is a must-read for all new learners.&lt;/p&gt;

&lt;p&gt;So here we begin!&lt;/p&gt;

&lt;p&gt;Define a function:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[f(\textbf{x})=\textbf{x}^{\top}\textbf{Ax}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This is a scalar function, since &lt;span  class=&#34;math&#34;&gt;\(\textbf{x}\)&lt;/span&gt; is &lt;span  class=&#34;math&#34;&gt;\(m\times 1\)&lt;/span&gt;. So the size of the output is:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[(1\times m)\times(m\times m)\times(m\times 1)=(1\times 1)\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;And we need to find its first derivative w.r.t &lt;span  class=&#34;math&#34;&gt;\(\textbf{x}\)&lt;/span&gt;. How?&lt;/p&gt;

&lt;p&gt;You may think, it is same as finding the gradient of the function, so just expand the equation and find the partial derivative.&lt;/p&gt;

&lt;p&gt;Yes, it is indeed a reasonal idea, but expanding all the terms is way to tedious and humans are fallible. Is there any other way to obtain the result without messing the matrix?&lt;/p&gt;

&lt;p&gt;Yes, there is. It is called &lt;strong&gt;&amp;quot;Trace Trick&amp;quot;&lt;/strong&gt; and is widely used in finding the derivative of quadratic form function.&lt;/p&gt;

&lt;h3 id=&#34;trace&#34;&gt;Trace&lt;/h3&gt;

&lt;p&gt;From wikipedia:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;In linear algebra, the trace of a square matrix &lt;span  class=&#34;math&#34;&gt;\(A\)&lt;/span&gt; is defined to be the sum of elements on the main diagonal of &lt;span  class=&#34;math&#34;&gt;\(A\)&lt;/span&gt;. The trace of a matrix is the sum of its eigenvalues, and it is invariant with respect to a change of basis.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;trace-laws&#34;&gt;Trace laws&lt;/h3&gt;

&lt;p&gt;Here are two most important laws:&lt;/p&gt;

&lt;h4 id=&#34;transpose-law&#34;&gt;Transpose law&lt;/h4&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\operatorname{tr}(\mathbf{A})=\operatorname{tr}\left(\mathbf{A}^{\top}\right)\]&lt;/span&gt;&lt;/p&gt;

&lt;h4 id=&#34;cyclic-permutation-law&#34;&gt;Cyclic permutation law&lt;/h4&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\operatorname{tr}(\mathbf{A B C D})=\operatorname{tr}(\mathbf{B C D A})=\operatorname{tr}(\mathbf{C D A B})=\operatorname{tr}(\mathbf{D A B C})\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;How do we apply the trace trick in our calculation? Well, from the definition of the trace, a trace of a scalar (which can be considered as a &lt;span  class=&#34;math&#34;&gt;\(1\times 1\)&lt;/span&gt; matrix) is itself, so:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\operatorname{tr}(\textbf{x}^{\top}\textbf{Ax})=\textbf{x}^{\top}\textbf{Ax}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Now it is the trick time, I will write everything here, please read the following equation, and try to understand how I get to the final line:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
{\rm d}(\textbf{x}^{\top}\textbf{Ax}) &amp;={\rm d}(\operatorname{tr}(\textbf{x}^{\top}\textbf{Ax})) \\
&amp;=\operatorname{tr}({\rm d}(\textbf{Ax}\textbf{x}^{\top})) \\
&amp;=\operatorname{tr}({\rm d}(\textbf{Ax})\textbf{x}^{\top}+{\bf Ax}{\rm d}(\textbf{x}^{\top})) \\
&amp;=\operatorname{tr}({\rm d}(\textbf{Ax})\textbf{x}^{\top})+\operatorname{tr}({\bf Ax}{\rm d}(\textbf{x}^{\top})) \\
&amp;=\operatorname{tr}(\textbf{A}({\rm d}\textbf{x})\textbf{x}^{\top})+\operatorname{tr}\left((({\rm d}\textbf{x})\textbf{x}^{\top} \textbf{A}^{\top})^{\top}\right) \\
&amp;=\operatorname{tr}((\textbf{x}^{\top}\textbf{A}({\rm d}\textbf{x})) + \operatorname{tr}(\textbf{x}^{\top}\textbf{A}^{\top}({\rm d}\textbf{x})) \\
&amp;=\operatorname{tr}(\textbf{x}^{\top}\textbf{A}){\rm d}\textbf{x} + \operatorname{tr}(\textbf{x}^{\top}\textbf{A}^{\top}){\rm d}\textbf{x} \\
&amp;=\operatorname{tr}\left((\textbf{x}^{\top}\textbf{A}+\textbf{x}^{\top}\textbf{A}^{\top}){\rm d}\textbf{x}\right) \\
&amp;=(\textbf{x}^{\top}\textbf{A}+\textbf{x}^{\top}\textbf{A}^{\top}){\rm d}\textbf{x}
\end{aligned}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I used cyclic permutation law at beginning and at the end twice, and used transpose law only once to transform &lt;span  class=&#34;math&#34;&gt;\({\rm d}\textbf{x}^{\top}\)&lt;/span&gt;. I installed trace function on first line and uninstall the trace function on the last line, &lt;span  class=&#34;math&#34;&gt;\({\rm d}\textbf{x}=\lim(\textbf{x}_1-\textbf{x}_2)\in \Bbb{R}^{N}\)&lt;/span&gt;, it can be proved that the expression on final line is still a scalar.&lt;/p&gt;

&lt;p&gt;And we can get the result &lt;span  class=&#34;math&#34;&gt;\(\textbf{x}^{\top}\textbf{A}+\textbf{x}^{\top}\textbf{A}^{\top}\)&lt;/span&gt; simply in several steps!&lt;/p&gt;

&lt;h4 id=&#34;another-important-law&#34;&gt;Another Important Law&lt;/h4&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\frac{\partial}{\partial A}\operatorname{tr}(AB)=B^{\top}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This law will be used once in the next section.&lt;/p&gt;

&lt;h2 id=&#34;multivariate-guassian-distribution-maximum-likelihood-estimate&#34;&gt;Multivariate Guassian Distribution Maximum Likelihood Estimate&lt;/h2&gt;

&lt;p&gt;In the end, I want to show you how to calculate the MLE for a multivariate guassian distribution model with all the stuff discussed in this post, I really hope you can enjoy it as much as I do!&lt;/p&gt;

&lt;h4 id=&#34;problem&#34;&gt;Problem:&lt;/h4&gt;

&lt;p&gt;Given &lt;span  class=&#34;math&#34;&gt;\(N\)&lt;/span&gt; samples &lt;span  class=&#34;math&#34;&gt;\(\{X_1,X_2,X_3,...,X_i\}\)&lt;/span&gt; are drawn from a p-variate multivariate guassian distribution model i.i.d:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[p(x | \mu, \Sigma)=\frac{1}{(2 \pi)^{p / 2}|\Sigma|^{1 / 2}} \exp \left\{-\frac{1}{2}(x-\mu)^{T} \Sigma^{-1}(x-\mu)\right\}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Find the MLE for &lt;span  class=&#34;math&#34;&gt;\(\mu\ \Sigma\)&lt;/span&gt;.&lt;/p&gt;

&lt;h4 id=&#34;solution&#34;&gt;Solution:&lt;/h4&gt;

&lt;p&gt;Define the likelihood function &lt;span  class=&#34;math&#34;&gt;\(L\)&lt;/span&gt;:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[f(\mu, \Sigma)=\frac{1}{(2\pi)^{\frac{pN}{2}}|\Sigma|^{\frac{N}{2}}}\exp{\left\{\sum_{i=1}^{N}-\frac{1}{2}(X_i-\mu)^{\top}\Sigma^{-1}(X_i-\mu)\right\}}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;In order to simplify the problem, plus due to the fact that the multivariate guassian distribution belongs to the exponential distribution family. Instead straight differentiating the likelihood function, it is better to calculate the logarithmic differentiation of the function.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
&amp; L(\mu, \Sigma)=\ln f(\mu, \Sigma)= \\
&amp; \sum_{i=1}^{N}-\frac{1}{2}(X_i-\mu)^{\top}\Sigma^{-1}(X_i-\mu)-\frac{pN}{2}\ln 2\pi - \frac{N}{2}\ln|\Sigma|\end{aligned}\]&lt;/span&gt;&lt;/p&gt;

&lt;h5 id=&#34;find-the-mle-for-the-the-mean&#34;&gt;Find the MLE for the the mean&lt;/h5&gt;

&lt;p&gt;Find &lt;span  class=&#34;math&#34;&gt;\(\mu\)&lt;/span&gt; first, then &lt;span  class=&#34;math&#34;&gt;\(\Sigma\)&lt;/span&gt;, calculate the first-order partial derivative of &lt;span  class=&#34;math&#34;&gt;\(L(\mu, \Sigma)\)&lt;/span&gt; w.r.t &lt;span  class=&#34;math&#34;&gt;\(\mu\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\frac{\partial L(\mu, \Sigma)}{\partial \mu} = \sum_{i=1}^n - \partial \frac{1}{2}(X_i-\mu)^{\top}\Sigma^{-1}(X_i-\mu) /\partial \mu \]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;And if we regard &lt;span  class=&#34;math&#34;&gt;\((X_i-\mu)\)&lt;/span&gt; as &lt;span  class=&#34;math&#34;&gt;\(\textbf{x}\)&lt;/span&gt; in the former section, the partial derivative on the right side is simply:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\frac{1}{2}\sum_{i=1}^{N} (X_i-\mu)^{\top}\Sigma^{-1}+ (X_i-\mu)^{\top}(\Sigma^{-1})^T\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Since &lt;span  class=&#34;math&#34;&gt;\(\Sigma\)&lt;/span&gt; is the covariance matrix, it is symmetric:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
\Sigma^{-1}\Sigma&amp;=(\Sigma\Sigma^{-1})^{\top} \\
\Sigma^{-1}\Sigma&amp;=(\Sigma^{-1})^{\top}\Sigma^{\top} \\
\Sigma^{-1}&amp;=(\Sigma^{-1})^{\top}
\end{aligned}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The partial derivative w.r.t &lt;span  class=&#34;math&#34;&gt;\(\mu\)&lt;/span&gt; in the conclusion:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\frac{\partial L(\mu, \Sigma)}{\partial \mu} =\sum_{i=1}^n(X_i-\mu)^{\top}\Sigma^{-1}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Find its critical point, i.e. the mean of all samples:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\hat{\mu}=\frac{1}{N}\sum_{i=1}^{N}X_i\]&lt;/span&gt;&lt;/p&gt;

&lt;h5 id=&#34;find-the-mle-for-the-covariance-matrix&#34;&gt;Find the MLE for the covariance matrix&lt;/h5&gt;

&lt;p&gt;Since we get &lt;span  class=&#34;math&#34;&gt;\(\hat{\mu}\)&lt;/span&gt;, and apparently the &lt;span  class=&#34;math&#34;&gt;\(\mu\)&lt;/span&gt; estimate does not rely on &lt;span  class=&#34;math&#34;&gt;\(\Sigma\)&lt;/span&gt;, these two parameters are independent. We can safely substitute all &lt;span  class=&#34;math&#34;&gt;\(\mu\)&lt;/span&gt; with &lt;span  class=&#34;math&#34;&gt;\(\hat{\mu}\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
\frac{\partial L(\hat{\mu}, \Sigma)}{\partial \Sigma^{-1}}&amp;=\partial\left(-\frac{N}{2}\ln|\Sigma|\right)/\partial\Sigma^{-1}-\frac{1}{2}\sum_{i=1}^{N}(X_i-\hat{\mu})(X_i-\hat{\mu})^{\top} \\
&amp;=\partial (\frac{N}{2}\ln|\Sigma^{-1}|)/\partial \Sigma^{-1} -\frac{1}{2}\sum_{i=1}^{N}(X_i-\hat{\mu})(X_i-\hat{\mu})^{\top} \\
&amp;=\frac{N}{2\Sigma^{-1}}-\frac{1}{2}\sum_{i=1}^{N}(X_i-\hat{\mu})(X_i-\hat{\mu})^{\top} \\
&amp;=\frac{N}{2}\Sigma-\frac{1}{2}\sum_{i=1}^{N}(X_i-\hat{\mu})(X_i-\hat{\mu})^{\top}
\end{aligned} \]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The last term on the first line was obtained by first using the cyclic permutaion then using the extra law in the former section.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\frac{1}{2} \sum_{n}\left(x_{n}-\mu\right)^{\top} \Sigma^{-1}\left(x_{n}-\mu\right)=\frac{1}{2} \sum_{i=1}^{N} \operatorname{tr}\left[\left(X_{i}-\hat{\mu}\right)\left(X_{i}-\hat{\mu}\right)^{\top} \Sigma^{-1}\right]\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Then the extra law was used.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
&amp; \frac{\partial}{\partial\Sigma^{-1}}(\frac{1}{2} \sum_{i=1}^{N} \operatorname{tr}\left[\left(X_{i}-\hat{\mu}\right)\left(X_{i}-\hat{\mu}\right)^{\top} \Sigma^{-1}\right]) \\
= &amp; \frac{1}{2}\sum_{i=1}^{N}(X_i-\hat{\mu})(X_i-\hat{\mu})^{\top}
\end{aligned}\]&lt;/span&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>LRTA* AND-OR ALPHA-BETA algorithms</title>
      <link>https://xiahualiu.github.io/posts/2020-01-11-lrta-ab/</link>
      <pubDate>Sat, 11 Jan 2020 21:59:55 -0500</pubDate>
      <guid>https://xiahualiu.github.io/posts/2020-01-11-lrta-ab/</guid>
      <description>&lt;p&gt;In this post, I will write down my understanding of these three algorithms, which are intended to solve:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Unknown but fully observable environment: LRTA*&lt;/li&gt;
&lt;li&gt;Known but non-deterministic environment: AND-OR Tree Search&lt;/li&gt;
&lt;li&gt;Classical two-player adversary game: ALPHA-BETA Tree Search&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The reason I put AND-OR and ALPHA-BETA Tree searches together is I think they are quite similiar, one is agent versus environment, one is agent versus another optimal agent.&lt;/p&gt;
&lt;p&gt;The reason I skipped genetic algorithm is that it is just a concept, and contains too many sub algorithms that follow the same evolutionary concept. I wrote a program using GA solving TSP problem, &lt;a href=&#34;https://github.com/xiahualiu/TSP_example&#34;&gt;TSP example&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;learning-real-time-a&#34;&gt;Learning Real Time A*&lt;/h2&gt;
&lt;p&gt;LRTA* is a simple implement of a online search agent. It is suitable for an unknown environment and the environment is safe to explore.&lt;/p&gt;
&lt;p&gt;The LRTA* algorithm is just like the value iteration algorithm of MDP, but the difference is in value iteration algorithm, the environment is known, we initialize the utility randomly with a random value linked to any state.&lt;/p&gt;
&lt;p&gt;But LRTA* is able to solve the unknown environment, we cannot assign a value at first, instead, the agent can only get access to the states where it has been in. So LRTA* use a &lt;code&gt;result&lt;/code&gt; to store transitions, and a &lt;code&gt;H&lt;/code&gt; to store the value of the explored states.&lt;/p&gt;
&lt;p&gt;And there is a problem which cannot be overcome by any type of algorithms, i.e. asserting the optimality of the solution, since we can only explored limited state space, so there is not guarantee that there is no better solution than the one we found.&lt;/p&gt;
&lt;h2 id=&#34;and-or-search&#34;&gt;AND-OR Search&lt;/h2&gt;
&lt;p&gt;AND-OR search include two functions that calling each other. It is an interesting idea.&lt;/p&gt;
&lt;p&gt;AND nodes can be regarded as an unstable transition model, which leads to different next states. AND-OR search is a DFS search, every path will end in a failure (loop or dead) or goal.&lt;/p&gt;
&lt;p&gt;OR nodes is the agent choice node, agent choose what to do in OR nodes. If the OR node is goal, OR search return the empty plan, and the upper OR nodes will add reflexes (if state n then do x) to that plan and the plan will eventually leads the agent to the goal.&lt;/p&gt;
&lt;p&gt;In AND nodes, the nodes return &amp;ldquo;switch&amp;rdquo; plans, so not matter what the environment outcome is, the plan is consistent for an agent. However this switch may have a failure case.&lt;/p&gt;
&lt;p&gt;It is a little tricky the fact that AND-OR search only need to find one goal, because OR searches exhausts all outcomes of an action, and AND searches are the choices of an agent, so if we only need a solution which can be not optimal, we just need find one possible plan.&lt;/p&gt;
&lt;h2 id=&#34;alpha-beta-pruningsearch&#34;&gt;ALPHA-BETA Pruning/Search&lt;/h2&gt;
&lt;p&gt;Alpha-Beta search is actually a smarter version of minimax search. Every path maintains a value bound (alpha and beta) that some bad branches will not be considered and explored if they are in the bound.&lt;/p&gt;
&lt;p&gt;Values need to be backed-up along the path. So every node on the path shares the same bound.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Searching Methods - AI: A Modern Approach Notes</title>
      <link>https://xiahualiu.github.io/posts/2020-01-07-searching/</link>
      <pubDate>Tue, 07 Jan 2020 13:02:01 -0500</pubDate>
      <guid>https://xiahualiu.github.io/posts/2020-01-07-searching/</guid>
      <description>&lt;h2 id=&#34;abstract&#34;&gt;Abstract&lt;/h2&gt;
&lt;p&gt;This article is my personal version summary of the famous book, Artificial Intelligence: A Modern Approach Chapter 3.&lt;/p&gt;
&lt;h2 id=&#34;tree-search-and-graph-search&#34;&gt;Tree Search and Graph Search&lt;/h2&gt;
&lt;p&gt;Tree search expands all child nodes and adds them into frontier even some of them have been visited.&lt;/p&gt;
&lt;p&gt;Graph search maintains a explored list where stores all visited nodes, it only adds unexplored nodes into frontier.&lt;/p&gt;
&lt;h2 id=&#34;uninformed-search&#34;&gt;Uninformed Search&lt;/h2&gt;
&lt;p&gt;There are many types of uninformed search algorithms:&lt;/p&gt;
&lt;h3 id=&#34;step-cost-problem&#34;&gt;Step-cost Problem&lt;/h3&gt;
&lt;p&gt;This kind of problems have the same step cost, we only need to find the minimal steps from initial state to goal state.&lt;/p&gt;
&lt;h4 id=&#34;breath-first-search&#34;&gt;Breath first search:&lt;/h4&gt;
&lt;p&gt;This method uses a FIFO (first-input-first-output) queue to implement. And is not sensitive to the choice between tree search or graph search.&lt;/p&gt;
&lt;h5 id=&#34;advantage-of-bfs&#34;&gt;Advantage of BFS:&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;It can find the optimal solution naturally without generating overhead nodes.&lt;/li&gt;
&lt;li&gt;It generates the fewest nodes before finding a solution for step-cost problem.&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;distadvantage-of-bfs&#34;&gt;Distadvantage of BFS:&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;It needs to store all the nodes on last layer.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;depth-first-search&#34;&gt;Depth first search:&lt;/h4&gt;
&lt;p&gt;DFS can be implement by two ways, one is using a LIFO (last input first output) stack, the other is calling &lt;code&gt;child()&lt;/code&gt; function recursively.&lt;/p&gt;
&lt;p&gt;Natural DFS under tree search (not the graph search) condition is incomplete, because the depth is infinite. The DFS itself is not an optimal algrithm.&lt;/p&gt;
&lt;h5 id=&#34;advantage-of-dfs&#34;&gt;Advantage of DFS:&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;It frees node memory once it finishs digging a branch, all the nodes on the branch can be deleted. So it can run on a memory-limited machine.&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;disadvantage-of-dfs&#34;&gt;Disadvantage of DFS:&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;It generates excessive nodes compared with BFS.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;varaints-of-dfs&#34;&gt;Varaints of DFS:&lt;/h4&gt;
&lt;h5 id=&#34;backtracking-search&#34;&gt;Backtracking search&lt;/h5&gt;
&lt;p&gt;It is more memory economical. Every generated node on searching tree has a successor information on its depth, so we only need to store &lt;em&gt;m&lt;/em&gt; nodes (m equals the depth of the frontier) at any time.&lt;/p&gt;
&lt;p&gt;It is suitable when a node is super large in memory.&lt;/p&gt;
&lt;h5 id=&#34;iterative-deeping-depth-first-search&#34;&gt;Iterative deeping depth-first search&lt;/h5&gt;
&lt;p&gt;It is simply a DFS with depth limitation. After each episode of IDS, the depth limit increases by 1.&lt;/p&gt;
&lt;p&gt;Two types of return result:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cutoff: Current episode reached depth limit.&lt;/li&gt;
&lt;li&gt;failure: Current episode ends before reaching depth limit.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;uniform-cost-problem&#34;&gt;Uniform-cost Problem&lt;/h3&gt;
&lt;p&gt;Uniform-cost problems have a postive cost for each step, however costs for different steps varys.&lt;/p&gt;
&lt;h4 id=&#34;uniform-cost-search&#34;&gt;Uniform-cost search&lt;/h4&gt;
&lt;p&gt;It is origin from the two-point shortest-path algorithm of Dijkstra.&lt;/p&gt;
&lt;p&gt;It relys on a priority queue, instead expanding randomly, it always expands the lowest path cost node on the present searching tree.&lt;/p&gt;
&lt;p&gt;Two modification:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The goal test is applied to a node when it is selected for expansion (fetched from the priority queue). This seems inefficient but it is essential. Once a node is generated, we cannot ensure that it will be pushed back to the top of priority queue, but the second time we met it, it must be the optimal solution, beacuse the path cost can only increase in uniformed cost problem case.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The second modification is similar to dynamic programming, a test is added and when we enter the same state multiple times, rather than storing all of the nodes, we only store the best node that reach this state.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;bidirection-search&#34;&gt;Bidirection search&lt;/h3&gt;
&lt;p&gt;Bidirection search is based on the simple math:&lt;/p&gt;
&lt;p&gt;$$2\ast branch^{depth/2} \quad  \text{is much less than} \quad branch^{depth}$$&lt;/p&gt;
&lt;p&gt;It needs a test to check whether the frontiers of two searches intersect.&lt;/p&gt;
&lt;p&gt;But calculating the predecessors needs substantial ingenuity.&lt;/p&gt;
&lt;h2 id=&#34;informed-heuristic-search&#34;&gt;Informed (Heuristic) Search&lt;/h2&gt;
&lt;p&gt;The difference between informed and uninformed search is whether we can find a heuristic function.&lt;/p&gt;
&lt;p&gt;$$h(n)=\text{heuristic function of a node}$$&lt;/p&gt;
&lt;h3 id=&#34;greedy-best-first-search&#34;&gt;Greedy best-first search&lt;/h3&gt;
&lt;p&gt;It chooses to expand the node that is most likely to lead to a solution. In two-point shortest route finding problem, the heuristic function is the 2-norm between the current address and goal address.&lt;/p&gt;
&lt;p&gt;In this case:&lt;/p&gt;
&lt;p&gt;$$h(n)=norm(n,goal)$$&lt;/p&gt;
&lt;h3 id=&#34;a-search&#34;&gt;A* search&lt;/h3&gt;
&lt;p&gt;Unlike uniform-cost search&#39;s only considering path cost from start, and greedy best-first search&#39;s only considering heuristic function value. A* combines them both.&lt;/p&gt;
&lt;p&gt;$$f(n)=g(n)+h(n)$$&lt;/p&gt;
&lt;h4 id=&#34;variants-of-a-search&#34;&gt;Variants of A* search&lt;/h4&gt;
&lt;p&gt;The biggest problem of A* is that A* stores all the nodes before finding a optimal solution.&lt;/p&gt;
&lt;p&gt;So the variants of A* mainly optimize the memory efficiency.&lt;/p&gt;
&lt;h5 id=&#34;iterative-deepening-a-search&#34;&gt;Iterative-deepening A* search&lt;/h5&gt;
&lt;p&gt;Cutoff &lt;em&gt;f&lt;/em&gt;-cost is the smallest &lt;em&gt;f&lt;/em&gt;-cost node that exceeded the cutoff on the previous iteration.&lt;/p&gt;
&lt;p&gt;Honestly, iterative deepening search only works efficiently for BFS, algorithms like iterative-deeping depth first search or iterative-deeping depth A* search all suffer from the cost of repeating expanding upper layers in each iteration.&lt;/p&gt;
&lt;h5 id=&#34;recursive-best-first-search-rbfs&#34;&gt;Recursive best-first search (RBFS)&lt;/h5&gt;
&lt;p&gt;If a node&#39;s children all cost more than a node&#39;s peer, we can just label the node with the best children cost then delete all the decendants, then move the peer node.&lt;/p&gt;
&lt;h5 id=&#34;memory-bounded-a-ma-and-simplified-ma-sma&#34;&gt;Memory-bounded A* (MA*) and simplified MA* (SMA*)&lt;/h5&gt;
&lt;p&gt;SMA* behaves same as A* before exhausting all the memory, after no node can be added to the memory, it removes the worst node in the tree and adds new node.&lt;/p&gt;
&lt;h3 id=&#34;how-to-choose-heuristic-function&#34;&gt;How to choose heuristic function&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Generating admissible heuristics from relaxed problem.&lt;/li&gt;
&lt;li&gt;Generating admissible heuristics from subproblems.&lt;/li&gt;
&lt;li&gt;Learning heuristics from experience.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;parallel-search&#34;&gt;Parallel search&lt;/h4&gt;
&lt;p&gt;Not covered but useful for computer cluster.&lt;/p&gt;
</description>
    </item>
    <item>
      <title>A Dynamic Programming Tuturial</title>
      <link>https://xiahualiu.github.io/posts/2019-12-23-dp/</link>
      <pubDate>Mon, 23 Dec 2019 17:59:10 -0500</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-12-23-dp/</guid>
      <description>&lt;p&gt;Well, it sounds old but for me, the true understanding of dynamic programming actually happended after I finished reading the book:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Optimal Control Theory: An Introduction by Donald E. Kirk&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;However, the book used an example that is too complicated for a beginner to understand (I think, for me it is.). So I wrote this article to help those who want to take a peek in the basics of dynamic programming, I will try my best to make it easy and you will see that dynamic programming is quite simple and intuitive.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Revised:&lt;/strong&gt; After finishing the canonical book AI: A Modern Approach, I felt I was fooled by the former book, dynamic programming is as simple as BFS or DFS.&lt;/p&gt;
&lt;h2 id=&#34;some-notations&#34;&gt;Some notations&lt;/h2&gt;
&lt;p&gt;In the rest of the article, some notations will appear more than once and I do not want to confuse any of you about the notations, what they mean.&lt;/p&gt;
&lt;p&gt;The first two is state and policy:&lt;/p&gt;
&lt;p&gt;Dynamic programming is suitable for solving problems that contain a series of decisions and states.&lt;/p&gt;
&lt;p&gt;For example, if you are a postman and today your job is to deliver some packages in an area, a common postman will stick to the same route everyday or randomly drives the van. But a clever postman like you will try to find a path that can visit all the package addresses meanwhile has the shortest distance among all viable routes.&lt;/p&gt;
&lt;p&gt;And for your information, This problem has another name, called &lt;a href=&#34;https://en.wikipedia.org/wiki/Travelling_salesman_problem&#34;&gt;Traveling Salesman Problem (TSP)&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We can tear the problem into a series of decisions, i.e. which address to visit first, then, after you finish the first delivery, at the first address, you have to decide which address to visit next.&lt;/p&gt;
&lt;p&gt;So here the states here, at first glance (not right though), are the different addresses, in other words, different outcomes of your decision. And the policy is like a GPS navigation system installed on your car, it tells you what is your next decision once you reach a state (address). So if your policy is optimal, you can follow the policy and traverse these addresses and finish the given task in the shortest path (and use less gas!). So&lt;/p&gt;
&lt;p&gt;Policy:&lt;/p&gt;
&lt;p&gt;$$P(state)=action$$&lt;/p&gt;
&lt;p&gt;Policy works like a function, it accepts discrete states and outputs corresponding actions at given state.&lt;/p&gt;
&lt;p&gt;However in the postman problem discribed above, the state is not simply address because once you made a decision, the outcome is not a simply change of your location, you also have one less package to deliver, so the state in this problem also has information of the package you are carry at the certain address. If you are at Address #1, but you only carry 1 package (1 address to go), apparently the situation differs from that you carry 10 packages (10 addresses to go), the biggest difference is your action set next is not same (you have 1 choice versus 10 choices).&lt;/p&gt;
&lt;p&gt;So a state can be more complexed.&lt;/p&gt;
&lt;h2 id=&#34;principle-of-optimality&#34;&gt;Principle of Optimality&lt;/h2&gt;
&lt;p&gt;Since we have discussed state and policy, we can move on to the principle of optimality.&lt;/p&gt;
&lt;p&gt;We can tear the problem into a series of decisions and states, right? Image we start at State #1 and reach State #n, the pricinple of optimality ensure that, if the policy is optimal, and path from the beginning state (State #1) to the State #(n-1) provided by the policy is optimal. This is simple to proof, if you can find a better path from State #1 to State #(n-1), you can simply do the same last step (State #(n-1) to State #n) and get a better result!&lt;/p&gt;
&lt;p&gt;This may confuse you a little, I will show an example using the above postman problem. Imagine you have reached the Address #i and you only have no package to deliver (but you need to return to the post office). And you recall your history moves, &amp;ldquo;Did I make the right moves?&amp;quot;. Well if you can think of a better waythat can lead you into the same situation you are right now, the route you chose is definitely not optimal, becase the next move clearly makes no difference on the total distance cost.&lt;/p&gt;
&lt;p&gt;If we do the backward deduction several times (Since the path from State #1 to State #(n-1) is optimal, the path from State #1 to State #(n-2) is also optimal, and so on), then we can get a conclusion:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If you get an optimal path to finish the task, all the sub-paths from the begginning state to any states inside the path are optimal.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;You may think, while, that is easy, we only need to find the optimal path from State #1 to State #2 and the optimal path from State #1 to State #3. Then we find State #1 to State #n.&lt;/p&gt;
&lt;p&gt;Yes, that is the gist of the dynamic programming. However, the hidden difficulty in the process is, once you get the optimal path from State #1 to State #2, how do you get the optimal path from State #1 to State #3.&lt;/p&gt;
&lt;p&gt;In some simple problems, like &lt;a href=&#34;https://en.wikipedia.org/wiki/Knapsack_problem&#34;&gt;Knapsack problem&lt;/a&gt;. You can use this way to find the best result, becasue in such problems, states are heavily history related, (Forgive me for not able to think of a better description), so you can push your current state towards the ending.&lt;/p&gt;
&lt;p&gt;Some of the problems are not simple like that, you need to search for all probably states that can reach State #3 in one move and check which one is the best, (In terms, which costs least).&lt;/p&gt;
&lt;p&gt;So the forward programming process can be simply described in one formula:&lt;/p&gt;
&lt;p&gt;$$ J^\ast=\min(C_h^\ast+C_i)$$&lt;/p&gt;
&lt;p&gt;The J star is the best cost for current state, Ch star is the best history cost from beginning to the state before current state, Ci is the cost for taking action i in a given former state.&lt;/p&gt;
&lt;p&gt;If you record all Ci&#39;s, you get the optimal path one by one.&lt;/p&gt;
&lt;h2 id=&#34;how-to-implement-dp&#34;&gt;How to implement DP&lt;/h2&gt;
&lt;p&gt;Well, there are two ways to implement a dynamic programming algorithm for a problem, one is forward way, like I discribed above, and you can do it backward. For every iteration, you do not own a history when you do it backward, but you can evaluate it later, and just accumulate the action costs, until you reach the begginning state.&lt;/p&gt;
&lt;p&gt;However they do not differ very much, choose one you like or according to the problem! Because you can planning the path in any direction you like, but you have to execute the actions one by one once you finish planning!&lt;/p&gt;
&lt;h2 id=&#34;a-tsp-example&#34;&gt;A TSP Example&lt;/h2&gt;
&lt;p&gt;This example can be found at my github repository &lt;a href=&#34;https://github.com/xiahualiu/TSP_example&#34;&gt;here&lt;/a&gt;. I used 3 different ways to solve the TSP problem but you only need the DP solution.&lt;/p&gt;
&lt;p&gt;So In this example the problem is stated as:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;There are 4 cities on the map. Their locations are (20,20) (20,40) (40,40) (40,20) respectively and they are are X Y values in the cartesian system. Find the shortest tour among those cities, each city must be at least visited once and you cannot visit a city twice, except the city where you start off, you need to return to the begin city after visiting all cities.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In this problem, we can start at any arbitrary city because the tours are required to be closed circles as described, the optimal solution is same for every beginning choice.&lt;/p&gt;
&lt;p&gt;Imagine we chose City #1 (20,20) to begin with.&lt;/p&gt;
&lt;p&gt;The states in this problem need to carry such information:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Total Distance&lt;/strong&gt;: How far did I go? (We need to know this while making comparsion in DP iteration)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Visited City Set&lt;/strong&gt;: Unordered set of all cities I have visited. (Why this is needed was talked above)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Current City&lt;/strong&gt;: Where am I now? (We need to know this before calculating the distance increments.)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;So we have the structure of the state in this problem, what we need now is &lt;strong&gt;evolving the intial state until the state reachs the final state&lt;/strong&gt;. This may sound strange to you, but you will know what I am talking about later.&lt;/p&gt;
&lt;p&gt;I used a common notaion for our state.&lt;/p&gt;
&lt;p&gt;$$g(current_city | visited_set)=total_distance$$&lt;/p&gt;
&lt;p&gt;And we did the DP forward using our hand, what we get is a tree:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-12-23-DP/p2.png&#34; alt=&#34;DP tree&#34;&gt;&lt;/p&gt;
&lt;p&gt;This problem is simple, we simply did a breath first searching first, and this is enough to lead us to find out all the candidates in the DP iteration formulas (Because the states are historically related so the candidates can always be found out at the former layers). How we did the DP iteration?&lt;/p&gt;
&lt;p&gt;For example, following path 1-3-4-2 and we reach the state where current location is City #2 and we have visited {4,3,2,1}. And later we find a better path 1-4-3-2 which lets us reach exactly the same state and offers a better distance cost. So we update the state and overwrite the new path to the state.&lt;/p&gt;
&lt;p&gt;Please know that this problem can be solved efficiently by BFS (not most efficiently though) does not mean every DP problems can all be solved with BFS. We can use another way to discover the candidate states, but the DP iteration process is same for any problem types.&lt;/p&gt;
&lt;h2 id=&#34;some-comments&#34;&gt;Some comments&lt;/h2&gt;
&lt;p&gt;To be honest, dynamic programming is not a very complicated method, it just systematically records all the solutions for the subproblems then increases the length to the original problem.&lt;/p&gt;
&lt;p&gt;DP essentially, we start with the smallest cases of the subproblem, becase when we find all optimal solutions to every possible subproblems, we can use the DP iteration to find optimal solutions to a bigger subproblem, then do this again and again we will reach the original problem.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Signal Processing Math - Partial Fraction Expansion Strategies</title>
      <link>https://xiahualiu.github.io/posts/2019-07-28-partial-fraction-expansion/</link>
      <pubDate>Sun, 28 Jul 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-07-28-partial-fraction-expansion/</guid>
      <description>&lt;p&gt;Partial fraction expansion (also known as partial fraction decomposition) is a very basic math operation when we want to simplify a problem involving a fraction with polynomial numerator and denominator. We have some methods to handle the fundamental fraction terms like Laplace transform of a simple exponential signal is:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{1}{a+s}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;And the by inverse Laplace Transform we know the signal is either &lt;span  class=&#34;math&#34;&gt;\(e^{-at}u(t)\)&lt;/span&gt; or &lt;span  class=&#34;math&#34;&gt;\(-e^{-at}u(-t)\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;, depending on the transform is left-sided or right-sided.&lt;/p&gt;

&lt;p&gt;But in a more complicated situation, while we are facing the transform like&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{s+3}{s^3+7s^2+10s}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;We want to decompose the fraction into a sum of simple fractions:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{A_1}{s}+\frac{A_2}{s+2}+\frac{A_3}{s+5}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;So we can use the basic Laplace transform pairs to get the signal. But we need a way to determine the values of&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[A_1,\ A_2 \text{ and }A_3\]&lt;/span&gt;&lt;/p&gt;

&lt;h2 id=&#34;a-simple-partial-fraction-expansion&#34;&gt;A Simple Partial Fraction Expansion&lt;/h2&gt;

&lt;p&gt;The simple situation is the one shown above, there is a simple and straightforward method to determining the unknown coefficients&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[A_1,\ A_2 \text{ and }A_3\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;To find &lt;span  class=&#34;math&#34;&gt;\(A_1\)&lt;/span&gt;, multiply &lt;span  class=&#34;math&#34;&gt;\(F(s)\)&lt;/span&gt; by &lt;span  class=&#34;math&#34;&gt;\(s\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
sF(s)&amp;=s\frac{s+3}{s(s+2)(s+5)} \cr 
&amp;=A_1+s\frac{A_2}{s+2}+s\frac{A_3}{s+5}
\end{aligned}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;and then set &lt;span  class=&#34;math&#34;&gt;\(s=0\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
sF(s)|_{s=0}&amp;=A_1+0\frac{A_2}{0+2}+0\frac{A_3}{0+5}=A_1 \cr
&amp;=\frac{s+3}{s(s+5)}|_{s=0}=\frac{3}{10}
\end{aligned}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Likewise, we can get &lt;span  class=&#34;math&#34;&gt;\(A_2\)&lt;/span&gt; by setting &lt;span  class=&#34;math&#34;&gt;\(s=-2\)&lt;/span&gt;, get &lt;span  class=&#34;math&#34;&gt;\(A_3\)&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;by setting &lt;span  class=&#34;math&#34;&gt;\(s=-5\)&lt;/span&gt;.&lt;/p&gt;

&lt;h2 id=&#34;special-cases-of-parial-fraction-expansion&#34;&gt;Special Cases of Parial Fraction Expansion&lt;/h2&gt;

&lt;p&gt;The simple partial fraction expansion can expand fraction into a sum of simpler fractions. However, ther are many situations where the expansion is not so simple.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;em&gt;Order of numerator polynomial is not less than that of the denominator.&lt;/em&gt;&lt;/strong&gt; Partial fraction expansion can only be performed when the order of the denominator polynomial (the bottom term of the fraction) is greater than the order of the numerator (the top term).  If this condition is not met, we must perform an extra step before continuing with the expansion.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;em&gt;DIstinct Real Roots&lt;/em&gt;&lt;/strong&gt; The problem solved above is described as the case of distinct, real roots. This means that each term only appears once in the denominator, and the root of each term in the denominator is a distinct real number.  In the example above, the roots were at &lt;span  class=&#34;math&#34;&gt;\(0\)&lt;/span&gt;, &lt;span  class=&#34;math&#34;&gt;\(-2\)&lt;/span&gt; and &lt;span  class=&#34;math&#34;&gt;\(-5\)&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;em&gt;Repeated Real Roots&lt;/em&gt;&lt;/strong&gt; Another possibility is a case of repeated roots. For example&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{s+3}{s(s+2)^2(s+5)}\]&lt;/span&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Complex Roots&lt;/em&gt;&lt;/strong&gt; If the denominator cannot be reduced to a product of real roots. For example&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{s+3}{(s+5)(s^2+4s+5)}=\frac{s+3}{(s+5)(s+2+j)(s+2-j)}\]&lt;/span&gt;&lt;/p&gt;

&lt;h4 id=&#34;order-of-numerator-polynomial-is-not-less-than-that-of-the-denominator&#34;&gt;Order of numerator polynomial is not less than that of the denominator&lt;/h4&gt;

&lt;p&gt;We can use long division to eliminate the high-order terms on the numerater.&lt;/p&gt;

&lt;h4 id=&#34;distinct-real-roots&#34;&gt;Distinct Real Roots&lt;/h4&gt;

&lt;p&gt;Like the example done above, In general&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{A_1}{s+a_1}+\frac{A_2}{s+a_2}+\cdot\cdot\cdot+\frac{A_n}{s+a_n}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[A_i=(s+a_i)F(s)|_{s=-a_i}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;When calculation is done by hand, it is easily to use the &amp;quot;cover-up&amp;quot; method.&lt;/p&gt;

&lt;h4 id=&#34;repeated-real-roots&#34;&gt;Repeated Real Roots&lt;/h4&gt;

&lt;p&gt;For example, consider the fraction:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{s+3}{s(s+2)^2(s+5)}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The expansion for this case is:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{A_1}{s}+\frac{A_2}{s+2}+\frac{A_3}{(s+2)^2}+\frac{A_4}{s+5}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;And we can proof the simple method cannot be used since $(s+2)$ appear twice, and we can only get one value by setting &lt;span  class=&#34;math&#34;&gt;\(s=-2\)&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;There are two ways, the most favored by the texbook method uses the relationship&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[A_2=\left[\frac{d}{ds}(s+2)^2F(s)\right]_{s=-2}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;so&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[A_2=\left.\frac{s(s+5)-(s+3)(2s+5)}{(s(s+5))^2}\right|_{s=-2}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;While this method is elegant (and can be extended to multiply repeated roots), the differentiation of the ratio of polynomials is prone to errors.&lt;/p&gt;

&lt;h5 id=&#34;example-cross-multiplication&#34;&gt;Example: Cross Multiplication&lt;/h5&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{s+3}{s(s+2)^2(s+5)}=\frac{A_1}{s}+\frac{A_2}{s+2}+\frac{A_3}{(s+2)^2}+\frac{A_4}{s+5}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[s+3=(s+2)^2(s+5)A_1+s(s+2)(s+5)A_2+s(s+5)A_3+s(s+2^2)A_4\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[s+3=(A_1+A_2+A_4)s^3+(9A_1+7A_2+A_3+4A_4)s^2+(24A_1+10A_2+5A_3+4A_4)s+20A_1 \]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This yields a four-by-four system of equations that can be solved for A1 through A4.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
A_1+A_2+A_4&amp;=0 \cr
9A_1+7A_2+A_3+4A_4 &amp;=0 \cr
24A_1+10A_2+5A_3+4A_4&amp;=1 \cr
20A_1&amp;=3
\end{aligned}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Or, in the matrix form&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{bmatrix}
{1} &amp; {1} &amp; {0} &amp; {1} \cr
{9} &amp; {7} &amp; {1} &amp; {4} \cr
{24} &amp; {10} &amp; {5} &amp; {4} \cr
{20} &amp; {0} &amp; {0} &amp; {0}
\end{bmatrix}\begin{bmatrix}
{A_{1}} \cr
{A_{2}} \cr
{A_{3}} \cr
{A_{4}}
\end{bmatrix}=\begin{bmatrix}
{0} \cr
{0} \cr
{1} \cr
{3}
\end{bmatrix}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;We can combine the cover-up method to get the coefficients that is distinct then use cross multiplication to get the coefficients that corresponds to the repeated roots.&lt;/p&gt;

&lt;h3 id=&#34;complex-roots&#34;&gt;Complex Roots&lt;/h3&gt;

&lt;p&gt;Consider the fraction&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{aligned}
F(s) &amp;=\frac{s+3}{(s+5)\left(s^{2}+4 s+5\right)}=\frac{s+3}{(s+5)(s+2-j)(s+2+j)} \cr
&amp;=\frac{A_{1}}{(s+5)}+\frac{A_{2}}{(s+2-j)}+\frac{A_{3}}{(s+2+j)}
\end{aligned}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;where&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\begin{array}{l}
{A_{1}=(s+5) F(s)|_{s=-5}} \cr
{A_{2}=(s+2-j) F(s)|_{s=-2+j}} \cr
{A_{3}=(s+2+j) F(s)|_{s=-2+j}=A_{2}^{*}}
\end{array}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Another way to expand the fraction without resorting to complex numbers is to perform the expansion as follows.&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[F(s)=\frac{s+3}{(s+5)(s^{2}+4 s+5)}=\frac{A}{s+5}+\frac{B s+C}{s^{2}+4 s+5}\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Note that the numerator of the second term is no longer a constant, but is instead a first order polynomial. Use cross-multiplication to get &lt;span  class=&#34;math&#34;&gt;\(A\ B\ C\)&lt;/span&gt;.&lt;/p&gt;</description>
    </item>
    <item>
      <title>How is Linear Feedback Shift Register(LFSR) used on Cyclic Redundancy Check(CRC)</title>
      <link>https://xiahualiu.github.io/posts/2019-04-25-lfsr-crc/</link>
      <pubDate>Fri, 26 Apr 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-04-25-lfsr-crc/</guid>
      <description>&lt;p&gt;Nowadays, cyclic redundancy check (CRC) is widely used on various fields, including data transmission or data integraty check, e.g UART or CAN bus. For many new hardware beginning learners, CRC appears to be a complexed mathematical blackbox which produces a serial of seemingly gibberish binary numbers. But it indeed is a very reliable mechanics which extracts the feature of the data and simple to understand and implement.&lt;/p&gt;
&lt;p&gt;First I want to introduce a thing to you, that is LFSR, Linear Feedback Shift Register. LFSR circuit looks just like below:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-4-25-LFSR-CRC/lfsr.png&#34; alt=&#34;A 4-bit LFSR&#34;&gt;&lt;/p&gt;
&lt;p&gt;If we put D3 D2 D1 D0 in a row, we can have a 4-bit value and every time when the clock edge occurs, the value is renewed by itself with the feedback channel. If only the g0 and g4 were open, LFSR itself transforms into a normal loop shift register.&lt;/p&gt;
&lt;p&gt;The intersting part is that we can acutally define a division calculation rule to describe this iterative process. I do not really understand how it works but it simply works anyway.&lt;/p&gt;
&lt;p&gt;In the case above, if the last value was $M(x)$ and the new value is $R(x)$. We define the polynomial $M(x)=d_3x^3+d_2x^2+d_1x+d_0$ and $d_3,d_2,d_1,d_0\in{1,0}$, $G(x)=g_4x^4+g_3x^3+g_2x^2+g_1x+g_0$ The $x$ in the polynomial has no value and can be ragarded as a symbol to indicate which $d_x$ digit is. And:&lt;/p&gt;
&lt;p&gt;$$
R(x)=M(x)\mod G(x)
$$&lt;/p&gt;
&lt;p&gt;How can it be divided? Let us put hands on a simple example:&lt;/p&gt;
&lt;p&gt;If the last ${d_3,d_2,d_1,d_0}={1,1,1,1}$ and the feedback gates ${g_4,g_3,g_2,g_1,g_0}={1,1,0,0,1}$. We can get new ${d_3,d_2,d_1,d_0}={1,1,1,0}$ by writing down the signal flow on the paper, and let us use the above rule:&lt;/p&gt;
&lt;p&gt;$$
R(x)=x \times (x^3+x^2+x+1)\mod(x^4+x^3+1)
$$&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-4-25-LFSR-CRC/cal1.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;The rule is simple, we only use the power of $x$ to times the divider and we get a result that has at most $x^3$. The substration procedure is acutally $\oplus$ which is also named XOR. We can now use binary digits to substitute the x. &lt;strong&gt;If you have any academic interest in the algebra part, it is called &lt;em&gt;Galois Field&lt;/em&gt; and we are currently use &lt;em&gt;GF(2)&lt;/em&gt;&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Let us continue on the calculation.&lt;/p&gt;
&lt;p&gt;Now we have $x^2+x+1$, which is ${d_3,d_2,d_1,d_0}={1,1,1,0}$ and the next several states are:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-4-25-LFSR-CRC/cal2.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;And by doing so, we get a serial of numbers that loop in circle which length is $x^4 -1$, the only number did not show is $0000$, you can imagine that $0000$ cannot drive these gates so it will always be $0000$. That serial numbers are tested to be a 4-bit pseudo-random number. the initial value is the seed of the random numbers, so we can use LFSR to create random number sequence very easily.&lt;/p&gt;
&lt;p&gt;But also, the gate values are not used without consideration, the gate polynomial has to be a primitive polynomial which means it cannot be a result of other two polynomials. You can refer to a primitive polynomial table to do so. (Google it, of course there is no link here.)&lt;/p&gt;
&lt;p&gt;But there is a very minutely chance that the modulo is all zeroes for example we make gates ${1,0,1,0}$ and the seed is ${0,1,0,1}$. That is how we do CRC.&lt;/p&gt;
&lt;p&gt;All the calculation illustrated above, we did not have an input, this equals to we input a zero every step. Assumed we have a serial of binary data ${1,0,1,1,0,1,0,0,0,&amp;hellip;}$, the length is 1024, and we push them in a 4-bit LFSR one by one, in the end we can get a modulo shorter than 5 bits. And here comes the tricky part, by adding this modulo to the end of the data (the modulo is acutally CRC data), the data now becomes 1028 bits, and also an exact division of the gate polynomial means eventually the LFSR will output all zeroes if we input this data serial.&lt;/p&gt;
&lt;p&gt;We see that LFSR has a random feature, that means if the data is changed somewhere in the serial, only 1 in 15 chance that we can divide it with LFSR exactly, and this is because we only use 4-bit LFSR, if we use a 32-bit LFSR instead, the error chance becomes extremely little.&lt;/p&gt;
&lt;p&gt;And we can also see that LFSR consumes very little gates and works very fast, we connect it to the shifter register of the transmitter and the receiver, so CRC process can work meanwhile the data is transmitted, so it is widely used in CRC.&lt;/p&gt;</description>
    </item>
    <item>
      <title>From SICP - Understand Event Driven Programming</title>
      <link>https://xiahualiu.github.io/posts/2019-04-04-event-driven/</link>
      <pubDate>Thu, 04 Apr 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-04-04-event-driven/</guid>
      <description>&lt;h1 id=&#34;introduction&#34;&gt;Introduction&lt;/h1&gt;
&lt;p&gt;I am recently working on the wizard book SICP (The Structure and Interpretation of Computer Programs) that was recommended by one of my friends who study computer science. To be honest, the book is not so simple and naive as it was firstly acknowledged as the introduction book of MIT CS major. It abstracts and reveals essential programming philosophy in a easiest way, by the vehicle that known as the programming language Scheme. At first I thought scheme was a painful language for normal programmers because I only used C/C++  language that is of imperative style. However after reading the book and finishing every exercise all the way down, I gradually learned how to maneuver it and really got it on the right way.&lt;/p&gt;
&lt;p&gt;In this post I used scheme as the language to illustrate what is event-driven programming, I once worked on a project that required to implement a simple protocal stack on a chip. However at that time I did not know about the event-driven paradigm so I make the processor to process the message packaging and unpackaging in a queue. In fact it worked pretty well (queue is also used in event-driven programming), however because lack of engineering experience, the whole program turned into a really intricate complex, with so many useless parts scattered everywhere. The whole project is difficult to maintain and debug.&lt;/p&gt;
&lt;p&gt;In Chapter 3, SICP gives a special example in scheme, showing students how to use scheme to implement a small circuit simulator just like verilog. However it did not go into details, just provides a rough sketch. And the codes are in a way that easy for adept programmer to read, not for new programmers like me.&lt;/p&gt;
&lt;p&gt;So I reiterate the code here, and describe the code segments in a human sequence (compared with SICP&#39;s only-god-know sequence).&lt;/p&gt;
&lt;h1 id=&#34;full-overview&#34;&gt;Full Overview&lt;/h1&gt;
&lt;p&gt;First of all, we only implement three basical gates (and or not) as primitives. We can imagine the circuit like the one below: In fact all the digital system can unfold into this three gates. So only 3 primitives is enough.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-4-4-Event-Driven/HA.png&#34; alt=&#34;Fig 1. A Half Adder Circuit&#34;&gt;&lt;/p&gt;
&lt;p&gt;We must know how to we make our program behave like the real circuit. The program must transmit the signal from a node to another node, and changed them according to the gates&amp;rsquo; different input output rules. What&#39;s more, we must know the delay of each gate and make every event happend in the time sequence. We will first go through main event-driven part and ignore the time line.&lt;/p&gt;
&lt;p&gt;The signals carried on circuit wires vary over time, when a signal changes, we know it causes a sequence of follow wires jumpping from 0 to 1 or 1 to 0 due to the logic gates rules. So we must invent a program mechanics to let a logic gate node able to catch a change on their input parameters and change their output, but how?&lt;/p&gt;
&lt;p&gt;The answer is add an extra intermedia to hold a state, and let it trigger the event. In this article, the &lt;strong&gt;wire&lt;/strong&gt; object takes this duty, we define wire as below:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; wire) (&lt;span style=&#34;color:#a6e22e&#34;&gt;wire&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;get-signal&lt;/span&gt;))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-signal!&lt;/span&gt; wire new-value)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;wire&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;set-signal!&lt;/span&gt;) new-value))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; wire action-procedure)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;wire&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;add-action!&lt;/span&gt;) action-procedure))

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;make-wire&lt;/span&gt;)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;signal-value&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) (&lt;span style=&#34;color:#a6e22e&#34;&gt;action-procedures&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;()))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-my-signal!&lt;/span&gt; new-value)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(not (= signal-value new-value))
          (&lt;span style=&#34;color:#66d9ef&#34;&gt;begin &lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;set! &lt;/span&gt;signal-value new-value)
                 (&lt;span style=&#34;color:#a6e22e&#34;&gt;call-each&lt;/span&gt; action-procedures))
          &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;not-changed&lt;/span&gt;))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;accept-action-procedure!&lt;/span&gt; proc)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;set! &lt;/span&gt;action-procedures
            (cons proc action-procedures))
      (&lt;span style=&#34;color:#a6e22e&#34;&gt;proc&lt;/span&gt;))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;dispatch&lt;/span&gt; m)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;get-signal&lt;/span&gt;) signal-value)
            ((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;set-signal!&lt;/span&gt;) set-my-signal!)
            ((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;add-action!&lt;/span&gt;) accept-action-procedure!)
            (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Unknown operation on wires&amp;#34;&lt;/span&gt;))))
    dispatch))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can see that the wire holds a local variable &lt;code&gt;signal-value&lt;/code&gt; and a procedure list &lt;code&gt;action-procedures&lt;/code&gt;. Wire has three interfaces to interact with other part of the program. The interesting part is the &lt;code&gt;set-my-signal!&lt;/code&gt; call, which does not simply change the signal value, but also triggeres the procedures in the list.&lt;/p&gt;
&lt;p&gt;So think when the state of a wire is changed, it will call the procedure (these procedures are stored internal but defined as global) to change the state of adjacent wires, by calling their &lt;code&gt;set-signal!&lt;/code&gt; calls, and &lt;code&gt;set-signal!&lt;/code&gt; is defined in a particular way that tiggeres internal-stored procedures which affect the next wires and there becomes a chain reaction till processor reaches the output wires where no procedures are stored, all the wires are refreshed.&lt;/p&gt;
&lt;p&gt;What are the procedures in the list? They are called when the value changes, in this case, they are logic gates. We must define these procedures in a way the connected wires are bound together, because we cannot bind them inside the wire object due to local environment rules. We want to change the connected wires states when called, it is important to construct the procedure environment enclosed in global environment and only in this way the wires state can be changed when internal precedures are called.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;call-each&lt;/code&gt; calls these procedures, which are defined as global procedures (very important) and have no arguments.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;call-each&lt;/span&gt; procedures)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(null? procedures)
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;done&lt;/span&gt;
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;begin &lt;/span&gt;((car procedures))
             (&lt;span style=&#34;color:#a6e22e&#34;&gt;call-each&lt;/span&gt; (cdr procedures)))))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;logic-gates&#34;&gt;Logic Gates&lt;/h1&gt;
&lt;p&gt;The three logic gates are defined below:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;inverter&lt;/span&gt; input output)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;invert-input&lt;/span&gt;)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;new-value&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;logical-not&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; input))))
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-signal!&lt;/span&gt; output new-value)))
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; input invert-input) &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ok&lt;/span&gt;)

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;logical-not&lt;/span&gt; s)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((= s &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        ((= s &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
        (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Invalid signal&amp;#34;&lt;/span&gt; s))))

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;and-gate&lt;/span&gt; input1 input2 output)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;and-input&lt;/span&gt;)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;new-value&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;logical-and&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; input1) (&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; input2))))
      (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-signal!&lt;/span&gt; output new-value)))
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; input1 and-input)
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; input2 and-input) &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ok&lt;/span&gt;)

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;logical-and&lt;/span&gt; s1 s2)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((= (* s1 s2) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        ((&lt;span style=&#34;color:#66d9ef&#34;&gt;or &lt;/span&gt;(= (+ s1 s2) &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) (= (+ s1 s2) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)) &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
        (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Invalid signal&amp;#34;&lt;/span&gt; s1 s2))))

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;or-gate&lt;/span&gt; input1 input2 output)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;or-input&lt;/span&gt;)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;new-value&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;logical-or&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; input1) (&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; input2))))
      (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-signal!&lt;/span&gt; output new-value)))
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; input1 or-input)
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; input2 or-input) &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ok&lt;/span&gt;)

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;logical-or&lt;/span&gt; s1 s2)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((&lt;span style=&#34;color:#66d9ef&#34;&gt;and &lt;/span&gt;(= s1 &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) (= s2 &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        ((&lt;span style=&#34;color:#66d9ef&#34;&gt;and &lt;/span&gt;(= s2 &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) (= s1 &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        ((&lt;span style=&#34;color:#66d9ef&#34;&gt;and &lt;/span&gt;(= s1 &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) (= s2 &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)) &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        ((&lt;span style=&#34;color:#66d9ef&#34;&gt;and &lt;/span&gt;(= s1 &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) (= s2 &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)) &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
        (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Invalid Signal&amp;#34;&lt;/span&gt; s1 s2))))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;These gates themselves are like injectors, they create the procedures and injected them into the input wires.&lt;/p&gt;
&lt;h1 id=&#34;probes&#34;&gt;Probes&lt;/h1&gt;
&lt;p&gt;We just finished the gates and the wires, and the simulation is ready to go, but we need a probe on the wires to tell us the change happended to what wire and from what state to another state.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;probe&lt;/span&gt; name wire)
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-action!&lt;/span&gt; wire
               (&lt;span style=&#34;color:#66d9ef&#34;&gt;lambda &lt;/span&gt;()
                 (display name) (display &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;)
                 (display &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; New-value = &amp;#34;&lt;/span&gt;)
                 (display (&lt;span style=&#34;color:#a6e22e&#34;&gt;get-signal&lt;/span&gt; wire))
                 (&lt;span style=&#34;color:#a6e22e&#34;&gt;newline&lt;/span&gt;))))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;go&#34;&gt;Go!&lt;/h1&gt;
&lt;p&gt;Using the gate primitives defined above, we can implement the &lt;code&gt;half-adder&lt;/code&gt; in picture above:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;half-adder&lt;/span&gt; A B S C)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;D (&lt;span style=&#34;color:#a6e22e&#34;&gt;make-wire&lt;/span&gt;))
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;E (&lt;span style=&#34;color:#a6e22e&#34;&gt;make-wire&lt;/span&gt;))
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;and-gate&lt;/span&gt; A B C)
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;or-gate&lt;/span&gt; A B D)
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;inverter&lt;/span&gt; C E)
  (&lt;span style=&#34;color:#a6e22e&#34;&gt;and-gate&lt;/span&gt; D E S))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I use DrRacket and SCM to test the program, here is the result of DrRacket:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-racket&#34; data-lang=&#34;racket&#34;&gt;&amp;gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;define&lt;/span&gt; in1 (make-wire))
&amp;gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;define&lt;/span&gt; in2 (make-wire))
&amp;gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;define&lt;/span&gt; out1 (make-wire))
&amp;gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;define&lt;/span&gt; cout1 (make-wire))
&amp;gt; (probe &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;in1&lt;/span&gt; in1)
in1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&amp;gt; (probe &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;in2&lt;/span&gt; in2)
in2  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&amp;gt; (probe &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;out1&lt;/span&gt; out1)
out1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&amp;gt; (probe &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;cout1&lt;/span&gt; cout1)
cout1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&amp;gt; (half-adder in1 in2 out1 cout1)
&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ok&lt;/span&gt;
&amp;gt; (set-signal! in1 &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
out1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
in1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;done&lt;/span&gt;
&amp;gt; (set-signal! in2 &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
out1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
cout1  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
in2  New-value = &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;done&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;time-line&#34;&gt;Time Line&lt;/h1&gt;
&lt;p&gt;We finished the event-driven part. Now I believe you have a basical idea of the program architecture. Now move to another question, the difficulty raised, if we add a delay to all the gates, and want to see both state and time line of the change, how to make it?&lt;/p&gt;
&lt;p&gt;We need to import a new concept into our program, a time queue. By this case, it is &lt;strong&gt;The Agenda&lt;/strong&gt;.&lt;/p&gt;
&lt;h2 id=&#34;the-agenda&#34;&gt;The Agenda&lt;/h2&gt;
&lt;p&gt;The agenda is actually a queue, every element in this queue contains a time stamp and the task.&lt;/p&gt;
&lt;p&gt;We can easily wrote down queue structure in scheme:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;;;;This file shows how to present queue in scheme (message-passing style)&lt;/span&gt;

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;nil &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#39;&lt;/span&gt;())

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-queue?&lt;/span&gt; queue)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;queue&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;empty&lt;/span&gt;)))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;front-queue&lt;/span&gt; queue)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;queue&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;front&lt;/span&gt;)))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;insert-queue!&lt;/span&gt; queue item)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;queue&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;insert&lt;/span&gt;) item))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;delete-queue!&lt;/span&gt; queue)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;queue&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;delete&lt;/span&gt;)))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;print-queue&lt;/span&gt; queue)
  ((&lt;span style=&#34;color:#a6e22e&#34;&gt;queue&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;print&lt;/span&gt;)))

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;make-queue&lt;/span&gt;)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;front-ptr&lt;/span&gt; nil)
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;rear-ptr&lt;/span&gt; nil))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-queue?&lt;/span&gt;)
      (eq? front-ptr nil))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;front-queue&lt;/span&gt;)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-queue?&lt;/span&gt;)
          (&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ERROR front-queue called with an empty queue&amp;#34;&lt;/span&gt;)
          (car front-ptr)))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-front-ptr!&lt;/span&gt; pair)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;set! &lt;/span&gt;front-ptr pair))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-rear-ptr!&lt;/span&gt; pair)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;set! &lt;/span&gt;rear-ptr pair))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;insert-queue!&lt;/span&gt; item)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-queue?&lt;/span&gt;)
             (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-front-ptr!&lt;/span&gt; (cons item nil))
             (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-rear-ptr!&lt;/span&gt; front-ptr)
             front-ptr)
            (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(set-cdr! rear-ptr (cons item nil))
                  (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-rear-ptr!&lt;/span&gt; (cdr rear-ptr))
                  front-ptr)))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;delete-queue!&lt;/span&gt;)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-queue?&lt;/span&gt;)
             (&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ERROR delete-queue called with an empty queue&amp;#34;&lt;/span&gt;))
            (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-front-ptr!&lt;/span&gt; (cdr front-ptr))
                  front-ptr)))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;print-queue&lt;/span&gt;)
      front-ptr)

    (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;dispatch&lt;/span&gt; m)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;cond &lt;/span&gt;((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;empty&lt;/span&gt;) empty-queue?)
            ((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;front&lt;/span&gt;) front-queue)
            ((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;insert&lt;/span&gt;) insert-queue!)
            ((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;delete&lt;/span&gt;) delete-queue!)
            ((eq? m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;print&lt;/span&gt;) print-queue)
            (&lt;span style=&#34;color:#66d9ef&#34;&gt;else &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Unknown queue operation&amp;#34;&lt;/span&gt;))))
    dispatch))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;implementing-the-agenda&#34;&gt;Implementing the agenda&lt;/h3&gt;
&lt;p&gt;Agenda is a list of &lt;em&gt;time segments&lt;/em&gt;. Each time segment is a pair of time and a queue (holds the procedures to be run at that time).&lt;/p&gt;
&lt;p&gt;Recall the signal process of each node, nodes are registered with events, we can insert a small piece of code in each event to push a &lt;em&gt;time segment&lt;/em&gt; behind the agenda queue, so after all events terminate, by checking the agenda we know when these changes happends.&lt;/p&gt;
&lt;p&gt;The problem is when we implement the agenda, we only know the delay of gates. Apropos the delay sequence and the exact time of each event, we have to accumulate the former delays and this elicits a formal problem that we have to maintain a current time variable, and &lt;code&gt;set!&lt;/code&gt; it every time when we push a time segment in the agenda structure.&lt;/p&gt;
&lt;p&gt;First we implememt the agenda structure:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;make-agenda&lt;/span&gt;) (list &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;current-time&lt;/span&gt; agenda) (car agenda))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-current-time!&lt;/span&gt; agenda time)
(set-car! agenda time))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;segments&lt;/span&gt; agenda) (cdr agenda))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;set-segments!&lt;/span&gt; agenda segments)
(set-cdr! agenda segments))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;first-segment&lt;/span&gt; agenda) (car (&lt;span style=&#34;color:#a6e22e&#34;&gt;segments&lt;/span&gt; agenda)))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rest-segments&lt;/span&gt; agenda) (cdr (&lt;span style=&#34;color:#a6e22e&#34;&gt;segments&lt;/span&gt; agenda)))
(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-agenda?&lt;/span&gt; agenda)
  (null? (&lt;span style=&#34;color:#a6e22e&#34;&gt;segments&lt;/span&gt; agenda)))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To add an action to an agenda, we first check if the agenda is empty. If so, we create a time segment for the action and install this in the agenda. Otherwise, we scan the agenda, examining the time of each segment. If we find a segment for our appointed time, we add the action to the associated queue. If we reach a time later than the one to which we are
appointed, we insert a new time segment into the agenda just before it. If we reach the end of the agenda, we must ceate a new time segment at the end.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;add-to-agenda!&lt;/span&gt; time action agenda)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;belongs-before?&lt;/span&gt; segments)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;or &lt;/span&gt;(null? segments)
        (&amp;lt; time (&lt;span style=&#34;color:#a6e22e&#34;&gt;segment-time&lt;/span&gt; (car segments)))))
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;make-new-time-segment&lt;/span&gt; time action)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;q&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;make-queue&lt;/span&gt;)))
      (&lt;span style=&#34;color:#a6e22e&#34;&gt;insert-queue!&lt;/span&gt; q action)
      (&lt;span style=&#34;color:#a6e22e&#34;&gt;make-time-segment&lt;/span&gt; time q)))
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;add-to-segments!&lt;/span&gt; segments)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(= (&lt;span style=&#34;color:#a6e22e&#34;&gt;segment-time&lt;/span&gt; (car segments)) time)
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;insert-queue!&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;segment-queue&lt;/span&gt; (car segments))
                       action)
        (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;rest&lt;/span&gt; (cdr segments)))
          (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;belongs-before?&lt;/span&gt; rest)
              (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-cdr!&lt;/span&gt;
               segments
               (cons (&lt;span style=&#34;color:#a6e22e&#34;&gt;make-new-time-segment&lt;/span&gt; time action)
                     (cdr segments)))
              (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-to-segments!&lt;/span&gt; rest)))))
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;segments&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;segments&lt;/span&gt; agenda)))
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;belongs-before?&lt;/span&gt; segments)
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-segments!&lt;/span&gt;
         agenda
         (cons (&lt;span style=&#34;color:#a6e22e&#34;&gt;make-new-time-segment&lt;/span&gt; time action)
               segments))
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;add-to-segments!&lt;/span&gt; segments))))

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;remove-first-agenda-item!&lt;/span&gt; agenda)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;q&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;segment-queue&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;first-segment&lt;/span&gt; agenda))))
    (&lt;span style=&#34;color:#a6e22e&#34;&gt;delete-queue!&lt;/span&gt; q)
    (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-queue?&lt;/span&gt; q)
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-segments!&lt;/span&gt; agenda (&lt;span style=&#34;color:#a6e22e&#34;&gt;rest-segments&lt;/span&gt; agenda)))))

(&lt;span style=&#34;color:#66d9ef&#34;&gt;define &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;first-agenda-item&lt;/span&gt; agenda)
  (&lt;span style=&#34;color:#66d9ef&#34;&gt;if &lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;empty-agenda?&lt;/span&gt; agenda)
      (&lt;span style=&#34;color:#a6e22e&#34;&gt;error&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Agenda is empty: FIRST-AGENDA-ITEM&amp;#34;&lt;/span&gt;)
      (&lt;span style=&#34;color:#66d9ef&#34;&gt;let &lt;/span&gt;((&lt;span style=&#34;color:#a6e22e&#34;&gt;first-seg&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;first-segment&lt;/span&gt; agenda)))
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;set-current-time!&lt;/span&gt; agenda
                           (&lt;span style=&#34;color:#a6e22e&#34;&gt;segment-time&lt;/span&gt; first-seg))
        (&lt;span style=&#34;color:#a6e22e&#34;&gt;front-queue&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;segment-queue&lt;/span&gt; first-seg)))))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    <item>
      <title>JOS Lab1 My Answers</title>
      <link>https://xiahualiu.github.io/posts/2019-02-23-jos-lab1/</link>
      <pubDate>Sat, 23 Feb 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-02-23-jos-lab1/</guid>
      <description>&lt;p&gt;The &lt;a href=&#34;https://pdos.csail.mit.edu/6.828/2018/labs/lab1/&#34;&gt;xv6 lab1&lt;/a&gt; provides a extern kernel named JOS, it works in the same way as xv6. So student can step in it to explore the world of xv6.&lt;/p&gt;
&lt;h1 id=&#34;part-2-the-boot-loader&#34;&gt;Part 2: The Boot Loader&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;At what point does the processor start executing 32-bit code? What exactly causes the switch from 16- to 32-bit mode?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: After opening A20 Gate and loading GDT table that is prepared in &lt;code&gt;boot.S&lt;/code&gt;, we enable protected mode by moving a value with &lt;code&gt;$CR0_PE_ON&lt;/code&gt; bit to &lt;code&gt;CR0&lt;/code&gt; register. But the exact activation event happens during &lt;code&gt;ljmp&lt;/code&gt; instruction, while &lt;code&gt;CS&lt;/code&gt; and &lt;code&gt;IP&lt;/code&gt; registers both update and point to the beginning of 32-bit code (which is, however, at the next memory address). CPU works in 32-bit mode after that.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;What is the last instruction of the boot loader executed, and what is the first instruction of the kernel it just loaded?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: The boot loader reads kernel in elf file format from disk, then copies each section into the corresponding location in memory. The last job of bootloader is calling the entry address of the kernel &lt;code&gt;*0x10018&lt;/code&gt;(the entry address is stored at the fixed address in memory because its fixed offset in elf file and is &lt;code&gt;0x0010000c&lt;/code&gt; in this case), transferring control to kernel. And the first instruction is: &lt;code&gt;movw $0x1234,0x472&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Where is the first instruction of the kernel?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: Said above, at &lt;code&gt;0x10000c&lt;/code&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;How does the boot loader decide how many sectors it must read in order to fetch the entire kernel from disk? Where does it find this information?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: The boot loader first reads elf header to get the starting address of program header table &lt;code&gt;ph=ELFHDR + ELFHDR-&amp;gt;e_phoff&lt;/code&gt;, then reads the number of entries in the program header table by &lt;code&gt;ELFHDR-&amp;gt;e_phnum&lt;/code&gt;, then adds it to &lt;code&gt;ph&lt;/code&gt; to acquire the end of the program header table &lt;code&gt;eph&lt;/code&gt;, then loops reading each segment.&lt;/p&gt;
&lt;h2 id=&#34;exercise-5&#34;&gt;Exercise 5&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Trace through the first few instructions of the boot loader again and identify the first instruction that would &amp;ldquo;break&amp;rdquo; or otherwise do the wrong thing if you were to get the boot loader&#39;s link address wrong. Then change the link address in boot/Makefrag to something wrong, run &lt;code&gt;make clean&lt;/code&gt;, recompile the lab with &lt;code&gt;make&lt;/code&gt;, and trace into the boot loader again to see what happens. Don&#39;t forget to change the link address back and &lt;code&gt;make clean&lt;/code&gt; again afterward!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: The boot loader&#39;s entry is at &lt;code&gt;0x7c00&lt;/code&gt; if it is changed to &lt;code&gt;0x7c01&lt;/code&gt; or else that are not aligned right, some &lt;code&gt;nop&lt;/code&gt; will be inserted at the top to slide processor to the aligned instructions.&lt;/p&gt;
&lt;p&gt;After that, the code is executed normally, however, when it comes to the first &lt;code&gt;ljmp&lt;/code&gt;, it crashes immediately. But the real problem happened way ahead, the crash is due to a loading GDT table failure (&lt;code&gt;lgdt&lt;/code&gt; did not complain).&lt;/p&gt;
&lt;p&gt;As we know, we changed the linker address however the load address of our program stays unchanged. The BIOS works blindly, it just reads 1st sector on disk (no matter what link address is) then jumps to &lt;code&gt;0x7c00&lt;/code&gt;. Thus the actual GDT table has still been put at the old place (GDT is always put at &lt;code&gt;0x7c4c&lt;/code&gt; in xv6 case), but into the bootloader, the &lt;code&gt;lgdt&lt;/code&gt; only accepts linker address, which is wrong. So what &lt;code&gt;lgdt&lt;/code&gt; actually installed was meaningless trash in memory after the modification.&lt;/p&gt;
&lt;p&gt;So when the &lt;code&gt;ljmp&lt;/code&gt; reads GDT, it gets trash value instead of real GDT entries. Then the program crashes.&lt;/p&gt;
&lt;h2 id=&#34;exercise-6&#34;&gt;Exercise 6&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;We can examine memory using GDB&#39;s &lt;code&gt;x&lt;/code&gt; command. The GDB manual has full details, but for now, it is enough to know that the command &lt;code&gt;x/Nx ADDR&lt;/code&gt; prints N words of memory at ADDR. (Note that both &lt;code&gt;x&lt;/code&gt;s in the command are lowercase.) Warning: The size of a word is not a universal standard. In GNU assembly, a word is two bytes (the &lt;code&gt;w&lt;/code&gt; in xorw, which stands for word, means 2 bytes).
Reset the machine (exit QEMU/GDB and start them again). Examine the 8 words of memory at &lt;code&gt;0x00100000&lt;/code&gt; at the point the BIOS enters the boot loader, and then again at the point the boot loader enters the kernel. Why are they different? What is there at the second breakpoints? (You do not really need to use QEMU to answer this question. Just think.)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: During the time from the CPU changed into protected mode and to the bootloader starts, &lt;code&gt;0x100000&lt;/code&gt; and higher addresses are of full zeroes.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;The reason is simple, we haven&#39;t mapped the kernel into memory yet at that time.&lt;/p&gt;
&lt;h1 id=&#34;part-3-kernel&#34;&gt;Part 3: Kernel&lt;/h1&gt;
&lt;h2 id=&#34;exercise-7&#34;&gt;Exercise 7&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Use QEMU and GDB to trace into the JOS kernel and stop at the movl %eax, %cr0. Examine memory at 0x00100000 and at 0xf0100000. Now, single step over that instruction using the stepi GDB command. Again, examine memory at 0x00100000 and at 0xf0100000. Make sure you understand what just happened.
What is the first instruction after the new mapping is established that would fail to work properly if the mapping weren&#39;t in place? Comment out the movl %eax, %cr0 in kern/entry.S, trace into it, and see if you were right.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: After &lt;code&gt;movl %eax %cr0&lt;/code&gt;, Memory at &lt;code&gt;0x0010000&lt;/code&gt; was copied to &lt;code&gt;0xf010000&lt;/code&gt;. But the real fact is that these pages are mapped to the same physical memory page.&lt;/p&gt;
&lt;p&gt;If the mapping failed, the jump up to the &lt;code&gt;KERNBASE&lt;/code&gt; would definitely fail.&lt;/p&gt;
&lt;p&gt;We can see that in picture. The program jumped to a null memory, then crashed.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;exercise-8&#34;&gt;Exercise 8&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;We have omitted a small fragment of code - the code necessary to print octal numbers using patterns of the form &amp;ldquo;%o&amp;rdquo;. Find and fill in this code fragment.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: Original file:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;...

&lt;span style=&#34;color:#75715e&#34;&gt;// (unsigned) octal
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
    &lt;span style=&#34;color:#75715e&#34;&gt;// Replace this with your code.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        putch(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;X&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;, putdat);
        putch(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;X&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;, putdat);
        putch(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;X&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;, putdat);
        &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;

...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;New file:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;...

&lt;span style=&#34;color:#75715e&#34;&gt;// (unsigned) octal
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
    &lt;span style=&#34;color:#75715e&#34;&gt;// My code
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        num &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; getuint(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;ap,lflag);
        base &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;goto&lt;/span&gt; number;

...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Be able to answer the following questions:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;Explain the interface between &lt;code&gt;printf.c&lt;/code&gt; and &lt;code&gt;console.c&lt;/code&gt;. Specifically, what function does &lt;code&gt;console.c&lt;/code&gt; export? How is this function used by printf.c?
&lt;strong&gt;Answer&lt;/strong&gt;: &lt;code&gt;console.c&lt;/code&gt; exports high-level I/O by providing three functions, &lt;code&gt;cputchar&lt;/code&gt; &lt;code&gt;getchar&lt;/code&gt; &lt;code&gt;iscons&lt;/code&gt;.
The &lt;code&gt;cputchar&lt;/code&gt; function is used for &lt;code&gt;printf.c&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;Explain the following from &lt;code&gt;console.c&lt;/code&gt;:&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (crt_pos &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CRT_SIZE) {
    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i;
    memmove(crt_buf, crt_buf &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; CRT_COLS, (CRT_SIZE &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; CRT_COLS) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(uint16_t));
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CRT_SIZE &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; CRT_COLS; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; CRT_SIZE; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
        crt_buf[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0700&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;;
    crt_pos &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CRT_COLS;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Prevent screen buffer overflow
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (crt_pos &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CRT_SIZE) {
    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i;
    &lt;span style=&#34;color:#75715e&#34;&gt;// Move all CRT content a column up, vacating the bottom column
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    memmove(crt_buf, crt_buf &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; CRT_COLS, (CRT_SIZE &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; CRT_COLS) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(uint16_t));
    &lt;span style=&#34;color:#75715e&#34;&gt;// Loop printing the bottom line with print attribute: &amp;#39;white on black&amp;#39;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CRT_SIZE &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; CRT_COLS; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; CRT_SIZE; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
        crt_buf[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0700&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;;
    crt_pos &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; CRT_COLS;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;For the following questions you might wish to consult the notes for Lecture 2. These notes cover GCC&#39;s calling convention on the x86.
Trace the execution of the following code step-by-step:&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;In the call to cprintf(), to what does &lt;code&gt;fmt&lt;/code&gt; point? To what does &lt;code&gt;ap&lt;/code&gt; point?&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, z &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;;
cprintf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;x %d, y %x, z %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, x, y, z);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;I add this code in &lt;code&gt;init.c&lt;/code&gt;, right after the first &lt;code&gt;cprintf&lt;/code&gt;, seen below:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;i386_init&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
	&lt;span style=&#34;color:#66d9ef&#34;&gt;extern&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; edata[], end[];

	&lt;span style=&#34;color:#75715e&#34;&gt;// Before doing anything else, complete the ELF loading process.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Clear the uninitialized global data (BSS) section of our program.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// This ensures that all static/global variables start out zero.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	memset(edata, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, end &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; edata);

	&lt;span style=&#34;color:#75715e&#34;&gt;// Initialize the console.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Can&amp;#39;t call cprintf until after we do this!
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	cons_init();

	cprintf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;6828 decimal is %o octal!&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;6828&lt;/span&gt;);

	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, z &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;;
	cprintf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;x %d, y %x, z %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, x, y, z);

	&lt;span style=&#34;color:#75715e&#34;&gt;// Test the stack backtrace function (lab 1 only)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	test_backtrace(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;);

	&lt;span style=&#34;color:#75715e&#34;&gt;// Drop into the kernel monitor.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
		monitor(NULL);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;fmt&lt;/code&gt; points to a memory that is in &lt;code&gt;.rodata&lt;/code&gt; section. And the content is the format string &lt;code&gt;x %d, y %x, z %d\n\0&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;I disassembled the kernel and found out that &lt;code&gt;ap&lt;/code&gt; pointed to the args that had been pushed to stack before calling &lt;code&gt;vcprintf&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;+-------------+
| 00 00 00 04 |
+-------------+
| 00 00 00 03 |
+-------------+
| 00 00 00 01 |
+-------------+ &amp;lt;--- ap
| f0 10 1a 92 |
+-------------+ &amp;lt;--- fmt
| f0 10 00 fa |
+-------------+ 
|             |
+-------------+
|             | 
     STACK
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;List (in order of execution) each call to &lt;code&gt;cons_putc&lt;/code&gt;, &lt;code&gt;va_arg&lt;/code&gt;, and &lt;code&gt;vcprintf&lt;/code&gt;. For &lt;code&gt;cons_putc&lt;/code&gt;, list its argument as well. For &lt;code&gt;va_arg&lt;/code&gt;, list what &lt;code&gt;ap&lt;/code&gt; points to before and after the call. For &lt;code&gt;vcprintf&lt;/code&gt; list the values of its two arguments.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: List: After print &amp;ldquo;x &amp;ldquo;, &lt;code&gt;getint&lt;/code&gt; was called, in which &lt;code&gt;va_arg&lt;/code&gt; was called. Before the calling &lt;code&gt;ap = (va_list) 0xf010ffd4 &amp;quot;\001&amp;quot;&lt;/code&gt;, after the calling &lt;code&gt;ap = (va_list) 0xf010ffd8 &amp;quot;\003&amp;quot;&lt;/code&gt;. Then &lt;code&gt;cons_putc(c=49)&lt;/code&gt; was called, output changed to &amp;ldquo;x 1&amp;rdquo;. Then &lt;code&gt;cons_putc(c=44)&lt;/code&gt; was called, output changed to &amp;ldquo;x 1,&amp;quot;. Then &lt;code&gt;cons_putc(c=32)&lt;/code&gt; was called, output changed to &amp;ldquo;x 1, &amp;ldquo;. Then &lt;code&gt;cons_putc(c=121)&lt;/code&gt; was called, output changed to &amp;ldquo;x 1, y&amp;rdquo;&amp;hellip; It worked in this sequence till finishing printing.&lt;/p&gt;
&lt;p&gt;For two arguments of &lt;code&gt;vcprintf&lt;/code&gt; see picture above.&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;Run the following code.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00646c72&lt;/span&gt;;
    cprintf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;H%x Wo%s&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;57616&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;i);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;What is the output? Explain how this output is arrived at in the step-by-step manner of the previous exercise.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Output&lt;/strong&gt;: He110 World!&lt;/p&gt;
&lt;p&gt;Decimal 57616 equals hexadecimal number 0xe110, so the first number was &amp;ldquo;e110&amp;rdquo;. And because i386 use little-endian, &lt;code&gt;0x00646c7c&lt;/code&gt; in little-endian byte order was&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xf010ffec&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x72&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x6c&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x64&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can translate it into string: &lt;code&gt;rld/0&lt;/code&gt;&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;In the following code, what is going to be printed after &amp;lsquo;y=&amp;rsquo;? (note: the answer is not a specific value.) Why does this happen?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;    cprintf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;x=%d y=%d&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Because we use &lt;code&gt;va_list&lt;/code&gt; pointer &lt;code&gt;ap&lt;/code&gt; to run down stack to acquire args that were pushed beforehand in the order from right to left in &lt;code&gt;cprintf&lt;/code&gt;. When &amp;lsquo;3&amp;rsquo; was read by &lt;code&gt;getint&lt;/code&gt; function, &lt;code&gt;va_arg&lt;/code&gt; moves pointer &lt;code&gt;ap&lt;/code&gt; upwards for the next arg, whereas we do not have another arg, instead it is an &lt;code&gt;ret&lt;/code&gt; address for &lt;code&gt;call &amp;lt;i386_init&amp;gt;&lt;/code&gt;, so the next &lt;code&gt;%d&lt;/code&gt; prints an address value.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;+-------------+
| 00 00 00 00 |
+-------------+
| f0 10 ff ec |
+-------------+ &amp;lt;--- ap (y=0xf010ffec)
| 00 00 00 03 |
+-------------+ &amp;lt;--- ap (x=3)
| f0 10 1a ce |
+-------------+ &amp;lt;--- fmt
| f0 10 01 2a |
+-------------+
|             | 
     STACK
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;To confirm my speculation, I replaced the second &lt;code&gt;y=%d&lt;/code&gt; with &lt;code&gt;y=%x&lt;/code&gt;, and here it goes:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;p&gt;Just like above.&lt;/p&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;Let&#39;s say that GCC changed its calling convention so that it pushed arguments on the stack in declaration order, so that the last argument is pushed last. How would you have to change cprintf or its interface so that it would still be possible to pass it a variable number of arguments?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: We can make &lt;code&gt;va_list&lt;/code&gt; pointer &lt;code&gt;ap&lt;/code&gt; points to the highest arg on stack before entering &lt;code&gt;vcprintf&lt;/code&gt;, then modify &lt;code&gt;va_arg&lt;/code&gt; to decrease &lt;code&gt;ap&lt;/code&gt; instead of increase it.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Challenge&lt;/strong&gt; Enhance the console to allow text to be printed in different colors. The traditional way to do this is to make it interpret ANSI escape sequences embedded in the text strings printed to the console, but you may use any mechanism you like. There is plenty of information on the 6.828 reference page and elsewhere on the web on programming the VGA display hardware. If you&#39;re feeling really adventurous, you could try switching the VGA hardware into a graphics mode and making the console draw text onto the graphical frame buffer.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: &lt;em&gt;Too complex, to be solved.&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;the-stack&#34;&gt;The Stack&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Exercise 9&lt;/strong&gt;. Determine where the kernel initializes its stack, and exactly where in memory its stack is located. How does the kernel reserve space for its stack? And at which &amp;ldquo;end&amp;rdquo; of this reserved area is the stack pointer initialized to point to?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: In file &amp;ldquo;entry.S&amp;rdquo;,&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86_asm&#34; data-lang=&#34;x86_asm&#34;&gt;	# Set the stack pointer
	movl	$(bootstacktop),%esp
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;$(bootstacktop)&lt;/code&gt; is defined the end of &amp;ldquo;entry.S&amp;rdquo;, it is &lt;code&gt;KSTKSIZE&lt;/code&gt; away from the beginning of &lt;code&gt;.data&lt;/code&gt; section.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86_asm&#34; data-lang=&#34;x86_asm&#34;&gt;.data
###################################################################
# boot stack
###################################################################
	.p2align	PGSHIFT		# force page alignment
	.globl		bootstack
bootstack:
	.space		KSTKSIZE
	.globl		bootstacktop   
bootstacktop:
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Exercise 10&lt;/strong&gt;. To become familiar with the C calling conventions on the x86, find the address of the test_backtrace function in obj/kern/kernel.asm, set a breakpoint there, and examine what happens each time it gets called after the kernel starts. How many 32-bit words does each recursive nesting level of test_backtrace push on the stack, and what are those words?
Note that, for this exercise to work properly, you should be using the patched version of QEMU available on the tools page or on Athena. Otherwise, you&#39;ll have to manually translate all breakpoint and memory addresses to linear addresses.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Answer&lt;/strong&gt;: Every level of nesting, push 8 words on stack.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2019-2-23-JOS-lab1/9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>xv6 Basics - Page Tables</title>
      <link>https://xiahualiu.github.io/posts/2019-02-06-xv6-paging-table/</link>
      <pubDate>Wed, 06 Feb 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-02-06-xv6-paging-table/</guid>
      <description>&lt;p&gt;&lt;strong&gt;Paging tables are the mechanism through which the operating system controls what memory address means.&lt;/strong&gt; They allow xv6 to multiplex the address spaces of different processes onto a single physical memory, and to protect the memories of different processes. The level of indirection provided by page tables allows many neat tricks. xv6 uses page tables primarily to multiplex address spaces and to protect memory.&lt;/p&gt;
&lt;p&gt;It also uses a few simple page-table tricks:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Mapping the same memory (the kernel) in several address spaces.&lt;/li&gt;
&lt;li&gt;Mapping the same memory more than once in one address space. (Each user page is also mapped into the kernel&#39;s physical view of memory)&lt;/li&gt;
&lt;li&gt;Guarding a user stack with an ummapped page.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;paging-hardware&#34;&gt;Paging hardware&lt;/h1&gt;
&lt;p&gt;As a reminder, x86 instructions (both user and kernel) manipulate virtual addresses. The mechine&#39;s RAM, or physical memory, is indexed with physical addresses.&lt;/p&gt;
&lt;p&gt;The x86 page table hardware connects these two kinds of addresses, by mapping each virtual address to a physical address.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;   10      10          12          |     PPN     | Offset |  
|-------|---------|----------|            ^
|  Dir  |  Table  |  Offset  |        20  |          12
|-------|----|----|----------|     |------|------|-------|
    |        |--------------------&amp;gt;|     PPN     | Flags |
    |                              |-------------|-------|
    |         20       10          |             |       |
    |     |---------|-------|      |-------------|-------|
    |     |         |       |      |             |       |
    |     |---------|-------|      |-------------|-------|
    |----&amp;gt;|   PPN   | Flags |-------&amp;gt;     Page Table
          |---------|-------|         2^10(1024) entries
          |         |       |              (PTEs)
          |---------|-------|
 |CR3|---&amp;gt;   Page Directory
           2^10(1024) entries
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;According to CSAPP, xv6 uses paging harware that support 2-level paging.&lt;/p&gt;
&lt;p&gt;We use first top 10 bits to index page directory, and fetch the 20 bits PPN to index the Page table, and use the second 10 bits to index PPN in page table.&lt;/p&gt;
&lt;p&gt;An x86 page table is logically an array of 2^20 (1,048,576) page table entries. Thus a page table gives table gives the operating system control over virtual-to-physical address translations at the granularity of aligned chunks of 4096 (2^12) bytes. Such a chunk is called a page.&lt;/p&gt;
&lt;p&gt;Each PTE contains &lt;strong&gt;flag bits&lt;/strong&gt; that tell the paging hardware how the associated virtual address is allowed to be used:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;|31                    |12   |8   |6  |5  |4   |3   |2  |1  |0  |
|----------------------|-----|----|---|---|----|----|---|---|---|
| Physical Page Number | AVL |    | D | A | CD | WT | U | W | P |
                          |         |   |   |    |    |    |   |---- P - Present
                          |         |   |   |    |    |    |-------- W - Writable
                          |         |   |   |    |    |------------- U - User
                          |         |   |   |    |----------------- WT - 1=Write-through, 0=Write-back
                          |         |   |   |---------------------- CD - Cache Disabled
                          |         |   |--------------------------- A - Accessed
                          |         |------------------------------- D - Dirty (0 in page directory)
                          |--------------------------------------- AVL - Available for system use

Page table and page directory entries are identical except for the D bits
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;PTE_P&lt;/code&gt; indicates whether the PTE is present: if it is not set, a reference to the page causes a fault.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PTE_W&lt;/code&gt; controls whether instructions are allows to issue writes to the page; if not set, only reads and instructions fetches are allowed.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PTE_U&lt;/code&gt; controls whether the user programs are allowed to use the page; if clear, only kernel is allowed to use the page.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The flags and all other page hardware related structures are defined in &lt;code&gt;mmu.h&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id=&#34;process-address-space&#34;&gt;Process address space&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://xiahua.blog/2019/01/29/2019-1-29-paging/&#34;&gt;The &lt;code&gt;entry.S&lt;/code&gt; provided a primal memory layout for the kernel&lt;/a&gt;. The two entries we created map virtual address &lt;code&gt;0:0x400000&lt;/code&gt; to physical address &lt;code&gt;0:0x400000&lt;/code&gt; as well as &lt;code&gt;KERNBASE:KERNBASE+0x400000&lt;/code&gt; to &lt;code&gt;0:0x400000&lt;/code&gt;. It is quite elaborately designed because the bootloader can only get access to physical addresses, whereas the kernel only uses virtual addresses. To prevent the &lt;code&gt;entry.S&lt;/code&gt; program breaking down, we assigned two different virtual address pages to the same physical address page. So the &lt;code&gt;jmp&lt;/code&gt; need to be an indirect jump.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;memory_layout.png&#34; alt=&#34;Figure 2-2. Layout of the virtual address space of a process and the layout of the physical address space. Note that if a machine has more than 2 Gbyte of physical memory, xv6 can use only the memory that fits between KERNBASE and 0xFE00000.&#34;&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define KERNBASE 0x80000000&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;But once we start the process, a more elaborate plan for describing process address space is required. And this turns to be the standard memory layout of the xv6 system. As we can see in the Figure 2-2.&lt;/p&gt;
&lt;h2 id=&#34;0kernbase&#34;&gt;0:KERNBASE&lt;/h2&gt;
&lt;p&gt;This area which addressed up to 2 gigabytes is reserved for the user process. That means one process can use 2 gigabytes of memory for the most. The structure of this area is familiar to the most programmers, including user text, user data, user stack, etc. The user programs use
them to do tasks on computer.&lt;/p&gt;
&lt;p&gt;This area is not mapped to physical memory at first because the entries are dynamically created, which means only when the program needs to use memory, the corresponding entries are created by kernel and linking the virtual pages with vacant physical pages. At first, there is no process being, so there is no entry in this area.&lt;/p&gt;
&lt;h2 id=&#34;kernbase0xffffffff&#34;&gt;KERNBASE:0xFFFFFFFF&lt;/h2&gt;
&lt;p&gt;Above &lt;code&gt;KERNBASE&lt;/code&gt; sits the kernel. And in this area, entries are all created with a simple mapping rule, which shown in &lt;code&gt;memlayout.h&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define V2P_WO(x) ((x) - KERNBASE)    &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// same as V2P, but without casts
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That means, in this area, virtual pages and physical pages are 1:1 mapped except for an offset &lt;code&gt;KERNBASE&lt;/code&gt;. Why?&lt;/p&gt;
&lt;p&gt;The advantage of this is that the kernel can manipulate the physical memory easily. The kernal can see the whole world including all processes&amp;rsquo; page tables.&lt;/p&gt;
&lt;p&gt;Xv6 does not set the PTE_U flag in the PTEs above KERNBASE, so only the kernel can use them.&lt;/p&gt;
&lt;p&gt;Having every processâ€™s page table contain mappings for both user memory and the entire kernel is convenient when switching from user code to kernel code during system calls and interrupts: such switches do not require page table switches. For the most part the kernel does not have its own page table; it is almost always borrowing some processâ€™s page table.&lt;/p&gt;
&lt;p&gt;To review, xv6 ensures that each process can use only its own memory. And, each process sees its memory as having contiguous virtual addresses starting at zero, while the processâ€™s physical memory can be non-contiguous. xv6 implements the first by setting the PTE_U bit only on PTEs of virtual addresses that refer to the processâ€™s own memory. It implements the second using the ability of page tables to translate successive virtual addresses to whatever physical pages happen to be allocated to the process.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;PHYSTOP&lt;/code&gt; in the physical memory show the maximum address of the physical address. However, the memory-mapped I/O devices occupy the addresses from &lt;code&gt;0xFE000000&lt;/code&gt; to &lt;code&gt;0xFFFFFFFF&lt;/code&gt;. Memory in between &lt;code&gt;PHYSTOP&lt;/code&gt; and &lt;code&gt;0xFE000000&lt;/code&gt; does not exist, and cannot be accessed.&lt;/p&gt;
&lt;h1 id=&#34;code-comments&#34;&gt;Code comments&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;main&lt;/code&gt; calls &lt;code&gt;kvmalloc&lt;/code&gt; to create and switch to a page table with the mappings above &lt;code&gt;KERNBASE&lt;/code&gt; required for the kernel to run.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Do remember the &lt;code&gt;%esp&lt;/code&gt; pointer is well prepared right a moment ago. In &lt;code&gt;entry.S&lt;/code&gt; we allocated a per-process kernel stack (4096 bytes) in the kernel. So the next call will store address in the kernel stack, just like an process that just has been trapped in the kernel.&lt;/p&gt;
&lt;p&gt;Jump into &lt;code&gt;kvmalloc&lt;/code&gt;: &lt;code&gt;vm.c.138:145&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Allocate one page table for the machine for the kernel address
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// space for scheduler processes.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;kvmalloc&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  kpgdir &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; setupkvm();
  switchkvm();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;kpgdir&lt;/code&gt; is the directory of kernel program pages. It is defined above in &lt;code&gt;vm.c&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; uint pde_t;
pde_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;kpgdir;  &lt;span style=&#34;color:#75715e&#34;&gt;// for use in scheduler()
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As far we don&#39;t know what is a &lt;code&gt;scheduler&lt;/code&gt;, but we just know &lt;code&gt;kpgdir&lt;/code&gt; is an entry pointer and  it is global in kernel.&lt;/p&gt;
&lt;p&gt;Jump into &lt;code&gt;setupkvm&lt;/code&gt;, where the most work is done.&lt;code&gt;vm.c.117:136&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Set up kernel part of a page table.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;pde_t&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;setupkvm&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  pde_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pgdir;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; kmap &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;k;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;((pgdir &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (pde_t&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)kalloc()) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
  memset(pgdir, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, PGSIZE);
  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (P2V(PHYSTOP) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)DEVSPACE)
    panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;PHYSTOP too high&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(k &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; kmap; k &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmap[NELEM(kmap)]; k&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(mappages(pgdir, k&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;virt, k&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;phys_end &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; k&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;phys_start,
                (uint)k&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;phys_start, k&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;perm) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) {
      freevm(pgdir);
      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    }
  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; pgdir;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;first we allocate a 4096 bytes page in physical memory, and clear it totally.&lt;/p&gt;
&lt;p&gt;Then xv6 uses a static &lt;code&gt;struct kmap&lt;/code&gt; array to represent the layout of the kernel virtual pages: &lt;code&gt;vm.c.103:115&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// This table defines the kernel&amp;#39;s mappings, which are present in
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// every process&amp;#39;s page table.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; kmap {
  &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;virt;
  uint phys_start;
  uint phys_end;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; perm;
} kmap[] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {
 { (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)KERNBASE, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,             EXTMEM,    PTE_W}, &lt;span style=&#34;color:#75715e&#34;&gt;// I/O space
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt; { (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)KERNLINK, V2P(KERNLINK), V2P(data), &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;},     &lt;span style=&#34;color:#75715e&#34;&gt;// kern text+rodata
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt; { (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)data,     V2P(data),     PHYSTOP,   PTE_W}, &lt;span style=&#34;color:#75715e&#34;&gt;// kern data+memory
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt; { (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)DEVSPACE, DEVSPACE,      &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,         PTE_W}, &lt;span style=&#34;color:#75715e&#34;&gt;// more devices
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;};
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The four entries in &lt;code&gt;kmap[]&lt;/code&gt; correspond to the 4 areas  above &lt;code&gt;KERNBASE&lt;/code&gt; in Figure 2.2.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mappages&lt;/code&gt; installs the translations that are described in &lt;code&gt;kmap&lt;/code&gt; array in page directory. &lt;code&gt;vm.c.57:80&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Create PTEs for virtual addresses starting at va that refer to
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// physical addresses starting at pa. va and size might not
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// be page-aligned.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;mappages&lt;/span&gt;(pde_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pgdir, &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;va, uint size, uint pa, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; perm)
{
  &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;a, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;last;
  pte_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pte;

  a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)PGROUNDDOWN((uint)va);
  last &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)PGROUNDDOWN(((uint)va) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; size &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(;;){
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;((pte &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; walkpgdir(pgdir, a, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pte &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; PTE_P)
      panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;remap&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pte &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pa &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; perm &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_P;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; last)
      &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
    a &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PGSIZE;
    pa &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PGSIZE;
  }
  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In &lt;code&gt;mappages&lt;/code&gt;, we use &lt;code&gt;walkpgdir&lt;/code&gt; function to find the right page of given virtual address (needs to be rounded down to page borders). &lt;code&gt;vm.c.32:55&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Return the address of the PTE in page table pgdir
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// that corresponds to virtual address va.  If alloc!=0,
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// create any required page table pages.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; pte_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;walkpgdir&lt;/span&gt;(pde_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pgdir, &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;va, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; alloc)
{
  pde_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pde;
  pte_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pgtab;

  pde &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;pgdir[PDX(va)];  &lt;span style=&#34;color:#75715e&#34;&gt;// Get first 10 bits of va, and index page directory entry
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pde &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; PTE_P){ &lt;span style=&#34;color:#75715e&#34;&gt;// If the page directory entry present
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    pgtab &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (pte_t&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)P2V(PTE_ADDR(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pde)); &lt;span style=&#34;color:#75715e&#34;&gt;// Get the first 20 bits of *pde, and index page table
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;alloc &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (pgtab &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (pte_t&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)kalloc()) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    &lt;span style=&#34;color:#75715e&#34;&gt;// Make sure all those PTE_P bits are zero.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    memset(pgtab, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, PGSIZE);
    &lt;span style=&#34;color:#75715e&#34;&gt;// The permissions here are overly generous, but they can
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// be further restricted by the permissions in the page table
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// entries, if necessary.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;pde &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; V2P(pgtab) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_P &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_W &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_U;
  }
  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;pgtab[PTX(va)];
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The interesting part is in &lt;code&gt;walkpgdir&lt;/code&gt;, it mimics the actions of the x86 paging hardware as it looks up the PTE for a virtual address. walkpgdir uses the upper 10 bits of the virtual address to find the page directory entry. If the page directory entry isnâ€™t present, then the required page table page hasnâ€™t yet been allocated; if the &lt;code&gt;alloc&lt;/code&gt; argument is set, walkpgdir allocates it and puts its physical address in the page directory. Finally it uses the next 10 bits of the virtual address to find the address of the PTE in the page table page.&lt;/p&gt;
&lt;h1 id=&#34;physical-memory-allocation&#34;&gt;Physical memory allocation&lt;/h1&gt;
&lt;p&gt;We said &lt;code&gt;kalloc&lt;/code&gt; again and again. When the xv6 works, we need to allocate and free physical memory dynamically.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The kernel must allocate and free physical memory at run-time for page tables, process user memory, kernel stacks, and pipe buffers.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The way &lt;code&gt;kalloc&lt;/code&gt; manages memory does not involve with a lot of optimization here. There is a list of all the physical memory pages and &lt;code&gt;kalloc&lt;/code&gt; keeps track of them.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;There is a bootstrap problem: all of physical memory must be mapped in order for the allocator to initialize the free list, but creating a page table with those mappings involves allocating page-table pages. xv6 solves this problem by using a separate page allocator during entry, which allocates memory just after the end of the kernelâ€™s data segment. This allocator does not support freeing and is limited by the 4 MB mapping in the &lt;code&gt;entrypgdir&lt;/code&gt;, but that is sufficient to allocate the first kernel page table.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;code-physical-memory-allocator&#34;&gt;Code: Physical memory allocator&lt;/h2&gt;
&lt;p&gt;This part is a little difficult to understand, xv6 use a &lt;em&gt;free list&lt;/em&gt; to implement allocation, which is the simplest way. &lt;code&gt;kalloc.c.79:95&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Allocate one 4096-byte page of physical memory.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Returns a pointer that the kernel can use.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Returns 0 if the memory cannot be allocated.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;kalloc&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; run &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;r;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(kmem.use_lock)
    acquire(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock);
  r &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; kmem.freelist;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(r)
    kmem.freelist &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; r&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;next;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(kmem.use_lock)
    release(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock);
  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)r;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Free list strategy does not have the best allocation performance, however it is the simplest way.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The function main calls &lt;code&gt;kinit1&lt;/code&gt; and &lt;code&gt;kinit2&lt;/code&gt; to initialize the allocator. The reason for having two calls is that for much of main one cannot use locks or memory above 4 megabytes. The call to &lt;code&gt;kinit1&lt;/code&gt; sets up for lock-less allocation in the first 4 megabytes, and the call to kinit2 enables locking and arranges for more memory to be allocatable. main ought to determine how much physical memory is available, but this turns out to be difficult on the x86. Instead it assumes that the machine has 224 megabytes (PHYSTOP) of physical memory, and uses all the memory between the end of the kernel and &lt;code&gt;PHYSTOP&lt;/code&gt; as the initial pool of free memory. &lt;code&gt;kinit1&lt;/code&gt; and &lt;code&gt;kinit2&lt;/code&gt; call &lt;code&gt;freerange&lt;/code&gt; to add memory to the free list via per-page calls to &lt;code&gt;kfree&lt;/code&gt;. A PTE can only refer to a physical address that is aligned on a 4096-byte boundary (is a multiple of 4096), so &lt;code&gt;freerange&lt;/code&gt; uses &lt;code&gt;PGROUNDUP&lt;/code&gt; to ensure that it frees only aligned physical addresses. The allocator starts with no memory; these calls to &lt;code&gt;kfree&lt;/code&gt; give it some to manage.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;kalloc.c.26:44&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Initialization happens in two phases.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 1. main() calls kinit1() while still using entrypgdir to place just
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// the pages mapped by entrypgdir on free list.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 2. main() calls kinit2() with the rest of the physical pages
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// after installing a full page table that maps them on all cores.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;kinit1&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;vstart, &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;vend)
{
  initlock(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock, &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;kmem&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
  kmem.use_lock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
  freerange(vstart, vend);
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;kinit2&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;vstart, &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;vend)
{
  freerange(vstart, vend);
  kmem.use_lock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The function &lt;code&gt;kfree&lt;/code&gt; begins by setting every byte in the memory being freed
to the value 1. This will cause code that uses memory after freeing it (uses â€˜â€˜dangling
referencesâ€™â€™) to read garbage instead of the old valid contents; hopefully that will cause
such code to break faster. &lt;code&gt;kalloc.c.54:77&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//PAGEBREAK: 21
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Free the page of physical memory pointed at by v,
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// which normally should have been returned by a
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// call to kalloc().  (The exception is when
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// initializing the allocator; see kinit above.)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;kfree&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;v)
{
  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; run &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;r;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;((uint)v &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; PGSIZE &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; v &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; end &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; V2P(v) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PHYSTOP)
    panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;kfree&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);

  &lt;span style=&#34;color:#75715e&#34;&gt;// Fill with junk to catch dangling refs.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  memset(v, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, PGSIZE);

  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(kmem.use_lock)
    acquire(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock);
  r &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; run&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)v;
  r&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;next &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; kmem.freelist;
  kmem.freelist &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; r;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(kmem.use_lock)
    release(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;user-address-space&#34;&gt;User address space&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;user.png&#34; alt=&#34;Figure 2-3. Memory layout of a user process with its initial stack.&#34;&gt;&lt;/p&gt;
&lt;p&gt;The program text and data segment start at virtual address 0 and end with a guard page. The guard page is not mapped so when the stack runs out, the hardware will throw an exception.&lt;/p&gt;
&lt;p&gt;The initial content of stack is created by &lt;code&gt;exec&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id=&#34;code-sbrk&#34;&gt;Code: sbrk&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;sbrk&lt;/code&gt; is the system call for a process to shrink or grow its memory. The system call is implemented by the function &lt;code&gt;growproc&lt;/code&gt;. If &lt;code&gt;n&lt;/code&gt; is postive, &lt;code&gt;growproc&lt;/code&gt; allocates one or more physical pages and maps them at the top of the processâ€™s address space. If &lt;code&gt;n&lt;/code&gt; is negative, &lt;code&gt;growproc&lt;/code&gt; unmaps one or more pages from the processâ€™s address space and frees the corresponding physical pages. To make these changes, xv6 modifies the processâ€™s page table. The processâ€™s page table is stored in memory, and so the kernel can update the table with ordinary assignment statements, which is what &lt;code&gt;allocuvm&lt;/code&gt; and &lt;code&gt;deallocuvm&lt;/code&gt; do.&lt;/p&gt;
&lt;p&gt;The x86 hardware caches page table entries in a Translation Lookaside Buffer (TLB), and when xv6 changes the page tables, it must invalidate the cached entries. If it didnâ€™t invalidate the cached entries, then at some point later the TLB might use an old mapping, pointing to a physical page that in the mean time has been allocated to another process, and as a result, a process might be able to scribble on some other processâ€™s memory. Xv6 invalidates stale cached entries, by reloading &lt;code&gt;cr3&lt;/code&gt;, the register that holds the address of the current page table.&lt;/p&gt;
&lt;h1 id=&#34;code-exec&#34;&gt;Code: exec&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;exec&lt;/code&gt; allocates a new page table with no user mappings with &lt;code&gt;setupkvm&lt;/code&gt;, allocates memory for each ELF segment with &lt;code&gt;allocuvm&lt;/code&gt;, and loads each segment into
memory with &lt;code&gt;loaduvm&lt;/code&gt;. &lt;code&gt;allocuvm&lt;/code&gt; checks that the virtual addresses requested is
below &lt;code&gt;KERNBASE&lt;/code&gt;. &lt;code&gt;loaduvm&lt;/code&gt; uses &lt;code&gt;walkpgdir&lt;/code&gt; to find the physical address of the allocated memory at which to write each page of the ELF segment, and &lt;code&gt;readi&lt;/code&gt; to read
from the file.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;During the preparation of the new memory image, if exec detects an error like an invalid program segment, it jumps to the label bad, frees the new image, and returns â€“1. Exec must wait to free the old image until it is sure that the system call will succeed: if the old image is gone, the system call cannot return â€“1 to it. The only error cases in exec happen during the creation of the image. Once the image is complete, exec can install the new image (6701) and free the old one (6702). Finally, exec returns 0.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;real-world&#34;&gt;Real World&lt;/h1&gt;
&lt;p&gt;The following content come directly from xv6 textbook, which is worth reading.&lt;/p&gt;
&lt;p&gt;Like most operating systems, xv6 uses the paging hardware for memory protection and mapping. Most operating systems use x86â€™s 64-bit paging hardware (which has 3 levels of translation). 64-bit address spaces allow for a less restrictive memory layout than xv6â€™s; for example, it would be easy to remove xv6â€™s limit of 2 gigabytes for physical memory. Most operating systems make far more sophisticated use of paging than xv6; for example, xv6 lacks demand paging from disk, copy-on-write fork, shared memory, lazily-allocated pages, and automatically extending stacks. The x86 supports address translation using segmentation (see Appendix B), but xv6 uses segments only for the common trick of implementing per-cpu variables such as proc that are at a fixed address but have different values on different CPUs (see seginit). Implementations of per-CPU (or per-thread) storage on non-segment architectures would dedicate a register to holding a pointer to the per-CPU data area, but the x86 has so few general registers that the extra effort required to use segmentation is worthwhile.&lt;/p&gt;
&lt;p&gt;Xv6 maps the kernel in the address space of each user process but sets it up so that the kernel part of the address space is inaccessible when the processor is in user mode. This setup is convenient because after a process switches from user space to kernel space, the kernel can easily access user memory by reading memory locations directly. It is probably better for security, however, to have a separate page table for the kernel and switch to that page table when entering the kernel from user mode, so that the kernel and user processes are more separated from each other. This design, for example, would help mitigating side-channels that are exposed by the Meltdown vulnerability and that allow a user process to read arbitrary kernel memory.&lt;/p&gt;
&lt;p&gt;On machines with lots of memory it might make sense to use the x86â€™s 4-megabytes â€˜â€˜super pages.â€™â€™ Small pages make sense when physical memory is small, to allow allocation and page-out to disk with fine granularity. For example, if a program uses only 8 kilobytes of memory, giving it a 4 megabytes physical page is wasteful. Larger pages make sense on machines with lots of RAM, and may reduce overhead for page-table manipulation. Xv6 uses super pages in one place: the initial page table. The array initialization sets two of the 1024 PDEs, at indices zero and 512 (&lt;code&gt;KERNBASE&amp;gt;&amp;gt;PDXSHIFT&lt;/code&gt;), leaving the other PDEs zero. Xv6 sets the PTE_PS bit in these two PDEs to mark them as super pages. The kernel also tells the paging hardware to allow super pages by setting the &lt;code&gt;CR_PSE&lt;/code&gt; bit (Page Size Extension) in &lt;code&gt;%cr4&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Xv6 should determine the actual RAM configuration, instead of assuming 224 MB. On the x86, there are at least three common algorithms: the first is to probe the physical address space looking for regions that behave like memory, preserving the values written to them; the second is to read the number of kilobytes of memory out of a known 16-bit location in the PCâ€™s non-volatile RAM; and the third is to look in BIOS memory for a memory layout table left as part of the multiprocessor tables. Reading the memory layout table is complicated.&lt;/p&gt;
&lt;p&gt;Memory allocation was a hot topic a long time ago, the basic problems being efficient use of limited memory and preparing for unknown future requests; see Knuth. Today people care more about speed than space-efficiency. In addition, a more elaborate kernel would likely allocate many different sizes of small blocks, rather than (as in xv6) just 4096-byte blocks; a real kernel allocator would need to handle small allocations as well as large ones.&lt;/p&gt;</description>
    </item>
    <item>
      <title>xv6 Chapter 4 - Creating the First Process</title>
      <link>https://xiahualiu.github.io/posts/2019-02-03-xv6-first-process/</link>
      <pubDate>Sun, 03 Feb 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-02-03-xv6-first-process/</guid>
      <description>&lt;p&gt;There goes the main part of xv6. Xv6 souce code provided a really clear view of each component of the kernel. All parts are shown below: &lt;code&gt;main.c:14-38&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;In this chapter, we will go through the sub-function &lt;code&gt;userinit&lt;/code&gt;, in which we initialize the memory for a user process, and create the first process.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Bootstrap processor starts running C code here.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Allocate a real stack and switch to it, first
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// doing some setup required for memory allocator to work.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  kinit1(end, P2V(&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;)); &lt;span style=&#34;color:#75715e&#34;&gt;// phys page allocator
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  kvmalloc();      &lt;span style=&#34;color:#75715e&#34;&gt;// kernel page table
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  mpinit();        &lt;span style=&#34;color:#75715e&#34;&gt;// detect other processors
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  lapicinit();     &lt;span style=&#34;color:#75715e&#34;&gt;// interrupt controller
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  seginit();       &lt;span style=&#34;color:#75715e&#34;&gt;// segment descriptors
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  picinit();       &lt;span style=&#34;color:#75715e&#34;&gt;// disable pic
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  ioapicinit();    &lt;span style=&#34;color:#75715e&#34;&gt;// another interrupt controller
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  consoleinit();   &lt;span style=&#34;color:#75715e&#34;&gt;// console hardware
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  uartinit();      &lt;span style=&#34;color:#75715e&#34;&gt;// serial port
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  pinit();         &lt;span style=&#34;color:#75715e&#34;&gt;// process table
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  tvinit();        &lt;span style=&#34;color:#75715e&#34;&gt;// trap vectors
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  binit();         &lt;span style=&#34;color:#75715e&#34;&gt;// buffer cache
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  fileinit();      &lt;span style=&#34;color:#75715e&#34;&gt;// file table
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  ideinit();       &lt;span style=&#34;color:#75715e&#34;&gt;// disk 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  startothers();   &lt;span style=&#34;color:#75715e&#34;&gt;// start other processors
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  kinit2(P2V(&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;), P2V(PHYSTOP)); &lt;span style=&#34;color:#75715e&#34;&gt;// must come after startothers()
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  userinit();      &lt;span style=&#34;color:#75715e&#34;&gt;// first user process
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  mpmain();        &lt;span style=&#34;color:#75715e&#34;&gt;// finish this processor&amp;#39;s setup
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;userinit&lt;/code&gt;&#39;s first action is to call &lt;code&gt;allocproc&lt;/code&gt;. Go to the definition of it, we can see &lt;code&gt;allocproc&lt;/code&gt; do several things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;allocating a slot (&lt;code&gt;struct proc&lt;/code&gt;) in process table. &lt;code&gt;allocproc&lt;/code&gt; scans the proc table for a slot with state &lt;code&gt;UNUSED&lt;/code&gt;. &lt;code&gt;proc.c:69-83&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Look in the process table for an UNUSED proc.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// If found, change state to EMBRYO and initialize
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// state required to run in the kernel.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Otherwise return 0.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; proc&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;allocproc&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; proc &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;p;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;sp;

  acquire(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;ptable.lock);

  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ptable.proc; p &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;ptable.proc[NPROC]; p&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;state &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; UNUSED)
      &lt;span style=&#34;color:#66d9ef&#34;&gt;goto&lt;/span&gt; found;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;initializing the parts of process&#39;s state required for its kernel thread to execute. It sets the state to &lt;code&gt;EMBRYO&lt;/code&gt; to mark it as used and give the process a unique pid. &lt;code&gt;proc.c:88-92&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;found:
  p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;state &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; EMBRYO;
  p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;pid &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nextpid&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;;

  release(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;ptable.lock);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;Next, it allocate a kernel stack for the process&#39;s kernel thread. If failed, labeled the &lt;code&gt;struct proc&lt;/code&gt; with &lt;code&gt;UNUSED&lt;/code&gt;, return 0. &lt;code&gt;proc.c:94-99&lt;/code&gt; (kernel thread is the thread when a process is trapped in kernel).&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// Allocate kernel stack.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;((p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;kstack &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; kalloc()) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;){
    p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;state &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; UNUSED;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
  }
  sp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;kstack &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; KSTACKSIZE;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here we meet a new function called &lt;code&gt;kalloc&lt;/code&gt;. Go to its definition, &lt;code&gt;kalloc.c:79-95&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Allocate one 4096-byte page of physical memory.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Returns a pointer that the kernel can use.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Returns 0 if the memory cannot be allocated.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;kalloc&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; run &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;r;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(kmem.use_lock)
    acquire(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock);
  r &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; kmem.freelist;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(r)
    kmem.freelist &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; r&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;next;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(kmem.use_lock)
    release(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;kmem.lock);
  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)r;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;kalloc&lt;/code&gt; is used to allocate one 4096-byte page physical memory. We can infer from the above usage that &lt;code&gt;kalloc&lt;/code&gt; return a pointer that can point to a stack space.&lt;/p&gt;
&lt;p&gt;In &lt;code&gt;allocproc&lt;/code&gt;, we assign &lt;code&gt;sp&lt;/code&gt; at the top of the kernel stack.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;kernel_stack.png&#34; alt=&#34;Figure 1-4. A new kernel stack&#34;&gt;&lt;/p&gt;
&lt;p&gt;Next &lt;code&gt;allocproc&lt;/code&gt; use &lt;code&gt;sp&lt;/code&gt; to form the stack like the picture above, and assign the various pointer like &lt;code&gt;p-&amp;gt;tf&lt;/code&gt; &lt;code&gt;p-&amp;gt;context&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;What is trapframe and context? Well, trapframe is used for the code to return from the kernel back to the process&#39;s user code. All the registers and the porgram counter value (in &lt;code&gt;%eip&lt;/code&gt;) are freezed before entering kernel and stored in trapframe through trap entry code. After exiting, all the registers are restored and the processor executes from the freezed program counter value. Then exit process is in &lt;code&gt;trapret&lt;/code&gt; function. &lt;code&gt;trapasm.S:23-32&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The trapframe structure is defined in &lt;code&gt;x86.h:148-183&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Layout of the trap frame built on the stack by the
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// hardware and by trapasm.S, and passed to trap().
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; trapframe {
  &lt;span style=&#34;color:#75715e&#34;&gt;// registers as pushed by pusha
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  uint edi;
  uint esi;
  uint ebp;
  uint oesp;      &lt;span style=&#34;color:#75715e&#34;&gt;// useless &amp;amp; ignored
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  uint ebx;
  uint edx;
  uint ecx;
  uint eax;

  &lt;span style=&#34;color:#75715e&#34;&gt;// rest of trap frame
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  ushort gs;
  ushort padding1;
  ushort fs;
  ushort padding2;
  ushort es;
  ushort padding3;
  ushort ds;
  ushort padding4;
  uint trapno;

  &lt;span style=&#34;color:#75715e&#34;&gt;// below here defined by x86 hardware
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  uint err;
  uint eip;
  ushort cs;
  ushort padding5;
  uint eflags;

  &lt;span style=&#34;color:#75715e&#34;&gt;// below here only when crossing rings, such as from user to kernel
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  uint esp;
  ushort ss;
  ushort padding6;
};
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The trapframe is built by hardware and by &lt;code&gt;trapasm.S&lt;/code&gt;: &lt;code&gt;trapasm.S:5-21&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;alltraps:
  # Build trap frame.
  pushl %ds
  pushl %es
  pushl %fs
  pushl %gs
  pushal
  
  # Set up data segments.
  movw $(SEG_KDATA&amp;lt;&amp;lt;3), %ax
  movw %ax, %ds
  movw %ax, %es

  # Call trap(tf), where tf=%esp
  pushl %esp
  call trap
  addl $4, %esp
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;trapret&lt;/code&gt; is also defined in &lt;code&gt;trapasm.S:23-32&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;  # Return falls through to trapret...
.globl trapret
trapret:
  popal
  popl %gs
  popl %fs
  popl %es
  popl %ds
  addl $0x8, %esp  # trapno and errcode
  iret
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The context works similar with trapframe, but it is used by context control system. The kernel switches processor from a process to another, so we also need to store the context frame into kernel stack for switching.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;allocproc&lt;/code&gt; function is called not only in &lt;code&gt;userinit&lt;/code&gt;, but also every time when a new process is forked. So it is delicately designed for both two conditions. It sets the context frame&#39;s &lt;code&gt;%eip&lt;/code&gt; value right at &lt;code&gt;forkret&lt;/code&gt;, so when the processor switches to this process, &lt;code&gt;forkret&lt;/code&gt; will be executed. Unlike &lt;code&gt;trapret&lt;/code&gt;, &lt;code&gt;forkret&lt;/code&gt; only does a simple thing, returning to whatever on the bottom of the kernel stack. At that time, the context frame has already poped, what at the stack bottom is the &lt;code&gt;trapret&lt;/code&gt; entrance. So the processor assumes the process just return from kernel, &lt;code&gt;trapret&lt;/code&gt; then restores the trapframe.&lt;/p&gt;
&lt;p&gt;However when the process was first allocated, we will deliberately set trapframe&#39;s &lt;code&gt;%eip&lt;/code&gt; to 0x0, so when &lt;code&gt;trapret&lt;/code&gt; returns, the user code will be executed at 0x0. &lt;code&gt;proc.c:101-106&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Leave room for trap frame.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  sp &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;tf;
  p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;tf &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; trapframe&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)sp;

  &lt;span style=&#34;color:#75715e&#34;&gt;// Set up new context to start executing at forkret,
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// which returns to trapret.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  sp &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;;
  &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;(uint&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)sp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (uint)trapret;

  sp &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;context;
  p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;context &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; context&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)sp;
  memset(p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;context, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;context);
  p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;context&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;eip &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (uint)forkret;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; p;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;When the &lt;code&gt;allocproc&lt;/code&gt; finish, we called &lt;code&gt;setupkvm&lt;/code&gt; to prepare the memory page for our first process code, and manipulate the trapframe to let it return right to the beginning of the user code. (&lt;code&gt;allocproc&lt;/code&gt; only modified the value of context and &lt;code&gt;forkret&lt;/code&gt; part) We will discuss &lt;code&gt;setupkvm&lt;/code&gt; in the near future, but at high level it creates a address space as the Figure 1-2.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;address_space.png&#34; alt=&#34;Figure 1-2. Layout of a virtual address space&#34;&gt;&lt;/p&gt;
&lt;p&gt;The initial contents of the first processâ€™s user-space memory are the compiled form of &lt;code&gt;initcode.S&lt;/code&gt;; as part of the kernel build process, the linker embeds that binary in the kernel and defines two special symbols, &lt;code&gt;_binary_initcode_start&lt;/code&gt; and &lt;code&gt;_binary_initcode_size&lt;/code&gt;, indicating the location and size of the binary. Userinit copies that binary into the new processâ€™s memory by calling inituvm, which allocates one page of physical memory, maps virtual address zero to that memory, and copies the binary to that page.&lt;/p&gt;
&lt;p&gt;Then userinit sets up the trap frame with the initial user mode state: the %cs register contains a segment selector for the &lt;code&gt;SEG_UCODE&lt;/code&gt; segment running at privilege level &lt;code&gt;DPL_USER&lt;/code&gt; (i.e., user mode rather than kernel mode), and similarly &lt;code&gt;%ds&lt;/code&gt;, &lt;code&gt;%es&lt;/code&gt;, and &lt;code&gt;%ss&lt;/code&gt; use &lt;code&gt;SEG_UDATA&lt;/code&gt; with privilege &lt;code&gt;DPL_USER&lt;/code&gt;. The &lt;code&gt;%eflags&lt;/code&gt; &lt;code&gt;FL_IF&lt;/code&gt; bit is set to allow hardware interrupts; we will re-examine this in Chapter 3.&lt;/p&gt;
&lt;p&gt;The stack pointer &lt;code&gt;%esp&lt;/code&gt; is set to the processâ€™s largest valid virtual address, &lt;code&gt;p-&amp;gt;sz&lt;/code&gt;. The instruction pointer is set to the entry point for the initcode, address 0. The function userinit sets &lt;code&gt;p-&amp;gt;name&lt;/code&gt; to initcode mainly for debugging. Setting &lt;code&gt;p-&amp;gt;cwd&lt;/code&gt; sets the processâ€™s current working directory; we will examine namei in detail in Chapter 6.&lt;/p&gt;
&lt;p&gt;Once the process is initialized, userinit marks it available for scheduling by setting &lt;code&gt;p-&amp;gt;state&lt;/code&gt; to &lt;code&gt;RUNNABLE&lt;/code&gt;.&lt;/p&gt;</description>
    </item>
    <item>
      <title>xv6 Chapter 3 - Turning on Paging</title>
      <link>https://xiahualiu.github.io/posts/2019-01-29-paging/</link>
      <pubDate>Tue, 29 Jan 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-01-29-paging/</guid>
      <description>&lt;p&gt;In the last post, we discussed about the C code part of the boot loader, namely &lt;code&gt;bootmain.c&lt;/code&gt;. It read 4096 bytes data from the beginning of the disk second sector into the physical address &lt;code&gt;0x10000&lt;/code&gt; then parsed the elf file header by a &lt;code&gt;struct elf&lt;/code&gt;, read specified fields of &lt;code&gt;struct elf&lt;/code&gt; in order to validate elf file and acquire information about the program table. After that our boot loader fetched every corresponding elf body segment (e.g. .text .data) defined by each entry in the program header table and placed them in the written physical address &lt;code&gt;p_addr&lt;/code&gt; By the end of boot loader it called &lt;code&gt;p-&amp;gt;entry&lt;/code&gt; which is the entry of the elf file, proceeding to the next program, which is &lt;code&gt;main&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The most difficult part of the boot loader is knowing how to parse the elf file structure. I assumed the reader was familiar with the virtual memory layout for a typical executable program, including what &lt;code&gt;.text&lt;/code&gt; &lt;code&gt;.data&lt;/code&gt; &lt;code&gt;.bss&lt;/code&gt; etc. are and where they locate at. If you cannot really catch that please refer to &lt;em&gt;CSAPP&lt;/em&gt; or other books. Back to the topic, an elf contains useful information that is necessary for an elf loader so our boot loader has actually performed a simple loading process in few lines.&lt;/p&gt;
&lt;p&gt;Here to remind you of the action sequence of the boot, we did not directly come from the very beginning to our boot loader program, because the machine need a tiny program (512 bytes), which was automatically imported from first sector on the disk since powered-up, that fact means the BIOS probably has the similar boot loader like bootmain.c, however this sneaky boot loader is stored in the mother-boardâ€™s rom other than disks and we cannot touch this pre-prepared boot loader.&lt;/p&gt;
&lt;p&gt;When the BIOS boot loader finished its duty, it gave the power to our 512-byte boot program, our tiny boot program contains code that tweaked our cpu settings and the boot loader. In a word the solidified BIOS boot loader loaded our boot program, there are two boot programs in different places and work in sequence. Make sure you are clear before continue.&lt;/p&gt;
&lt;h1 id=&#34;abstract&#34;&gt;Abstract&lt;/h1&gt;
&lt;p&gt;In this chapter, the kernel has already been in the memory, but where is it? The kernel has been compiled and linked so that it expects to find itself at virtual addresses starting at &lt;code&gt;0x80100000&lt;/code&gt;. Thus, function call instructions must mention destination addresses that look like &lt;code&gt;0x801xxxxx&lt;/code&gt;; you can see examples in &lt;code&gt;kernel.asm&lt;/code&gt;. This address is configured in &lt;code&gt;kernel.ld&lt;/code&gt; (9311). &lt;code&gt;0x80100000&lt;/code&gt; is a relatively high address, towards the end of the 32-bit address space;  further chapters will explain the reasons for this choice. There may not be any physical memory at such a high address. Once the kernel starts executing, it will set up the paging hardware to map virtual addresses starting at &lt;code&gt;0x80100000&lt;/code&gt; to physical addresses starting at &lt;code&gt;0x00100000&lt;/code&gt;; the kernel assumes that there is physical memory at this lower address. At this point in the boot process, however, paging is not enabled. Instead, kernel.ld specifies that the ELF p_addr start at &lt;code&gt;0x00100000&lt;/code&gt;, which causes the boot loader to copy the kernel to the low physical addresses to which the paging hardware will eventually point.&lt;/p&gt;
&lt;p&gt;That is quite a big load of words, simply speaking:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The kernelâ€™s entry is placed at physical address &lt;code&gt;0x00100000&lt;/code&gt;, because address &lt;code&gt;0xa00000&lt;/code&gt; to &lt;code&gt;0x100000&lt;/code&gt; is reserved by IO devices. (Plus we assigned address &lt;code&gt;0x0&lt;/code&gt; to &lt;code&gt;0x7c00&lt;/code&gt; used for stack in &lt;code&gt;bootasm.S&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;The kernel entry cannot be called directly since paging hardware is not enabled yet, and kernel uses virtual address for its functions. You can enter the kernel by &lt;code&gt;jmp&lt;/code&gt; instruction but once we were in the kernel, all functions, variables cannot be found.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Conclusion&lt;/strong&gt;: We need a transition program to set up the virtual map for the kernel. It is linked with the &lt;code&gt;main.c&lt;/code&gt; program, and where &lt;code&gt;p-&amp;gt;entry&lt;/code&gt; fell.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;turn-on-paging&#34;&gt;Turn on paging&lt;/h1&gt;
&lt;p&gt;We need to do 3 things to turn on paging:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Set the size for the virtual memory page, which also regarded as page size. By convention, it should be either 4K bytes or 4M bytes. Here we chose 4M bytes.&lt;/li&gt;
&lt;li&gt;We need to create the page table entries (PTE) for every page, currently we only need the one for &lt;code&gt;0x80100000&lt;/code&gt; (We must sure that the elf is smaller than 4M) and 0x0 the address where the &lt;code&gt;%eip&lt;/code&gt; is pointing at now. With 4M page, that number is 512 and 0 respectively.&lt;/li&gt;
&lt;li&gt;Set the entry for page table directory in &lt;code&gt;%cr3&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Turn on paging, by setting a specified bit in &lt;code&gt;%cr0&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The kernelâ€™s physical address (&lt;code&gt;p_addr&lt;/code&gt;) is used for our boot loader, it tells to allocate the first program segment at physical address &lt;code&gt;0x10000&lt;/code&gt;. However, from the kernelâ€™s perspective, it assumes itself locates at &lt;code&gt;v_addr&lt;/code&gt; &lt;code&gt;0x80100000&lt;/code&gt;. So we need to cast the virtual address &lt;code&gt;0x80000000&lt;/code&gt; to the physical address &lt;code&gt;0x0&lt;/code&gt;, thus entry 512 has the base address &lt;code&gt;0x0&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Here is a simple illustration of how mmu interprets virtual address:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Read &lt;code&gt;v_addr&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Calculate the index of PTE implicitly, because we chose 4M page size so the value of the segment register is &lt;code&gt;v_addr/4M&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Fetch page table entry 512. The address was calculated by step 2.&lt;/li&gt;
&lt;li&gt;Check whether the page is missing, and validate the operation (i.e writing to a read-only page is illegal).&lt;/li&gt;
&lt;li&gt;Add up offset and the base address of the page, return the result physical address to cpu. (In some processor like later the Core i7, there are several levels of PTE so we need more steps to get the physical address.)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In the transition program, we also created the entry 0 for our current program, it points to &lt;code&gt;0x0&lt;/code&gt;, where we are now and the same address as entry 512 does, otherwise the program will crash after we turn on the paging function in &lt;code&gt;%cr0&lt;/code&gt;, because cpu cannot find the next instruction.&lt;/p&gt;
&lt;p&gt;When we finished, we needed an indirect jump (fill the &lt;code&gt;%eip&lt;/code&gt; by hand), since the assembler would otherwise generate the PC-related version of jump, and the result address is a low address, which is invalid in virtual address system.&lt;/p&gt;
&lt;h1 id=&#34;code-notes&#34;&gt;Code notes&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;entry.S&lt;/code&gt; was linked with &lt;code&gt;main.c&lt;/code&gt;, so the elf contained them both. Let&#39;s first read the header notes of &lt;code&gt;entry.S&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;entry.S:1-3&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;# The xv6 kernel starts executing in this file. This file is linked with
# the kernel C code, so it can refer to kernel symbols such as main().
# The boot block (bootasm.S and bootmain.c) jumps to entry below.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;See? And there is the &lt;code&gt;_start&lt;/code&gt; convention: &lt;code&gt;entry.S:37-41&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;# By convention, the _start symbol specifies the ELF entry point.
# Since we havent set up virtual memory yet, our entry point is
# the physical address of entry.
.globl _start
_start = V2P_WO(entry)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The &lt;code&gt;_start&lt;/code&gt; labeled the first function of the elf when executed, because &lt;code&gt;entry.S&lt;/code&gt; and &lt;code&gt;main.c&lt;/code&gt; were linked together, They shared the same entry point. The linker we used assumed all the segments locate at virtual addresses starting from &lt;code&gt;0x80100000&lt;/code&gt; which includes &lt;code&gt;entry&lt;/code&gt;. That is why we need to use macro &lt;code&gt;V2P_WO()&lt;/code&gt; to change &lt;code&gt;entry&lt;/code&gt; address. Otherwise, in the last step: &lt;code&gt;entry()&lt;/code&gt; cannot be executed, since the  function pointer &lt;code&gt;p-&amp;gt;entry&lt;/code&gt; points to a high virtual address, and at that time we have not turned on paging yet.&lt;/p&gt;
&lt;p&gt;After called &lt;code&gt;p-&amp;gt;entry&lt;/code&gt;, we came here: &lt;code&gt;entry.S:43-56&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;# Entering xv6 on boot processor, with paging off.
.globl entry
entry:
  # Turn on page size extension for 4Mbyte pages
  movl    %cr4, %eax
  orl     $(CR4_PSE), %eax
  movl    %eax, %cr4
  # Set page directory
  movl    $(V2P_WO(entrypgdir)), %eax
  movl    %eax, %cr3
  # Turn on paging.
  movl    %cr0, %eax
  orl     $(CR0_PG|CR0_WP), %eax
  movl    %eax, %cr0
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;A series of operations to turn on paging. Please note that &lt;code&gt;entrypgdir&lt;/code&gt; must be physical address, it is required by MMU and the linker created the virtual version. Since different CPUs have different paging config registers, so I do not want to explain in details about &lt;code&gt;%cr0&lt;/code&gt; and &lt;code&gt;%cr3&lt;/code&gt; &lt;code&gt;%cr4&lt;/code&gt; registers. When you really need to write a OS, you have to refer to the corresponding processor manual. Different generations of CPU differ from each other on paging registers.&lt;/p&gt;
&lt;p&gt;However, please know the &lt;code&gt;entrypgdir&lt;/code&gt; structure is defined in &lt;code&gt;main.c:97-108&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// The boot page table used in entry.S and entryother.S.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Page directories (and page tables) must start on page boundaries,
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// hence the __aligned__ attribute.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// PTE_PS in a page directory entry enables 4Mbyte pages.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
__attribute__((__aligned__(PGSIZE)))
pde_t entrypgdir[NPDENTRIES] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {
  &lt;span style=&#34;color:#75715e&#34;&gt;// Map VA&amp;#39;s [0, 4MB) to PA&amp;#39;s [0, 4MB)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  [&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_P &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_W &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_PS,
  &lt;span style=&#34;color:#75715e&#34;&gt;// Map VA&amp;#39;s [KERNBASE, KERNBASE+4MB) to PA&amp;#39;s [0, 4MB)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  [KERNBASE&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDXSHIFT] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_P &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_W &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; PTE_PS,
};
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As I said above, the page table contains two entries, one for &lt;code&gt;0x0&lt;/code&gt; and one for &lt;code&gt;0x80000000&lt;/code&gt; and the page table is strictly aligned, it is a global variable, so it can be found in the elf&#39;s &lt;code&gt;.data&lt;/code&gt; segment.&lt;/p&gt;
&lt;p&gt;Next, prepare for calling &lt;code&gt;main()&lt;/code&gt;: &lt;code&gt;entry.S:58-68&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;  # Set up the stack pointer.
  movl $(stack + KSTACKSIZE), %esp

  # Jump to main(), and switch to executing at
  # high addresses. The indirect call is needed because
  # the assembler produces a PC-relative instruction
  # for a direct jump.
  mov $main, %eax
  jmp *%eax

.comm stack, KSTACKSIZE
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;When it comes to call a function, always remember to &lt;strong&gt;make sure the stack is available now&lt;/strong&gt;, we have changed address configuration so we want to change stack pointer.&lt;/p&gt;
&lt;p&gt;The final line has a strange command &lt;code&gt;.comm&lt;/code&gt;. Here is its usage:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt; .comm name, size, alignment
 # The .comm directive allocates storage in the data section. 
 # The storage is referenced by the identifier name. Size is 
 # measured in bytes and must be a positive integer. Name 
 # cannot be predefined. Alignment is optional. If alignment 
 # is specified, the address of name is aligned to a multiple 
 # of alignment.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;.comm stack, KSTACKSIZE&lt;/code&gt; allocated a storage &lt;code&gt;stack&lt;/code&gt; of size &lt;code&gt;KSTACKSIZE&lt;/code&gt; in &lt;code&gt;.data&lt;/code&gt; segment and can be linked by others (just like global variables), &lt;code&gt;KSTACKSIZE&lt;/code&gt; are defined in &lt;code&gt;param.h:2&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define KSTACKSIZE 4096  &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// size of per-process kernel stack
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Per-process kernel stack allows multiple processes trapped in the kernel at the same time. These stacks seem to be isolated, kernel knows which stack is for which process when switches to different processes.&lt;/p&gt;
&lt;p&gt;In the end, we use an indirect jump to transfer the processor to &lt;code&gt;main&lt;/code&gt; in &lt;code&gt;main.c&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;In this chapter, we talked about the process of turning on paging in xv6, the code implementation can be found in entry.S file. The code is pretty simple but has a lot important things in how to handle details of the P2V transition including indirect jump, and the PTE 0.&lt;/p&gt;
&lt;p&gt;In the next post we will discuss the details of the creating the first process in xv6.&lt;/p&gt;</description>
    </item>
    <item>
      <title>xv6 Chapter 1 - Bootstrap</title>
      <link>https://xiahualiu.github.io/posts/2019-01-26-xv6-boot1/</link>
      <pubDate>Sat, 26 Jan 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-01-26-xv6-boot1/</guid>
      <description>&lt;p&gt;The xv6 note collection is based on the textbook and source code provided by MIT class code 6.828,which also called the &lt;em&gt;xv6 a Unix-like operating system&lt;/em&gt;. All the materials including codes and scripts are under &lt;a href=&#34;https://mit-license.org/&#34;&gt;the MIT License&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This post is the first chapter in the collection, we will go through the basic knowledge of Intel 8088 processor and do the bootstrap work for xv6 kernel step by step.&lt;/p&gt;
&lt;p&gt;Xv6 provided official textbook &lt;a href=&#34;https://pdos.csail.mit.edu/6.828/2018/xv6/book-rev11.pdf&#34;&gt;xv6 book&lt;/a&gt; online to illustrate what the codes are trying to do. The text version of code can be downloaded here &lt;a href=&#34;https://pdos.csail.mit.edu/6.828/2018/xv6/xv6-rev11.pdf&#34;&gt;xv6 source&lt;/a&gt;.&lt;/p&gt;
&lt;h1 id=&#34;after-powering-up&#34;&gt;After powering up&lt;/h1&gt;
&lt;p&gt;After you powered up your processor, a small program would automatically executed. The program was not designed by us, instead it was burned in the rom. And it performed a very simple action, transferring the data on first sector of disk to the main memory address &lt;code&gt;0x7c00&lt;/code&gt; and jumped to that location. In order not to get confused about the boot loader in next chapter, we called the ex-factory boot loader &lt;em&gt;BIOS boot loader&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;After that, processor turned to our program, namely &lt;code&gt;bootasm.S&lt;/code&gt;. All the operations will performed in &lt;code&gt;bootasm.S&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Disable the BIOS interrupts&lt;/li&gt;
&lt;li&gt;Clear all segment registers including DS, ES, SS except CS, it can only be modified by &lt;code&gt;ljmp&lt;/code&gt; instruction.&lt;/li&gt;
&lt;li&gt;Open A20 Gate, make the 21st address line valid, or the 21st bit of address register will always be 0, the address is not consecutive.(It is also required by protected mode)&lt;/li&gt;
&lt;li&gt;Create GDT, here we choose GDT to be flat, the address is not changed and 1 to 1 mapped.&lt;/li&gt;
&lt;li&gt;Transform CPU from &lt;code&gt;Real Mode&lt;/code&gt; to &lt;code&gt;Protected Mode&lt;/code&gt;, enabling 32-bit addressing.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We will go through them one by one in the following.&lt;/p&gt;
&lt;p&gt;First we need to know what BIOS had done before our program &lt;code&gt;bootasm.S:3-6&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;# Start the first CPU: switch to 32-bit protected mode, jump into C.
# The BIOS loads this code from the first sector of the hard disk into
# memory at physical address 0x7c00 and starts executing in real mode
# with %cs=0 %ip=7c00.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We know that our program entry is at &lt;code&gt;0x7c00&lt;/code&gt;, and &lt;code&gt;%cs&lt;/code&gt; had been cleared . In the initial real mode, the CPU can only address in 16 bit mode.&lt;/p&gt;
&lt;h2 id=&#34;disable-bios-interrupts&#34;&gt;Disable BIOS interrupts&lt;/h2&gt;
&lt;p&gt;Let us focus on &lt;code&gt;bootasm.S:13&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;  cli                         # Disable interrupts
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;It is a convention for the programmer to disable BIOS interrupts, because in this period, the interrupt handlers are not available, so when an interrupt occurs, it will cause undefined behaviors.&lt;/p&gt;
&lt;p&gt;Please be advised about &lt;code&gt;.code16&lt;/code&gt;, it means until the next related symbols, the assembler will only generate 16-bit format machine code.&lt;/p&gt;
&lt;h2 id=&#34;clear-segment-registers&#34;&gt;Clear segment registers&lt;/h2&gt;
&lt;p&gt;Go to &lt;code&gt;bootasm.S:15-19&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;  # Zero data segment registers DS, ES, and SS.
  xorw    %ax,%ax             # Set %ax to zero
  movw    %ax,%ds             # -&amp;gt; Data Segment
  movw    %ax,%es             # -&amp;gt; Extra Segment
  movw    %ax,%ss             # -&amp;gt; Stack Segment
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;These segment registers are all of 16-bit width, besides there is another segment register named &lt;code&gt;CS&lt;/code&gt;, it cannot be modified by &lt;code&gt;mov&lt;/code&gt; or other math and logic instructions. The default value for &lt;code&gt;CS&lt;/code&gt; is zero, so there is no need to clear &lt;code&gt;CS&lt;/code&gt; register. We will discuss &lt;code&gt;CS&lt;/code&gt; later in the article.&lt;/p&gt;
&lt;p&gt;The three registers contains different types of addresses and they are chosen implicitly by processor. For example, when the instruction being executed consists instruction address, like &lt;code&gt;jmp foo&lt;/code&gt; processor will automatically fetch the value from &lt;code&gt;%cs&lt;/code&gt; which is the address of &lt;code&gt;foo&lt;/code&gt;. If the processor met &lt;code&gt;push %ax&lt;/code&gt;, it will automatically choose &lt;code&gt;%ss&lt;/code&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;%ds&lt;/code&gt; Data Segment Register.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%ss&lt;/code&gt; Stack Segment Register.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%cs&lt;/code&gt; Code Segment Register.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%es&lt;/code&gt; Extra Segment Register. Only used for duplicating and depositing value from other segment register.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The reason why called segment register is that, Intel processors use a special method to address variables in which the corresponding segment register is shifted to left 4 bits (equals x16) then added with a 16-bit offset register. This method allows the processor to do a 20-bit addressing with two 16-bit registers, however, it also caused another problem, putting forward the origin of A20 Gate.&lt;/p&gt;
&lt;h2 id=&#34;open-the-a20-gate&#34;&gt;Open the A20 Gate&lt;/h2&gt;
&lt;p&gt;As I said above, the final address that cpu fetches is calculated like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;final_address&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(seg_reg&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;offset_reg;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;What if we input &lt;code&gt;seg_reg=0xFFFF, offset_reg=0xFFFF&lt;/code&gt;?&lt;/p&gt;
&lt;p&gt;The result is &lt;code&gt;final_address=0x10FFEF&lt;/code&gt; which actually is a 21-bit value. Back to the days when Intel 8086 only had 20 address lines, the 21st bit was ignored.&lt;/p&gt;
&lt;p&gt;But after that Intel released processor with more than 20 address lines, however, Intel still wanted to make them backward compatible, so the 21st address line was ignored by default. IBM used a small tricks to solve this problem, it assigned a unused pin named A20 in the 8042 controller (PS/2 controller) to be the switch of 21st address line, that was, the origin of A20 Gate.&lt;/p&gt;
&lt;p&gt;What if we do not open the A20 Gate? Well, if we had an address like &lt;code&gt;0xFFFFFFFF&lt;/code&gt; which is longer than 20 bits, the 21st bit would always be 0, thus the memory space is not consecutive, we are only accessible to 0~1MB, 2~3MB, 4~5MB memory addresses. That was a definitely catastrophy for programmer. I have not try it, who knows lol.&lt;/p&gt;
&lt;p&gt;How to open A20 gate? The approach is simple, we just let the 2nd pin of 8042 controller output 1. But the operations are pretty complex, first we must know the mechanics of 8042 I/O.&lt;/p&gt;
&lt;p&gt;The related instructions can be found here &lt;code&gt;bootasm.S:21-37&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;  # Physical address line A20 is tied to zero so that the first PCs 
  # with 2 MB would run software that assumed 1 MB.  Undo that.
seta20.1:
  inb     $0x64,%al               # Wait for not busy
  testb   $0x2,%al
  jnz     seta20.1

  movb    $0xd1,%al               # 0xd1 -&amp;gt; port 0x64
  outb    %al,$0x64

seta20.2:
  inb     $0x64,%al               # Wait for not busy
  testb   $0x2,%al
  jnz     seta20.2

  movb    $0xdf,%al               # 0xdf -&amp;gt; port 0x60
  outb    %al,$0x60
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Intel CPU controls 8042 through I/O ports. As we know, cpu is not only made of cores, there are also many peripheral controllers on chip like ethernet, usb, PCI, etc. The processor addresses them from &lt;code&gt;0x0&lt;/code&gt; to &lt;code&gt;0xFF&lt;/code&gt;. As for 8042, its I/O number is &lt;code&gt;0x60&lt;/code&gt; and &lt;code&gt;0x64&lt;/code&gt;.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;IO Port&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Access Type&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Purpose&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x60&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;R/W&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Data Port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;R&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Status Register&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;W&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Command Register&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;code&gt;0x64&lt;/code&gt; port connects to different registers for different access types, which is pretty common in embedded system.&lt;/p&gt;
&lt;p&gt;The opening A20 gate contains following operations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Wait for not busy, by checking the status register. Loop while busy.&lt;/li&gt;
&lt;li&gt;Send command to 0x64, indicating an incoming output.&lt;/li&gt;
&lt;li&gt;Wait for not busy, by checking the status register. Loop while busy.&lt;/li&gt;
&lt;li&gt;Send data to 0x60, output 1 on 2nd pin.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Details on &lt;a href=&#34;https://wiki.osdev.org/%228042%22_PS/2_Controller&#34;&gt;8042 Controller&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;From now on, we can make 21-bit addressing (up to 2MB). It is slightly better than 20-bit version (up to 1MB) however we want 32-bit addressing (up to 4GB) in the end.&lt;/p&gt;
&lt;h2 id=&#34;turn-on-32-bit-addressing&#34;&gt;Turn on 32-bit addressing&lt;/h2&gt;
&lt;p&gt;By default, when CPU is powered up, it ran in Real Mode, where we can only do 21-bit address. We can change it into Protected Mode, in which 32-bit addressing is available.&lt;/p&gt;
&lt;p&gt;But to transform cpu into Protected Mode, we must create a table called GDT. Every entry in GDT contains:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a 32-bit base address field&lt;/li&gt;
&lt;li&gt;a 20-bit limit field&lt;/li&gt;
&lt;li&gt;a 12-bit flag field&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;What a GDT entry does? First, CPU no longer used segment registers to addressing anymore, instead, the segment registers are used as an index in GDT, each value from (0-65535) maps an entry in the table.&lt;/p&gt;
&lt;p&gt;CPU will fetch the 32-bit base address in the entry and add it with another register named &lt;code&gt;%eip&lt;/code&gt; which is familiar by most programmers. The result is a 32-bit address.&lt;/p&gt;
&lt;p&gt;Another advantage of using GDT is the high security, GDT is considered as the cpu&#39;s hardware mechanics to isolate the executable code from data if we set the flags in the flag field, it labels what memory is executable and cannot be modified, and what memory (i.e data) cannot be executed. It prevent the overflow attack from a hardware level.&lt;/p&gt;
&lt;p&gt;In x86 asm, GDT is loaded by &lt;code&gt;ldgt&lt;/code&gt; instruction, and GDT is defined in  &lt;code&gt;bootasm.S:78-87&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;# Bootstrap GDT
.p2align 2                                # force 4 byte alignment
gdt:
  SEG_NULLASM                             # null seg
  SEG_ASM(STA_X|STA_R, 0x0, 0xffffffff)   # code seg
  SEG_ASM(STA_W, 0x0, 0xffffffff)         # data seg

gdtdesc:
  .word   (gdtdesc - gdt - 1)             # sizeof(gdt) - 1
  .long   gdt                             # address gdt
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We fill three entries in GDT, they are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Null segment, this segment has no real function, but usually reserved for debug purpose.&lt;/li&gt;
&lt;li&gt;Code segment, labeled by the 12-bit flag. Base address is &lt;code&gt;0x00&lt;/code&gt;, maximum offset is &lt;code&gt;0xffffffff&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Data segment, labeled by the 12-bit flag. Base address is &lt;code&gt;0x00&lt;/code&gt;, maximum offset is &lt;code&gt;0xffffffff&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Per cpu data segment, I do not know nothing about it.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Want to know more about GDT, please refer to &lt;a href=&#34;https://wiki.osdev.org/Global_Descriptor_Table&#34;&gt;Global Descriptor Table - OSDev Wiki&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In the end, move 1 to &lt;code&gt;%cr0&lt;/code&gt; to open Protected Mode, we need to reload &lt;code&gt;%cs&lt;/code&gt; and &lt;code&gt;%eip&lt;/code&gt; registers. The only way to modify &lt;code&gt;%cs&lt;/code&gt; is by &lt;code&gt;ljmp&lt;/code&gt; to the other place, here we jumped to &lt;code&gt;start32&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Next, reload DS, ES, SS. &lt;code&gt;bootasm.S:54-62&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;start32:
  # Set up the protected-mode data segment registers
  movw    $(SEG_KDATA&amp;lt;&amp;lt;3), %ax    # Our data segment selector
  movw    %ax, %ds                # -&amp;gt; DS: Data Segment
  movw    %ax, %es                # -&amp;gt; ES: Extra Segment
  movw    %ax, %ss                # -&amp;gt; SS: Stack Segment
  movw    $0, %ax                 # Zero segments not ready for use
  movw    %ax, %fs                # -&amp;gt; FS
  movw    %ax, %gs                # -&amp;gt; GS
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Here we successfully bootstrap our xv6 system, including turning on A20 gate, open Protected Mode. After these, we need to transfer the processor to &lt;code&gt;bootmain.c&lt;/code&gt; which is our boot loader program.&lt;/p&gt;
&lt;p&gt;Before we proceed, we need to check the &lt;code&gt;%esp&lt;/code&gt;, because we cannot have the stack pointer points to &lt;code&gt;0x0&lt;/code&gt; before calling, the stack grow from up to down, &lt;code&gt;0x0&lt;/code&gt; means everything pushed into the stack will be lost. Since our boot program starts at &lt;code&gt;0x7c00&lt;/code&gt;, we assigned &lt;code&gt;%esp&lt;/code&gt; to &lt;code&gt;0x7c00&lt;/code&gt;, it is ok because we do not need a lot space on stack, and it is proper to use space from &lt;code&gt;0x0000&lt;/code&gt; to &lt;code&gt;0x7c00&lt;/code&gt;. &lt;code&gt;bootasm.S:64-66&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-x86asm&#34; data-lang=&#34;x86asm&#34;&gt;  # Set up the stack pointer and call into C.
  movl    $start, %esp
  call    bootmain
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;review&#34;&gt;Review&lt;/h1&gt;
&lt;p&gt;We discussed about the hardware preparation for xv6, including:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Disable BIOS interrupts.&lt;/li&gt;
&lt;li&gt;Clear segment registers.&lt;/li&gt;
&lt;li&gt;Open A20 Gate.&lt;/li&gt;
&lt;li&gt;Create GDT.&lt;/li&gt;
&lt;li&gt;Transform CPU into Protected Mode&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In the next chapter, we proceed to the boot loader program, and please know it is different from the BIOS one.&lt;/p&gt;</description>
    </item>
    <item>
      <title>xv6 Chapter 2 - Boot Loader</title>
      <link>https://xiahualiu.github.io/posts/2019-01-26-xv6-boot2/</link>
      <pubDate>Sat, 26 Jan 2019 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2019-01-26-xv6-boot2/</guid>
      <description>&lt;p&gt;This post is based on materials from MIT class code 6.828, namely xv6. In the &lt;a href=&#34;https://xiahua.blog/2019/01/25/2019-1-26-xv6-Boot1/&#34;&gt;last section&lt;/a&gt; we talked about the bootstrap for xv6, and after that we need to load the kernel into memory.&lt;/p&gt;
&lt;p&gt;Because the BIOS boot loader only loaded 512 bytes program on disk sector 1, we still need more program, to be read from disk, thus, we need a boot loader to call for this duty.&lt;/p&gt;
&lt;h1 id=&#34;what-is-a-boot-loader&#34;&gt;What is a boot loader&lt;/h1&gt;
&lt;p&gt;Boot loader do a simply task, transporting code from some place to main memory. In xv6, the boot loader read full elf of the kernel, then parsed the file, allocate different segments at different place in the memory. First thing, we need to know the elf file format that boot loader carried.&lt;/p&gt;
&lt;p&gt;Elf file consists a lot information that is not run by processor, including machine information, system information, and code segments. We can also check for this information to validate the elf file, whether it is executable.&lt;/p&gt;
&lt;h1 id=&#34;elf-file-structure&#34;&gt;ELF file structure&lt;/h1&gt;
&lt;p&gt;Elf files can be divided into two types, linkable elf files and executable elf files. They are of similar structure, except the second section, program header is optional in linkable elf and is necessary in executable elf.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;     Executable ELF
-----------------------
|     ELF header      |
-----------------------
|   Program header    | &amp;lt;-- *Optional in linkable ELF
|        table        |     *Necessary in executable ELF
-----------------------
|        .text        |
-----------------------
|        .data        |
-----------------------
|// .bss/.stab/etc. //|
-----------------------
|   Segment header    |
|        table        |
-----------------------
note: Program header table is called 
      Section header table in a linkable elf.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ELF header&lt;/strong&gt; stores the information about this elf file, it starts at offset 0 in elf.
| Position (32 bit) | Value                                                 |
| :&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;- | :&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;- |
| 0-3               | &lt;strong&gt;Magic number - 0x7F&lt;/strong&gt;, then &amp;lsquo;ELF&amp;rsquo; in ASCII          |
| 4                 | 1 = 32 bit, 2 = 64 bit                                |
| 5                 | 1 = little endian, 2 = big endian                     |
| 6                 | ELF Version                                           |
| 7                 | OS ABI - usually 0 for System V                       |
| 8-15              | Unused/padding                                        |
| 16-17             | 1 = relocatable, 2 = executable, 3 = shared, 4 = core |
| 18-19             | Instruction set - see table below                     |
| 20-23             | ELF Version                                           |
| 24-27             | Program entry position                                |
| 28-31             | Program header table position                         |
| 32-35             | Section header table position                         |
| 36-39             | Flags - architecture dependent; &lt;strong&gt;see note below&lt;/strong&gt;    |
| 40-41             | Header size                                           |
| 42-43             | &lt;strong&gt;Size of an entry in the program header table&lt;/strong&gt;      |
| 44-45             | &lt;strong&gt;Number of entries in the program header table&lt;/strong&gt;     |
| 46-47             | Size of an entry in the section header table          |
| 48-49             | Number of entries in the section header table         |
| 50-51             | Index in section header table with the section names  |&lt;/p&gt;
&lt;p&gt;Bold words are used later in the program, please take attention to them.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;Architecture&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;No Specific&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Sparc&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;x86&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;MIPS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;PowerPC&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0x14&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;ARM&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0x28&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;SuperH&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0x2A&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;IA-64&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0x32&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;x86-64&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0x3E&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;AArch64&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0xB7&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Program table is following ELF header, for each entry, the format below:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;Position&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;0-3&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Type of segment (see below)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;4-7&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;The offset in the file that the data for this segment can be found (p_offset)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;8-11&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Where you should start to put this segment in virtual memory (p_vaddr)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;12-15&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Undefined for the System V ABI&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;16-19&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Size of the segment in the file (p_filesz)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;20-23&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Size of the segment in memory (p_memsz)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;24-27&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Flags (see below)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;28-31&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;The required alignment for this section (must be a power of 2)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Segment types:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0 = null - ignore the entry;&lt;/li&gt;
&lt;li&gt;1 = load - clear p_memsz bytes at p_vaddr to 0, then copy p_filesz bytes from p_offset to p_vaddr;&lt;/li&gt;
&lt;li&gt;2 = dynamic - requires dynamic linking;&lt;/li&gt;
&lt;li&gt;3 = interp - contains a file path to an executable to use as an interpreter for the following segment;&lt;/li&gt;
&lt;li&gt;4 = note section.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There are more numbers for segment types, but most of them are related with operation system and processor architecture, mainstream segment types are above ones.&lt;/p&gt;
&lt;p&gt;Flags:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 = executable,&lt;/li&gt;
&lt;li&gt;2 = writable,&lt;/li&gt;
&lt;li&gt;4 = readable.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For our boot loader program, we care &lt;code&gt;.data&lt;/code&gt; and &lt;code&gt;.text&lt;/code&gt; segments most in elf file, so how to locate them in a elf file is the biggest problem for us.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://wiki.osdev.org/images/f/fe/Elfdiagram.png&#34; alt=&#34;ELF re-mapping&#34;&gt;&lt;/p&gt;
&lt;p&gt;The boot loader need first to read value from ELF header and get the information about program header table. We can see in the bytes definition of elf header that bytes &lt;strong&gt;42-45&lt;/strong&gt; is the size of program header table, so we search for every entry in the program header table, then get the information about every segment including offset and size. The final move is reading from the disk at specific offset and size and copy the segment into memory.&lt;/p&gt;
&lt;p&gt;Let us focusing on the codes.&lt;/p&gt;
&lt;h1 id=&#34;bootmainc-code-notes&#34;&gt;bootmain.c code notes&lt;/h1&gt;
&lt;p&gt;It is a good habit to start at reading the code header notes. &lt;code&gt;bootmain.c:1-6&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Boot loader.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Part of the boot sector, along with bootasm.S, which calls bootmain().
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// bootasm.S has put the processor into protected 32-bit mode.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// bootmain() loads an ELF kernel image from the disk starting at
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// sector 1 and then jumps to the kernel entry routine.
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;elf æŒ‡é’ˆè¢«å¼ºåˆ¶æŒ‡å‘äº† &lt;code&gt;0x10000&lt;/code&gt; åœ°å€ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ¥ä¸‹æ¥è¦å°† elf æ–‡ä»¶æ•´ä¸ªæ”¾åˆ° &lt;code&gt;0x10000&lt;/code&gt; åœ°å€èµ·å§‹çš„åé¢çš„ç©ºé—´å†…ã€‚ä»£ç å®šä½ &lt;code&gt;bootmain.c:20-28&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; elfhdr &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;elf;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; proghdr &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ph, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;eph;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;entry)(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;);
  uchar&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; va;

  elf &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; elfhdr&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)&lt;span style=&#34;color:#ae81ff&#34;&gt;0x10000&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;// scratch space
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  
  &lt;span style=&#34;color:#75715e&#34;&gt;// Read 1st page off disk
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  readseg((uchar&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)elf, &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;These structs are defined in header file &lt;code&gt;elf.h&lt;/code&gt;. The destination address is &lt;code&gt;0x10000&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;There are two sub-functions that manage reading from disk, &lt;code&gt;readseg&lt;/code&gt; and &lt;code&gt;readsect&lt;/code&gt;. &lt;code&gt;bootmain.c:76-96&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Read &amp;#39;count&amp;#39; bytes at &amp;#39;offset&amp;#39; from kernel into virtual address &amp;#39;va&amp;#39;.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Might copy more than asked.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;readseg&lt;/span&gt;(uchar&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; va, uint count, uint offset)
{
  uchar&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; eva;

  eva &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; va &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; count;

  &lt;span style=&#34;color:#75715e&#34;&gt;// Round down to sector boundary.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  va &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; offset &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; SECTSIZE;

  &lt;span style=&#34;color:#75715e&#34;&gt;// Translate from bytes to sectors; kernel starts at sector 1.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  offset &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (offset &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; SECTSIZE) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;

  &lt;span style=&#34;color:#75715e&#34;&gt;// If this is too slow, we could read lots of sectors at a time.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// We&amp;#39;d write more to memory than asked, but it doesn&amp;#39;t matter --
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// we load in increasing order.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(; va &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; eva; va &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SECTSIZE, offset&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
    readsect(va, offset);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;readsect()&lt;/code&gt; is an low-level function, it reads a sector of given sector number. &lt;code&gt;SECTSIZE/4&lt;/code&gt; is because the asm &lt;code&gt;insl&lt;/code&gt; reads data in double words (4 bytes).&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;waitdisk&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
  &lt;span style=&#34;color:#75715e&#34;&gt;// Wait for disk ready.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;((inb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F7&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xC0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x40&lt;/span&gt;)
    ;
}

&lt;span style=&#34;color:#75715e&#34;&gt;// Read a single sector at offset into dst.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;readsect&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dst, uint offset)
{
  &lt;span style=&#34;color:#75715e&#34;&gt;// Issue command.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  waitdisk();
  outb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F2&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);   &lt;span style=&#34;color:#75715e&#34;&gt;// count = 1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  outb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F3&lt;/span&gt;, offset);
  outb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F4&lt;/span&gt;, offset &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;);
  outb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F5&lt;/span&gt;, offset &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;);
  outb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F6&lt;/span&gt;, (offset &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;24&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xE0&lt;/span&gt;);
  outb(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F7&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x20&lt;/span&gt;);  &lt;span style=&#34;color:#75715e&#34;&gt;// cmd 0x20 - read sectors
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;// Read data.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  waitdisk();
  insl(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1F0&lt;/span&gt;, dst, SECTSIZE&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Because the mechanics of hard disk, we can only get access to a full sector once. When we want to get data from specified offset, we need to read all the sectors that contains the data. That means we have to read more data than we need, and the redundant data is trash data we need to sweep away.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Round down the offset to the sector beginning.&lt;/li&gt;
&lt;li&gt;Read until the end of the final sector.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The first elf header data comes from the beginning sector 2, so there will not be any round down, but after the first read,  there is no guarantee about segments always meet the boundaries of disk sectors.&lt;/p&gt;
&lt;p&gt;Magic number lies in the fixed offset in an elf, so we can check Magic number to validate the elf. &lt;code&gt;bootmain.c:30-32&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Is this an ELF executable?
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(elf&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;magic &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ELF_MAGIC)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;// let bootasm.S handle error
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;return&lt;/code&gt;? where does processor go? Actually it returns to &lt;code&gt;bootasm.S&lt;/code&gt; and execute the error handler, which will transmit an error to the virtual machine we are using through an special I/O port.&lt;/p&gt;
&lt;p&gt;Now we have checked the elf, next we start carrying things into memory. &lt;code&gt;bootmain.c:34-42&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Load each program segment (ignores ph flags).
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  ph &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; proghdr&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)((uchar&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)elf &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; elf&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;phoff);
  eph &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ph &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; elf&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;phnum;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(; ph &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; eph; ph&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {
    va &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (uchar&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)(ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;va &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xFFFFFF&lt;/span&gt;);
    readseg(va, ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;filesz, ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;offset);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;memsz &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;filesz)
      stosb(va &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;filesz, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;memsz &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; ph&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;filesz);
  }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The first 4096 bytes was loaded, we assumed both the elf header and program header table are in the 4096 bytes. Next we checked the Magic number, then we searched for every entry in the program table and copy segments into memory.&lt;/p&gt;
&lt;p&gt;Here we used &lt;code&gt;stosb&lt;/code&gt; function to padding the segment, in fact, to clear the accompanying trash code between sectors and the code. &lt;code&gt;x86.h:42-49&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;inline&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// store some(cnt) bytes(data) to addr(addr)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;stosb(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;addr, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; data, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; cnt)
{
  &lt;span style=&#34;color:#66d9ef&#34;&gt;asm&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;volatile&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;cld; rep stosb&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
               &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;=D&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; (addr), &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;=c&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; (cnt) &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
               &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; (addr), &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; (cnt), &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;a&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; (data) &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
               &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;memory&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;cc&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In the end, we cast entry into a function pointer and call the function, all done!&lt;/p&gt;
&lt;h1 id=&#34;read-world&#34;&gt;Read World&lt;/h1&gt;
&lt;p&gt;The boot loader described in this chapter compiles to around 470 bytes of machine code, depending on the optimizations used when compiling the C code. In order to fit in that small amount of space, the xv6 boot loader makes a major simplifying assumption, that the kernel has been written to the boot disk contiguously starting at sector 1. More commonly, kernels are stored in ordinary file system, where they may not be contiguous, or are loaded over a network. These complications require the boot loader to be able to drive a variety of disk and network controllers and understand various file system and network protocols. In other words, the boot loader itself must be a small operation system. Since such complicated boot loader certainly won&#39;t fit in 512 bytes, most PC operating systems use a two-step boot process.&lt;/p&gt;
&lt;p&gt;First, a simple boot loader like the one in this appendix loads a full-featured boot loader from a known disk location, often relying on the less space-constrained BIOS for disk access rather than trying to drive the disk itself. The full loader, relieved of the 512-byte limit, can implement the complexity needed to locate, load, and execute the desired kernel. Modern PCs avoid many of the above complexities, because they support the Unified Extensible Firmware Interface (UEFI), which allows PC to read a larger boot loader from the disk (and start in protected and 32-bit mode).&lt;/p&gt;
&lt;p&gt;The Chapter 1 and Chapter 2 is written as if the only thing that happens between power on and the execution of boot loader is that the BIOS loads the boot sector. In fact the BIOS does a huge amount of initialization in order to make the complex hardware of a modern computer look like a traditional standard PC. The BIOS is really a small operating system embedded in the hardware, which is present after the computer has booted.&lt;/p&gt;
&lt;h1 id=&#34;exercises--answer&#34;&gt;Exercises &amp;amp; Answer&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;Due to sector granularity, the call to &lt;code&gt;readseg&lt;/code&gt; in the text is equivalent to &lt;code&gt;readseg((uchar*)0x100000, 0xb500, 0x1000)&lt;/code&gt;. In practice, this sloppy behavior turns out not to be a problem. Why doesn&#39;t the sloppy readsect cause problems?&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;Very easy if you carefully read the code, &lt;code&gt;readseg&lt;/code&gt; performs a offset round down before reading, so the actual offset transferred to &lt;code&gt;readsect&lt;/code&gt; is always aligned to the border of sectors.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Suppose you wanted &lt;code&gt;bootmain()&lt;/code&gt; to load the kernel at 0x20000 instead of 0x100000, and you did so by modifying &lt;code&gt;bootmain()&lt;/code&gt; to add 0x100000 to the va of each ELF section. Something would go wrong. What?&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;This question is tricky. It won&#39;t cause any problems until we call &lt;code&gt;p-&amp;gt;entry&lt;/code&gt;. The entry in memory has been move backwards by 0x100000, whereas the &lt;code&gt;p-&amp;gt;entry&lt;/code&gt; points to the original va.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;It seems potentially dangerous for the boot loader to copy the ELF header to memory at the arbitray location 0x10000. Why doesn&#39;t it call &lt;code&gt;malloc&lt;/code&gt; to obtain the memory it needs?&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;This question is stupid. &lt;code&gt;malloc&lt;/code&gt; need system call &lt;code&gt;sbrk()&lt;/code&gt; to implement. We cannot use &lt;code&gt;malloc&lt;/code&gt; because we haven&#39;t imported the kernel yet.&lt;/p&gt;
&lt;/blockquote&gt;</description>
    </item>
    <item>
      <title>RB-Tree - Reading STL Source Code</title>
      <link>https://xiahualiu.github.io/posts/2018-08-28-rb-tree/</link>
      <pubDate>Tue, 28 Aug 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-08-28-rb-tree/</guid>
      <description>&lt;p&gt;çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„å·²ç»è¢«ç ”ç©¶äº†å¤šå¹´ï¼Œæœ€ä¸ºæœ€å¹¿æ³›åº”ç”¨çš„æ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œå› ä¸ºå…¶å…·æœ‰ä¼˜è‰¯çš„ç‰¹æ€§ï¼Œå³è‡ªå¹³è¡¡æ€§ï¼Œæ‰€ä»¥æ— è®ºåœ¨æœ€åæˆ–è€…æ˜¯æœ€å¥½çš„è¾“å‡ºä¸­ï¼Œçº¢é»‘æ ‘çš„é«˜åº¦éƒ½ååˆ†ç¨³å®šï¼ˆ&lt;strong&gt;çº¢é»‘æ ‘å¯ä»¥èƒ½ç¡®ä¿æ ‘çš„æœ€é•¿è·¯å¾„ä¸å¤§äºä¸¤å€çš„æœ€çŸ­è·¯å¾„çš„é•¿åº¦&lt;/strong&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ç›¸å¯¹çš„ï¼Œçº¢é»‘æ ‘çš„æ“ä½œä¹Ÿè¾ƒä¸ºå¤æ‚ï¼Œæœ¬æ–‡å°†ä¼šä» &lt;strong&gt;2-3 æ ‘å‡ºå‘&lt;/strong&gt;ï¼Œä»‹ç» 2-3 æ ‘åˆ°çº¢é»‘æ ‘çš„æ¼”åŒ–ï¼Œæœ€åä»‹ç»ç›®å‰ STL æ¨¡å‹ä¸­çš„çº¢é»‘æ ‘æ¨¡å‹å®ç°ï¼Œè¯¦ç»†ä»‹ç»çº¢é»‘æ ‘çš„å‘å±•å†ç¨‹ï¼ˆçº¢é»‘æ ‘ç®—æ³•è¿˜åœ¨ä¸æ–­åœ°å®Œå–„ä¸­ï¼Œæœ¬æ–‡åªæ˜¯ç®€è¦åœ°å™è¿°æ¨¡å‹ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–æœ¬æ–‡åœ¨æœªæ¥è¿˜ä¼šè¡¥å…… AA æ ‘ç­‰å…¶ä»–çš„çº¢é»‘æ ‘å˜ç§ï¼Œä½†æ˜¯æ›´æ–°çœ‹å¿ƒæƒ…å’¯ï¼ˆå½“åœºå»ä¸–ï¼‰ã€‚AVL æ ‘çš„å†…å®¹æˆ‘ä¹Ÿä¼šç­‰æœªæ¥æ…¢æ…¢æ·»åŠ è¿›å»çš„ï¼Œä¸è¿‡ AVL æ ‘æ²¡æœ‰çº¢é»‘æ ‘åº”ç”¨å¹¿æ³›ï¼Œè€Œä¸”å®ç°æ–¹æ³•å…¶å®å’Œçº¢é»‘æ ‘åŸºæœ¬ä¸€æ ·ï¼Œæ‰€ä»¥å°±ç®€å•å™è¿°äº†ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆè¯´æ˜ä¸€ä¸‹ï¼Œæ ‘å’Œå“ˆå¸Œè¡¨çš„å¯¹æ¯”ï¼Œå“ˆå¸Œè¡¨çš„è¯»å–æ’å…¥æ€§èƒ½å¼ºäºæ ‘ï¼Œä½†æ˜¯å“ˆå¸Œè¡¨åœ¨é¢å¯¹æŒç»­è¾“å…¥æœªçŸ¥æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæ— æ³•åšåˆ°æ¯ä¸ªé”®å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œè€Œä¸”å“ˆå¸Œè¡¨éœ€è¦æ›´å¤§çš„ç©ºé—´æ¥å­˜æ”¾ï¼Œæ‰€ä»¥æ ‘åœ¨é’ˆå¯¹åŠ¨æ€æ•°æ®çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯ååˆ†é‡è¦çš„ã€‚è€Œå¯¹äºå·²çŸ¥çš„é™æ€æ•°æ®æ¥è¯´ï¼Œé€šè¿‡ä¸åŒçš„ç®—æ³•å®ç°å“ˆå¸Œè¡¨è¿˜æ˜¯æ›´ä¸ºé«˜æ•ˆçš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;äºŒå‰æ ‘çš„ç¼ºç‚¹&lt;/h2&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä½¿ç”¨äºŒå‰æ ‘ä½œä¸ºå„ç§å®¹å™¨çš„æ•°æ®ç»“æ„å‘¢ï¼Œå› ä¸ºäºŒå‰æ ‘çš„ç¨³å®šæ€§æ¯”è¾ƒå·®ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒäºŒå‰æ ‘çš„é«˜åº¦å…¶å®æ˜¯æ²¡æœ‰ä¿è¯çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨é‡åˆ°è¿ç»­é¡ºåºè¾“å…¥çš„æƒ…å†µä¸‹ï¼ŒäºŒå‰æ ‘çš„é«˜åº¦ä¼šéå¸¸çš„é«˜ï¼Œè¿™æ ·æŸ¥æ‰¾çš„æ—¶é—´æ•ˆç‡ä¼šè¿‘ä¼¼äº O(N)ï¼Œè¾¾ä¸åˆ°ä½¿ç”¨çš„è¦æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œäººä»¬åœ¨ä¸€å¼€å§‹å°±æ€è€ƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›å°å°çš„å˜æ¢ä½¿å¾—äºŒå‰æ ‘æˆä¸ºå¹³è¡¡çš„æ ‘å˜›ï¼Œäºæ˜¯å°±äº§ç”Ÿäº† AVL æ ‘ã€‚AVL æ ‘å’Œçº¢é»‘æ ‘ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æ ‘ï¼Œå®ç°è¿‡ç¨‹ä¹Ÿä¸çº¢é»‘æ ‘ç±»ä¼¼ï¼Œä½†æ˜¯ç”±äº AVL æ ‘å¯¹äºå¹³è¡¡çš„è¦æ±‚æ¯”è¾ƒä¸¥æ ¼ï¼Œæ‰€ä»¥åœ¨è‡ªå¹³è¡¡çš„è¿‡ç¨‹ä¸­ï¼Œæ—‹è½¬çš„æ¬¡æ•°æ¯”è¾ƒå¤šï¼Œè™½ç„¶ AVL æ ‘å’Œçº¢é»‘æ ‘çš„ç®—æ³•å¤æ‚åº¦ä¸€æ ·ï¼Œä½†æ˜¯ç»Ÿè®¡å‡ºçš„æ€§èƒ½ä¸å¦‚çº¢é»‘æ ‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-3-&#34;&gt;2-3 æŸ¥æ‰¾æ ‘&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿å¾—ä¸€ä¸ªæ ‡å‡†çš„äºŒå‰æŸ¥æ‰¾æ ‘åŒæ—¶å…·æœ‰äºŒå‰èŠ‚ç‚¹å’Œä¸‰å‰èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-28-RB-tree/2-3-1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;2-3 æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾è¡Œä¸ºï¼Œæ˜¯ä¸äºŒå‰æ ‘ç±»ä¼¼çš„ï¼Œä½†æ˜¯åˆæœ‰äº›ä¸åŒï¼Œå› ä¸ºå…·æœ‰äº†ä¸‰å‰èŠ‚ç‚¹ï¼Œæ‰€ä»¥æŸ¥æ‰¾çš„æ—¶å€™æœ‰å¯èƒ½é‡åˆ° 3 èŠ‚ç‚¹æˆ–è€… 2 èŠ‚ç‚¹ï¼Œéœ€è¦æ ¹æ®æƒ…å†µåˆ¤æ–­ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-28-RB-tree/2-3-2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å…·ä½“çš„ 2-3 æ ‘çš„æ’å…¥ï¼Œåˆ é™¤ï¼Œæ›¿æ¢ç»†èŠ‚ä¸åšè¿‡å¤šä»‹ç»ï¼Œä½†æ˜¯åœ¨çœ‹ä¸‹é¢çš„å†…å®¹ä¹‹å‰ï¼Œæœ€å¥½è¿˜æ˜¯å…ˆäº†è§£ä¸€ä¸‹ 2-3 æ ‘çš„å˜æ¢è¿‡ç¨‹ï¼š
&lt;a href=&#34;https://en.wikipedia.org/wiki/2%E2%80%933_tree#Operations&#34;&gt;2-3 Tree Operation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¾ˆç®€å•ï¼Œå®¹æ˜“ç†è§£ï¼Œ2 èŠ‚ç‚¹æ’å…¥å°±å˜ä¸º 3 èŠ‚ç‚¹ï¼Œ3 èŠ‚ç‚¹æ’å…¥å°±å˜æˆ 4 èŠ‚ç‚¹ï¼Œç„¶åè½¬å˜æˆä¸ºä¸‰ä¸ª 2 èŠ‚ç‚¹ï¼Œå…¶ä¸­çš„çˆ¶èŠ‚ç‚¹å’Œä¸Šå±‚èŠ‚ç‚¹ç»“åˆã€‚é€šè¿‡ä»”ç»†è§‚å¯Ÿï¼Œè¿™ä¸¤ç§å˜æ¢è¿‡ç¨‹éƒ½ä¿è¯äº†ä¸€ä¸ªç»†èŠ‚ï¼Œä¹Ÿå°±æ˜¯ä¸ç®¡æ€ä¹ˆæ’å…¥ï¼Œ2-3 æ ‘éƒ½æ˜¯å¹³è¡¡çš„ï¼Œçº¢é»‘æ ‘æ­£æ˜¯åˆ©ç”¨äº†è¿™ç§æ€§è´¨ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ä¼šä»‹ç»çº¢é»‘æ ‘çš„ç»“æ„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;çº¢é»‘æ ‘å®šä¹‰&lt;/h2&gt;
&lt;p&gt;æ—¢ç„¶å¤§å®¶éƒ½æœ‰ä¸€æ ·çš„æ€§è´¨ï¼Œä¸ºä»€ä¹ˆä¸ç”¨ 2-3 æ ‘è€Œåè¦ç”¨çº¢é»‘æ ‘å‘¢ï¼Ÿé€šè¿‡ä¹‹å‰çš„æè¿°æˆ‘ä»¬å°±èƒ½çœ‹å‡ºæ¥ï¼Œ2-3 æ ‘å…·æœ‰ä¸¤ç§èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸¤ç§åŒç±»å‹çš„èŠ‚ç‚¹ï¼Œå†æ’å…¥æ—¶éœ€è¦åœ¨ä¸¤ç§èŠ‚ç‚¹é—´è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå®ç°è¿™äº›è¿‡ç¨‹éœ€è¦å¤§é‡çš„ä»£ç ï¼Œè€Œä¸”æ•ˆç‡ä¹Ÿä¸é«˜ã€‚æˆ‘ä»¬å¸Œæœ›åˆ©ç”¨æ›´å°‘çš„ä»£ç å’Œå¼€é”€æ¥å®ç°è¿™ç§åŠŸèƒ½ï¼Œè¿™å°±æ˜¯çº¢é»‘æ ‘ã€‚&lt;/p&gt;
&lt;p&gt;çº¢é»‘æ ‘çš„åŸºæœ¬æ€æƒ³æ˜¯åªåˆ©ç”¨æ ‡å‡†çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå’Œä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼ˆé¢œè‰²ï¼‰æ¥è¡¨ç¤º 2-3 æ ‘ã€‚æ ‘ä¸­çš„é“¾æ¥è¢«åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯çº¢é“¾æ¥ï¼Œå¦å¤–ä¸€ç±»æ˜¯é»‘é“¾æ¥ã€‚è¢«çº¢é“¾æ¥é“¾æ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹ç›¸å½“äºæ˜¯ä¸€ä¸ªä¸‰èŠ‚ç‚¹ã€‚çº¢é“¾æ¥æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;çº¢é“¾æ¥å‡ä¸ºå·¦é“¾æ¥&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹åŒæ—¶å’Œä¸¤æ¡çº¢é“¾æ¥ç›¸è¿&lt;/li&gt;
&lt;li&gt;æ ‘æ˜¯å®Œç¾å¹³è¡¡çš„ï¼Œä»»æ„ NULL é“¾æ¥é€šå¾€æ ¹èŠ‚ç‚¹çš„è·¯å¾„ä¸Šï¼Œé»‘é“¾æ¥çš„æ•°é‡ä¸ºå®šå€¼ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;çº¢é»‘æ ‘çš„å®ç°&lt;/h2&gt;
&lt;p&gt;è¿™é‡Œçº¢é»‘æ ‘çš„å®ç°å‚è€ƒäº† STL å‡½æ•°åº“ï¼š&lt;/p&gt;
&lt;h3 id=&#34;rb-tree-node&#34;&gt;RB-Tree Node&lt;/h3&gt;
&lt;p&gt;çº¢é»‘æ ‘åˆ†ä¸ºçº¢é»‘ä¸¤ç§é¢œè‰²ï¼Œåœ¨æˆ‘ä»¬ä¹‹å‰çš„æè¿°ä¸­ï¼Œè¢«çº¢è‰²é“¾æ¥é“¾æ¥çš„å­èŠ‚ç‚¹ä¸ºçº¢è‰²èŠ‚ç‚¹ï¼Œè¢«é»‘è‰²é“¾æ¥é“¾æ¥çš„èŠ‚ç‚¹ä¸ºé»‘è‰²èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; __rb_tree_color_type;
&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; __rb_tree_color_type __rb_tree_red &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; false;
&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; __rb_tree_color_type __rb_tree_red &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; true;

&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;__rb_tree_node_base&lt;/span&gt;
{
	&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; __rb_tree_color_type color_type;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; __rb_tree_node_base&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; base_ptr;

	color_type color; &lt;span style=&#34;color:#75715e&#34;&gt;// Color of the node, RED or BLACK
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	base_ptr parent; &lt;span style=&#34;color:#75715e&#34;&gt;// Child node can trace back to Root
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	base_ptr left; &lt;span style=&#34;color:#75715e&#34;&gt;// Left child ptr
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	base_ptr right; &lt;span style=&#34;color:#75715e&#34;&gt;// Right child ptr
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; base_ptr &lt;span style=&#34;color:#a6e22e&#34;&gt;minimum&lt;/span&gt;(base_ptr x)
	{   &lt;span style=&#34;color:#75715e&#34;&gt;// Find the smallest value 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (x&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;left &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;left; 
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; x;
	}

	&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; base_ptr &lt;span style=&#34;color:#a6e22e&#34;&gt;maximum&lt;/span&gt;(base_ptr x)
	{
		&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (x&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;right &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;right;
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; x;
	}
};

&lt;span style=&#34;color:#66d9ef&#34;&gt;template&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;__rb_tree_node&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; __rb_tree_node_base 
{
	&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; __rb_tree_node&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; link_type;
	Value value_field;
};
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    <item>
      <title>FPGA EEPROM Communication</title>
      <link>https://xiahualiu.github.io/posts/2018-08-09-fpga-eeprom/</link>
      <pubDate>Thu, 09 Aug 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-08-09-fpga-eeprom/</guid>
      <description>&lt;p&gt;æœ¬æ–‡å°†ä¼šå°± FPGA çš„ I2C æ€»çº¿å®ç°è¿›è¡Œå®è·µï¼Œåœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå‡è±¡çš„ EEPROM å¯¹è±¡æ¥è¿›è¡Œæµ‹è¯•ï¼ŒéªŒè¯æˆ‘ä»¬è®¾è®¡çš„åˆç†æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;i2c-&#34;&gt;I2C æ€»çº¿ç‰©ç†å±‚ä¸é“¾è·¯å±‚&lt;/h2&gt;
&lt;p&gt;I2C ä¸ºä¸¤çº¿åŒå·¥æ€»çº¿ï¼Œä¸¤æ ¹çº¿åˆ†åˆ«ä¸º SCL å’Œ SDAã€‚ç©ºé—²æ—¶ SCL å’Œ SDA å‡ä¸ºé«˜ç”µå¹³ã€‚å¯åŠ¨ä¿¡å·ç”± SCL å¤„äºé«˜ç”µå¹³ï¼ŒSDA æ‹‰ä½å¼€å§‹ã€‚ä»è¿™ä¸ªæ—¶é—´åä¸»æœºè¾“å‡ºæ—¶é’Ÿ SCLï¼Œåœ¨ SCL å¤„äºä½ç”µå¹³çŠ¶æ€ä¸‹è¿›è¡Œ SDA æ”¹å˜ï¼ŒSCL é«˜ç”µå¹³æƒ…å†µä¸‹ SDA æ•°æ®è¢«é”å®šï¼Œç»™ä¸›æœºè¯»å–ï¼Œæœ€å SCL åœ¨é«˜ç”µå¹³æƒ…å†µä¸‹æ‹‰é«˜ SDA å®Œæˆä¼ è¾“ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¼ è¾“ 8 ä¸ªä½ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—èŠ‚åï¼Œä¸‹ä¸€ä¸ªä½çš„æ—¶é’ŸæœŸé—´ï¼Œå°†SDA é‡Šæ”¾ï¼Œæˆä¸ºé«˜ç”µå¹³ï¼Œæ¥æ”¶æ–¹å°†å…¶æ‹‰ä½ï¼Œåº”ç­”å®Œæ¯•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;eeprom-&#34;&gt;EEPROM æµ‹è¯•æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;æµ‹è¯•ä½¿ç”¨çš„ EEPROM æ¨¡å‹æ˜¯ä½¿ç”¨ FPGA å®ç°çš„ç†æƒ³åŒ–ç®€åŒ–è¡Œä¸ºæ¨¡å‹ï¼Œä»…ä»…ä¾›æµ‹è¯•ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* This file is made by EggyCat to implement AT24C02 */&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;`timescale&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;ns&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;ns
&lt;span style=&#34;color:#75715e&#34;&gt;`define&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; timeslice 100&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; EEPROM(scl, sda);
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; scl;
&lt;span style=&#34;color:#66d9ef&#34;&gt;inout&lt;/span&gt; sda;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; out_flag;

&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] memory[&lt;span style=&#34;color:#ae81ff&#34;&gt;2047&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;];
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] address;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] memory_buf;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] sda_buf;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] shift;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] addr_byte;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] ctrl_byte;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] State;

&lt;span style=&#34;color:#66d9ef&#34;&gt;integer&lt;/span&gt; i;

&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r7&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101111&lt;/span&gt;, w7&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101110&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 7
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r6&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101101&lt;/span&gt;, w6&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 6
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r5&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101011&lt;/span&gt;, w5&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101010&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 5
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r4&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101001&lt;/span&gt;, w4&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10101000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 4
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r3&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100111&lt;/span&gt;, w3&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100110&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 3
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r2&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100101&lt;/span&gt;, w2&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 2
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100011&lt;/span&gt;, w1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100010&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; r0&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100001&lt;/span&gt;, w0&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10100000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//memory page 0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; sda&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;sda_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&amp;#39;bz; &lt;span style=&#34;color:#75715e&#34;&gt;//sda whether output
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;initial&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
    addr_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    sda_buf&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00&lt;/span&gt;;
    memory_buf&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    address&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    shift&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(i&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;i&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2047&lt;/span&gt;;i&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        memory[i]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; sda)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(scl&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
            State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;State&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b01&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;//ModelSim6.0ç‰ˆæœ¬ä»¥ä¸Šè®¤ä¸ºzåˆ°1æ˜¯è´Ÿè·³å˜æ²¿
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b11&lt;/span&gt;)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;disable&lt;/span&gt; write_to_eeprom;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; sda)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(scl&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
        stop_W_R; &lt;span style=&#34;color:#75715e&#34;&gt;//ä¼ è¾“å®Œæ¯•
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;casex&lt;/span&gt;(State)
                &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b01&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; 
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    read_in;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w7 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w6 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w5 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w4 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w3 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w2 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w1 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;w0)
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                        State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10&lt;/span&gt;;
                        write_to_eeprom;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
						  &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
							State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00&lt;/span&gt;;
					 &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b11&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
                read_from_eeprom;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
                State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00&lt;/span&gt;;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; stop_W_R;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt; 
        State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00&lt;/span&gt;;
        addr_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
        ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
        out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
        sda_buf&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; read_in;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        shift_in(ctrl_byte);
        shift_in(addr_byte);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; write_to_eeprom;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        shift_in(memory_buf);
        address&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{ctrl_byte[&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;], addr_byte};
        memory[address]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;memory_buf;
        $display(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;eeprom---memory[%0h]=%0h&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, address, memory[address]);
        State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00&lt;/span&gt;;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; read_from_eeprom;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        shift_in(ctrl_byte);
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r7 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r6 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r5 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r4 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r3 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r2 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r1 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ctrl_byte&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;r0)
            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                address&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{ctrl_byte[&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;], addr_byte};
                sda_buf&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;memory[address];
                shift_out;
                State&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00&lt;/span&gt;;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; shift_in;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]shift;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; scl) shift[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; scl)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    #&lt;span style=&#34;color:#66d9ef&#34;&gt;`timeslice&lt;/span&gt;;
                    out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                    sda_buf&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; scl)
                #&lt;span style=&#34;color:#66d9ef&#34;&gt;`timeslice&lt;/span&gt; out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; shift_out;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(i&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;;i&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;i&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;i&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt; 
                @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; scl);
                #&lt;span style=&#34;color:#66d9ef&#34;&gt;`timeslice&lt;/span&gt;;
                sda_buf&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sda_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
        @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; scl) #&lt;span style=&#34;color:#66d9ef&#34;&gt;`timeslice&lt;/span&gt; sda_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
        @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; scl) #&lt;span style=&#34;color:#66d9ef&#34;&gt;`timeslice&lt;/span&gt; out_flag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading&#34;&gt;æ¨¡å—åˆ†æ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ EEPROM ä»¿çœŸæ¨¡å—æ˜¯ä½¿ç”¨çŠ¶æ€æœºæ¥è¿›è¡Œæ¨¡æ‹Ÿçš„ï¼Œ&lt;code&gt;State&lt;/code&gt; ä¸ºçŠ¶æ€å€¼ï¼ŒçŠ¶æ€æœºé—²ç½®çŠ¶æ€æ—¶ &lt;code&gt;State=2&#39;b00&lt;/code&gt;ï¼ŒEEPROMå¤„äºè¢«å†™çŠ¶æ€ä¸º &lt;code&gt;State=2&#39;b01&lt;/code&gt;ï¼ŒEEPROMå¤„äºè¢«è¯»çŠ¶æ€ä¸º &lt;code&gt;State=2&#39;b11&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯åŠ¨ä¿¡å·ä¸º sda çš„ä¸‹é™æ²¿å’Œ scl å¤„äºé«˜ç”µå¹³æ—¶ï¼Œç»“æŸä¼ è¾“ä¿¡å·æ˜¯ sda å¤„äºä¸Šå‡æ²¿ä¸” scl ä¸ºé«˜ç”µå¹³çŠ¶æ€ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œä¹Ÿå°±æ˜¯ sda å¤„äºä¸Šå‡æ²¿ä¸” scl å¤„äºä½ç”µå¹³çŠ¶æ€æ—¶ï¼ˆå› ä¸º EEPROM çš„ç¬¬ä¸€ä¸ªæ§åˆ¶ä½ä¸€å®šä¸º 1ï¼‰ï¼Œæˆ‘ä»¬å°±è®¤å®šå·²ç»å¼€å§‹ä¼ è¾“æ•°æ®ä½äº†ï¼Œè¿™æ—¶è§¦å‘ &lt;code&gt;read_in&lt;/code&gt; ä»»åŠ¡ï¼Œå¼€å§‹é¡ºåºåœ¨ scl çš„ä¸Šå‡æ²¿è¯»å– sda çš„æ•°æ®åˆ°æ§åˆ¶å­—èŠ‚å’Œæ•°æ®å­—èŠ‚ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åº”ç­”æ˜¯é€šè¿‡ä¸€ä¸ªè¿æ¥æ ‡å¿— &lt;code&gt;out_flag&lt;/code&gt; å®ç°çš„ï¼Œsda ä¼šåœ¨ &lt;code&gt;out_flag==1&lt;/code&gt; çš„æƒ…å†µä¸‹è¢«è¿æ¥åœ¨ sda_buf[7] ä¸Šé¢ã€‚åº”ç­”æ˜¯åœ¨æœ€åçš„ scl ä¸‹é™æ²¿æ‹‰ä½ sdaï¼Œæˆ‘ä»¬åœ¨æœ€åçš„ä¸‹é™æ²¿å°† sda_buf ç½®ä¸º 0ï¼Œå¹¶å°† &lt;code&gt;out_flag&lt;/code&gt; ç½® 1 è¿æ¥å³å¯ï¼Œåœ¨ä¸‹ä¸€ä¸ª scl ä¸‹é™æ²¿ï¼ˆæ­¤æ—¶åº”ç­”ç»“æŸï¼‰å°† &lt;code&gt;out_flag&lt;/code&gt; ç½® 0ï¼Œæ–­å¼€è¾“å‡ºï¼ˆsda ç½®ä¸ºé«˜é˜»ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¯»ä»»åŠ¡å®Œæˆåï¼ŒEEPROM è·å–äº†å¤–éƒ¨çš„æ²Ÿé€šä¿¡æ¯ï¼Œä¿¡æ¯åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯å¤–éƒ¨è¯·æ±‚è¯»æŸåœ°å€çš„æ•°æ®ï¼Œå¦ä¸€ç±»æ˜¯å¤–éƒ¨è¯·æ±‚å†™æŸåœ°å€çš„æ•°æ®ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥åˆ†æè¯·æ±‚æ˜¯è¯»è¿˜æ˜¯å†™ï¼Œä½¿ç”¨ if è¯­å¥æ¯”è¾ƒç¬¬ä¸€ä¸ªå­—èŠ‚ï¼ˆæ§åˆ¶å­—èŠ‚ï¼‰çš„ä¿¡æ¯ï¼Œå¦‚æœæ˜¯è¯·æ±‚å†™æ•°æ®ï¼Œé‚£ä¹ˆè§¦å‘å†™æ“ä½œä»»åŠ¡ï¼›ç›¸åå¦‚æœæ§åˆ¶å­—èŠ‚æ˜¯è¯»ä¿¡æ¯ï¼Œé‚£ä¹ˆè§¦å‘è¯»æ“ä½œä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;å†™æ“ä½œè¾ƒä¸ºç®€å•ï¼Œå› ä¸ºä¸æ¶‰åŠåº”ç­”ï¼Œè€Œè¯»æ“ä½œéœ€è¦åº”ç­”ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¯»ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°†éœ€è¦å‘é€çš„è¾“å‡ºæ”¾ç½®åœ¨ sda_buf ä¸­ï¼Œç„¶åè¿æ¥ sda
å’Œ sda_buf(&lt;code&gt;out_flag=1&lt;/code&gt;)ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ä¹‹å‰ read_in çš„æœ€å scl ä¸‹é™æ²¿æ²¡æœ‰æ”¹å˜æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸€å¼€å§‹è¿æ¥çš„æ—¶å€™å°±ç›¸å½“äºå·²ç»å‘é€å‡ºå»äº†ä¸€ä½æ•°æ®ã€‚ä¸ºäº†é¿å…å†’é™©ï¼Œæˆ‘ä»¬å®šä¹‰äº† `timeslice å»¶è¿Ÿï¼Œåœ¨è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨éé˜»å¡çš„æ–¹æ³•é¿å…å†’é™©ã€‚åœ¨å‘é€å®Œç¬¬ 8 ä½åï¼Œæ–­å¼€è¿æ¥é‡Šæ”¾æ€»çº¿ï¼Œç­‰å¾…ä¸»æœºæ‹‰é«˜ sdaï¼ˆä¸»æœºæ¥æ”¶å™¨ä¸åº”ç­”ï¼‰ç»“æŸé€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Quartus Prime Lite ä¸­ç¼–è¯‘æç¤ºï¼Œåœ¨ &lt;code&gt;task shift_in&lt;/code&gt; é‡Œé¢ä¸èƒ½äº§ç”Ÿå¤šäº‹ä»¶åºåˆ—ï¼Œç»¼åˆå¤±è´¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;-eeprom-&#34;&gt;å¯ç»¼åˆçš„ EEPROM è¯»å†™å™¨æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;ç¨‹åºå®é™…ä¸Šæ˜¯ä¸€ä¸ªåµŒå¥—çš„çŠ¶æ€æœºï¼Œç”±ä¸»çŠ¶æ€æœºå’Œä»çŠ¶æ€æœºé€šè¿‡æ§åˆ¶çº¿å¯åŠ¨çš„æ€»çº¿åœ¨ä¸åŒçš„è¾“å…¥ä¿¡å·æƒ…å†µä¸‹æ„æˆä¸åŒåŠŸèƒ½çš„è¾ƒå¤æ‚å¾—åˆ°æœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¤ä¸ªçŠ¶æ€æœºçš„æ¨¡å‹ï¼Œåˆ†åˆ«ä¸ºæ§åˆ¶æ—¶åºç”µè·¯å’Œå¼€å…³ç»„åˆç”µè·¯ï¼Œå¼€å…³ç»„åˆç”µè·¯æ§åˆ¶æ€»çº¿çš„å¼€é—­ï¼Œæœ‰èŠ‚å¥åœ°æ‰“å¼€æˆ–è€…é—­åˆï¼Œè¿™æ · SDA å¯ä»¥æŒ‰ç…§ I2C æ•°æ®æ€»çº¿çš„æ ¼å¼è¾“å…¥å’Œè¾“å‡ºï¼Œä½¿å¾— SDA å’Œ SCL ä¸€èµ·å®Œæˆ EEPROM çš„è¯»å†™æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-9-FPGA-EEPROM/struct.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å…¶çŠ¶æ€æœºçš„çŠ¶æ€è½¬ç§»å›¾å¦‚ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-9-FPGA-EEPROM/FSM.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;çŠ¶æ€æœºçš„çŠ¶æ€ç¼–ç é‡‡ç”¨ç‹¬çƒ­ç¼–ç ï¼Œå‡å°‘å®ç°çŠ¶æ€æœºçš„ç»„åˆé€»è¾‘æ•°ç›®ï¼Œå‡å°‘å¤æ‚æ€§ï¼Œæé«˜ç³»ç»Ÿçš„é€Ÿåº¦ï¼Œé€šå¸¸ç”¨äºé«˜é€ŸçŠ¶æ€æœºä¸­ï¼ˆä¹Ÿæœ‰ç¼–ç è¾“å‡ºå‹çŠ¶æ€æœºï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;`timescale&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;ns&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;ns

&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; EEPROM_WR(SDA, SCL, ACK, RESET, CLK, WR, RD, ADDR, DATA);
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; SCL;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; ACK;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; RESET;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; CLK;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; WR, RD;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] ADDR;
&lt;span style=&#34;color:#66d9ef&#34;&gt;inout&lt;/span&gt; SDA;
&lt;span style=&#34;color:#66d9ef&#34;&gt;inout&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] DATA;

&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; ACK;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; SCL;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; WF, RF;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; FF;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] head_buf;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] stop_buf;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] sh8out_buf;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] sh8out_state;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] sh8in_state;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] head_state;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] stop_state;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] main_state;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] data_from_rm;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; link_sda;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; link_read;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; link_head;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; link_write;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; link_stop;
&lt;span style=&#34;color:#66d9ef&#34;&gt;wire&lt;/span&gt; sda1, sda2, sda3, sda4;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Switch Signal */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; sda1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(link_head)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; head_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; sda2&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(link_write)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; sh8out_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; sda3&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(link_stop)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; stop_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; sda4&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(sda1&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;sda2&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;sda3);
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; SDA&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(link_sda)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; sda4: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&amp;#39;bz;
&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; DATA&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(link_read)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; data_from_rm &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&amp;#39;hzz;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Main FSM State Definition */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt;
    IDLE        &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00000000001&lt;/span&gt;,
    Ready       &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00000000010&lt;/span&gt;,
    Write_start &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00000000100&lt;/span&gt;,
    Ctrl_write  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00000001000&lt;/span&gt;,
    Addr_write  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00000010000&lt;/span&gt;,
    Data_write  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00000100000&lt;/span&gt;,
    Read_start  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00001000000&lt;/span&gt;,
    Ctrl_read   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00010000000&lt;/span&gt;,
    Data_read   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b00100000000&lt;/span&gt;,
    Stop        &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b01000000000&lt;/span&gt;,
    Ackn        &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10000000000&lt;/span&gt;,

&lt;span style=&#34;color:#75715e&#34;&gt;/* Parallel to Serial Output State Definition */&lt;/span&gt;
    sh8out_bit7 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b000000001&lt;/span&gt;,
    sh8out_bit6 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b000000010&lt;/span&gt;,
    sh8out_bit5 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b000000100&lt;/span&gt;,
    sh8out_bit4 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b000001000&lt;/span&gt;,
    sh8out_bit3 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b000010000&lt;/span&gt;,
    sh8out_bit2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b000100000&lt;/span&gt;,
    sh8out_bit1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b001000000&lt;/span&gt;,
    sh8out_bit0 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b010000000&lt;/span&gt;,
    sh8out_end  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b100000000&lt;/span&gt;,

&lt;span style=&#34;color:#75715e&#34;&gt;/* Serial to Parallel Output State Definition */&lt;/span&gt;
    sh8in_begin &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0000000001&lt;/span&gt;,
    sh8in_bit7  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0000000010&lt;/span&gt;,
    sh8in_bit6  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0000000100&lt;/span&gt;,
    sh8in_bit5  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0000001000&lt;/span&gt;,
    sh8in_bit4  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0000010000&lt;/span&gt;,
    sh8in_bit3  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0000100000&lt;/span&gt;,
    sh8in_bit2  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0001000000&lt;/span&gt;,
    sh8in_bit1  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0010000000&lt;/span&gt;,
    sh8in_bit0  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0100000000&lt;/span&gt;,
    sh8in_end   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1000000000&lt;/span&gt;,

&lt;span style=&#34;color:#75715e&#34;&gt;/* Start of Transmission */&lt;/span&gt;
    head_begin &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b01&lt;/span&gt;,
    head_bit   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10&lt;/span&gt;,

&lt;span style=&#34;color:#75715e&#34;&gt;/* End of Transmission */&lt;/span&gt;
    stop_begin &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b001&lt;/span&gt;,
    stop_bit   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b010&lt;/span&gt;,
    stop_end   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b100&lt;/span&gt;,

    YES &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;,
    NO  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Generate SCL (CLK divided by 2) */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(&lt;span style=&#34;color:#66d9ef&#34;&gt;negedge&lt;/span&gt; CLK)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(RESET)
        SCL&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
        SCL&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;SCL;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Main FSM Status */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; CLK)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(RESET) &lt;span style=&#34;color:#75715e&#34;&gt;// RESET
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
            link_read  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
            link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
            link_head  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
            link_stop  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
            link_sda   &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
            ACK        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
            RF         &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
            WF         &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
            FF         &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
            main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDLE;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;casex&lt;/span&gt;(main_state)
                IDLE:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                        link_read  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_head  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_stop  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_sda   &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(WR)
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                                WF&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                                main_state&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;Ready;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(RD)
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                                RF&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                                main_state&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;Ready;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                                WF&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                                RF&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                                main_state&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;IDLE;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Ready:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                        link_read  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_head  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                        link_stop  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                        link_sda   &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                        head_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10&lt;/span&gt;;
                        stop_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b01&lt;/span&gt;;
                        head_state    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_begin;
                        FF  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                        ACK &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                        main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Write_start;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Write_start:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift_head;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            sh8out_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;, ADDR[&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;], &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;};
                            link_head &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                            link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                            sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit6;
                            main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Ctrl_write;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Ctrl_write:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift8_out;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(WF)
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit7;
                                    sh8out_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DATA;
                                    main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Data_write;
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(RF)
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                                    head_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10&lt;/span&gt;;
                                    head_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_begin;
                                    main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Read_start;
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Addr_write:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift8_out;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(WF)
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt; 
                                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit7;
                                    sh8out_buf[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DATA;
                                    main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Data_write;
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(RF)
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                                    head_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b10&lt;/span&gt;;
                                    head_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_begin;
                                    main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Read_start;
                                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Data_write:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift8_out;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_begin;
                            main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Stop;
                            link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                
                Read_start:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift_head;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;, ADDR[&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;], &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;};
                            link_head &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                            link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                            link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                            sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit6;
                            main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Ctrl_read;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Data_read:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift8in;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            link_stop &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                            link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                            stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_bit;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                            main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Stop;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
                
                Stop:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(FF&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
                        shift_stop;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                            ACK &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                            FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                            main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Ackn;
                        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                Ackn:
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                        ACK &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                        WF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                        RF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                        main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDLE;
                    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

                &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; 
                    main_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDLE;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Serial to Parallel Task */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; shift8in;
&lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;casex&lt;/span&gt;(sh8in_state)
        sh8in_begin:
            sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit7;
        sh8in_bit7:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit6;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit7;
        sh8in_bit6:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit5;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit6;
        sh8in_bit5:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit4;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit5;
        sh8in_bit4:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit3;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit4;
        sh8in_bit3:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit2;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit3;
        sh8in_bit2:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit1;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit2;
        sh8in_bit1:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit0;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit1;
        sh8in_bit0:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    data_from_rm[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SDA;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_end;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit0;
        sh8in_end:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_read &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                    sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit7;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_end;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                link_read &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                sh8in_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8in_bit7;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Parallel to Serial Task */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; shift8_out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;casex&lt;/span&gt;(sh8out_state)
        sh8out_bit7:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit6;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit7;
        sh8out_bit6:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit5;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit6;
        sh8out_bit5:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit4;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit5;
        sh8out_bit4:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit3;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit4;
        sh8out_bit3:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit2;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit3;
        sh8out_bit2:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit1;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit2;
        sh8out_bit1:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit0;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit1;
        sh8out_bit0:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_end;
                    sh8out_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_buf&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_bit0;
        sh8out_end:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                    link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                    FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                sh8out_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sh8out_end;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;/* Start of Transmission Task */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; shift_head;
&lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;casex&lt;/span&gt;(head_state)
        head_begin:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
                    link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    link_head &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    head_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_bit;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                head_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_begin;
        head_bit:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                    head_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                    head_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_bit;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                head_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; head_bit;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;/* End of Transmission */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; shift_stop;
&lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;casex&lt;/span&gt;(stop_state)
        stop_begin:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    link_write &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                    link_stop &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; YES;
                    stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_bit;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_begin;
        stop_bit:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    stop_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_buf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                    stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_end;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_bit;
        stop_end:
            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;SCL)
                &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
                    link_head &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                    link_stop &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                    link_sda &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NO;
                    FF &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
                &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
                stop_state &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stop_end;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading-1&#34;&gt;è¯»å†™å™¨æ¨¡å‹è§£æ&lt;/h2&gt;
&lt;p&gt;åœ¨è¿™ä¸ªè¯»å†™å™¨æ¨¡å‹ä¸­ï¼Œæˆ‘è®¤ä¸ºéš¾ç‚¹åœ¨äºä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å¼€å…³çš„æ§åˆ¶ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯çŠ¶æ€æœºçŠ¶æ€çš„è½¬æ¢è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬æ¥è®¨è®ºå¼€å…³çš„æ§åˆ¶ã€‚æˆ‘ä»¬ç”¨äº†å››ä¸ªå¼€å…³æ¥æ§åˆ¶ SDA çº¿çš„è¾“å…¥å’Œè¾“å‡ºï¼Œå…¶ä¸­ &lt;code&gt;link_sda&lt;/code&gt; ä¸ºæ€»çš„ä½¿èƒ½å¼€å…³ï¼Œæ§åˆ¶ç€æ€»çº¿çš„é‡Šæ”¾è¿˜æ˜¯å æ®ï¼Œé‡Šæ”¾çš„æ—¶å€™ï¼Œsda å¤„äºé«˜é˜»æ€ï¼Œä¹Ÿå°±æ˜¯å¤„äºè¯»å–çŠ¶æ€ã€‚è€Œå‰©ä½™çš„ä¸‰ä¸ªå¼€å…³ &lt;code&gt;link_head&lt;/code&gt;/&lt;code&gt;link_write&lt;/code&gt;/&lt;code&gt;link_stop&lt;/code&gt; ä»…ä»…æ§åˆ¶ sda çš„ç§»ä½å¯„å­˜å™¨è¿æ¥å…³ç³»ï¼Œè€Œè¿™ä¸‰ä¸ªå¼€å…³æ˜¯äº’æ–¥çš„ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶ sda æ‰€è¿æ¥çš„å¯„å­˜å™¨åªå¯èƒ½æ˜¯ â€œå¯åŠ¨ä¿¡å·â€ï¼Œâ€œæ•°æ®ä¿¡å·â€ï¼Œâ€œåœæ­¢ä¿¡å·â€ ä¸­çš„ä¸€ç§å¯„å­˜å™¨ä¸­çš„æœ€é«˜ä½ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥å¯åŠ¨ä¿¡å·å’Œåœæ­¢ä¿¡å·éƒ½æ˜¯ä¸¤ä½çš„å¯„å­˜å™¨ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬è¦é€šè¿‡ &lt;strong&gt;ä½ç§»å¯„å­˜å™¨&lt;/strong&gt; æ¥äº§ç”Ÿè·³è¾¹æ²¿ã€‚è€Œæ•°æ®å¯„å­˜å™¨æ²¡æœ‰å¤šäºä¸€ä½ï¼Œæˆ‘ä»¬åœ¨æè¿°ä¸­&lt;code&gt;shift8_out&lt;/code&gt; ä»»åŠ¡ä¸­ï¼Œ8 ä½çš„æ•°æ®åªä½ç§»äº† 7 æ¬¡ï¼Œç¬¬ä¸€æ¬¡åªè¿æ¥å¯„å­˜å™¨ï¼Œè€Œä¸ä½ç§»ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å‘é€å®Œå¯åŠ¨ä¿¡å·ä¹‹åçš„ &lt;code&gt;Write_start&lt;/code&gt; çŠ¶æ€ä¸­ï¼Œæˆ‘ä»¬çš„ &lt;code&gt;shift8_out&lt;/code&gt; æ˜¯ä»ç¬¬ bit6 çŠ¶æ€å¼€å§‹çš„ï¼Œå› ä¸ºåœ¨è¿™ä¹‹å‰å·²ç»å®Œæˆäº†å¼€å…³ï¼Œç›¸å½“äºå·²ç»å‘é€äº†ä¸€ä½äº†ã€‚è€Œåœ¨ &lt;code&gt;Addr_write&lt;/code&gt; ä¸­ï¼Œæˆ‘ä»¬åˆ™æ˜¯ä» bit7 çŠ¶æ€å¼€å§‹çš„ï¼Œå› ä¸ºæˆ‘ä»¬å…¶å®åœ¨è¿™ä¸ªæ—¶å€™ç©ºå‡ºäº†ä¸€ä¸ª SCL çš„ä½ç”µå¹³æ€»çº¿æ²¡æœ‰å æ®ï¼Œåœ¨è¿™ä¸ªæ—¶é—´å†…æ˜¯åº”ç­”ä¿¡å·çš„æ—¶é—´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;-rtl-&#34;&gt;çŠ¶æ€æœºåˆ†æå’Œ RTL ç½‘è¡¨&lt;/h2&gt;
&lt;p&gt;çŠ¶æ€æœºçš„åˆ†æå¾ˆæ¸…æ™°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-9-FPGA-EEPROM/Serial_Check_main_state.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç›¸æ¯”ä¹‹ä¸‹ï¼ŒRTL ç½‘è¡¨çš„åˆ†æå°±æœ‰äº›å¤æ‚äº†ï¼Œå› ä¸ºæˆ‘ä»¬è®¾è®¡çš„çŠ¶æ€æœºç”¨åˆ°äº†è®¸å¤šå¯„å­˜å™¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-9-FPGA-EEPROM/RTL.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†å¯¹äº EEPROM è¯»å†™å™¨çš„æ¨¡å‹å»ºç«‹è¿‡ç¨‹ï¼Œåœ¨æœªæ¥æˆ‘ä»¬å°†ä¼šå¯¹äºè¿™ä¸ªæ¨¡å‹ä½¿ç”¨æˆ‘ä»¬å†™å¥½çš„ EEPROM æ¨¡å—è¿›è¡Œæµ‹è¯•ã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>Some Verilog HDL Modules</title>
      <link>https://xiahualiu.github.io/posts/2018-08-08-verilog-example/</link>
      <pubDate>Wed, 08 Aug 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-08-08-verilog-example/</guid>
      <description>&lt;p&gt;æœ¬æ–‡å°†ä¼šä¸å®šæœŸæ›´æ–°ä¸€äº›å¸¸è§çš„ Verilog HDL æ¨¡å—å®ä¾‹ä¾›å¤§å®¶å­¦ä¹ ã€‚å¦‚æœå¯¹äºæ•°å­—ç”µè·¯ä¸æ˜¯å¾ˆç†è§£ï¼Œæˆ–è€…å¯¹äºè¯­æ³•ä¸æ˜¯å¾ˆç†Ÿç»ƒï¼Œå¯ä»¥å€Ÿé‰´è¿™é‡Œçš„ä¾‹å­ï¼Œç»“åˆè‡ªå·±çš„é¡¹ç›®è¿›è¡Œæ¨¡å—å¼€å‘ã€‚&lt;/p&gt;
&lt;p&gt;FPGA è®¾è®¡æ¨¡å¼åˆ†ä¸ºç»„åˆé€»è¾‘è®¾è®¡å’Œæ—¶åºé€»è¾‘è®¾è®¡ï¼Œæˆ‘ä»¬å°†è¿™ä¸¤ç±»åˆ†å¼€è®¨è®ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;ç»„åˆé€»è¾‘&lt;/h2&gt;
&lt;h3 id=&#34;8-&#34;&gt;8 ä½å¸¦è¿›ä½ç«¯çš„åŠ æ³•å™¨è®¾è®¡å®ä¾‹&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; adder_8(cout, sum, a, b, cin);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; cout;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] sum;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; cin;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] a, b;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; {cout, sum} &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; b &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; cin;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;always&#34;&gt;æŒ‡ä»¤è¯‘ç ç”µè·¯è®¾è®¡å®ä¾‹ï¼ˆalwaysï¼‰&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;`define&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; plus 3&amp;#39;d0&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;`define&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; minus 3&amp;#39;d1&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;`define&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; band 3&amp;#39;d2&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;`define&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; bor 3&amp;#39;d3&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;`define&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; unegate 3&amp;#39;d4&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; alu(out, opcode, a, b);
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] opcode;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] a, b;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(opcode &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; a &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; b)
&lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt;(opcode)
        &lt;span style=&#34;color:#66d9ef&#34;&gt;`plus&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;b;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;`minus&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;b;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;`band&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;b;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;`bor&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;b;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;`unegate&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;a;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&amp;#39;hx;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;task--always&#34;&gt;ä¿¡å·é‡ç»„ç»„åˆé€»è¾‘ï¼ˆtask å’Œ alwaysï¼‰&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; sort4(ra, rb, rc, rd, a, b, c, d);
&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; t&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [t:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] ra, rb, rc, rd;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [t:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] a, b, c, d;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [t:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] ra, rb, rc, rd;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(a &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; b &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; c &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; d)
&lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; local &lt;span style=&#34;color:#75715e&#34;&gt;//å› ä¸ºå—æœ‰å±€éƒ¨å˜é‡ï¼Œå—å¿…é¡»æœ‰åå­—
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt;[t:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] va, vb, vc, vd;
    {va, vb, vc, vd}&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{a, b, c, d};

    sort2(va,vc);
    sort2(vb,vd);
    sort2(va,vb);
    sort2(vc,vd);
    sort2(vb,vc);

    {ra, rb, rc, rd}&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{va, vb, vc, vd};
&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;task&lt;/span&gt; sort2;
&lt;span style=&#34;color:#66d9ef&#34;&gt;inout&lt;/span&gt; [t:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] x, y;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [t:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] tmp;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(x&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;y)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        tmp&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;x;
        x&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;y;
        t&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tmp;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endtask&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-1&#34;&gt;æ¯”è¾ƒå™¨çš„è®¾è®¡å®ä¾‹ï¼ˆåˆ©ç”¨èµ‹å€¼è¯­å¥è®¾è®¡ç»„åˆé€»è¾‘ï¼‰&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; compare(equal, a, b);
&lt;span style=&#34;color:#66d9ef&#34;&gt;parameter&lt;/span&gt; size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; equal;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [size&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] a, b;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; equal&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(a&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;b)&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;3-8-&#34;&gt;3-8 è¯‘ç å™¨çš„å®ç°ï¼ˆåˆ©ç”¨èµ‹å€¼è¯­å¥è®¾è®¡ç»„åˆé€»è¾‘ï¼‰&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; decoder(out, in);
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] in;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;in;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-2&#34;&gt;å¤šè·¯å™¨çš„è®¾è®¡å®ä¾‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;åˆ©ç”¨èµ‹å€¼è®¾è®¡ç»„åˆé€»è¾‘&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; emux1(out, a, b, sel);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; out;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; a, b, sel;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;sel&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;a:b;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;åˆ©ç”¨ always case è®¾è®¡ç»„åˆé€»è¾‘&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; mux2(out, a, b, sel);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; out;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; a, b, sel;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; out;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(a &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; b &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; sel)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt;(sel)
            &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a;
            &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;b;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;#39;bx;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;endcase&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;åˆ©ç”¨ always if è®¾è®¡ç»„åˆé€»è¾‘&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; mux3(out, a, b, sel);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; out;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; a, b, sel;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; out;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(a &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; b &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; sel)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(sel)
            out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
            out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;b;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-3&#34;&gt;å¥‡å¶æ ¡éªŒä½ç”Ÿæˆå™¨è®¾è®¡å®ä¾‹&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; parity(even_numbits, odd_numbits, input_bus);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; even_numbits, odd_numbits;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] input_bus;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; odd_numbits&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;^&lt;/span&gt;input_bus;
    &lt;span style=&#34;color:#75715e&#34;&gt;//assign b=^a; equals assign b=a[0]^a[1]^a[2]^a[3]^a[4]^a[5]^a[6]^a[7];
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; even_numbits&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;odd_numbits;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-4&#34;&gt;ä¸‰æ€è¾“å‡ºé©±åŠ¨å™¨&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;è®¾è®¡æ–¹æ¡ˆ1ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; trist1(out, in, enable);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; out;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; in, enable;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;enable&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;in:&amp;#39;bz;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;è®¾è®¡æ–¹æ¡ˆ2ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; trist2(out, in, enable);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; out;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; in, enable;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;bufif1&lt;/span&gt; mubuf1(out, in, enable);
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-5&#34;&gt;ä¸‰æ€åŒå‘é©±åŠ¨å™¨è®¾è®¡å®ä¾‹&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; bidir(tri_inout, out, in, en, b);
&lt;span style=&#34;color:#66d9ef&#34;&gt;inout&lt;/span&gt; tri_out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; in, en, b;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; tri_inout&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;en&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;in:&amp;#39;bz;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tri_inout&lt;span style=&#34;color:#f92672&#34;&gt;^&lt;/span&gt;b;
    &lt;span style=&#34;color:#75715e&#34;&gt;//tri_inout ç«¯å£è¾“å‡º in ä¿¡å·ï¼Œè¾“å…¥ä¿¡å·è½¬äº¤ out
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading-6&#34;&gt;æ—¶åºé€»è¾‘ç”µè·¯è®¾è®¡å®ä¾‹&lt;/h2&gt;
&lt;h3 id=&#34;d-&#34;&gt;D è§¦å‘å™¨è®¾è®¡å®ä¾‹&lt;/h3&gt;
&lt;p&gt;D è§¦å‘å™¨ç›®å‰æ­£åœ¨é€æ¸æ›¿ä»£å·²ç»æ·˜æ±°çš„ JK è§¦å‘å™¨ï¼Œæœ¬è®¾è®¡ä»¥ D è§¦å‘å™¨ä¸ºè®¾è®¡å¯¹è±¡ã€‚D è§¦å‘å™¨åœ¨æ—¶é’Ÿä¸Šå‡æ²¿åŒæ­¥è¾“å…¥è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; dff(q, data, clk);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; q;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; data, clk;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; q;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; clk)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        q&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;data;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-7&#34;&gt;ç”µå¹³æ•æ„Ÿå‹é”å­˜å™¨è®¾è®¡å®ä¾‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;è®¾è®¡æ–¹æ¡ˆ1&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; latch1(q, data, clk);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; q;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; data, clk;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; q&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;clk&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;data:q;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;è®¾è®¡æ–¹æ¡ˆ2&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; latch1(q, data, clk);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; q;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; data, clk;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; q; &lt;span style=&#34;color:#75715e&#34;&gt;//å› ä¸ºè¦ç”¨ always å—
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(clk &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; data)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(clk)
        q&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;data;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-8&#34;&gt;å¸¦ç½®ä½å’Œå¤ä½ç«¯å£çš„ç”µå¹³æ•æ„Ÿå‹é”å­˜å™¨è®¾è®¡å®ä¾‹&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; latch2(q, data, clk, set, reset);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; q;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; data, clk, set, reset;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; q&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;reset&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;(set&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;(clk&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;data:q));
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-9&#34;&gt;ç§»ä½å¯„å­˜å™¨è®¾è®¡å®ä¾‹&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; shifter(din, clk, clr, dout);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; din, clk, clr;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] dout;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] dout;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(posegde clk)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(clr)
            dout&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;#39;b0&lt;/span&gt;;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
            dout&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;dout&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
            dout[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;din;
            &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;8--1&#34;&gt;8 ä½è®¡æ•°å™¨çš„è®¾è®¡å®ä¾‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;è®¾è®¡å®ä¾‹1&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; counter1(out, cout, data, load, cin, clk);
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; cout;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] data;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; load, cin, clk;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(&lt;span style=&#34;color:#66d9ef&#34;&gt;posedge&lt;/span&gt; clk)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(load)
            out&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;data;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
            out&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;out&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;cin;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; cout&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;out)&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;cin;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;è®¾è®¡å®ä¾‹2&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; counter2(out, cout, data, load, cin, clk);
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; cout;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] data;
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; load, cin, clk;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] out;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; cout;
&lt;span style=&#34;color:#66d9ef&#34;&gt;reg&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] preout;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(posegde clk)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        out&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;preout;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;always&lt;/span&gt; @(out &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; data &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; load &lt;span style=&#34;color:#66d9ef&#34;&gt;or&lt;/span&gt; cin)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;begin&lt;/span&gt;
        {cout, preout}&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;out&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;cin;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(load)
            preout&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;data;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    <item>
      <title>Adder and Multiplier in FPGA</title>
      <link>https://xiahualiu.github.io/posts/2018-08-07-claa/</link>
      <pubDate>Tue, 07 Aug 2018 10:48:30 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-08-07-claa/</guid>
      <description>&lt;p&gt;æœ¬æ–‡å°†ä¼šå°±åœ¨ FPGA ä¸­å¦‚ä½•å®ç°åŠ æ³•å™¨ä¸ä¹˜æ³•å™¨è¿›è¡Œä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼Œå¹¶ä¸”åœ¨åé¢æä¾›äº†ä¸€äº›ä¼˜åŒ–çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;åŠ æ³•å™¨&lt;/h2&gt;
&lt;p&gt;åŠ æ³•å™¨åœ¨ã€Šæ•°å­—ç”µè·¯ã€‹è¯¾ç¨‹ä¸­å¤§å®¶éƒ½æœ‰å­¦è¿‡ï¼Œåœ¨è¯¾ç¨‹ä¸­æåˆ°ä¸¤ç§åŠ æ³•ç”µè·¯ï¼Œä¹Ÿå³ &lt;strong&gt;åŠåŠ å™¨&lt;/strong&gt; å’Œ &lt;strong&gt;å…¨åŠ å™¨&lt;/strong&gt;ã€‚åŠåŠ å™¨æ²¡æœ‰è¿›ä½è¾“å…¥æœ‰è¿›ä½è¾“å‡ºï¼Œè€Œå…¨åŠ å™¨æ—¢å…·æœ‰è¿›ä½è¾“å…¥ä¹Ÿæœ‰è¿›ä½è¾“å‡ºã€‚å…¨åŠ å™¨çš„ç«¯å£æœ‰ 5 ä¸ªï¼Œåˆ†åˆ«ä¸º $Xï¼ŒYï¼ŒC_{i-1}ï¼ŒSï¼ŒC_i$ã€‚$X$ï¼Œ$Y$ æ˜¯ä¸¤ä¸ªåŠ æ•°ï¼Œ$S_i$ è¡¨ç¤ºå’Œï¼Œ$C_{i-1}$ ä¸ºæ¥è‡ªä½ä½çš„è¿›ä½ï¼Œ$C_i$ ä¸ºå‘é«˜ä½çš„è¿›ä½ã€‚ä»çœŸå€¼è¡¨ä¸­æˆ‘ä»¬å¾ˆå®¹æ˜“å†™å‡ºä»¥ä¸‹çš„é€»è¾‘è¡¨è¾¾å¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;$X_i$&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;$Y_i$&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;$C_{i-1}$&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;$S_i$&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;$C_i$&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;$$C_i=X_iY_i+Y_iC_{i-1}+X_iC_{i-1}$$&lt;/p&gt;
&lt;p&gt;$$S_i=X_i\overline{C_i}+Y_i\overline{C_i}+C_{i-1}\overline{C_i}+X_iY_iC_{i-1}$$&lt;/p&gt;
&lt;p&gt;ä»¤ $P_i=X_i\oplus Y_i \quad G=X_i \cdot Y_i$ ,æˆ‘ä»¬å¯ä»¥å°†é€»è¾‘å¼åŒ–ç®€ä¸ºä»¥ä¸‹å½¢å¼ã€‚ï¼ˆ$S_i$ çš„å½¢å¼å°±æ˜¯ä¸‰è¿å¼‚æˆ–çš„å±•å¼€å¼ï¼Œè¯·ç‰¢è®°ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;$$S_i=P_i \oplus C_{i-1}$$&lt;/p&gt;
&lt;p&gt;$$ C_i=P_i \cdot C_{i-1} + G_i$$
å¯¹äºå¡è¯ºå›¾(Karnaugh Map)çš„åŒ–ç®€å¾—åˆ°é€»è¾‘è¡¨è¾¾å¼æˆ‘ä»¬ä¸åšè¿‡å¤šçš„ä»‹ç»ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºå…·æœ‰è¿›ä½è¾“å…¥å’Œè¾“å‡ºï¼Œæˆ‘ä»¬æ‰€åˆ—å‡ºæ¥çš„ä¸€ä½å…¨åŠ å™¨ï¼Œæ‹¥æœ‰äº†ä¸æ›´å¤šå…¨åŠ å™¨ä¸²è¡Œè¿æ¥ï¼Œç»„æˆå¤šä½åŠ æ³•å™¨çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/Serial-Adder.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè®¡ç®—çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªä¸²è¡Œçš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯æœ€åçš„ $C_{out}$ ä¿¡å·éœ€è¦ä»ä¸€å¼€å§‹çš„ $C_{in}$ ä¸€ç›´ä¼ é€’åˆ°æœ€åï¼Œç»è¿‡äº†å¤šå°‘çš„é—¨å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªå…¨åŠ å™¨æ‹†å¼€æ¥çœ‹ä¸€ä¸‹å†…éƒ¨çš„ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/Full-Adder.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ä¸­çš„çº¢çº¿å°±æ˜¯è®¡ç®—ä¸­ï¼Œè¿›ä½ä¿¡å·æ‰€ç»è¿‡çš„è·¯çº¿ï¼Œè¿™ä¸ªè·¯çº¿åœ¨æ¨¡å—ä¸­æ˜¯æœ€é•¿çš„ï¼Œä¸€å…±æ˜¯ 9 ä¸ªé—¨ç”µè·¯ï¼Œè€Œç”±äºæ•°å­—ç”µè·¯çš„ç‰©ç†ç‰¹æ€§ï¼Œå­˜åœ¨ä¸¤ç§å»¶è¿Ÿ(Propagation Delay)ï¼Œä¸€ç§æ˜¯é—¨å»¶è¿Ÿ(Gate Delay)ï¼Œå¦ä¸€ç§æ˜¯çº¿å»¶è¿Ÿï¼ˆLine Delayï¼‰åœ¨æœ¬ä¾‹ä¸­å¿½ç•¥ã€‚ä¸€ä¸ªæ¨¡å—çš„å»¶è¿Ÿå–å†³äºå®ƒçš„æœ€é•¿å»¶è¿Ÿè·¯å¾„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸²è¡Œçš„åŠ æ³•å™¨çš„ç¼ºç‚¹å°±å¯ä»¥çœ‹å‡ºæ¥äº†ï¼Œåœ¨é€æ¸å¢åŠ ä½æ•°çš„åŒæ—¶ï¼Œè¿›ä½ä¿¡å·çš„ä¼ é€’è·¯çº¿ä¼šè¶Šæ¥è¶Šé•¿ï¼Œè€Œè¿è¡Œé€Ÿåº¦ä¼šè¶Šæ¥è¶Šæ…¢ã€‚å¯¹äºä¸€ä¸ª32bit çš„ä¸²è¡ŒåŠ æ³•å™¨ï¼Œæœ‰æ€»å»¶è¿Ÿæ—¶é—´ï¼š(2n+1)T =(2Ã—32+1)Ã—T =65Tï¼Œè¿™æ˜¯ä»€ä¹ˆæ¦‚å¿µå‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼ŒiPhone 5sçš„A7 SoCå¤„ç†å™¨é‡‡ç”¨28nmåˆ¶é€ å·¥è‰ºï¼Œä¸»é¢‘1.3GHzï¼ˆ0.66nsï¼‰ã€‚æŒ‰ç…§è¿™ä¸ªå·¥è‰ºæ°´å¹³ï¼Œé—¨å»¶è¿Ÿ T è®¾ä¸º 0.02nsï¼Œé‚£ä¹ˆ 32-bit ä¸²è¡ŒåŠ æ³•å™¨çš„å»¶è¿Ÿæ—¶é—´ä¸º1.3ns ï¼Œæ—¶é’Ÿé¢‘ç‡ä¸º 769MHzï¼Œè¿œè¶… A7 å¤„ç†å™¨çš„ä¸»é¢‘å»¶è¿Ÿæ—¶é—´ï¼Œæ›´åˆ«è¯´è¿™ä¸ª 32bit çš„ RCA åªæ˜¯ä¸€ä¸ªåŠ æ³•è¿ç®—å™¨ï¼Œæ›´æ›´åˆ«è¯´ï¼Œæˆ‘ä»¬åœ¨è®¡ç®—è¿‡ç¨‹ä¸­åªè€ƒè™‘äº†é—¨å»¶è¿Ÿï¼Œè¿˜æœ‰çº¿å»¶è¿Ÿç­‰å„ç§å»¶è¿Ÿæ²¡æœ‰åŠ å…¥è®¡ç®—â€¦â€¦&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œå¦‚ä½•æ”¹è¿›è¿™ç§ç°è±¡å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¹¶è¡Œçš„æ€æƒ³ï¼Œä¸²è¡ŒåŠ æ³•å™¨çš„è¿‡ç¨‹æ˜¯ï¼Œè®¡ç®—å‡ºå‰ä¸€ä¸ªå€¼ï¼Œå†å¸¦å…¥å¦ä¸€ä¸ªç›¸åŒçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå°†å…¶è½¬æ¢æˆæ˜¯ä»£ç ï¼Œä¸²è¡ŒåŠ æ³•å°±ç±»ä¼¼äºç±»ä¼¼äºå‡½æ•°è¿­ä»£çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°†è¿›ä½ä¿¡å·è®¡ç®—è¿‡ç¨‹å†™æˆä¸€ä¸ªé€’æ¨çš„å…¬å¼ï¼Œå°†å…¶å±•å¼€å°±å¯ä»¥çœ‹å‡ºæ¥äº†ã€‚ä½¿ç”¨è¿™ç§æ±‚è¿›ä½çš„æ–¹å¼çš„åŠ æ³•å™¨è¢«ç§°ä½œ &lt;strong&gt;è¶…å‰è¿›ä½åŠ æ³•å™¨ï¼ˆCarry-Look-Ahead-Adderï¼ŒCLAï¼‰&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºï¼š
$$ C_i=P_i \cdot C_{i-1} + G_i$$&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼š&lt;/p&gt;
&lt;p&gt;$$
\begin{align}
C_{out} &amp;amp;=P_3 \cdot C_2 + G_3 \&lt;br&gt;
&amp;amp;=P_3 \cdot (P_2 \cdot C_1 +G_2)+G_3\&lt;br&gt;
&amp;amp;=G_3+P_3 \cdot G_2+P_3 \cdot P_2 \cdot G_1+P_3 \cdot P_2 \cdot P_1 \cdot G_0+ \&lt;br&gt;
&amp;amp;\ P_3 \cdot P_2 \cdot P_1 \cdot P_0 \cdot C_{in}
\end{align}
$$&lt;/p&gt;
&lt;p&gt;åŒ–ç®€å¾—åˆ°çš„æœ€åä¸€è¡Œä¸­çš„ç³»æ•°ï¼ˆ$P_3, G_3, P_2, G_2&amp;hellip;$ï¼‰éƒ½å¯ä»¥é€šè¿‡ç®€å•çš„æˆ–é—¨å’Œä¸é—¨è®¡ç®—å¾—åˆ°ã€‚æˆ‘ä»¬å°†æ±‚ $C_{out}$ è¿›ä½ä¿¡å·çš„ç”µè·¯æ›´æ”¹ä¸ºä»¥ä¸‹çš„ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/CLAA.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬æœ€é•¿è·¯å¾„è¢«ç®€åŒ–æˆä¸ºäº† 3 ä¸ªé—¨ï¼Œä½†æ˜¯ç›¸åº”çš„æˆ‘ä»¬ä½¿ç”¨äº†æ›´å¤šçš„ç”µè·¯é€»è¾‘é—¨èµ„æºã€‚æ ¹æ®ç›¸åŒçš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡å‡ºæ±‚ $C_2, C_1,C_0$ è¿›ä½ä¿¡å·çš„æ–¹æ³•ï¼Œè€Œä»–ä»¬çš„è®¡ç®—è·¯å¾„éƒ½åªæœ‰ä¸‰ä¸ªé—¨ï¼Œå°†å®Œæ•´çš„ç”µè·¯ç”»å‡ºæ¥ä¹‹åï¼Œè¿™ä¸ªç”µè·¯å›¾çš„å°±æ˜¯ 72LS283 è¶…å‰è¿›ä½åŠ æ³•å™¨å…ƒä»¶çš„å†…éƒ¨ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://gss1.bdstatic.com/9vo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike80%2C5%2C5%2C80%2C26/sign=e34dec20b27eca80060831b5f04afcb8/d53f8794a4c27d1e834771c719d5ad6eddc4384b.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°æ±‚è¿›ä½çš„æ–¹å¼ä¸æˆ‘ä»¬ä¸Šæ–‡çš„ç›¸åŒï¼Œä½†æ˜¯ä»…ä»…æ˜¯ 4 ä½åŠ æ³•å™¨å°±éœ€è¦å¦‚æ­¤å¤šçš„èµ„æºï¼Œå¦‚æœæ˜¯ 32 ä½å¹¶è¡ŒåŠ æ³•å™¨ï¼Œé‚£ä¹ˆæ‰€éœ€çš„é—¨èµ„æºå°†ä¼šæ˜¯ä¸€ä¸ªå·¨å¤§çš„æ•°é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å¤Ÿå®Œå…¨ä½¿ç”¨å¹¶è¡ŒåŠ æ³•å™¨ï¼Œè€Œæ˜¯ä½¿ç”¨å¤šå±‚å¹¶è¡Œçš„æ–¹å¼ï¼Œç¨å¾®å¢åŠ ä¸€äº›å»¶è¿Ÿï¼Œä¹Ÿå°±æ˜¯è·¯å¾„ä¸Šé—¨çš„æ•°é‡ï¼Œè€Œå‡å°‘å¤§é‡çš„èµ„æºä½¿ç”¨ã€‚åœ¨å®ç° 16 ä½äºŒè¿›åˆ¶è¶…å‰è¿›ä½åŠ æ³•ç”µè·¯å¯ä»¥å…ˆä½¿ç”¨ 4 ä¸ª 4 ä½è¶…å‰è¿›ä½åŠ æ³•å™¨ï¼Œå’Œå¦ä¸€ä¸ª 4 ä½è¶…å‰è¿›ä½å½¢æˆã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å®šä¹‰ $PX_0=P_3 \cdot P_2 \cdot P_1 \cdot P_0 \quad GX_0=G_3+P_3 \cdot G_2+P_3 \cdot P_2 \cdot G_1+P_3 \cdot P_2 \cdot P_1 \cdot G_0$ã€‚&lt;/p&gt;
&lt;p&gt;åˆ™å¯ä»¥å¾—åˆ° $C_4=GX_0+PX_0 \cdot C_0$ (è¿™é‡Œçš„ $C_4$ å°±æ˜¯ ä¸Šæ–‡ä¸­ $C_{out}$ï¼›$C_0$ å°±æ˜¯ä¸Šæ–‡ä¸­ $C_{in}$)ã€‚&lt;/p&gt;
&lt;p&gt;å®šä¹‰ $PX_1=P_7 \cdot P_6 \cdot P_5 \cdot P_4 \quad GX_1=G_7+P_7 \cdot G_6+P_7 \cdot P_6 \cdot G_5+P_7 \cdot P_6 \cdot P_5 \cdot G_4$&lt;/p&gt;
&lt;p&gt;å¯ä»¥å¾—åˆ°ï¼š&lt;/p&gt;
&lt;p&gt;$$
\begin{align}
C_8 &amp;amp;= GX_1+PX_1 \cdot C_4 \&lt;br&gt;
&amp;amp;= GX_1 + PX_1 \cdot (GX_0+PX_0 \cdot C_0)\&lt;br&gt;
&amp;amp;= GX_1 + PX_1 \cdot GX_0 + PX_1 \cdot PX_0 \cdot C_0
\end{align}
$$&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éªŒè¯äº†ä»…ä»…ä½¿ç”¨ $PX_i$ å’Œ $GX_i$ ä¸¤ä¸ªä¿¡å·å°±å¯ä»¥è¿­ä»£å¾—åˆ°æ¯éš” 4 ä½çš„è¿›ä½ä¿¡å·ã€‚è€Œè¿™ä¸¤ä¸ªä¿¡å·çš„è®¡ç®—ï¼Œå¯ä»¥åœ¨æ¯ä¸ªå°çš„è¶…å‰è¿›ä½åŠ æ³•å™¨ä¸­è¿›è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/16-bit.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹æ³•ä½¿å¾—æœ¬æ¥åªéœ€è¦ 3 æ¬¡é—¨å»¶è¿Ÿçš„è®¡ç®—å¢åŠ åˆ°äº† 6 æ¬¡é—¨å»¶è¿Ÿï¼Œä½†æ˜¯èŠ‚çº¦çš„èµ„æºæ˜¯å¾ˆå¤šçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;-verilog-&#34;&gt;åŠ æ³•å™¨ Verilog å®ç°&lt;/h3&gt;
&lt;p&gt;åœ¨ FPGA ä¸­ï¼ŒåŠ æ³•å™¨çš„æè¿°å¾ˆç®€å•ï¼Œç®€å•åˆ°äº†ä¸€æ¡åŠ æ³•æŒ‡ä»¤å°±å¯ä»¥ã€‚è€Œç©¶ç«Ÿæ˜¯ä½¿ç”¨ä½•ç§çš„é—¨çº§ç»“æ„ç»“æ„ï¼Œç»¼åˆå™¨ä¼šæ ¹æ®é€‰é¡¹è‡ªåŠ¨æŒ‘é€‰ä¸€ç§åŸºæœ¬çš„ç»“æ„ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ FPGA çš„åº“ä¸­è¿›è¡ŒæŒ‘é€‰ï¼Œå®ä¾‹åŒ–æˆ‘ä»¬çš„åŠ æ³•ç”µè·¯ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº 4 ä½åŠ æ³•å™¨çš„æè¿°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; b4_adder(X, Y, sum, C);
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] X, Y;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] sum;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; C;

&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; {C, sum} &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; X &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; Y;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading-1&#34;&gt;å¹¶è¡Œä¹˜æ³•å™¨ä¸è¿›ä½èŠ‚çœä¹˜æ³•å™¨&lt;/h2&gt;
&lt;p&gt;å¹¶è¡Œä¹˜æ³•å™¨åˆè¢«ç§°ä½œç§»ä½ä¹˜æ³•å™¨ï¼Œè¯¥ä¹˜æ³•å™¨çš„è®¡ç®—è¿‡ç¨‹ç±»ä¼¼äºæ‰‹å·¥è®¡ç®—ï¼Œä¸€æ¬¡è®¡ç®—äºŒè¿›åˆ¶ä¸€ä½ï¼Œç„¶åé”™ä½å¹¶åˆ—ç›¸åŠ ï¼ŒäºŒè¿›åˆ¶ä¹˜æ³•çš„åŸºæœ¬è§„åˆ™å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;$$ 0 \times 0=0;\quad 1 \times 0=0;\quad 1 \times 1=1$$&lt;/p&gt;
&lt;p&gt;é€»è¾‘ä¸ºä¸é—¨é€»è¾‘ã€‚è€Œè®¡ç®—çš„è¿‡ç¨‹æˆ‘ä»¬å¯ä»¥ç®€å•åœ°é€šè¿‡ä¸€å¼ å›¾æ¥å±•ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/times.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¿«é€Ÿä¹˜æ³•å™¨ä½¿ç”¨ç½‘æ ¼å½¢å¼çš„å å¸¦é˜µåˆ—ç»“æ„ï¼Œæ¯ä¸€ä¸ªä¹˜æ³•å•å…ƒè¢«ç§°ä½œ &lt;strong&gt;MU(Multiplier Unit)&lt;/strong&gt;, å¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/multiplier.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è§‚å¯Ÿå‘ç°ï¼Œåœ¨ç¬¬ä¸€è¡Œï¼Œæ‰€æœ‰çš„ MU å•å…ƒå¯ä»¥ä¸å«æœ‰å…¨åŠ å™¨ï¼Œä»…æœ‰ä¸é—¨ç»“æ„ï¼Œå› ä¸ºç¬¬ä¸€è¡Œçš„æ•°æ— è¿›ä½ï¼›åŒç†ï¼Œæ¯ä¸€è¡Œç¬¬ä¸€ä¸ª MU å•å…ƒä¹Ÿå¯ä»¥ä»…ä½¿ç”¨ä¸é—¨ç»“æ„ã€‚å¹¶ä¸”ï¼Œè¿™ç§ç»“æ„çš„ä¹˜æ³•å™¨åŒæ ·å¯ä»¥ä½¿ç”¨è¶…å‰è¿›ä½åŠ æ³•å™¨ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æ”¹è‰¯äº†è¿™ç§ç»“æ„ï¼Œæ–°ç»“æ„è¢«ç§°ä½œè¿›ä½èŠ‚çœä¹˜æ³•å™¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-8-7-CLAA/new_m.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;-verilog--1&#34;&gt;ä¹˜æ³•å™¨å™¨ Verilog å®ç°&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-verilog&#34; data-lang=&#34;verilog&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;module&lt;/span&gt; b4_mult(X, Y, Z);
&lt;span style=&#34;color:#66d9ef&#34;&gt;input&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] X, Y;
&lt;span style=&#34;color:#66d9ef&#34;&gt;output&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] Z;

&lt;span style=&#34;color:#66d9ef&#34;&gt;assign&lt;/span&gt; Z &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; X &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; Y;
&lt;span style=&#34;color:#66d9ef&#34;&gt;endmodule&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹˜æ³•å™¨å’ŒåŠ æ³•å™¨çš„å®ç°æ˜¯æ ¹æ®ç”¨æˆ·çš„é€‰æ‹©å’Œçº¦æŸæ–‡ä»¶å†³å®šçš„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç»¼åˆå™¨è¿˜ä¼šå®ç°æµæ°´çº¿ç»“æ„ï¼Œä»¥æ»¡è¶³ç”¨æˆ·å¯¹äºè¿ç®—é€Ÿåº¦çš„éœ€æ±‚ã€‚æœ¬æ–‡åªæ˜¯ç®€å•ä»‹ç»äº†ä¸¤ç§åŠ æ³•å™¨å’Œä¸¤ç§ä¹˜æ³•å™¨çš„ç»“æ„ï¼Œåœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œè¿˜æ˜¯éœ€è¦æ ¹æ®å®é™…çš„éœ€æ±‚åœ¨ FPGA åº“å’Œ ASIC åº“ä¸­é€‰æ‹©åˆé€‚çš„åŠ æ³•å™¨å’Œä¹˜æ³•å™¨ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;Verilog å’Œ VHDL åªæ˜¯æè¿°æ€§è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯ä»£ç ä¸èƒ½ç›´æ¥ç¿»è¯‘æˆä¸ºç”µè·¯ç»“æ„ï¼Œç»¼åˆå™¨ä¼šåœ¨åº“ä¸­å¯»æ‰¾å¯¹åº”çš„æ¨¡å‹ï¼Œå°†ä»£ç å®ä¾‹åŒ–ã€‚è¿™ä¸å…¶ä»–çš„è®¡ç®—æœºè¯­è¨€æœ‰äº›ä¸åŒï¼Œå› ä¸ºç›¸åŒçš„å†…å®¹å¯ä»¥è¢«ç¿»è¯‘æˆä¸ºä¸åŒçš„ç”µè·¯ç»“æ„ï¼Œè€Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶ã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>Sorting Algorithms</title>
      <link>https://xiahualiu.github.io/posts/2018-07-27-sorting/</link>
      <pubDate>Fri, 27 Jul 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-07-27-sorting/</guid>
      <description>&lt;p&gt;æœ¬æ–‡çš„å†…å®¹æ˜¯æ€»ç»“æ•°æ®ç»“æ„ä¸ç®—æ³•ä¸­å¸¸è§çš„å‡ ç§æ’åºç®—æ³•ï¼Œç®—æ˜¯ç¨‹åºå‘˜çš„åŸºæœ¬åŠŸä¹‹ä¸€ã€‚é¦–å…ˆä¼šä»å‡ ç§ç®€å•çš„æ’åºç®—æ³•å¼€å§‹ï¼Œæœ€åä¼šé€æ¸æ¶‰åŠè¾ƒä¸ºå¤æ‚çš„æ’åºç®—æ³•ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè¦çº¦å®šï¼Œæˆ‘ä»¬è¦æ’åºçš„å…ƒç´ ä¸ªæ•°ä¸º Nï¼Œå…ƒç´ åœ¨æ•°ç»„ä¸­å¹¶ä¸”æ•°ç»„ä»¥ä¸‹æ ‡ 0 å¼€å§‹æ”¾ç½®å…ƒç´ ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;æ’å…¥æ’åº&lt;/h2&gt;
&lt;p&gt;æœ€ç®€å•çš„æ’åºç®—æ³•å®ç°ï¼Œåœ¨å¾ªç¯çš„ç¬¬ N æ­¥ï¼Œç¡®ä¿å‰ N ä¸ªå…ƒç´ æ˜¯æ’åºçš„ï¼Œç›¸å½“äºæ¯æ¬¡å¾ªç¯ä»å°¾éƒ¨å¢åŠ ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ æ”¾ç½®åˆ°æ­£ç¡®çš„ä½ç½®ä¸Šå»ã€‚&lt;/p&gt;
&lt;p&gt;ä»£ç å®ç°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;InsertionSort&lt;/span&gt;(ElementType A[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; N) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; j, P;

	ElementType Tmp;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (P &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; P &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; N; P&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {
		Tmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[P];
		&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (j &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; P; j &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; A[j &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; Tmp; j&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;)
			A[j] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[j &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;];
		A[j] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Tmp;
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;åˆå§‹&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;34&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;8&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;64&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;51&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;32&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;21&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;ç§»åŠ¨çš„æ¬¡æ•°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;p=1 å&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;51&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;p=2 å&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;51&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;p=3 å&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;51&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;p=4 å&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;51&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;p=5 å&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;51&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿™ç§æ’åºçš„æ–¹å¼ä»£è¡¨äº†æ‰€æœ‰çš„ç®€å•æ’åºï¼ŒåŒ…æ‹¬äº†é€‰æ‹©æ’åºå’Œå†’æ³¡æ’åºï¼Œå®ƒä»¬çš„æ—¶é—´å¤æ‚åº¦å¯ä»¥ä»ä»£ç ä¸Šæ˜¾è€Œæ˜“è§çš„çœ‹å‡ºæ¥æ˜¯ &lt;em&gt;O(N^2)&lt;/em&gt;ã€‚è€Œè‡³äºä¸ºä»€ä¹ˆç®€å•æ’åºä¸èƒ½çªç ´ N^2 æ—¶é—´ç•Œï¼Œæœ‰ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„æ•°å­¦è¯æ˜ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºä¸€ä¸ªéœ€è¦æ’åºçš„æ•°ç»„ Aï¼Œå®ƒä¹‹ä¸­å­˜åœ¨ä¸€ä¸ªé€†åºï¼Œå½“æ•°ç»„ä¸­ i&amp;lt;j, å¹¶ä¸” A[i]&amp;gt;A[j]ã€‚ä¾‹å¦‚å¯¹äºä¸Šé¢çš„è¡¨æ ¼ï¼Œå­˜åœ¨ 9 ä¸ªé€†åºï¼Œåˆ†åˆ«æ˜¯ (34, 8), (34, 32), (34, 21), (64, 32), (64, 21), (51, 32), (51, 21) ä»¥åŠ (32, 21)ã€‚å¯¹äºæ¯æ¬¡çš„ç›¸é‚»å…ƒç´ çš„äº¤æ¢ï¼Œéƒ½ä»…ä»…æ¶ˆé™¤ä¸€ä¸ªé€†åºï¼Œè€Œä¿è¯å…¶ä»–çš„é€†åºä¸å‘ç”Ÿå˜åŒ–ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å®šç†ï¼šå¯¹äº N ä¸ªäº’å¼‚æ•°çš„æ•°ç»„çš„å¹³å‡é€†åºæ•°æ˜¯ N(N-1)/4ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ¡å®šç†è¯æ˜ï¼šå¦‚æœä¸€ä¸ªæ•°ç»„é€†åºæ•°ä¸º Nï¼Œå°†è¯¥æ•°ç»„ä»å°¾åˆ°å¤´é‡æ–°æ„é€ ä¸€ä¸ªååºæ•°ç»„ï¼Œå…¶é€†åºæ•°å’Œ N äº’è¡¥ï¼Œå’Œä¸ºæ€»çš„å…ƒç´ ä¸¤ä¸¤ç»„åˆçš„æ•°é‡ï¼Œå³ä¸º N(N-1)/2ã€‚æ‰€ä»¥å¹³å‡é€†åºæ•°ä¸ºå’Œçš„ä¸€åŠï¼Œä¹Ÿå°±æ˜¯ N(N-1)/4ã€‚&lt;/p&gt;
&lt;p&gt;è€Œå› æ­¤ï¼Œæˆ‘ä»¬åœ¨ç®€å•æ’åºç®—æ³•ä¸­ï¼Œæ¯æ¬¡å…ƒç´ äº¤æ¢åªèƒ½å‡å°‘ä¸€ä¸ªé€†åºï¼Œå¹³å‡éœ€è¦çš„æ—¶é—´å°±æ˜¯ N(N-1)/4 = Î©(N^2) æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æ ¹æ®æˆ‘ä»¬ç†è®ºæ¨å¯¼ï¼Œè‹¥æ˜¯ä¸€ä¸ªæ’åºç®—æ³•æƒ³è¦è¶…è¿‡ N^2 çš„æ—¶é—´ç•Œï¼Œå°±å¿…é¡»æ¯æ¬¡äº¤æ¢è¶…è¿‡ä¸€ä¸ªé€†åºæ•°ï¼Œè¿™å°±è¦æ±‚äº¤æ¢çš„ä¸¤ä¸ªå¯¹è±¡å°½å¯èƒ½è¿œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº†å¦‚ä¸‹çš„ä¸€ä¸ªæŠ€å·§ï¼š&lt;strong&gt;åœ¨æ’åºä¸­é¿å…ä½¿ç”¨äº¤æ¢&lt;/strong&gt;ï¼Œäº¤æ¢æ˜¯ä¸€ä¸ªç›¸å¯¹ä½æ•ˆçš„æ–¹æ³•ï¼Œç‰¹åˆ«åœ¨è¿ç»­ç›¸é‚»å…ƒç´ çš„äº¤æ¢ä¸­ã€‚æˆ‘ä»¬å¯ä»¥å…ˆç”¨ä¸€ä¸ªä¸´æ—¶å˜é‡å‚¨å­˜èµ·æ¥éœ€è¦æ’å…¥çš„æ–°å€¼ï¼Œç„¶åä»åå‘å‰æ¯”è¾ƒä¸å…ƒç´ å€¼çš„å¤§å°ï¼Œè‹¥å½“å‰å¾ªç¯å…ƒç´ å¤§äºè¦æ’å…¥çš„æ–°å€¼ï¼Œåˆ™å‘åç§»ä¸€ä½ï¼Œç›´åˆ°æ¯”è¾ƒåˆ°å°äºæ–°å€¼çš„å…ƒç´ åœæ­¢ï¼Œå¹¶åœ¨è¯¥ä½ç½®æ’å…¥æ–°å€¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;shellsort&#34;&gt;å¸Œå°”æ’åº(Shellsort)&lt;/h2&gt;
&lt;p&gt;å¸Œå°”æ’åºåˆè¢«ç§°ä¸ºç¼©å°å¢é‡æ’åºï¼Œæ¯æ¬¡äº¤æ¢çš„å…ƒç´ ä¹‹é—´å­˜åœ¨ä¸€ä¸ªè·ç¦»ã€‚åœ¨ç¬¬ k æ¬¡å¾ªç¯ä¸­ï¼Œæ¯”è¾ƒå…ƒç´ çš„é—´éš”ä¸º &lt;em&gt;hk&lt;/em&gt;ï¼Œæˆ‘ä»¬ä¿è¯å¯¹äºä»»æ„ iï¼ŒA[i]&amp;lt;=A[i+hk]ï¼Œæˆ‘ä»¬å°±ç§°æ•°ç»„æ˜¯ hk-æ’åºçš„ (hk-sorted)ã€‚å¸Œå°”æ’åºçš„é‡è¦æ€§è´¨æ˜¯ï¼Œåœ¨æ¥ä¸‹æ¥çš„å¾ªç¯ä¸­ï¼Œå°½ç®¡ h(k-1) å°äº hkï¼Œæ•°ç»„ä¾æ—§èƒ½å¤Ÿä¿æŒ hk-æ’åºçš„æ€§è´¨ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;åˆå§‹&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;81&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;94&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;11&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;96&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;12&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;35&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;17&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;95&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;28&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;58&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;41&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;75&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;15&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5-æ’åºå&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;28&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;41&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;75&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;96&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;58&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;81&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;94&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;95&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3-æ’åºå&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;28&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;41&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;58&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;94&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;75&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;81&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;96&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;95&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1-æ’åºå&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;28&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;35&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;41&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;58&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;75&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;81&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;94&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;95&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;96&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å¸Œå°”æ’åºä¸­å¯¹äº hk çš„é€‰æ‹©å†³å®šäº†å…¶æ—¶é—´ç•Œçš„å¤§å°ï¼Œè€Œå¯¹äºä¸€ä¸ªè¾ƒä¸ºç®€å•çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€å¼€å§‹çš„ h ä¸ºå…ƒç´ æ•°é‡çš„ä¸€åŠï¼Œè€Œæ¯æ¬¡å¾ªç¯çš„ hk éƒ½æ˜¯ä¸Šä¸€æ¬¡çš„ä¸€åŠï¼Œå®ç°çš„ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Shellsort&lt;/span&gt;(ElementType A[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; N) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i, j, Increment;
	ElementType Tmp;

	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (Increment &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; N &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;; Increment &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; Increment &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Increment; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; N; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {
			Tmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[i];
			&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (j &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; i; j &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Increment &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; A[j&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;Increment] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; Tmp; j &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Increment)
					A[j] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[j &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; Increment];
			A[j] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Tmp;
		}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ¬¡ä¾æ—§ä½¿ç”¨äº†ä¹‹å‰æ’å…¥æ’åºä¸­ä½¿ç”¨çš„ &lt;strong&gt;é¿å…äº¤æ¢&lt;/strong&gt; çš„æ–¹æ³•ã€‚ä»£ç ç±»ä¼¼äºæ’å…¥æ’åºï¼Œåªä¸è¿‡æ¯”è¾ƒæ—¶åŠ ä¸Šäº†é—´éš” Increment å˜é‡ã€‚æ¯æ¬¡ Increment ç¡®å®šåï¼Œå…¶å®ä¹‹ååšçš„äº‹æƒ…å°±æ˜¯ä¸€ä¸ªé—´éš” Increment å…ƒç´ åºåˆ—çš„æ’å…¥æ’åºã€‚&lt;/p&gt;
&lt;h3 id=&#34;-hk&#34;&gt;å¦‚ä½•é€‰æ‹© hk&lt;/h3&gt;
&lt;p&gt;æƒ³è¦æ›´å¥½åœ°é€‰æ‹© hk çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ Hibbard å¢é‡ã€‚Hibbard å¢é‡çš„åˆ—ä¸ºå½¢å¦‚ï¼š1ï¼Œ3ï¼Œ7 &amp;hellip; 2^k-1 çš„åºåˆ—ï¼Œè¿™äº›åºåˆ—ç›¸é‚»ä¹‹å‰æ²¡æœ‰å…¬å› å­ï¼Œè€Œä¸”æœ‰ç ”ç©¶è¯æ˜ï¼Œä½¿ç”¨ Hibbard å¢é‡çš„æœ€å·®æƒ…å†µè¿è¡Œæ—¶é—´ä¸º &lt;em&gt;O(N^(3/2))&lt;/em&gt;ã€‚è¯æ˜è¿™ä¸ªæ—¶é—´å¸¸é‡éœ€è¦ä½¿ç”¨åˆ°å †å’æ•°è®ºä¸­æŸäº›ä¼—ä¸ºæ‰€çŸ¥çš„ç»“æœï¼Œæˆ‘ä»¬ä¸åœ¨è¿™é‡Œè¯¦ç»†æè¿°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;å †æ’åº&lt;/h2&gt;
&lt;p&gt;åœ¨å…ˆå‰çš„ç« èŠ‚ï¼ˆ&lt;a href=&#34;https://eggycat.coding.me/2018/07/24/Priority_Queue/&#34;&gt;ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆå †ï¼‰çŸ¥è¯†ç‚¹&lt;/a&gt;ï¼‰ä¸­ä»‹ç»äº†å‡ ç§å¸¸è§çš„å †æ¨¡å‹ï¼Œæˆ‘ä»¬çŸ¥é“å †ä¸­çš„ DeleteMin æ’åºæ—¶é—´è¾¹ç•Œä¸º &lt;em&gt;O(N*logN)&lt;/em&gt;ï¼ˆæ¯æ¬¡ä¸º logNï¼Œå…± N æ¬¡ï¼‰ï¼Œè€Œæ„é€ å †çš„æ—¶é—´èŠ±è´¹æœ€åæƒ…å†µä¸º &lt;em&gt;O(N)&lt;/em&gt;ã€‚æ‰€ä»¥æˆ‘ä»¬æœ‰æ€»æ—¶é—´&lt;em&gt;O(N+N*logN)&lt;/em&gt;ï¼Œä¹Ÿå°±æ˜¯ &lt;em&gt;O(N*logN)&lt;/em&gt; çš„æ—¶é—´è¾¹ç•Œï¼Œè¿™æ ·çš„è¾¹ç•Œæ˜¯æˆ‘ä»¬ç›®å‰çœ‹åˆ°çš„æœ€å¥½çš„æ—¶é—´å€¼ï¼Œä½†æ˜¯åœ¨å®è·µä¸­å´ä½äº &lt;em&gt;Sedgewick&lt;/em&gt; å¢é‡åºåˆ—çš„å¸Œå°”æ’åºã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ä½¿ç”¨äºŒå‰å †æ’åºæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯éœ€è¦ä¸€ä¸ªé¢å¤–çš„æ•°ç»„ç”¨äºæ„å»ºäºŒå‰å †ï¼Œè¿™é€ æˆäº†ç©ºé—´ä¸Šçš„èŠ±è´¹ã€‚ä»æ’åºåçš„äºŒå‰å †æ•°ç»„æ‹·è´å›åŸæ•°ç»„æ—¶æ—¶é—´ä¸º &lt;em&gt;O(N)&lt;/em&gt;ï¼Œä¸ä¼šæ˜¾è‘—å½±å“è¿è¡Œæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“çš„å®ç°è¿‡ç¨‹å°±æ˜¯å…ˆä½¿ç”¨åŸæ•°ç»„çš„æ•°æ®ï¼Œæ„å»ºä¸€ä¸ªäºŒå‰å †ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ—¶é—´èŠ±è´¹ä¸º O(N)ã€‚ç„¶åé€æ­¥çš„ DeleteMaxï¼ˆä¹‹å‰äºŒå‰æ ‘æ˜¯é€’å¢æ ‘ï¼Œä½†æ˜¯å¯ä»¥å¾ˆç®€å•çš„æ”¹æˆé€’å‡æ ‘ï¼‰ï¼Œè¿™ä¸ªåœ°æ–¹æœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œæˆ‘ä»¬åªç”¨åˆ°äºŒå‰æ ‘çš„ä¸‹æ»¤æ“ä½œï¼Œæ¯æ¬¡å°†äºŒå‰å †å †é¦–å…ƒç´ ä¸å †å°¾äº¤æ¢ï¼Œç„¶åå¯¹äºå †å¤´è¿›è¡Œä¸‹æ»¤æ“ä½œï¼Œå°†äºŒå‰å †å †åºæ€§æ¢å¤ï¼Œå¹¶ä¸”æœ€å¤§å€¼è¢«æ”¾ç½®åœ¨äº†å †å°¾ï¼Œç¼©å‡äºŒå‰å †çš„å¤§å°ï¼Œæˆ‘ä»¬å°±å°†æœ€å¤§å€¼å›ºå®šåœ¨äº†æœ€åã€‚é€æ­¥å¾ªç¯å°±å¾—åˆ°äº†é€’å¢çš„æ’åºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define LeftChild(i) (2 * (i) + 1)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PercDown&lt;/span&gt;(ElementType A[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; N) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Child;
	ElementType Tmp;

	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (Tmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[i]; LeftChild(i) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; N; i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Child) {
		Child &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LeftChild(i);
		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (Child &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; N &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; A[Child &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; A[Child])
			Child&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;;
		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (Tmp &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; A[Child])
			A[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[Child];
		&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
			&lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
	}
	A[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Tmp;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Heapsort&lt;/span&gt;(ElementType A[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; N) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i;

	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; N &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;/* Build Heap Question: WHY i=N/2 */&lt;/span&gt;
		PercDown(A, i, N);
	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; N &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;) { &lt;span style=&#34;color:#75715e&#34;&gt;/* DeleteMax */&lt;/span&gt;
		Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[i]);
		PercDown(A, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, i);
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;heading-2&#34;&gt;å †æ’åºçš„åˆ†æ&lt;/h4&gt;
&lt;p&gt;å †æ’åºç¬¬ä¸€é˜¶æ®µæœ€å¤šç”¨åˆ° 2N æ¬¡æ¯”è¾ƒï¼Œç¬¬äºŒé˜¶æ®µæœ€å¤šç”¨åˆ° 2[logi] æ¬¡æ¯”è¾ƒã€‚å †æ’åºæ˜¯ä¸€ä¸ªéå¸¸ç¨³å®šçš„ç®—æ³•ï¼šå®ƒå¹³å‡ä½¿ç”¨çš„æ¯”è¾ƒå’Œæœ€åæƒ…å½¢æ¥è¿‘ï¼Œåªæ˜¯ç•¥å°‘ã€‚ç›´åˆ°æœ€è¿‘ï¼Œä¹Ÿæ²¡æœ‰äººèƒ½å¤ŸæŒ‡å‡ºå †åºæ’åºå¹³å‡è¿è¡Œæ—¶é—´çš„éå¹³å‡¡ç•Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-3&#34;&gt;å½’å¹¶æ’åº&lt;/h2&gt;
&lt;p&gt;å½’å¹¶æ’åºä»¥ &lt;em&gt;O(N*logN)&lt;/em&gt; æœ€åæƒ…å½¢è¿è¡Œæ—¶é—´è¿è¡Œï¼Œä½†æ˜¯æ¯”è¾ƒçš„æ¬¡æ•°å‡ ä¹æ˜¯æœ€ä¼˜çš„ã€‚å®ƒæ˜¯é€’å½’ç®—æ³•çš„ä¸€ä¸ªå¾ˆå¥½çš„å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆå‡è®¾æˆ‘ä»¬æ‹¥æœ‰äº†ä¸¤ä¸ªå·²ç»æ’åºå®Œæˆçš„è¡¨ A Bï¼Œå› ä¸ºè¿™ä¸¤ä¸ªè¡¨æ˜¯å·²ç»æ’åºå®Œæˆçš„ï¼Œè‹¥å°†å…¶ä¸¤ä¸ªè¡¨åˆå¹¶æˆä¸ºä¸€ä¸ªæ’åºçš„è¡¨ C å¯ä»¥ç®€å•åœ°é€šè¿‡ä¸€è¶Ÿæ¯”è¾ƒå®Œæˆï¼Œå¯¹äºä¸€å¼€å§‹ä¸¤ä¸ªæŒ‡é’ˆ Aptr å’Œ Bptr è¢«åˆ†åˆ«æ”¾åœ¨ä¸¤ä¸ªè¡¨çš„å¼€å¤´ï¼Œç„¶åæ¯”è¾ƒæŒ‡å‘çš„æ•°æ®å¤§å°ï¼Œè¾ƒå°çš„å€¼ä¼šè¢«æ”¾å…¥ Cï¼Œç„¶åå°†è¾ƒå°å€¼æŒ‡é’ˆ +1ï¼Œç»§ç»­æ’åºï¼Œå½“ä¸¤ä¸ªè¾“å…¥è¡¨æœ‰ä¸€ä¸ªè¢«ç”¨å®Œçš„æ—¶å€™ï¼Œåˆ™å°†å¦å¤–ä¸€ä¸ªè¡¨çš„å‰©ä½™å†…å®¹ç›´æ¥æ‹·è´å…¥ Cã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-27-Sorting/mergesort.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;åˆå¹¶ä¸¤ä¸ªå·²æ’åºè¡¨çš„æ—¶é—´æ˜¯çº¿æ€§çš„ï¼Œå› ä¸ºæœ€å¤šè¿›è¡Œäº† N-1 æ¬¡æ¯”è¾ƒï¼Œæ¯æ¬¡æ¯”è¾ƒéƒ½è‡³å°‘æ·»åŠ è¿›ä¸€ä¸ªå…ƒç´ ï¼Œè€Œæœ€åçš„é‚£ä¸€æ¬¡æ·»åŠ å¯ä»¥ç›´æ¥æ·»åŠ ä¸¤ä¸ªå…ƒç´ è¿›å»ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨é€’å½’è¡¨ç¤ºå½’å¹¶æ’åºï¼šå¦‚æœ N = 1ï¼Œé‚£ä¹ˆ A B åŠ èµ·æ¥å°±ä¸€ä¸ªå…ƒç´ ï¼Œç›´æ¥å°†å…ƒç´ æ”¾ç½®è¿› C å³å¯ã€‚å¦åˆ™ï¼Œå°†å‰åŠéƒ¨åˆ†å’ŒååŠéƒ¨åˆ†å„è‡ªä½¿ç”¨å½’å¹¶æ’åºï¼Œå¹¶å°†ç»“æœä½¿ç”¨åˆå¹¶ç®—æ³•åˆå¹¶ã€‚&lt;/p&gt;
&lt;p&gt;å½’å¹¶æ’åºçš„åŸç†å¹¶ä¸éš¾ï¼Œç†è§£èµ·æ¥ä¹Ÿè¾ƒä¸ºå®¹æ˜“ï¼Œä½†æ˜¯åœ¨é€’å½’çš„æ—¶å€™å¾ˆå®¹æ˜“å°±é™·å…¥ &lt;strong&gt;å°¾é€’å½’&lt;/strong&gt; çš„å›°å¢ƒï¼Œæˆ‘ä»¬ä¸‹è¾¹çš„ä»£ç é‡‡ç”¨äº†ä¸€ä¸ªå…±äº«çš„ &lt;code&gt;TmpArray&lt;/code&gt; æ•°ç»„ï¼Œæ•°æ®å½’å¹¶çš„è¿‡ç¨‹ä¸­çš„è¿‡ç¨‹æ•°æ®éƒ½ä¼šæš‚æ—¶å‚¨å­˜åœ¨è¿™é‡Œï¼Œæš‚å­˜æ•°ç»„çš„å¤§å°å’ŒåŸæ•°ç»„å¤§å°ä¸€è‡´å°±å¯ä»¥ï¼Œåœ¨è¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„ Merge éƒ½ä½¿ç”¨åŒä¸€ä¸ªæš‚å­˜æ•°ç»„ã€‚è¿™æ ·æˆ‘ä»¬è¿­ä»£çš„è¿‡ç¨‹ä¸­æ²¡æœ‰ä¸´æ—¶æ•°ç»„å˜é‡çš„äº§ç”Ÿï¼Œä¹Ÿå°±å‡å°‘äº†å†…å­˜çš„æ¶ˆè€—ï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿé€ æˆäº†ä¸€ä¸ªç¼ºç‚¹ï¼Œæˆ‘ä»¬æ¯æ¬¡è¿­ä»£çš„æ—¶å€™ï¼ŒMerge å‡½æ•°éƒ½è¦è¾“å…¥è¿™ä¸ªæš‚å­˜æ•°ç»„çš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆéœ€è¦åœ¨ä¸åŒçš„è¿­ä»£æ¬¡æ•°ä¹‹é—´ä¼ é€’ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MSort&lt;/span&gt;(ElementType A[], ElementType TmpArray[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Left, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Right) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Center;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (Left &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; Right) {
		Center &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (Left &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; Right) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;;
		MSort(A, TmpArray, Left, Center);
		MSort(A, TmpArray, Center &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, Right);
		Merge(A, TmpArray, Left, Center &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, Right);
	}
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Merge&lt;/span&gt;(ElementType A[], ElementType TmpArray[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Lpos, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Rpos, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; RightEnd) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i, LeftEnd, NumElements, TmpPos;
	LeftEnd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Rpos &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
	TmpPos &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Lpos;
	NumElements &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; RightEnd &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; Lpos &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;

	&lt;span style=&#34;color:#75715e&#34;&gt;/* Main Loop */&lt;/span&gt;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (Lpos &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LeftEnd&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;Rpos &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; RightEnd)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (A[Lpos] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[Rpos])
			TmpArray[TmpPos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[Lpos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;];
		&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
			TmpArray[TmpPos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[Rpos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;];

	&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (Lpos &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LeftEnd)
		TmpArray[TmpPos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[Lpos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;];
	&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (RightEnd &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; RightEnd)
		TmpArray[TmpPos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; A[Rpos&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;];

	&lt;span style=&#34;color:#75715e&#34;&gt;/* Copy back */&lt;/span&gt;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; NumElements; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;, RightEnd&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;) {
		A[RightEnd] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Tmp[RightEnd];
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;heading-4&#34;&gt;å½’å¹¶æ’åºçš„åˆ†æ&lt;/h4&gt;
&lt;p&gt;é€šè¿‡åˆ†æå½’å¹¶æ’åºï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¹ åˆ°åˆ†æé€’å½’ç¨‹åºçš„ç»å…¸å®ä¾‹ï¼šæˆ‘ä»¬å¿…é¡»æ ¹æ®è¿è¡Œçš„æ—¶é—´å†™å‡ºä¸€ä¸ªé€’å½’çš„å…³ç³»ã€‚å¯¹äº N ä¸ªæ•°å½’å¹¶çš„æ—¶é—´ç­‰äºä¸¤ä¸ªå¯¹åŠå½’å¹¶æ’åºçš„æ—¶é—´åŠ ä¸Šå¤åˆ¶çš„æ—¶é—´ O(N)ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å…¬å¼çš„æ˜¾ç¤ºï¼Œå…¬å¼ç”¨äº† MathJax è¿™ä¸ª JS æ’ä»¶ï¼Œå¦‚æœä½ æ˜¯æ‰‹æœºæµè§ˆçš„ï¼Œå¯ä»¥é€šè¿‡é•¿æŒ‰å…¬å¼ä¿®æ”¹ Math Setting-&amp;gt;Scale All Math å€¼ç¼©æ”¾å…¬å¼ã€‚&lt;/p&gt;
&lt;p&gt;$$ T(1)=1 $$&lt;/p&gt;
&lt;p&gt;$$ T(N)=2T(N/2)+N $$&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†ç­‰å¼ä¸¤è¾¹åŒæ—¶é™¤ä»¥ Nã€‚&lt;/p&gt;
&lt;p&gt;$$ \frac{T(N)}{N}=\frac{T(N/2)}{N/2}+1 $$&lt;/p&gt;
&lt;p&gt;è¯¥ç­‰å¼å¯¹äºä»»æ„ N å‡æˆç«‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸¦å…¥ N/2, N/4&amp;hellip; ï¼Œå¹¶å°†å®ƒä»¬å·¦å³å¼åˆ†åˆ«å åŠ ã€‚&lt;/p&gt;
&lt;p&gt;$$ \frac{T(N)}{N} + \frac{T(N/2)}{N/2} + &amp;hellip; =\frac{T(N/2)}{N/2}+ 1 + \frac{T(N/4)}{N/4} + 1 +&amp;hellip; $$&lt;/p&gt;
&lt;p&gt;æ¶ˆå»å·¦å³éƒ½æœ‰çš„é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼š&lt;/p&gt;
&lt;p&gt;$$ \frac{T(N)}{N}=\frac{T(1)}{1} + \log_2 N $$&lt;/p&gt;
&lt;p&gt;åŒ–ç®€å¯ä»¥å¾—åˆ°
$$T(N)=N\log_2N+N=O(N\log_{}N)$$&lt;/p&gt;
&lt;p&gt;è™½ç„¶å½’å¹¶æ’åºçš„è¿è¡Œæ—¶é—´æ˜¯ &lt;em&gt;O(NlogN)&lt;/em&gt;ï¼Œä½†æ˜¯ç”±äºå®ƒéœ€è¦ä¸€ä¸ªå’ŒåŸæœ¬æ•°æ®ä¸€æ ·å¤§çš„ç¼“å†²åŒºä½œä¸ºæ•°æ®æš‚å­˜ï¼Œæ‰€ä»¥åœ¨ä¸»å­˜æ’åºä¸­å¾ˆéš¾åº”ç”¨ã€‚è€Œä¸”é¢å¤–çš„æ‹·è´æ“ä½œä¹Ÿä¾èµ–äºç¡¬ä»¶çš„å®ç°é€Ÿåº¦ï¼Œåœ¨æ‹·è´é€Ÿåº¦è¾ƒæ…¢çš„åœºåˆï¼Œå°†ä¼šå¤§å¤§æ‹–æ…¢æ’åºé€Ÿåº¦ã€‚å½’å¹¶æ’åºå¸¸å¸¸åº”ç”¨äºå¤–éƒ¨æ’åºå½“ä¸­ï¼Œå¯¹äºå†…éƒ¨æ’åºï¼Œäººä»¬è¿˜æ˜¯ä¼šé€‰æ‹©å¿«é€Ÿæ’åºç®—æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-5&#34;&gt;å¿«é€Ÿæ’åº&lt;/h2&gt;
&lt;p&gt;å¿«é€Ÿæ’åºæ˜¯ç›®å‰åœ¨å®è·µä¸­å·²çŸ¥çš„æœ€å¿«çš„æ’åºç®—æ³•ã€‚å®ƒçš„å¹³å‡è¿è¡Œæ—¶é—´æ˜¯ &lt;em&gt;O(NlogN)&lt;/em&gt;ã€‚è¯¥ç®—æ³•ä¹‹æ‰€ä»¥ç‰¹åˆ«å¿«çš„åŸå› æ˜¯å®ƒå…·æœ‰éå¸¸ç²¾ç‚¼å’Œé«˜åº¦ä¼˜åŒ–çš„å†…éƒ¨å¾ªç¯ã€‚&lt;/p&gt;
&lt;p&gt;å¿«é€Ÿæ’åºæ˜¯é‡‡ç”¨äº†ç±»ä¼¼äºå½’å¹¶æ’åºç±»ä¼¼çš„åˆ†æ²»ç®—æ³•ã€‚åŸç†æ˜¯åœ¨é›†åˆä¸­å¯»æ‰¾ä¸€ä¸ªæ¢çº½å…ƒï¼Œç„¶åå°†é›†åˆåˆ†ä¸ºå¤§äºæ¢çº½å…ƒçš„éƒ¨åˆ†å’Œå°äºæ¢çº½å…ƒçš„éƒ¨åˆ†ã€‚ç„¶åå°†ä¸¤éƒ¨åˆ†ç»§ç»­ä½¿ç”¨å¿«é€Ÿæ’åºï¼Œç›´åˆ°æœ€åçš„é›†åˆä¸­æœ‰ä¸€ä¸ªæˆ–è€…æ— å…ƒç´ ï¼Œç›´æ¥è¿”å›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-6&#34;&gt;é€‰å–æ¢çº½å…ƒ&lt;/h2&gt;
&lt;h4 id=&#34;heading-7&#34;&gt;ä¸€ç§é”™è¯¯çš„åšæ³•&lt;/h4&gt;
&lt;p&gt;ä¸€ç§æƒ³å½“ç„¶çš„åšæ³•æ˜¯å°†è¾“å…¥çš„ç¬¬ä¸€ä¸ªå…ƒç´ ç”¨äºæ¢çº½å…ƒã€‚è¿™å¯¹äºè¾“å…¥æ˜¯éšæœºçš„æƒ…å†µä¸‹æ˜¯å¯ç”¨çš„ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯¹äºé¢„æ’åºçš„è¾“å…¥ï¼Œè¿™ç§åªä¼šè®©å¿«é€Ÿæ’åºæ¯æ¬¡è¿è¡Œåœ¨æœ€åçš„çŠ¶æ€ä¸‹ã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-8&#34;&gt;å®‰å…¨çš„åšæ³•&lt;/h4&gt;
&lt;p&gt;å®‰å…¨çš„åšæ³•æ˜¯éšæœºé€‰å–æ¢çº½å…ƒã€‚ä¸€èˆ¬æ¥è¯´è¿™ç§ç­–ç•¥æ˜¯éå¸¸æœ‰æ•ˆçš„ï¼Œé™¤ééšæœºæ•°ç”Ÿæˆå™¨äº§ç”Ÿäº†é—®é¢˜ã€‚ä½†æ˜¯éšæœºæ•°çš„äº§ç”Ÿæ˜¯æ˜‚è´µçš„ï¼Œæ ¹æœ¬å‡å°‘ä¸äº†ç®—æ³•å…¶ä½™éƒ¨åˆ†çš„å¹³å‡è¿è¡Œæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;äº‹å®ä¸Šï¼Œå®Œå…¨éšæœºçš„æ¢çº½å…ƒçš„é€‰æ‹©å…¶å®å¯¹äºç®—æ³•æ—¶é—´å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œå› ä¸ºæœ€ä½³çš„é€‰æ‹©æ˜¯æ¯ä¸€æ¬¡éƒ½é€‰ä¸­äº†æ­£å¥½èƒ½å°†æ•°æ®åˆ†æˆä¸¤ä¸ªæ•°é‡ç›¸ç­‰çš„æ¢çº½å…ƒï¼Œä¹Ÿå°±æ˜¯é›†åˆçš„ä¸­å€¼ã€‚ä½†æ˜¯é€‰æ‹©ä¸­å€¼çš„é—®é¢˜åœ¨äºï¼Œæˆ‘ä»¬æ— æ³•è·å¾—ä¸­å€¼ä½ç½®ï¼Œè¿™éœ€è¦å¤§é‡çš„æ—¶é—´ã€‚æ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨äº†ä¸€ç§ &lt;strong&gt;ä¸‰æ•°ä¸­å€¼åˆ†å‰²æ³•&lt;/strong&gt; çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä»é›†åˆå¤´ï¼Œé›†åˆä¸­éƒ¨ï¼Œé›†åˆå°¾å„å–ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”ä½¿ç”¨è¿™ä¸‰ä¸ªå…ƒç´ çš„ä¸­é—´å€¼ä½œä¸ºæ¢çº½å…ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-9&#34;&gt;æµç¨‹&lt;/h2&gt;
&lt;h4 id=&#34;heading-10&#34;&gt;é›†åˆåˆ†å‰²&lt;/h4&gt;
&lt;p&gt;åœ¨é€‰å–å®Œæ¢çº½å…ƒåï¼Œéœ€è¦å¯¹äºé›†åˆè¿›è¡Œåˆ†å‰²ï¼Œé‡æ–°æ•´ç†æˆä¸ºä¸¤éƒ¨åˆ†ï¼Œè¿™é‡Œçš„æ€è·¯æ˜¯å…ˆå°†é›†åˆä¸­çš„æ¢çº½å…ƒæ”¾åœ¨æœ«å°¾ï¼Œå¹¶ä¸”ä¸€ä¸ªæŒ‡é’ˆä»å¤´åˆ°å°¾æ»‘è¿‡å°äºæ¢çº½å…ƒçš„å…ƒç´ ï¼Œä¸€ä¸ªæŒ‡é’ˆä»å°¾åˆ°å¤´æ»‘è¿‡å¤§äºæ¢çº½å…ƒçš„å…ƒç´ ï¼Œç›´åˆ°ä¸¤ä¸ªæŒ‡é’ˆåœä¸‹æ¥ï¼Œè¿™æ—¶äº¤æ¢ä¸¤ä¸ªæŒ‡é’ˆçš„å…ƒç´ ï¼Œæœ€åæŒ‡é’ˆè·¨è¿‡å¦å¤–ä¸€ä¸ªæŒ‡é’ˆï¼Œç»“æŸï¼Œå°†æ¢çº½å…ƒä»æœ«å°¾å’Œå…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆäº¤æ¢å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å¦‚æœå‡ºç°äº†ç­‰äºæ¢çº½å…ƒçš„å…ƒç´ ï¼Œå°±è¦æ³¨æ„äº†ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬åœ¨æ­¤ä½ç½®åœä¸‹æ¥ï¼Œè¿›è¡Œäº¤æ¢ï¼Œå…¶å®æ˜¯æ— æ„ä¹‰çš„äº¤æ¢ï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯å¯ä»¥ä¿è¯æŒ‡é’ˆä¸ä¼šä¸€æ¬¡æ€§æ»‘è¿‡è¾ƒå¤šå…ƒç´ è€Œå¯¼è‡´ä¸¤ä¸ªæœ€ååˆ’åˆ†çš„é›†åˆä¸å‡è¡¡ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç­–ç•¥æ˜¯é‡åˆ°ä¸æ¢çº½å…ƒå€¼ç›¸ç­‰çš„å…ƒç´ ï¼Œä¾æ—§ä¼šåœä¸‹æŒ‡é’ˆï¼Œç­‰å¾…äº¤æ¢ã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-11&#34;&gt;å°æ•°ç»„&lt;/h4&gt;
&lt;p&gt;åœ¨é€’å½’çš„è¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿå¾ˆå¤šå°çš„æ•°ç»„ï¼Œå¯¹äºå¾ˆå°çš„æ•°ç»„ï¼ˆN&amp;lt;20)ï¼Œå¿«é€Ÿæ’åºçš„æ•ˆç‡ç”šè‡³ä¸å¦‚æ’å…¥æ’åºï¼Œè¿™æ—¶å› ä¸ºå¿«é€Ÿæ’åºé‡‡ç”¨äº†é€’å½’çš„æ–¹æ³•ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å¿«é€Ÿæ’åºä¸­ä½¿ç”¨æ’å…¥æ’åºæ¥å¤„ç†å°æ•°ç»„ï¼Œè€Œä½¿ç”¨å¿«é€Ÿæ’åºæ¥å¤„ç†å¤§é—®é¢˜ï¼Œè¿™æ ·ä¸ä»…ä»…èƒ½å¤Ÿè§£å†³æ•ˆç‡çš„é—®é¢˜ï¼Œè€Œä¸”å¯ä»¥é¿å…è¯¸å¦‚ä¸‰æ•°ä¸­å€¼åˆ†å‰²æ³•å‡ºç°åªæœ‰ä¸¤ä¸ªæˆ–ä¸€ä¸ªå…ƒç´ çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;ElementType &lt;span style=&#34;color:#a6e22e&#34;&gt;Median3&lt;/span&gt;(ElementType A[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Left, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Right) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Center &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (Left &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; Right) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (A[Left] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; A[Center])
		Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Left], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Center]);
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (A[Left] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; A[Right])
		Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Left], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Right]);
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (A[Center] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; A[Right])
		Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Center], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Right]);

	Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Center], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Right &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]);
	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; A[Right &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;];
}

&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define Cutoff(3)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Qsort&lt;/span&gt;(ElementType A[], &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Left, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Right) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i, j;
	ElementType Pivot;

	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (Left &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; Cutoff &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Right) {
		Pivot &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Median3(A, Left, Right);
		i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Left; j &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Right &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
		&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (;;) {
			&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (A[&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;j] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; Pivot) {}
			&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (A[&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;j] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; Pivot) {}
			&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; j)
				Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[i], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[j]);
			&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
				&lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
		}
		Swap(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[i], &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;A[Right &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]);

		Qsort(A, Left, i &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
		Qsort(A, i &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, Right);
	}
	&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
		InsertSort(A &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; Left, Right &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; Left &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading-12&#34;&gt;å¯¹äºå¤§å‹ç»“æ„çš„æ’åº&lt;/h2&gt;
&lt;p&gt;å¯¹äºå¤§å‹ç»“æ„çš„æ’åºï¼Œé¦–å…ˆå› ä¸ºç»“æ„çš„æ€§è´¨ä½¿å¾—å¤åˆ¶çš„æ“ä½œå¾ˆéš¾ä»¥è¿›è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåºåˆ—æŒ‡é’ˆçš„æ–¹æ³•ï¼Œå°†æŒ‡å‘ç»“æ„çš„æŒ‡é’ˆæ”¾ç½®åœ¨ä¸€ä¸ªæ•°å­—ä¸­å¹¶å¯¹æŒ‡é’ˆæ’åºå³å¯ã€‚è¿™ç§æ’åºè¢«ç§°ä½œ &lt;strong&gt;é—´æ¥æ’åº&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-13&#34;&gt;æ¡¶å¼æ’åº&lt;/h2&gt;
&lt;p&gt;æ¡¶å¼æ’åºæ˜¯ä¸€ä¸ªå¾ˆç¥å¥‡çš„æ’åºæ–¹æ³•ï¼Œå› ä¸ºä»–åªéœ€è¦çº¿æ€§çš„æ—¶é—´å°±å¯ä»¥å¯¹äºæ•°ç»„è¿›è¡Œæ’åºã€‚ä½†æ˜¯æ¡¶å¼æ’åºçš„è¦æ±‚æ¯”è¾ƒä¸¥æ ¼ï¼Œè¢«æ’åºçš„å…ƒç´ å¿…é¡»æ˜¯æ•´æ•°ä¸”æ˜¯ä¸å¤§äº M çš„ï¼Œæˆ‘ä»¬ç”¨å¦å¤–ä¸€ä¸ªå¤§å°ä¸º M åˆå§‹åŒ–ä¸º 0 çš„æ•°ç»„ï¼Œå¯¹äºé›†åˆä¸­ä»»æ„ä¸€ä¸ªå…ƒç´ ï¼Œæ•°ç»„ä¸­éƒ½æœ‰ä¸€ä¸ªä¸‹æ ‡ä¸ä¹‹å¯¹åº”ï¼Œæˆ‘ä»¬é¡ºåºè®°å½•å…ƒç´ åœ¨æ¡¶ä¸­ä¸åŒä½ç½®çš„å‡ºç°æ¬¡æ•°ï¼Œè­¬å¦‚å¯¹äº 3,8,2,4,5,1,3 åºåˆ—ä½¿ç”¨ä¸€ä¸ª M=8 çš„æ•°ç»„ï¼Œè¾“å…¥ 3 åˆ™ M[3]++ï¼Œè¾“å…¥ 8ï¼ŒM[8]++ã€‚ç›´åˆ°æœ€åï¼ŒæŒ‰ç…§å€¼ä½œä¸ºæ¬¡æ•°ï¼Œæ‰“å°å‡ºæ•°ç»„ä¸­çš„ä¸‹æ ‡å³å¯ã€‚æ¡¶å¼æ’åºåœ¨è¾ƒå°çš„æ•´æ•°è¾“å…¥ä¸­æ•ˆç‡å¾ˆé«˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæ¡¶å¼æ’åºèƒ½å¤Ÿæ‰“ç ´ &lt;em&gt;O(NlogN)&lt;/em&gt; ä¸‹ç•Œï¼Œå…¶å®å¾ˆç®€å•ï¼Œå› ä¸ºæ¡¶å¼æ’åºå…¶å®åŸç†ä¸Šä½¿ç”¨çš„æ˜¯ä¸€ä¸ª M-è·¯é€‰æ‹©å™¨ï¼Œå’Œæˆ‘ä»¬ä¹‹å‰çš„ä¸¤å…ƒæ¯”è¾ƒä¸åŒï¼Œæ¡¶å¼æ’åºä¸€æ¬¡æ€§è¿›è¡Œäº† M å…ƒæ¯”è¾ƒï¼Œå¹¶æœ€ç»ˆç¡®å®šäº†å…ƒç´ çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-14&#34;&gt;å¤–éƒ¨æ’åº&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆå‰çš„æ’åºï¼Œéƒ½æ˜¯æŒ‡å†…éƒ¨æ’åºï¼Œä¹Ÿå°±æ˜¯é›†åˆå‚¨å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸è€ƒè™‘æ•°æ®çš„è¯»å–å’Œå†™å…¥çš„æ—¶é—´æ¶ˆè€—ï¼Œä½†å®é™…ä¸Šï¼Œå¦‚æœæˆ‘ä»¬è¦å°†ä½äºç¡¬ç›˜ä¸Šçš„æ•°æ®æ’åºï¼Œæˆ–è€…ä½äºç£ç›˜ä¸Šçš„æ•°æ®è¿›è¡Œæ’åºï¼Œè¯»å–æ—¶é—´å’Œå†™å…¥æ—¶é—´ä¼šæˆä¸ºæ’åºç®—æ³•çš„ç“¶é¢ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;heading-15&#34;&gt;ç®€å•ç®—æ³•&lt;/h3&gt;
&lt;p&gt;ç®€å•çš„å¤–éƒ¨æ’åºç®—æ³•æ˜¯ä½¿ç”¨å½’å¹¶æ’åºä¸­çš„ Merge ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸¤ä¸ªç£å¸¦æˆ–è€…å­˜å‚¨å™¨ä»¶ï¼Œè®¾å†…å­˜ä¸€æ¬¡å¯ä»¥å­˜å‚¨ M ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬å°±å…ˆä»ä¸€ä¸ªç£å¸¦ä¸­è¯»å– M ä¸ªå…ƒç´ ï¼Œä½¿ç”¨å†…éƒ¨æ’åºå°†è¿™äº›æ•°æ®æ’åºåï¼Œå†æŠŠè¿™äº›æ’è¿‡åºçš„è®°å½•äº¤æ›¿çš„å†™åœ¨ä¸¤ä¸ªç£ç›˜ä¸Šï¼Œè¿™äº›æ’è¿‡åºçš„è®°å½•å«åš &lt;strong&gt;é¡ºä¸²&lt;/strong&gt;ã€‚å½“æˆ‘ä»¬è·å¾—é¡ºä¸²ä¹‹åï¼Œä½¿ç”¨å½’å¹¶æ’åºä¸­çš„åˆå¹¶æ“ä½œï¼Œå°†é¡ºä¸²æˆå¯¹åˆå¹¶å³å¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;heading-16&#34;&gt;å¤šè·¯åˆå¹¶&lt;/h3&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬æœ‰å¥½å‡ ä¸ªå¤–éƒ¨å­˜å‚¨è®¾å¤‡ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨å¤šè·¯åˆå¹¶ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡æ€§å¯¹äºå¤šä¸ªé¡ºä¸²ä½¿ç”¨å½’å¹¶æ’åºï¼Œå°†ä¸¤è·¯å½’å¹¶æ‹“å±•åˆ°å¤šè·¯æ˜¯å¾ˆç®€å•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸åšç‰¹åˆ«çš„æè¿°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-17&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å¯¹äºä¸€èˆ¬çš„å†…éƒ¨æ’åºåº”ç”¨ï¼Œæˆ‘ä»¬çš„é€‰æ‹©åªæœ‰ä¸‰ç§ï¼Œæ’å…¥æ’åºï¼Œå¸Œå°”æ’åºï¼Œå¿«é€Ÿæ’åºï¼Œå®ƒä»¬çš„é€‰æ‹©ä¸»è¦æ˜¯æ ¹æ®è¾“å…¥çš„è§„æ¨¡å†³å®šçš„ã€‚å½’å¹¶æ’åºçš„æ•ˆç‡è¾ƒä½ï¼Œä½†æ˜¯å®ƒå´æ˜¯å¤–éƒ¨æ’åºçš„å…³é”®æ€æƒ³ã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>Priority Queue/Heap</title>
      <link>https://xiahualiu.github.io/posts/2018-07-24-priority_queue/</link>
      <pubDate>Tue, 24 Jul 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-07-24-priority_queue/</guid>
      <description>&lt;p&gt;åœ¨æœ¬æ–‡ä¸­å°†ä¼šå¯¹äº &lt;strong&gt;ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆPriority Queueï¼‰&lt;/strong&gt; çš„å‡ ç§å®ç°æ–¹å¼è¿›è¡Œè¯¦ç»†çš„å™è¿°ï¼Œä¼˜å…ˆé˜Ÿåˆ—åœ¨æ—¥å¸¸ä¸­çš„ä½¿ç”¨éå¸¸æ™®éï¼Œåœ¨å­¦æ ¡é‡Œé¢çš„æ‰“å°æœºæ‰“å°æ–‡ä»¶çš„æ—¶å€™ï¼Œåº”è¯¥å¯¹äºæ–‡ä»¶çš„é¡µæ•°è¿›è¡Œæ’åºï¼Œé¦–å…ˆæ‰“å°é¡µæ•°æœ€å°‘çš„æ–‡ä»¶ï¼Œæœ€åå¤„ç†é¡µæ•°æœ€å¤šçš„æ–‡ä»¶ï¼Œè™½ç„¶åœ¨é˜Ÿåˆ—ä¸­ï¼Œæ–‡ä»¶æäº¤çš„é¡ºåºå¹¶ä¸æ˜¯è¿™æ ·çš„ã€‚ï¼ˆä½†æ˜¯ç°åœ¨çš„å¤§å¤šæ•°æ‰“å°æœºéƒ½ä¸ä¼šè¿™æ ·åšï¼Œè­¬å¦‚æˆ‘ä»¬å­¦æ ¡çš„æ‰“å°æœºï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç³»ç»Ÿä¸­ï¼Œæ“ä½œç³»ç»Ÿè°ƒåº¦ç¨‹åºå¿…é¡»å†³å®šåœ¨è‹¥å¹²è¿›ç¨‹ä¸­è¿è¡Œå“ªä¸ªè¿›ç¨‹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªè¿›ç¨‹åªèƒ½è¢«å…è®¸è¿è¡Œä¸€ä¸ªå›ºå®šçš„æ—¶é—´ç‰‡ï¼ˆåœ¨è¿™é‡Œä¸è€ƒè™‘è¿›ç¨‹å¹¶è¡Œæƒ…å†µï¼‰ã€‚ä¸€ç§ç®—æ³•æ˜¯ä½¿ç”¨é˜Ÿåˆ—ï¼Œè°ƒåº¦æ—¶ä¸€ç›´ä»é˜Ÿé¦–æ‹¿å‡ºä½œä¸šè¿›è¡Œï¼Œåœ¨é˜Ÿå°¾å¢åŠ ä½œä¸šã€‚ä½†æ˜¯æ›´ä¼˜çš„æƒ…å†µæ˜¯ï¼ŒçŸ­çš„ä½œä¸šè¦å°½å¯èƒ½å¿«çš„ç»“æŸï¼Œå› ä¸ºçŸ­çš„ä½œä¸šé‡è¦æ€§å’Œé•¿çš„ç›¸åŒï¼›æœ‰äº›æƒ…å†µä¸‹ï¼Œå³ä½¿ä½œä¸šå¾ˆé•¿ï¼Œä½†æ˜¯ç”±äºå…¶å…·æœ‰ä¼˜å…ˆçº§ï¼Œä¹Ÿåº”è¯¥é¦–å…ˆå¯¹å…¶è¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°†è®¨è®ºä»¥ä¸‹çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆé˜Ÿåˆ— ADT çš„æœ‰æ•ˆå®ç°&lt;/li&gt;
&lt;li&gt;ä¼˜å…ˆé˜Ÿåˆ—çš„ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;ä¼˜å…ˆé˜Ÿåˆ—çš„é«˜çº§å®ç°&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä»¬å°†çœ‹åˆ°çš„è¿™ç±»æ•°æ®ç»“æ„å±äºè®¡ç®—æœºç§‘å­¦ä¸­æœ€è®²ç©¶çš„ä¸€ç§ã€‚
&amp;mdash;&lt;em&gt;ã€ŠData Structure and Algorithm Analysis in Cã€‹&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦ä¸ºè¿™ä¸€ç« å•ç‹¬è®°å½•çš„åŸå› ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;ç”±äºæ˜¯é˜Ÿåˆ—ï¼Œæ‰€ä»¥ä¼˜å…ˆé˜Ÿåˆ—çš„æ¨¡å‹ä¸é˜Ÿåˆ—ç›¸åŒï¼Œ&lt;strong&gt;å…¥é˜Ÿï¼ˆEnqueueï¼‰&lt;/strong&gt;ï¼Œå’Œ &lt;strong&gt;å‡ºé˜Ÿï¼ˆDequeueï¼‰&lt;/strong&gt;ï¼Œä½†æ˜¯ä¸æ™®é€šé˜Ÿåˆ—ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œçš„å‡ºé˜Ÿæ˜¯è¸¢å‡ºä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ã€‚åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œä¼˜å…ˆçº§ä¸€èˆ¬ä½¿ç”¨æ•°å­—ï¼ˆ0ï¼Œ1ï¼Œ2ï¼Œ3&amp;hellip;ï¼‰è¡¨ç¤ºï¼Œä¼˜å…ˆçº§è¶Šé«˜çš„å…ƒç´ ï¼Œå…¶å¯¹åº”çš„æ•°å­—å°±ä¼šè¶Šä½ã€‚æ‰€ä»¥åœ¨æ¨¡å‹çš„æ“ä½œä¸­ï¼Œæˆ‘ä»¬å°†å‡ºé˜Ÿç§°ä¸º &lt;strong&gt;åˆ é™¤æœ€å°å€¼ï¼ˆDeleteMinï¼‰&lt;/strong&gt;ï¼Œå…¥é˜Ÿç§°ä¸º &lt;strong&gt;æ’å…¥ï¼ˆInsertï¼‰&lt;/strong&gt;ï¼Œä½†è¿™ä¸¤ç§æ“ä½œçš„ä½œç”¨å’ŒåŸæœ‰çš„æ™®é€šé˜Ÿåˆ—ç›¸åŒï¼Œåªä¸è¿‡å‡ºé˜Ÿæ“ä½œç•¥æœ‰æ”¹å˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è½¯ä»¶å·¥ç¨‹ç•Œç›®å‰è®¤ä¸ºåˆ é™¤æœ€å°å€¼å¹¶ä¸æ˜¯ä¸ªå¾ˆå¥½çš„æ€è·¯ï¼Œä¸è¿‡å‡ºäºå†å²åŸå› æˆ‘ä»¬ç»§ç»­ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-24-Priority_Queue/module.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;ä¸€äº›ç®€å•çš„å®ç°&lt;/h2&gt;
&lt;p&gt;æœ€ç®€å•çš„å®ç°æ˜¯ä½¿ç”¨é“¾è¡¨ï¼Œåœ¨é“¾è¡¨çš„è¡¨å¤´ä»¥ &lt;em&gt;O(1)&lt;/em&gt; æ‰§è¡Œæ’å…¥æ“ä½œï¼Œä»¥ &lt;em&gt;O(n)&lt;/em&gt; éå†é“¾è¡¨ä»¥å¯»æ‰¾æœ€å°å…ƒåˆ é™¤ï¼Œå¦å¤–ä¸€ç§åŠæ³•æ˜¯ä½¿é“¾è¡¨ä¸€ç›´ä¿æŒæ’åºçŠ¶æ€ï¼Œè¿™ä¼šä½¿æ’å…¥æ“ä½œæˆä¸º &lt;em&gt;O(n)&lt;/em&gt;ï¼Œåˆ é™¤æ“ä½œæˆä¸º &lt;em&gt;O(1)&lt;/em&gt;ã€‚ä½†æ˜¯åœ¨é˜Ÿåˆ—ä¸­ï¼Œåˆ é™¤æ“ä½œä»æ¥ä¸ä¼šå¤šäºæ’å…¥æ“ä½œï¼Œæ‰€ä»¥å‰è€…çš„åŠæ³•æ›´å¥½ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–çš„ä¸€ç§åŠæ³•æ˜¯ä½¿ç”¨äºŒå‰æŸ¥æ‰¾æ ‘ï¼ŒäºŒå‰æ ‘ä½¿å¾—å…ƒç´ çš„æ’å…¥å’Œåˆ é™¤æ“ä½œå¹³å‡æ—¶é—´éƒ½æ˜¯ &lt;em&gt;O(logN)&lt;/em&gt;ã€‚ä½†æ˜¯ä½¿ç”¨äºŒå‰æŸ¥æ‰¾æ ‘ä¼¼ä¹æœ‰ç‚¹è¿‡åˆ†ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦å¾ˆå°‘çš„æ“ä½œï¼Œè€ŒäºŒå‰æ ‘çš„åŠŸèƒ½è¿‡äºå¼ºå¤§ï¼Œè€Œä¸”ä¸æŒ‡é’ˆæœ‰å…³ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ç§æ–°çš„æ•°æ®ç»“æ„ï¼Œå®ƒå°†ä¸éœ€è¦æŒ‡é’ˆï¼Œå¹¶ä»¥æœ€åæƒ…å†µ &lt;em&gt;O(logN)&lt;/em&gt; æ”¯æŒè¿™ä¸¤ç§æ“ä½œã€‚ç„¶åæˆ‘ä»¬è®¨è®ºå¦‚ä½•åˆå¹¶å®ƒä»¬ï¼Œåœ¨åˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨åˆ°æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;äºŒå‰å †&lt;/h2&gt;
&lt;p&gt;å®ƒå«åš &lt;strong&gt;äºŒå‰å †ï¼ˆbinary heapï¼‰&lt;/strong&gt;ï¼Œå®ƒå¯¹äºä¼˜å…ˆé˜Ÿåˆ—å¦‚æ­¤æ™®éï¼Œä»¥è‡³äºåªè¦æèµ· &lt;strong&gt;å †ï¼ˆheapï¼‰&lt;/strong&gt;ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºæ˜¯è¿™ç§æ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;heading-3&#34;&gt;ç»“æ„æ€§è´¨&lt;/h3&gt;
&lt;p&gt;å †æ˜¯ä¸€ç§å®Œå…¨è¢«å¡«æ»¡æˆ–è€…å³å°†è¢«å¡«æ»¡çš„äºŒå‰æ ‘ï¼Œå³ä½¿åº•éƒ¨å¯èƒ½æœ‰äº›æ²¡æœ‰å¡«æ»¡ï¼Œä½†æ˜¯å…ƒç´ ä»é¡¶åˆ°åº•ä¾æ¬¡å¡«å…¥äºŒå‰æ ‘çš„å„ä¸ªéƒ¨ä½ã€‚ç”±äºå…¶è§„å¾‹å¾ˆæ˜¾è‘—ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ•°ç»„æ¥è¡¨ç¤ºå®ƒã€‚å¦‚å›¾ï¼Œæ ‘ä¸­çš„æ•°å­—å¯¹åº”ç€å®ƒä»¬åœ¨æ•°ç»„å†…çš„ä½ç½®ã€‚è‡³äºä¸ºä»€ä¹ˆæ ¹ä¸æ˜¯ 0 ä½ç½®ï¼Œæˆ‘ä»¬åœ¨ä¸‹éƒ¨åˆ†æ¥è®¨è®ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-24-Priority_Queue/binary_heap.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ˜¾ç„¶ï¼Œå¯¹äºä¸‹æ ‡ä¸º i çš„å…ƒç´ ï¼Œä½¿ç”¨ i/2 å¯ä»¥è®¿é—®å…¶çˆ¶èŠ‚ç‚¹ï¼Œä½¿ç”¨ 2i å¯ä»¥è®¿é—®å…¶å·¦å­æ ‘ï¼Œä½¿ç”¨ 2i+1 ç´¢å¼•å¯ä»¥è®¿é—®å…¶å³å­æ ‘ï¼Œç›¸æ¯”äºæŒ‡é’ˆï¼Œè¿™æ ·çš„è®¿é—®æ–¹å¼æ›´åŠ å¿«æ·ï¼Œç¼ºç‚¹å°±æ˜¯å…ƒç´ åªèƒ½æ˜¯è¿ç»­åˆ†å¸ƒçš„æ•°ç»„ç±»å‹ï¼Œæ ‘å¿…é¡»æ˜¯æ»¡äºŒå‰æ ‘ã€‚å †çš„å¤§å°ï¼Œç­‰äºæˆ‘ä»¬å£°æ˜æ•°ç»„æ—¶å€™çš„æ•°ç»„é•¿åº¦ã€‚&lt;/p&gt;
&lt;h3 id=&#34;heading-4&#34;&gt;åˆ›å»ºäºŒå‰å †&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹çš„ä»£ç åˆ›å»ºäºŒå‰å †ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define ElementType int&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define MinValue 0&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; HeapStruct {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Capacity;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; Size;
	ElementType &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;Elements;
}&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;PriorityQueue;

&lt;span style=&#34;color:#75715e&#34;&gt;//åˆå§‹åŒ–å †
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;PriorityQueue &lt;span style=&#34;color:#a6e22e&#34;&gt;PQInitialize&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; MaxElements);
&lt;span style=&#34;color:#75715e&#34;&gt;//é”€æ¯å †
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PQDestroy&lt;/span&gt;(PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//æ¸…ç©ºå †
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MakeEmpty&lt;/span&gt;(PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//æ’å…¥å…ƒç´ 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Insert&lt;/span&gt;(ElementType X, PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//æ‰“å°ç›®å‰å †çš„å½¢çŠ¶
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PrintPQ&lt;/span&gt;(PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//å‡ºé˜Ÿ
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;ElementType &lt;span style=&#34;color:#a6e22e&#34;&gt;DeleteMin&lt;/span&gt;(PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//å¯»æ‰¾ä¸‹ä¸€ä¸ªå‡ºé˜Ÿå…ƒç´ 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;ElementType &lt;span style=&#34;color:#a6e22e&#34;&gt;FindMin&lt;/span&gt;(PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//å †æ˜¯å¦ä¸ºç©º
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;IsEmpty&lt;/span&gt;(PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//å‡å°‘å…³é”®å­—çš„å€¼(å¢å¤§ä¼˜å…ˆçº§)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DecreaseKey&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; P,&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; delta,PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//å¢å¤§å…³é”®å­—çš„å€¼(å‡å°‘ä¼˜å…ˆçº§)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;IncreaseKey&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; P, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; delta, PriorityQueue H);
&lt;span style=&#34;color:#75715e&#34;&gt;//åˆ é™¤ä¸€ä¸ªå…ƒç´ 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DeleteKey&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; P, PriorityQueue H);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¦ç»†çš„å„ç§å‡½æ•°å®ç°æ–¹æ³•åœ¨æˆ‘å†™çš„å¯¹åº”çš„ &lt;a href=&#34;https://git.coding.net/Eggycat/DSAA.git&#34;&gt;repo&lt;/a&gt; ä¸­çš„ &lt;code&gt;Priority_Queue&lt;/code&gt; ä¸­ï¼Œä¸å…·ä½“ä»‹ç»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;d-&#34;&gt;d-å †&lt;/h2&gt;
&lt;p&gt;d-å †ï¼Œåˆè¢«ç§°ä½œå¤šå‰å †ï¼Œæ˜¯ä¸€ä¸ªå®Œå…¨çš„å¤šå‰æ ‘ï¼Œä¸äºŒå‰å †ç›¸æ¯”ï¼Œå¤šå‰å †çš„ä¼˜ç‚¹åœ¨äºå‡å°‘äº† &lt;code&gt;Insert&lt;/code&gt; çš„æ—¶é—´ï¼Œå› ä¸ºæ ‘çš„å±‚æ ‘å°‘äº†ï¼Œè€Œ &lt;code&gt;Insert&lt;/code&gt; æ“ä½œçš„æœ€åæ—¶é—´å°±æ˜¯å…ƒç´ ä»æœ€åº•å±‚å‡åˆ°æ ¹ï¼Œä¸å±‚æ•°å¤šå°‘æœ‰å…³ï¼Œä¸º &lt;em&gt;O(logdN)&lt;/em&gt;ã€‚è€Œ &lt;code&gt;DeleteMin&lt;/code&gt; æ“ä½œç”±äºæœ‰ç›¸é‚»å…ƒç´ çš„æ¯”è¾ƒè¿‡ç¨‹ï¼Œå¤šå‰å †çš„æ•ˆç‡å°±æ˜¾è‘—ä¸‹é™ï¼Œä¸º &lt;em&gt;O(d&lt;/em&gt;logdN)*ï¼Œd å †çš„ä½¿ç”¨å’Œ B æ ‘ä½¿ç”¨ç±»ä¼¼ï¼Œåœ¨ç£ç›˜ä¸Šè¯»å†™æ•°æ®æ—¶æ•ˆç‡é«˜äºäºŒå‰å †ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-5&#34;&gt;å·¦å¼å †&lt;/h2&gt;
&lt;p&gt;å·¦å¼å †çš„å®ç°æ˜¯ä¸ºäº†ç®€åŒ–ä¸¤ä¸ªäºŒå‰å †çš„åˆå¹¶è¿‡ç¨‹ï¼Œå·¦å¼å †çš„å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä»¬æŠŠä»»ä¸€èŠ‚ç‚¹ X çš„ &lt;strong&gt;é›¶è·¯å¾„é•¿ï¼ˆNPLï¼‰&lt;/strong&gt; &lt;em&gt;Npl(X)&lt;/em&gt; å®šä¹‰ä¸ºä» &lt;em&gt;X&lt;/em&gt; åˆ°ä¸€ä¸ªæ²¡æœ‰ä¸¤ä¸ªå„¿å­çš„èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„çš„é•¿åº¦ã€‚å…·æœ‰ä¸€ä¸ªæˆ–è€…é›¶ä¸ªèŠ‚ç‚¹çš„ &lt;em&gt;Npl(X)&lt;/em&gt; ä¸º 0ï¼Œè€Œ *Npl(NULL)*=-1ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å·¦å¼å †ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸­ä»»æ„èŠ‚ç‚¹çš„å·¦å„¿å­é›¶è·¯å¾„é•¿è¦å¤§äºç­‰äºå³å„¿å­é›¶è·¯å¾„é•¿ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å®šç†ï¼šåœ¨å³è·¯å¾„ä¸Šæœ‰ r ä¸ªèŠ‚ç‚¹çš„å·¦å¼æ ‘å¿…ç„¶è‡³å°‘æœ‰ 2^r-1 ä¸ªèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-24-Priority_Queue/leftist_heap.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-6&#34;&gt;å·¦å¼å †çš„åˆå¹¶ï¼ˆé‡ç‚¹ï¼‰&lt;/h2&gt;
&lt;p&gt;åˆå¹¶æ˜¯å·¦å¼å †çš„åŸºæœ¬æ“ä½œã€‚æ’å…¥å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªå•èŠ‚ç‚¹æ ‘çš„åˆå¹¶ã€‚åˆå¹¶çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œæ€ä¹ˆç†è§£å‘¢ï¼Œå°±æ˜¯å·¦å¼å †çš„ä¸¤ä¸ªå­æ ‘ä¸€å®šä¹Ÿæ˜¯å·¦å¼å †ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ªåŸºæœ¬çŠ¶æ€å¼€å§‹ï¼Œé€æ­¥åˆ†æé€’å½’åˆå¹¶çš„è¿‡ç¨‹ï¼šç¡®ä¿åˆå¹¶è¿‡åæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘å³å­æ ‘å‡ä¸ºå·¦å¼å †ï¼Œå¹¶ä¿è¯æ ¹èŠ‚ç‚¹æ»¡è¶³å·¦å¼å †è¦æ±‚ã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-7&#34;&gt;åˆå¹¶çš„è¿‡ç¨‹ä¸­çš„ç±»å‹&lt;/h4&gt;
&lt;p&gt;å¯¹äºå·¦å¼å † H1&amp;lt;-H2 çš„åˆå¹¶çš„è¿‡ç¨‹æœ‰ä¸‰ç§ç±»å‹ï¼Œç¬¬ä¸€ç§æ˜¯ H1 çš„å·¦å­æ ‘ä¸ºç©ºï¼Œåœ¨è¿™ç§æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°† H2 ç½®ä¸º H1 å·¦å­æ ‘ï¼Œå› ä¸ºåœ¨å·¦å¼å †ä¸­å·¦å­æ ‘ä¸ºç©ºæ„å‘³ç€å³å­æ ‘ä¹Ÿä¸ºç©ºï¼ŒH1 æ˜¯ä¸€ä¸ªå•èŠ‚ç‚¹å·¦å¼å †ï¼Œç›´æ¥åˆå¹¶çš„æ“ä½œæ˜¯å®‰å…¨çš„ã€‚å¹¶ä¸”è¿™æ ·ç”šè‡³ä¸ä¼šæ”¹å˜ H1 æ ¹èŠ‚ç‚¹çš„ &lt;em&gt;Npl&lt;/em&gt; å€¼ï¼Œå®ƒä¾æ—§ä¸º 0ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒç§ä¸º H1 çš„å³å­æ ‘ä¸ºç©ºï¼Œè¿™ç§çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬å°† H2 ç½®ä¸º H1 çš„å³å­æ ‘ï¼Œå› ä¸º H2 æ˜¯å·¦å¼å †ï¼ŒH1 çš„å·¦å­æ ‘ä¹Ÿæ˜¯å·¦å¼å †ï¼Œæ•…æˆ‘ä»¬åªè¦ç¡®ä¿åˆå¹¶åçš„ H1 æ ¹èŠ‚ç‚¹çš„é›¶è·¯å¾„é•¿æ»¡è¶³è¦æ±‚å³å¯ï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶ H1 æ ¹èŠ‚ç‚¹å·¦é›¶è·¯å¾„é•¿äºå³è·¯å¾„ï¼Œè‹¥ä¸æ»¡è¶³åˆ™å°†å…¶å·¦å³å­æ ‘äº¤æ¢ä½ç½®ï¼Œæœ€åæˆ‘ä»¬å°† H1 æ ¹èŠ‚ç‚¹çš„ &lt;em&gt;Npl&lt;/em&gt; å€¼å˜æˆä¸¤è€…ä¸­æœ€å°å€¼åŠ ä¸€ï¼Œå°±å®Œæˆäº†åˆå¹¶çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ï¼Œè¿™ç§çŠ¶æ€å¹¶ä¸å¸¸å‘ç”Ÿï¼ŒH1 é€šå¸¸å·¦å³å­æ ‘å·²ç»æœ‰å­æ ‘äº†ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬ä¸€ç›´é¡ºç€ H1 çš„å³å­æ ‘è·¯å¾„èµ°ä¸‹å»ï¼Œç›´åˆ°æ‰¾åˆ°æœ‰ä¸€ä¸ªæ»¡è¶³æˆ‘ä»¬ç¬¬ä¸€æˆ–ç¬¬äºŒç§ç±»å‹çš„èŠ‚ç‚¹ H1* å³å¯ï¼Œå› ä¸º H1 æ˜¯å·¦å¼å †ï¼Œå­æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ»¡è¶³å·¦å¼å †çš„æ¡ä»¶ï¼Œæˆ‘ä»¬è¿™ä¸ªæ—¶å€™å°±è§†ä½œ H1* ä¸ºç¬¬ä¸€æˆ–ç¬¬äºŒç§ç±»å‹ä¸­çš„å·¦å¼å †æ ¹èŠ‚ç‚¹ï¼Œå°† H1* å’Œ H2 åˆå¹¶ã€‚ä½†æ˜¯åœ¨ç¬¬äºŒç§ç±»å‹ä¸­ï¼Œæˆ‘ä»¬ä¿®æ”¹çš„ Npl å€¼ä¼šå½±å“çˆ¶èŠ‚ç‚¹çš„é›¶è·¯å¾„é•¿ï¼Œæ•…æˆ‘ä»¬è¦ä¾æ¬¡å‘ä¸Šæ£€æŸ¥ï¼Œæœ‰å¯èƒ½è¦äº¤æ¢å¥½å‡ æ¬¡å·¦å³å­æ ‘çš„ä½ç½®ï¼Œè€Œç¬¬ä¸€ç§ç±»å‹çš„åˆå¹¶æ˜¯å®‰å…¨çš„ï¼Œæˆ‘ä»¬æ— éœ€å†å»è€ƒè™‘ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰çš„æ—¶å€™ï¼Œåœ¨ H1 å‘å³å¯»æ‰¾å„¿å­çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½ä¼šé‡åˆ° H1 çš„å­èŠ‚ç‚¹å€¼å°äº H2 æ ¹èŠ‚ç‚¹å€¼å¤§å°çš„æƒ…å†µï¼Œæˆ‘ä»¬åªéœ€è¦äº¤æ¢ H1* H2 çš„é¡ºåºå³å¯ï¼Œä¹Ÿå°±æ˜¯æœ¬æ¥æ˜¯ H1*&amp;lt;-H2 åˆå¹¶ï¼Œæ”¹ä¸º H2&amp;lt;-H1*ï¼Œåˆå¹¶å®Œçš„ç»“æœæ˜¯ H1 æ ‘ä¸­çš„æŸäº›ç‚¹è¢« H2 ç»™å…ˆåˆå¹¶äº†ï¼Œç„¶åå¸¦æœ‰ H1 æŸäº›èŠ‚ç‚¹çš„ H2 å·¦å¼å †åˆè¢« H1 åˆå¹¶äº†ï¼Œå®é™…çš„å…ƒç´ å¹¶æ²¡æœ‰ä¸¢å¤±ï¼Œåªä¸è¿‡åœ¨ H1 å’Œ H2 ä¹‹é—´è¿›è¡Œäº†ä½ç½®çš„äº’æ¢ã€‚&lt;/p&gt;
&lt;p&gt;è¯¦ç»†å®ç°çš„ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SwapChildren&lt;/span&gt;(PriorityQueue L) {
	PriorityQueue temp;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (L &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NULL)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;;
	temp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; L&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Left;
	L&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Left &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; L&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Right;
	L&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Right &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; temp;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; PriorityQueue &lt;span style=&#34;color:#a6e22e&#34;&gt;Merge1&lt;/span&gt;(PriorityQueue L1, PriorityQueue L2) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Left &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NULL)
		L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Left &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; L2;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
		L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Right &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Merge(L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Right, L2);
		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Left&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Npl &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Right&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Npl)
			SwapChildren(L1);

		L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Npl &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Right&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Npl &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
	}
	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; L1;
}

PriorityQueue &lt;span style=&#34;color:#a6e22e&#34;&gt;Merge&lt;/span&gt;(PriorityQueue L1, PriorityQueue L2) {
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (L1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NULL)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; L2;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (L2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NULL)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; L1;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (L1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Element &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; L2&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Element)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Merge1(L1, L2);
	&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Merge1(L2, L1);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading-8&#34;&gt;æ–œå †&lt;/h2&gt;
&lt;p&gt;æ–œå †ä¸å·¦å¼å †çš„å…³ç³»å¦‚åŒä¼¸å±•æ ‘å’Œ AVL æ ‘ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬å¯¹äºæ–œå †çš„åˆæˆä½¿ç”¨ä¸å·¦å¼å †ç›¸åŒçš„æ–¹å¼ï¼Œé€’å½’çš„ç”Ÿæˆåˆæˆæ ‘ï¼Œä½†æ˜¯åœ¨éªŒè¯æ ¹çš„å·¦å¼æ€§æ—¶ï¼Œæˆ‘ä»¬éƒ½å‡è®¾åˆå¹¶åå³å­æ ‘é›¶è·¯å¾„é•¿è¾ƒé•¿ï¼Œç›´æ¥è¿›è¡Œäº¤æ¢ï¼Œè¿™æ ·åˆæˆçš„æ ‘åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯å·¦å¼çš„ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯ã€‚&lt;/p&gt;
&lt;p&gt;æ–œå †è¿™ä¸ªæ— éœ€éªŒè¯çš„æ€§è´¨ä½¿å¾—æ–œå †çš„èŠ‚ç‚¹æ— éœ€å‚¨å­˜ Npl å€¼ï¼Œä½¿å…¶å…·æœ‰è¾ƒé«˜çš„ç©ºé—´åˆ©ç”¨ç‡ï¼Œå¹¶ä¸”å‡å°‘äº†éªŒè¯è¿‡ç¨‹çš„æ—¶é—´æ¶ˆè€—ã€‚&lt;/p&gt;
&lt;p&gt;ç²¾ç¡®ç¡®å®šå·¦å¼å †å’Œæ–œå †çš„å³è·¯å¾„é•¿æ˜¯ä¸€ä¸ªæ‚¬è€Œæœªå†³çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-9&#34;&gt;äºŒé¡¹é˜Ÿåˆ—&lt;/h2&gt;
&lt;p&gt;äºŒé¡¹é˜Ÿåˆ—ä½¿ç”¨äº†ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„æ€ç»´ï¼Œå®ƒä½¿ç”¨äº†â€œæ£®æ—â€çš„æ•°æ®ç»“æ„ï¼Œåœ¨äºŒé¡¹é˜Ÿåˆ—ä¸­ï¼Œæœ‰è®¸å¤š &lt;strong&gt;å †åºæ ‘&lt;/strong&gt; ç»„æˆï¼Œè€Œè¿™äº›æ ‘çš„å…ƒç´ ä¸ªæ•°éƒ½æ˜¯ 2 çš„å€æ•°ï¼šé«˜åº¦ä¸º 0 çš„äºŒé¡¹æ ‘æ˜¯ä¸€æ£µå•èŠ‚ç‚¹æ ‘ï¼›é«˜åº¦ä¸º k çš„äºŒé¡¹æ ‘ B&lt;em&gt;k&lt;/em&gt; ç”±ä¸¤æ£µé«˜åº¦ä¸º B&lt;em&gt;k-1&lt;/em&gt; çš„äºŒé¡¹æ ‘ç»„æˆï¼Œç±»ä¼¼äºäºŒè¿›åˆ¶ä¸­çš„è¿›ä½æ¦‚å¿µï¼Œæœ€åç»„æˆçš„æ•°æ®ç»“æ„çš„å½¢çŠ¶å¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-24-Priority_Queue/binomial_queue.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ ·æ„é€ çš„æ£®æ—ç»“æ„å’Œå…ƒç´ æ•°é‡ä¸€ä¸€å¯¹åº”ï¼Œè­¬å¦‚æœ‰ 11 ä¸ªå…ƒç´ ï¼Œè½¬æ¢ä¸ºäºŒè¿›åˆ¶ä¸ºï¼š11=8+2+1=0b1011ã€‚åˆ™æ£®æ—çš„ç»“æ„ä¸º B0ï¼ŒB1ï¼ŒB3ã€‚æ²¡æœ‰ B2ï¼Œå¯¹åº”çš„äºŒè¿›åˆ¶ä½ä¹Ÿä¸º 0ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·æ„é€ çš„å †åºæ ‘æ£®æ—ï¼Œæˆ‘ä»¬è¦å¯»æ‰¾æœ€å°å…ƒç´ ï¼Œåªéœ€è¦åœ¨æ£®æ—å„ä¸ªæ ‘çš„æ ¹å¯»æ‰¾ï¼Œæ˜“å¾—ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ &lt;em&gt;O(logn)&lt;/em&gt;ã€‚åˆå¹¶æ“ä½œæ‹¥æœ‰ä¸äºŒè¿›åˆ¶ç›¸åŒçš„è¿›ä½æ–¹æ³•ã€‚åˆå¹¶ä¸¤ä¸ªç›¸åŒç»“æ„æ ‘åªéœ€è¦å°†å…¶ä¸­æ ¹èŠ‚ç‚¹å€¼è¾ƒå¤§çš„æ ‘é™„åŠ åœ¨æ ¹èŠ‚ç‚¹å€¼è¾ƒå°æ ‘çš„æ ¹ä¸Šå°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿éå†è¿™ä¸ªæ£®æ—ä¸­çš„æ ¹èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°†å…¶æ ¹èŠ‚ç‚¹æ”¾ç½®åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ã€‚è€Œç”±å›¾å¯è§ï¼Œæˆ‘ä»¬å‘ç°äºŒé¡¹é˜Ÿåˆ—ä¸­çš„æ ‘ä¸æ˜¯äºŒå‰æ ‘ï¼ŒèŠ‚ç‚¹çš„å­æ ‘æ•°é‡ä¸å®šï¼Œè¿™æ ·æ€ä¹ˆç”¨ç¨‹åºè¡¨ç¤ºå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„è½¬å˜å³å¯ï¼Œå°†æ¯ä¸€å±‚ä¸­çš„ç›¸é‚»èŠ‚ç‚¹ç”¨é“¾è¡¨ç©¿èµ·æ¥ï¼Œè¿™äº›åŒä¸€å±‚çš„èŠ‚ç‚¹å¯ä»¥è§†ä½œæ˜¯ â€œå…„å¼Ÿâ€ è€Œä¸æ˜¯çˆ¶å­å…³ç³»ï¼Œå› ä¸ºå…„å¼Ÿä¹‹é—´æ²¡æœ‰å¤§å°é¡ºåºï¼Œè€Œçˆ¶å­ä¹‹é—´å­˜åœ¨å¤§å°å…³ç³»ã€‚å›¾ä¸­çš„è™šçº¿å°±æ˜¯è¡¨ç¤ºè¿™ç§å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-24-Priority_Queue/binomial_queue_new.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªèŠ‚ç‚¹çš„æ•°æ®ç»“æ„ä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; BinNode{
	ElementType Element;
	Position Child;
	Position Sibling;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿›è¡Œåˆå¹¶çš„æ—¶å€™ï¼Œå¾ˆç®€å•çš„æ“ä½œï¼Œè­¬å¦‚ä¸¤ä¸ªäºŒé¡¹é˜Ÿåˆ— B1 å’Œ B2 åˆå¹¶ï¼ŒB1 æ ¹å…ƒç´ å°äº B2ã€‚æ•…ä¸º B1&amp;lt;-B2 åˆå¹¶ï¼Œæ ¹æ®äºŒé¡¹é˜Ÿåˆ—çš„ç»“æ„æˆ‘ä»¬å¯ä»¥çŸ¥é“åˆå¹¶çš„åŒæ–¹å…·æœ‰ç›¸åŒçš„å½¢çŠ¶ã€‚ä¾æ—§ä½¿ç”¨é€’å½’ï¼Œè¿™ä¸ªé€’å½’åœ¨æ ‘çš„åˆå¹¶ä¸­ä½¿ç”¨å¤ªå¹¿æ³›äº†ï¼Œä¸è®²è§£äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;BinTree &lt;span style=&#34;color:#a6e22e&#34;&gt;CombineTrees&lt;/span&gt;(BinTree T1, BinTree T2){
	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(T1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Element &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; T2&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Element)
		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; CombineTrees(T2, T1);
	T2&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Sibling&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;T1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Child;
	T1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;Child&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;T2;
	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; T1;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;heading-10&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;è¿™ä¸€ç« æˆ‘ä»¬ä»‹ç»äº†æ•°ç§å¸¸è§çš„ä¼˜å…ˆé˜Ÿåˆ—æ•°æ®ç»“æ„ï¼Œå®ƒä»¬å„æœ‰å„çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œå¯¹äºæœ€å¸¸ç”¨çš„äºŒå‰å †ï¼Œå®ƒçš„å®ç°æ˜¯ç®€å•å’Œå¿«é€Ÿçš„ï¼Œå› ä¸ºå®ƒå¹³å‡ä»…ä»…éœ€è¦å¸¸æ•°æ—¶é—´çš„æ’å…¥æ—¶é—´èŠ±è´¹ï¼ˆæœ€åæƒ…å†µä¸º &lt;em&gt;logN&lt;/em&gt;ï¼Œæ°”æ³¡æ³•ï¼Œä»åº•æµ®åˆ°æ ¹ï¼‰ï¼Œå’Œ &lt;em&gt;logN&lt;/em&gt; çš„åˆ é™¤æ—¶é—´èŠ±è´¹(æ°”æ³¡æ³•ï¼Œæ¯æ¬¡åˆ é™¤å‡ ä¹éƒ½æ˜¯ä»æ ¹åˆ°åº•æ²‰ä¸‹ï¼Œæ‰€ä»¥æœ€åä¹Ÿä¸º &lt;em&gt;O(logN)&lt;/em&gt;)ï¼Œä½†æ˜¯å®ƒå¯¹äºåˆå¹¶çš„æ”¯æŒè¾ƒå·®ï¼Œæ—¶é—´è¾¹ç•Œä¸º &lt;em&gt;O(N)&lt;/em&gt;ã€‚å·¦å¼å †å’Œæ–œå †å¯¹äºæ’å…¥ï¼Œåˆå¹¶ï¼Œå’Œåˆ é™¤çš„æ“ä½œï¼Œæ—¶é—´è¾¹ç•Œå‡ä¸º &lt;em&gt;O(logN)&lt;/em&gt;ã€‚äºŒé¡¹é˜Ÿåˆ—ä»¥ &lt;em&gt;O(logN)&lt;/em&gt; æ—¶é—´è¾¹ç•Œæ”¯æŒè¿™ä¸‰ç§æ“ä½œï¼Œå¹¶ä¸”å¯¹äºæ’å…¥æ“ä½œï¼Œå¹³å‡èŠ±è´¹å¸¸æ•°æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“ä½¿ç”¨å“ªä¸€ç§è¿˜æ˜¯è¦çœ‹å…·ä½“çš„æ•°æ®æ€§è´¨å’¯ã€‚Peace out~&lt;/p&gt;</description>
    </item>
    <item>
      <title>Linking (CSAPP Reading Notes)</title>
      <link>https://xiahualiu.github.io/posts/2018-07-13-csapp-link/</link>
      <pubDate>Fri, 13 Jul 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-07-13-csapp-link/</guid>
      <description>&lt;h2 id=&#34;heading&#34;&gt;é™æ€é“¾æ¥&lt;/h2&gt;
&lt;p&gt;åƒLinux LD ç¨‹åºè¿™æ ·çš„ &lt;strong&gt;é™æ€é“¾æ¥å™¨ï¼ˆstatic linkerï¼‰&lt;/strong&gt; ä»¥ä¸€ç»„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°ä½œä¸ºè¾“å…¥ï¼Œç¥æˆä¸€ä¸ªå®Œå…¨é“¾æ¥çš„ã€å¯ä»¥åŠ è½½å’Œè¿è¡Œçš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä½œä¸ºè¾“å‡ºã€‚è¾“å…¥çš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ç”±å„ç§ä¸åŒçš„ä»£ç å’Œ &lt;strong&gt;æ•°æ®èŠ‚&lt;/strong&gt; ç»„æˆï¼Œæ¯ä¸€èŠ‚éƒ½æ˜¯ä¸€ä¸ªè¿ç»­çš„å­—èŠ‚åºåˆ—ã€‚æŒ‡ä»¤åœ¨ä¸€èŠ‚ä¸­ï¼Œåˆå§‹åŒ–äº†çš„å…¨å±€å˜é‡åœ¨å¦ä¸€èŠ‚ä¸­ï¼Œè€Œæœªåˆå§‹åŒ–çš„å˜é‡åˆåœ¨å¦å¤–ä¸€èŠ‚ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶å‰ï¼Œé“¾æ¥å™¨å¿…é¡»å®Œæˆä»¥ä¸‹çš„ä¸¤ä¸ªä¸»è¦ä»»åŠ¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¬¦å·è§£æï¼ˆsymbol resolutionï¼‰&lt;/strong&gt;ã€‚ç›®æ ‡æ–‡ä»¶å®šä¹‰å’Œå¼•ç”¨ç¬¦å·ï¼Œæ¯ä¸ªç¬¦å·å¯¹åº”ä¸€ä¸ªå‡½æ•°ã€ä¸€ä¸ªå…¨å±€å˜é‡æˆ–ä¸€ä¸ªé™æ€å˜é‡ï¼ˆä¹Ÿå°±æ˜¯ C è¯­è¨€ä¸­ä»»ä½•ä»¥ static å±æ€§å£°æ˜çš„å˜é‡ï¼‰ã€‚ç¬¦å·è§£æçš„ç›®çš„æ˜¯å°†æ¯ä¸ªç¬¦å·å¼•ç”¨æ­£å¥½å’Œä¸€ä¸ªç¬¦å·å®šä¹‰å…³è”èµ·æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡å®šä½ï¼ˆreallocationï¼‰&lt;/strong&gt;ã€‚ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨ç”Ÿæˆæ­£å¥½ä»åœ°å€ 0 å¼€å§‹çš„ä»£ç å’Œæ•°æ®èŠ‚ã€‚é“¾æ¥å™¨é€šè¿‡æŠŠæ¯ä¸ªç¬¦å·å®šä¹‰ä¸ä¸€ä¸ªå†…å­˜ä½ç½®å…³è”èµ·æ¥ï¼Œä»è€Œ &lt;em&gt;é‡å®šä½&lt;/em&gt; è¿™äº›èŠ‚ï¼Œç„¶åä¿®æ”¹æ‰€æœ‰å¯¹äºè¿™äº›ç¬¦å·çš„å¼•ç”¨ï¼Œä½¿å¾—ä»–ä»¬æŒ‡å‘è¿™ä¸ªå†…å­˜ä½ç½®ã€‚é“¾æ¥å™¨ä½¿ç”¨æ±‡ç¼–å™¨äº§ç”Ÿçš„ &lt;em&gt;é‡å®šä½æ¡ç›®ï¼ˆrelocation entryï¼‰&lt;/em&gt; çš„è¯¦ç»†æŒ‡ä»¤ï¼Œä¸åŠ ç”„åˆ«åœ°æ‰§è¡Œè¿™æ ·çš„é‡å®šä½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é“¾æ¥å™¨çš„ç›®æ ‡æ–‡ä»¶ï¼š**ç›®æ ‡æ–‡ä»¶çº¯ç²¹æ˜¯å­—èŠ‚å—çš„é›†åˆã€‚**åœ¨è¿™äº›å—ä¸­ï¼Œæœ‰äº›åŒ…å«ç¨‹åºä»£ç ï¼Œæœ‰äº›åŒ…å«ç¨‹åºæ•°æ®ï¼Œè€Œå…¶ä»–çš„åˆ™åŒ…å«å¼•å¯¼é“¾æ¥å™¨å’ŒåŠ è½½å™¨çš„æ•°æ®ç»“æ„ã€‚é“¾æ¥å™¨å°†è¿™äº›å—è¿æ¥èµ·æ¥ï¼Œç¡®å®šè¢«è¿æ¥å—çš„è¿è¡Œæ—¶ä½ç½®ï¼Œå¹¶ä¸”ä¿®æ”¹ä»£ç å’Œæ•°æ®å—ä¸­çš„å„ç§ä½ç½®ã€‚é“¾æ¥å™¨å¯¹ç›®æ ‡æœºå™¨çš„è¿æ¥ç”šå°‘ã€‚äº§ç”Ÿç›®æ ‡æ–‡ä»¶çš„ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨å·²ç»å®Œæˆäº†å¤§éƒ¨åˆ†å·¥ä½œã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;ç›®æ ‡æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;ç›®æ ‡æ–‡ä»¶æœ‰ä¸‰ç§å½¢å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶&lt;/strong&gt;ã€‚åŒ…å«äºŒè¿›åˆ¶ä»£ç å’Œæ•°æ®ï¼Œå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™ä¸å…¶ä»–çš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶åˆå¹¶èµ·æ¥ï¼Œåˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶&lt;/strong&gt;ã€‚åŒ…å«äºŒè¿›åˆ¶ä»£ç å’Œæ•°æ®ï¼Œå…¶å½¢å¼å¯ä»¥è¢«ç›´æ¥å¤åˆ¶åˆ°å†…å­˜ä¸­æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…±äº«ç›®æ ‡æ–‡ä»¶&lt;/strong&gt;ã€‚ä¸€ç§ç‰¹æ®Šç±»å‹çš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼Œå¯ä»¥åœ¨åŠ è½½æˆ–è€…è¿è¡Œæ—¶è¢«åŠ¨æ€åœ°åŠ è½½åˆ°å†…å­˜å¹¶ä¸”é“¾æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;ä¸€ä¸ªå…¸å‹çš„ ELF å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶çš„æ ¼å¼ã€‚æˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥çš„å†…å®¹é‡Œé€æ¡åˆ†æå„ä¸ªèŠ‚çš„å†…å®¹å’Œä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-13-CSAPP-link/ELF_structure.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ELF å¤´ï¼ˆELF headerï¼‰ä»¥ä¸€ä¸ª 16 å­—èŠ‚çš„åºåˆ—å¼€å§‹ï¼Œè¿™ä¸ªåºåˆ—æè¿°äº†ç”Ÿæˆè¯¥æ–‡ä»¶çš„ç³»ç»Ÿçš„ &lt;strong&gt;å­—çš„å¤§å°&lt;/strong&gt; å’Œ &lt;strong&gt;å­—èŠ‚é¡ºåº&lt;/strong&gt;ã€‚ ELF å¤´å‰©ä¸‹çš„éƒ¨åˆ†åŒ…å«å¸®åŠ©é“¾æ¥å™¨è¯­æ³•åˆ†æå’Œè§£é‡Šç›®æ ‡æ–‡ä»¶çš„ä¿¡æ¯ã€‚å…¶ä¸­åŒ…æ‹¬ &lt;strong&gt;ELF å¤´çš„å¤§å°&lt;/strong&gt;ã€&lt;strong&gt;ç›®æ ‡æ–‡ä»¶çš„ç±»å‹ï¼ˆå¦‚å¯é‡å®šä½ã€å¯æ‰§è¡Œæˆ–å¯å…±äº«çš„ï¼‰&lt;/strong&gt;ã€&lt;strong&gt;æœºå™¨ç±»å‹ï¼ˆå¦‚ x86-64ï¼‰&lt;/strong&gt;ã€&lt;strong&gt;èŠ‚å¤´éƒ¨è¡¨ï¼ˆsection header tableï¼‰çš„æ–‡ä»¶åç§»&lt;/strong&gt;ï¼Œä»¥åŠèŠ‚å¤´éƒ¨è¡¨ä¸­æ¡ç›®çš„å¤§å°å’Œæ•°é‡ã€‚ä¸åŒèŠ‚çš„ä½ç½®å’Œå¤§å°éƒ½æ˜¯ç”±èŠ‚å¤´éƒ¨è¡¨æè¿°çš„ã€‚å…¶ä¸­ç›®æ ‡æ–‡ä»¶ä¸­çš„æ¯ä¸ªèŠ‚éƒ½æœ‰ä¸€ä¸ªå›ºå®šå¤§å°çš„æ¡ç›®ï¼ˆentryï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¤¹åœ¨ ELF å¤´å’ŒèŠ‚å¤´éƒ¨è¡¨ä¹‹é—´çš„éƒ½æ˜¯ &lt;strong&gt;èŠ‚ï¼ˆsectionï¼‰&lt;/strong&gt;ã€‚ä¸€ä¸ªå…¸å‹çš„ ELF å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶åŒ…å«ä¸‹é¢çš„å‡ ä¸ªèŠ‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;.text&lt;/code&gt;ï¼šå·²ç»ç¼–è¯‘çš„æœºå™¨ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.rodata&lt;/code&gt;ï¼šåªè¯»æ•°æ®ï¼Œæ¯”å¦‚ &lt;code&gt;printf&lt;/code&gt; è¯­å¥ä¸­çš„æ ¼å¼ä¸²å’Œ &lt;code&gt;switch case&lt;/code&gt; å¼€å…³è¯­å¥çš„è·³è½¬è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.data&lt;/code&gt;ï¼šå·²ç»åˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€ C å˜é‡ã€‚å±€éƒ¨ C å˜é‡åœ¨è¿è¡Œçš„æ—¶å€™è¢«ä¿å­˜åœ¨æ ˆä¸­ï¼Œæ—¢ä¸ä¼šå‡ºç°åœ¨ .data ä¸­ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨ .bss èŠ‚ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.bss&lt;/code&gt;ï¼šæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€ C å˜é‡ï¼Œä»¥åŠæ‰€æœ‰è¢«åˆå§‹åŒ–ä¸º 0 çš„å…¨å±€æˆ–é™æ€å˜é‡ã€‚åœ¨ç›®æ ‡æ–‡ä»¶ä¸­è¿™ä¸ªèŠ‚ä¸å æ®å®é™…çš„ç©ºé—´ï¼Œå®ƒä»…ä»…æ˜¯ä¸€ä¸ªå ä½ç¬¦ã€‚ç›®æ ‡æ–‡ä»¶æ ¼å¼åŒºåˆ†å·²åˆå§‹åŒ–å’Œæœªåˆå§‹åŒ–å˜é‡æ˜¯ä¸ºäº†ç©ºé—´æ•ˆç‡ï¼šåœ¨ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œæœªåˆå§‹åŒ–çš„å˜é‡ä¸éœ€è¦å æ®ä»»ä½•å®é™…çš„ç£ç›˜ç©ºé—´ã€‚è¿è¡Œæ—¶ï¼Œåœ¨å†…å­˜ä¸­åˆ†é…è¿™äº›å˜é‡ï¼Œåˆå§‹å€¼ä¸º 0ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;symtab&lt;/code&gt;ï¼šä¸€ä¸ªç¬¦å·è¡¨ï¼Œå®ƒå­˜æ”¾åœ¨ç¨‹åºä¸­å®šä¹‰å’Œå¼•ç”¨çš„å‡½æ•°å’Œå…¨å±€å˜é‡çš„ä¿¡æ¯ã€‚ä¸€äº›ç¨‹åºå‘˜é”™è¯¯çš„è®¤ä¸ºå¿…é¡»é€šè¿‡ &lt;code&gt;-g&lt;/code&gt; é€‰é¡¹æ¥ç¼–è¯‘ä¸€ä¸ªç¨‹åºï¼Œæ‰èƒ½å¾—åˆ°ç¬¦å·è¡¨ä¿¡æ¯ã€‚å®é™…ä¸Šï¼Œæ¯ä¸ªé‡å®šä½ç›®æ ‡æ–‡ä»¶åœ¨ .symtab ä¸­éƒ½æœ‰ä¸€å¼ ç¬¦å·è¡¨ï¼ˆé™¤éç¨‹åºå‘˜ç‰¹æ„ç”¨ STRIP æ˜æœ—å»æ‰å®ƒï¼‰ã€‚ç„¶è€Œï¼Œå’Œç¼–è¯‘å™¨ä¸­çš„ç¬¦å·è¡¨ä¸åŒï¼Œ.symtab ç¬¦å·è¡¨ä¸åŒ…å«å±€éƒ¨å˜é‡çš„æ¡ç›®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.rel.text&lt;/code&gt;ï¼šä¸€ä¸ª .text èŠ‚ä¸­ä½ç½®çš„åˆ—è¡¨ï¼Œå½“é“¾æ¥å™¨æŠŠè¿™ä¸ªç›®æ ‡æ–‡ä»¶å’Œå…¶ä»–æ–‡ä»¶ç»„åˆæ—¶ï¼Œéœ€è¦ä¿®æ”¹è¿™äº›ä½ç½®ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä»»ä½• &lt;strong&gt;è°ƒç”¨å¤–éƒ¨å‡½æ•°æˆ–è€…å¼•ç”¨å…¨å±€å˜é‡&lt;/strong&gt; çš„æŒ‡ä»¤éƒ½éœ€è¦ä¿®æ”¹ã€‚è€Œè°ƒç”¨æœ¬åœ°å‡½æ•°çš„æŒ‡ä»¤åˆ™ä¸éœ€è¦ä¿®æ”¹ã€‚æ³¨æ„ï¼Œå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä¸­å¹¶ä¸éœ€è¦é‡å®šä½ä¿¡æ¯ï¼Œå› æ­¤é€šå¸¸è¢«çœç•¥ï¼Œé™¤éç”¨æˆ·æ˜¾å¼åœ°æŒ‡ç¤ºé“¾æ¥å™¨åŒ…å«è¿™äº›ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;rel.data&lt;/code&gt;ï¼šè¢«æ¨¡å—å¼•ç”¨æˆ–å®šä¹‰çš„æ‰€æœ‰å…¨å±€å˜é‡çš„é‡å®šä½ä¿¡æ¯ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä»»ä½•å·²åˆå§‹åŒ–çš„å˜é‡ï¼Œå¦‚æœå®ƒçš„åˆå§‹å€¼æ˜¯ä¸€ä¸ª &lt;strong&gt;å…¨å±€å˜é‡åœ°å€&lt;/strong&gt; æˆ–è€… &lt;strong&gt;å¤–éƒ¨å®šä¹‰å‡½æ•°çš„åœ°å€&lt;/strong&gt;ï¼Œéƒ½éœ€è¦è¢«ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.debug&lt;/code&gt;ï¼šä¸€ä¸ªè°ƒè¯•ç¬¦å·è¡¨ï¼Œå…¶æ¡ç›®æ˜¯ç¨‹åºä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡å’Œç±»å‹å®šä¹‰ï¼Œç¨‹åºä¸­å®šä¹‰å’Œå¼•ç”¨çš„å…¨å±€å˜é‡ï¼Œä»¥åŠåŸå§‹çš„ C æºæ–‡ä»¶ã€‚åªæœ‰ &lt;code&gt;-g&lt;/code&gt; é€‰é¡¹ç¼–è¯‘æ—¶ï¼Œæ‰ä¼šå¾—åˆ°è¿™å¼ è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.line&lt;/code&gt;ï¼šåŸå§‹ C æºæ–‡ä»¶ä¸­çš„è¡Œå·å’Œ &lt;code&gt;.text&lt;/code&gt; èŠ‚ä¸­çš„æœºå™¨æŒ‡ä»¤ä¹‹é—´çš„æ˜ å°„ã€‚åªæœ‰ &lt;code&gt;-g&lt;/code&gt; é€‰é¡¹è°ƒç”¨ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åºæ—¶ï¼Œæ‰ä¼šå¾—åˆ°è¿™å¼ è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.strtab&lt;/code&gt;ï¼šä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ï¼Œå…¶å†…å®¹åŒ…æ‹¬ .symtab å’Œ .debug èŠ‚ä¸­çš„ç¬¦å·è¡¨ï¼Œä»¥åŠèŠ‚å¤´éƒ¨è¡¨ä¸­çš„èŠ‚åå­—ã€‚å­—ç¬¦ä¸²è¡¨å°±æ˜¯ä»¥ null ç»“å°¾çš„å­—ç¬¦ä¸²çš„åºåˆ—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;heading-3&#34;&gt;ä½ç½®æ— å…³çš„ä»£ç &lt;/h2&gt;
&lt;p&gt;å…±äº«åº“çš„ä¸€ä¸ªä¸»è¦ç›®çš„å°±æ˜¯å…è®¸å¤šä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹å…±äº«å†…å­˜ä¸­ç›¸åŒçš„åº“ä»£ç ï¼Œå› è€ŒèŠ‚çº¦å®è´µçš„å†…å­˜èµ„æºã€‚é‚£ä¹ˆï¼Œå¤šä¸ªè¿›ç¨‹æ˜¯å¦‚ä½•å…±äº«ç¨‹åºä¸­çš„ä¸€ä¸ªå‰¯æœ¬çš„å‘¢ï¼Ÿä¸€ç§æ–¹æ³•æ˜¯ç»™æ¯ä¸ªåº“åˆ†é…ä¸€ä¸ªäº‹å…ˆé¢„å¤‡å¥½çš„ä¸“ç”¨çš„åœ°å€ç©ºé—´ç‰‡ï¼Œç„¶åè¦æ±‚åŠ è½½å™¨æ€»æ˜¯åœ¨è¿™ä¸ªåœ°å€åŠ è½½å…±äº«åº“ã€‚è™½ç„¶è¿™ç§æ–¹æ³•å¾ˆç®€å•ï¼Œä½†æ˜¯å®ƒåŒæ—¶é€ æˆäº†ä¸€äº›ä¸¥é‡çš„é—®é¢˜ï¼Œå®ƒå¯¹äºåœ°å€ç©ºé—´çš„ä½¿ç”¨æ•ˆç‡ä¸é«˜ï¼Œå› ä¸ºå³ä½¿ä¸€ä¸ªè¿›ç¨‹ä¸ä½¿ç”¨è¿™ä¸ªåº“ï¼Œé‚£éƒ¨åˆ†ç©ºé—´è¿˜æ˜¯ä¼šè¢«åˆ†é…å‡ºæ¥ã€‚å®ƒä¹Ÿéš¾ä»¥ç®¡ç†ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯æ²¡æœ‰ç‰‡é‡å ã€‚æ¯å½“ä¸€ä¸ªåº“ä¿®æ”¹äº†ä»¥åï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯åˆ†é…çš„ç©ºé—´è¿˜ä¾æ—§åˆé€‚ã€‚æ›´ç³Ÿçš„æ˜¯ï¼Œå¯¹æ¯ä¸ªç³»ç»Ÿè€Œè¨€ï¼Œåº“åœ¨å†…å­˜ä¸­çš„åˆ†é…æ–¹å¼éƒ½æ˜¯ä¸åŒçš„ï¼Œè¿™å°±å¼•èµ·äº†æ›´å¤šä»¤äººå¤´ç—›çš„ç®¡ç†é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;è¦é¿å…è¿™äº›é—®é¢˜ï¼Œç°åœ¨ç³»ç»Ÿä»¥è¿™æ ·ä¸€ç§æ–¹å¼ç¼–è¯‘å…±äº«æ¨¡å—çš„å—²ç æ®µï¼Œæ˜¯çš„å¯ä»¥æŠŠå®ƒä»¬åŠ è½½åˆ°å†…å­˜çš„ä»»ä½•ä½ç½®è€Œæ— éœ€é“¾æ¥å™¨ä¿®æ”¹ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæ— é™å¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«ä¸€ä¸ªå…±äº«æ¨¡å—çš„ä»£ç æ®µçš„å•ä¸€å‰¯æœ¬ã€‚ï¼ˆæ¯ä¸ªè¿›ç¨‹ä»ç„¶æœ‰è‡ªå·±çš„è¯»/å†™æ•°æ®å—ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;å¯åŠ è½½è€Œæ— éœ€é‡å®šä½çš„ä»£ç è¢«ç§°ä½œ &lt;strong&gt;ä½ç½®æ— å…³ä»£ç ï¼ˆPosition-Independent Codeï¼ŒPICï¼‰&lt;/strong&gt;ã€‚ç”¨æˆ·å¯ä»¥å¯¹ GCC ä½¿ç”¨ -fpic é€‰é¡¹æŒ‡ç¤º GNU ç¼–è¯‘ç³»ç»Ÿç”Ÿæˆ PIC ä»£ç ã€‚å…±äº«åº“çš„ç¼–è¯‘å¿…é¡»ä½¿ç”¨è¯¥é€‰é¡¹ã€‚&lt;/p&gt;
&lt;h4 id=&#34;pic-&#34;&gt;PIC æ•°æ®å¼•ç”¨&lt;/h4&gt;
&lt;p&gt;ç¼–è¯‘å™¨é€šè¿‡å·²çŸ¥å¾—çš„ä¿¡æ¯ç¡®å®šå…¨å±€å˜é‡çš„ PIC å¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯æ— è®ºåœ¨å†…å­˜ä¸­çš„ä½•å¤„åŠ è½½ä¸€ä¸ªç›®æ ‡æ¨¡å—ï¼ˆåŒ…æ‹¬å…±äº«çš„ç›®æ ‡æ¨¡å—ï¼‰ï¼Œæ•°æ®æ®µä¸ä»£ç æ®µçš„è·ç¦»æ€»æ˜¯ä¿æŒä¸å˜ï¼ˆåœ¨ç¼–è¯‘çš„æ—¶å€™ç”±åº“ä¸­å¤´éƒ¨è¡¨é¦–å…ˆåˆ’åˆ†ä¸¤ä¸ªæ®µçš„å¤§å°å’Œä½ç½®ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;PIC å¼•ç”¨çš„ç¼–è¯‘å™¨ä½¿ç”¨äº†è¿™ä¸€äº‹å®ï¼Œå®ƒåœ¨æ•°æ®æ®µå¼€å§‹çš„åœ°æ–¹åˆ›å»ºäº†ä¸€ä¸ªè¡¨ï¼Œå«åš &lt;strong&gt;å…¨å±€åç§»é‡è¡¨ï¼ˆGlobal Offset Table, GOTï¼‰&lt;/strong&gt;ã€‚åœ¨ GOT ä¸­æ‰€æœ‰è¢«è¿™ä¸ªåº“å¼•ç”¨çš„å…¨å±€å˜é‡éƒ½ä¼šæœ‰ä¸€ä¸ª 8 å­—èŠ‚æ¡ç›®ã€‚è€Œåœ¨ä»£ç ä¸­ï¼Œç¼–è¯‘å™¨ä¸ºæ¯ä¸€ä¸ªåœ¨ GOT æ¡ç›®ä¸­çš„å˜é‡è®¾ç½®äº†é‡å®šä½ä¿¡æ¯ï¼Œå°†å…¶é‡å®šä½ä¸º GOT å¯¹åº”çš„æ¡ç›®ï¼Œæ¯ä¸ªå¼•ç”¨å…¨å±€å˜é‡çš„åº“éƒ½æœ‰è‡ªå·±å•ç‹¬çš„ GOTã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œç¼–è¯‘å™¨åœ¨å…±äº«åº“ä¸­çš„æ•°æ®æ®µå¼€å§‹çš„åœ°æ–¹è®¾ç½®äº† GOT è¡¨ï¼Œè¡¨å†…å®¹æ˜¯æ¯ä¸€æ¡å˜é‡çš„é‡å®šä½ä¿¡æ¯ï¼Œä½†æ˜¯åœ¨åº“å¹¶æœªåŠ è½½çš„æ—¶å€™ï¼Œè¿™äº›ä¿¡æ¯éƒ½æ˜¯æ— æ•ˆçš„ï¼ŒåŠ è½½å™¨ä¼šåœ¨åŠ è½½åº“çš„æ—¶å€™ï¼Œæ ¹æ®ç³»ç»Ÿçš„ç¯å¢ƒä¿¡æ¯å¯¹åº“ä¸­çš„æ¯ä¸€æ¡ GOT æ¡ç›®åˆ†åˆ«è®¾ç½®å¯¹åº”çš„é‡å®šä½æ¡ç›®ï¼Œè§£æå¯¹åº”å˜é‡çœŸå®çš„ç»å¯¹åœ°å€ã€‚å¦‚æœè¿™ä¸ªåº“æƒ³è¦ä½¿ç”¨è¿™ä¸ªå˜é‡çš„æ—¶å€™ï¼Œå®ƒå¹¶ä¸çŸ¥é“å˜é‡çš„å†…å­˜åœ°å€ï¼Œä½†æ˜¯å®ƒå¯ä»¥æ ¹æ®è‡ªå·±æºå¸¦çš„ GOT è¡¨å»é‡å®šä½è¯¥å˜é‡ï¼ˆå› ä¸º GOT è¡¨çš„ä½ç½®æ˜¯ç›¸å¯¹åº“æœ¬èº«é™æ­¢çš„ï¼Œè·ç¦»ä¿æŒä¸å˜ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ç®€å•çš„åç§»é‡è®¿é—® GOT è¡¨å„ä¸ªæ¡ç›®ï¼‰ã€‚&lt;/p&gt;
&lt;h4 id=&#34;pic--1&#34;&gt;PIC å‡½æ•°è°ƒç”¨&lt;/h4&gt;
&lt;p&gt;å¦‚æœç¨‹åºè°ƒç”¨äº†ä¸€ä¸ªç”±å…±äº«åº“å®šä¹‰çš„å‡½æ•°ã€‚ç¼–è¯‘å™¨æ²¡æœ‰åŠæ³•é¢„æµ‹è¿™ä¸ªå‡½æ•°çš„è¿è¡Œæ—¶åœ°å€ï¼Œå› ä¸ºå®šä¹‰å®ƒçš„å…±äº«æ¨¡å—åœ¨è¿è¡Œçš„æ—¶å€™å¯ä»¥åŠ è½½çš„ä»»ä½•ä½ç½®ã€‚åœ¨è¿™é‡Œï¼Œç¼–è¯‘å™¨ä½¿ç”¨äº†ä¸€ä¸ªç§°ä¸º &lt;em&gt;å»¶è¿Ÿç»‘å®š&lt;/em&gt; çš„æŠ€æœ¯ï¼Œè¯¥æŠ€æœ¯ä½¿å¾— PIC çš„å‡½æ•°è°ƒç”¨å¯ä»¥åœ¨è¿è¡Œçš„æ—¶å€™å†è¿›è¡Œè§£æï¼Œè¿™ç§æ–¹æ³•å¹¶ä¸æ˜¯ GOT å› ä¸ºå®ƒä¿®æ”¹äº†è°ƒç”¨è€…çš„ä»£ç æ®µã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆä½¿ç”¨å»¶è¿Ÿç»‘å®šæŠ€æœ¯æ˜¯å› ä¸ºåœ¨ä¸€ä¸ªåº“ä¸­ï¼Œé€šå¸¸ä¼šå…·æœ‰æˆåƒä¸Šç™¾ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªå…¸å‹çš„åº”ç”¨ç¨‹åºåªä¼šç”¨åˆ°å…¶ä¸­çš„ä¸€å°éƒ¨åˆ†ã€‚æŠŠå‡½æ•°åœ°å€è§£ææ”¾åœ¨å®é™…è¢«è°ƒç”¨çš„åœ°æ–¹ï¼Œå¯ä»¥é¿å…åŠ¨æ€é“¾æ¥å™¨åœ¨åŠ è½½æ—¶è¿›è¡Œæˆåƒä¸Šç™¾ä¸ªå…¶å®å¹¶ä¸éœ€è¦çš„é‡å®šä½ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨çš„å¼€é”€å¾ˆå¤§ï¼Œä½†æ˜¯å…¶åçš„æ¯æ¬¡è°ƒç”¨éƒ½åªä¼šèŠ±è´¹ä¸€æ¡æŒ‡ä»¤å’Œä¸€ä¸ªé—´æ¥çš„å†…å­˜å¼•ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å»¶è¿Ÿç»‘å®šæ˜¯é€šè¿‡ä¸¤ä¸ªè¡¨å®ç°çš„ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ &lt;strong&gt;GOT å…¨å±€åç§»é‡è¡¨&lt;/strong&gt;ï¼Œç¬¬äºŒä¸ªå°±æ˜¯ &lt;strong&gt;è¿‡ç¨‹é“¾æ¥è¡¨ï¼ˆprocedure linkage table,PLTï¼‰&lt;/strong&gt;ã€‚GOT æ˜¯æ•°æ®æ®µçš„ä¸€éƒ¨åˆ†ï¼ŒPLT æ˜¯ä»£ç æ®µçš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¿‡ç¨‹é“¾æ¥è¡¨ï¼ˆPLTï¼‰&lt;/strong&gt;ã€‚PLT æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­çš„æ¯ä¸ªæ¡ç›®æ˜¯ 16 å­—èŠ‚ä»£ç ã€‚PLT[0] æ˜¯ä¸€ä¸ªç‰¹æ®Šæ¡ç›®ï¼Œå®ƒè·³è½¬åˆ°åŠ¨æ€é“¾æ¥å™¨ä¸­ã€‚æ¯ä¸ªå¯æ‰§è¡Œç¨‹åºè°ƒç”¨çš„åº“å‡½æ•°éƒ½æœ‰å®ƒè‡ªå·±çš„ç³»ç»Ÿå¯åŠ¨å‡½æ•°ï¼ˆ&lt;code&gt;__libc_start_main&lt;/code&gt;ï¼‰ï¼Œå®ƒåˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒï¼Œè°ƒç”¨ &lt;code&gt;main&lt;/code&gt; å‡½æ•°å¹¶ä¸”å¤„ç†å…¶è¿”å›å€¼ã€‚ä» PLT[2] å¼€å§‹çš„æ¡ç›®è°ƒç”¨ç”¨æˆ·ä»£ç è°ƒç”¨çš„å‡½æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€åç§»é‡è¡¨ï¼ˆGOTï¼‰&lt;/strong&gt;ã€‚GOT æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªæ¡ç›®æ˜¯ 8 å­—èŠ‚çš„åœ°å€ã€‚å’Œ PLT è”åˆä½¿ç”¨çš„æ—¶å€™ï¼ŒGOT[0] å’Œ GOT&lt;a href=&#34;https://xiahualiu.github.io/img/2018-7-13-CSAPP-link/ELF_structure.png&#34;&gt;1&lt;/a&gt; åŒ…å«åŠ¨æ€é“¾æ¥å™¨åœ¨è§£æå‡½æ•°åœ°å€æ—¶ä¼šç”¨åˆ°ä¿¡æ¯ã€‚å…¶ä½™æ¯ä¸€ä¸ªæ¡ç›®å¯¹åº”ä¸€ä¸ªè¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå…¶åœ°å€éœ€è¦åœ¨è¿è¡Œæ—¶è¢«è§£æã€‚æ¯ä¸ªæ¡ç›®éƒ½å¯¹åº”ä¸€ä¸ªç›¸åŒ¹é…çš„ PLT æ¡ç›®ã€‚&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    <item>
      <title>Program Low Level Optimization (CSAPP Reading Notes)</title>
      <link>https://xiahualiu.github.io/posts/2018-07-05-optimize-your-c-code/</link>
      <pubDate>Thu, 05 Jul 2018 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2018-07-05-optimize-your-c-code/</guid>
      <description>&lt;p&gt;å†™å‡ºä¸€ä¸ªä¸ç®¡åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½å¤Ÿæ­£ç¡®è¿è¡Œçš„ç¨‹åºæ˜¯ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜çš„åŸºæœ¬æŠ€èƒ½ï¼Œåœ¨æ­¤ä¹‹ä¸Šï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œä¹Ÿåº”è¯¥å†™å‡ºä¸€ä¸ªæ¸…æ™°è€Œç®€æ´çš„ä»£ç ï¼Œè¿™æ ·åšä¸ä»…ä»…æ˜¯ä¸ºäº†è‡ªå·±èƒ½å¤Ÿåœ¨è°ƒè¯•çš„æ—¶å€™çœ‹æ‡‚ä»£ç ï¼Œä¹Ÿæ˜¯ä¸ºäº†åœ¨æœªæ¥æ£€æŸ¥ä»£ç å’Œä»Šåéœ€è¦ä¿®æ”¹ä»£ç çš„æ—¶å€™ï¼Œå…¶ä»–äººèƒ½å“¦è¿‡è¯»æ‡‚å’Œç†è§£è‡ªå·±çš„ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯åœ¨æ•°æ®é‡æ—¥ç›Šå¢å¤§ä»Šå¤©ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œç¨‹åºè¿è¡Œçš„é€Ÿåº¦ä¹Ÿæˆä¸ºäº†ä¸€ä¸ªé‡è¦çš„è€ƒè™‘å› ç´ ã€‚å¦‚æœä¸€ä¸ªç¨‹åºè¦å®æ—¶çš„å¤„ç†è§†é¢‘å’Œç½‘ç»œåŒ…ï¼Œä¸€ä¸ªè¿è¡Œå¾ˆæ…¢çš„ç¨‹åºå°±ä¸èƒ½å¤Ÿæ»¡è¶³ä½¿ç”¨çš„è¦æ±‚ã€‚è€Œå¯¹äºä¸€ä¸ªè®¡ç®—ä»»åŠ¡éå¸¸å¤§çš„ç¨‹åºï¼Œä¾‹å¦‚éœ€è¦æ‰§è¡Œæ•°æ—¥æˆ–æ•°å‘¨çš„ç¨‹åºï¼Œå…¶é€Ÿåº¦æå‡ 20% ä¹Ÿèƒ½å¤Ÿé€ æˆå·¨å¤§çš„å½±å“ï¼Œæœ¬æ–‡çš„ç›®çš„åœ¨äºæ¢è®¨ä½¿ç”¨ä¸åŒçš„ç±»å‹çš„ç¨‹åºä¼˜åŒ–æŠ€æœ¯ï¼Œä½¿å¾—ç¨‹åºä¼˜åŒ–çš„æ›´å¿«ã€‚&lt;/p&gt;
&lt;p&gt;ç¼–å†™é«˜æ•ˆçš„ç¨‹åºéœ€è¦åšåˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¿…é¡»é€‰æ‹©åˆé€‚çš„ç®—æ³•å’Œæ•°æ®ç»“æ„&lt;/li&gt;
&lt;li&gt;å¿…é¡»ç¼–å†™å‡ºç¼–è¯‘å™¨èƒ½å¤Ÿæœ‰æ•ˆä¼˜åŒ–ï¼Œè½¬æ¢æˆé«˜æ•ˆå¯æ‰§è¡Œä»£ç çš„æºä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;å°†å¤§ä»»åŠ¡åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œå¹¶è¡Œè®¡ç®—ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯¹äºç¬¬äºŒä¸ªæ–¹é¢ï¼Œæˆ‘ä»¬åº”è¯¥ç†è§£ç¼–è¯‘å™¨ä¼˜åŒ–æ–¹æ³•çš„å±€é™æ€§ã€‚å¯¹äº C è¯­è¨€æ¥è¯´ï¼Œç”±äºå­˜åœ¨æŒ‡é’ˆè¿ç®—å’Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä½¿å¾—ç¼–è¯‘å™¨å¾ˆéš¾å¯¹äºä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œåœ¨ç›®å‰ï¼Œæœ€å¥½çš„ç¼–è¯‘å™¨ä¹Ÿå—åˆ° &lt;em&gt;å¦¨ç¢ä¼˜åŒ–çš„å› ç´ &lt;/em&gt; çš„é˜»ç¢ï¼Œå¦¨ç¢ä¼˜åŒ–çš„å› ç´ å°±æ˜¯ç¨‹åºè¡Œä¸ºä¸­é‚£äº› &lt;strong&gt;ä¸¥é‡ä¾èµ–äºæ‰§è¡Œç¯å¢ƒ&lt;/strong&gt; çš„æ–¹é¢ã€‚ç¨‹åºå‘˜å¿…é¡»ç¼–å†™å®¹æ˜“ä¼˜åŒ–çš„ä»£ç ï¼Œä»¥å¸®åŠ©ç¼–è¯‘å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;ä¼˜åŒ–çš„ç¬¬ä¸€æ­¥&lt;/h2&gt;
&lt;p&gt;ç¨‹åºä¼˜åŒ–çš„ç¬¬ä¸€æ­¥æ˜¯æ¶ˆé™¤ä¸å¿…è¦çš„å·¥ä½œï¼Œè®©ä»£ç å°½å¯èƒ½æœ‰æ•ˆçš„æ‰§è¡Œæ‰€æœŸæœ›çš„ä»»åŠ¡ã€‚è¿™åŒ…æ‹¬æ¶ˆé™¤ä¸å¿…è¦çš„ &lt;strong&gt;è¿‡ç¨‹è°ƒç”¨ã€æ¡ä»¶æµ‹è¯•&lt;/strong&gt; å’Œ &lt;strong&gt;å†…å­˜å¼•ç”¨&lt;/strong&gt; ã€‚è¿™äº›ä¼˜åŒ–ä¸ä¾èµ–äºç›®æ ‡æœºå™¨çš„ä»»ä½•å…·ä½“å±æ€§ã€‚ä¸ºäº†ä½¿ä»£ç çš„æ‰§è¡Œæ•ˆç‡æœ€é«˜ï¼Œåœ¨ç¨‹åºå‘˜å’Œç¼–è¯‘å™¨é¢å‰éƒ½æœ‰ä¸€ä¸ªç›®æ ‡æœºå™¨çš„æ¨¡å‹ï¼ŒæŒ‡æ˜å¦‚ä½•æ‰§è¡Œå„æ¡ä»£ç ï¼Œä»¥åŠå„ä¸ªæ“ä½œçš„æ—¶åºç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œç¼–è¯‘å™¨å¿…é¡»çŸ¥é“å¤„ç†å™¨çš„æ—¶åºä¿¡æ¯ï¼Œè¿™æ ·æ‰èƒ½ç¡®å®šå¦‚ä½•ç¼–è¯‘ä¹˜æ³•ï¼Œæ˜¯ä½¿ç”¨ç§»ä½å’ŒåŠ æ³•çš„æŸç§ç»„åˆè¿˜æ˜¯ç›´æ¥ä½¿ç”¨ä¹˜æ³•æŒ‡ä»¤ã€‚ç°ä»£è®¡ç®—æœºä½¿ç”¨äº†å¤æ‚çš„æŠ€æœ¯æ¥å¤„ç†æœºå™¨çº§ç¨‹åºï¼Œå¹¶è¡Œæ‰§è¡Œè®¸å¤šæ¡æŒ‡ä»¤ï¼Œæ‰§è¡Œçš„é¡ºåºè¿˜å¯èƒ½ä¸åŒäºå…¶åœ¨ç¨‹åºä¸­å‡ºç°çš„é¡ºåºã€‚&lt;/p&gt;
&lt;p&gt;äº†è§£å¤„ç†å™¨çš„è¿ä½œè§„å¾‹ï¼Œå°±å¯ä»¥è¿›è¡Œä¼˜åŒ–ç¨‹åºçš„ç¬¬äºŒå¸ƒï¼Œåˆ©ç”¨å¤„ç†å™¨æä¾›çš„æŒ‡ä»¤çº§å¹¶è¡Œèƒ½åŠ› (instruction-level parallelism) èƒ½åŠ›ï¼ŒåŒæ—¶æ‰§è¡Œå¤šæ¡æŒ‡ä»¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;ç¼–è¯‘å™¨çš„å±€é™æ€§&lt;/h2&gt;
&lt;p&gt;ç¼–è¯‘å™¨åœ¨ä¼˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œåªå¯¹äºç¨‹åºè¿›è¡Œå®‰å…¨çš„ä¼˜åŒ–ã€‚ä¹Ÿå°±æ˜¯å¯¹äºç¨‹åºå¯èƒ½é‡åˆ°çš„æ‰€æœ‰æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨éƒ½ä¿è¯ä¼˜åŒ–åçš„ç¨‹åºå’Œä¼˜åŒ–å‰çš„ç¨‹åºæœ‰ä¸€æ ·çš„è¡Œä¸ºï¼Œè¿™æ ·å°±é™åˆ¶äº†ç¼–è¯‘å™¨åªè¿›è¡Œå®‰å…¨çš„ä¼˜åŒ–ã€‚ä¸ºäº†ç†è§£è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ¥çœ‹ä»¥ä¸‹ä¸¤ä¸ªè¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;twiddle1&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp, &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp)
{
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp;
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;twiddle2&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp, &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp)
{
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸¤ä¸ªè¿‡ç¨‹çš„ç»“æœçœ‹ä¼¼æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œä½†æ˜¯æ‰§è¡Œçš„æ•ˆç‡ä¸åŒã€‚å¯¹äº &lt;code&gt;twiddle1()&lt;/code&gt; è¿‡ç¨‹ï¼Œè¿›è¡Œäº†å…­æ¬¡å†…å­˜å¼•ç”¨ï¼ˆè¯» ypï¼Œè¯» xpï¼Œå†™ xpï¼Œè¯» ypï¼Œè¯» xpï¼Œå†™ xpï¼‰ï¼Œè€Œå¯¹äº &lt;code&gt;twiddle2()&lt;/code&gt; è¿‡ç¨‹ï¼Œåªè¿›è¡Œäº† 3 æ¬¡å†…å­˜å¼•ç”¨ï¼ˆè¯» ypï¼Œè¯» xpï¼Œå†™ xpï¼‰ã€‚å› æ­¤ï¼ŒåŸºäºç¼–è¯‘å™¨ç¼–è¯‘è¿‡ç¨‹  &lt;code&gt;twiddle1()&lt;/code&gt;ï¼Œæˆ‘ä»¬è®¤ä¸ºåŸºäº &lt;code&gt;twiddle2()&lt;/code&gt; è¿‡ç¨‹ä¼šäº§ç”Ÿæ›´åŠ æœ‰æ•ˆçš„ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘åˆ°å½“ &lt;code&gt;xp&lt;/code&gt; å’Œ &lt;code&gt;yp&lt;/code&gt; ç›¸ç­‰çš„æƒ…å†µä¸‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªè¿‡ç¨‹çš„æ‰§è¡Œç»“æœå®Œå…¨ä¸åŒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;twiddle1&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp, &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp)
{
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp; &lt;span style=&#34;color:#75715e&#34;&gt;/* *xp=2* *xp */&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp; &lt;span style=&#34;color:#75715e&#34;&gt;/* *xp=2* 2* *xp=4* *xp */&lt;/span&gt;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;twiddle2&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp, &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp)
{
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;xp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;yp; &lt;span style=&#34;color:#75715e&#34;&gt;/* *xp=3* *xp */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœæ˜¯å‰è€… &lt;code&gt;*xp&lt;/code&gt; çš„å€¼å¢å¤§ä¸ºåŸæ¥çš„ 4 å€ï¼Œåè€…ä¸ºå¢å¤§ 3 å€ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§ä¸¤ä¸ªæŒ‡é’ˆå¯èƒ½æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€çš„æƒ…å†µè¢«ç§°ä¸º &lt;strong&gt;å†…å­˜åˆ«åå¼•ç”¨ï¼ˆmemory aliasingï¼‰&lt;/strong&gt;ã€‚å¯¹äºä¸åŒçš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å¿…é¡»ä¿è¯è¿™ç§æƒ…å†µå­˜åœ¨ï¼Œè€Œä¸å¯¹äºè¯¥ç¨‹åºè¿›è¡Œè¿‡ç¨‹çš„ä¼˜åŒ–ã€‚è¿™é€ æˆäº†ä¸€ä¸ªä¸»è¦çš„å¦¨ç¢ä¼˜åŒ–çš„å› ç´ ï¼Œä¹Ÿæ˜¯å¯èƒ½ä¸¥é‡é™åˆ¶ç¼–è¯‘å™¨äº§ç”Ÿä¼˜åŒ–ä»£ç ç¨‹åºçš„ä¸€ä¸ªæ–¹é¢ã€‚å¦‚æœç¼–è¯‘å™¨ä¸èƒ½ç¡®å®šä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªä½ç½®ï¼Œå°±å¿…é¡»å‡è®¾ä»€ä¹ˆæƒ…å†µéƒ½æœ‰å¯èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ä¸ªå¦¨ç¢ç¼–è¯‘å™¨ä¼˜åŒ–çš„å› ç´ æ˜¯å‡½æ•°è°ƒç”¨ã€‚ä½œä¸ºä¸€ä¸ªç¤ºä¾‹ï¼Œè€ƒè™‘ä»¥ä¸‹çš„ä¸¤ä¸ªè¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;f&lt;/span&gt;();

&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func1&lt;/span&gt;(){
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; f()&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;f()&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;f()&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;f();
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func2&lt;/span&gt;(){
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;f();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸¤ä¸ªè¿‡ç¨‹çš„ç»“æœåˆæ˜¯æ„Ÿè§‰æ˜¯ç›¸åŒçš„ç»“æœï¼Œä½†æ˜¯åœ¨ &lt;code&gt;func1()&lt;/code&gt; ä¸­ï¼Œè¿ç»­è°ƒç”¨äº†å››æ¬¡ &lt;code&gt;f()&lt;/code&gt;ï¼›è€Œåœ¨ &lt;code&gt;func2()&lt;/code&gt; ä¸­ï¼Œä»…ä»…è°ƒç”¨äº†ä¸€æ¬¡ã€‚ä»ä»¥ä¸Šçš„è§’åº¦æ¥çœ‹ï¼Œè¿‡ç¨‹ 2 æ˜æ˜¾æ•ˆç‡æ›´é«˜ï¼Œç¼–è¯‘å™¨åº”è¯¥ä½¿ç”¨ &lt;code&gt;func2()&lt;/code&gt; ä¸ºä¼˜åŒ–çš„ç‰ˆæœ¬ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°ä»¥ä¸‹çš„æƒ…å†µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;f&lt;/span&gt;();
 &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; counter&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; 

 &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;f&lt;/span&gt;(){
     &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; counter&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;;
 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ &lt;code&gt;f()&lt;/code&gt; ä¸­ä¿®æ”¹äº†æŸä¸ªå…¨å±€å˜é‡ counterï¼Œè¿™å°±å¯¼è‡´ &lt;code&gt;f()&lt;/code&gt; çš„å¼•ç”¨æ¬¡æ•°å˜åŒ–ä¼šä½¿è¯¥å…¨å±€å˜é‡äº§ç”Ÿä¸åŒçš„å€¼ã€‚æ‰€ä»¥ï¼Œå¤§å¤šæ•°ç¼–è¯‘å™¨ä¼šä¿æŒåŸæœ‰ä»£ç ä¸­æ‰€æœ‰çš„å‡½æ•°è°ƒç”¨ä¸å˜ï¼Œå¹¶ä¸ä¼šä¼˜åŒ–ç›¸çš„ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæƒ³è¦ä¼˜åŒ–å‡½æ•°è°ƒç”¨çš„è¿‡ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†…è”å‡½æ•°&lt;/li&gt;
&lt;li&gt;å®å®šä¹‰å‡½æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸¤ç§æ–¹æ³•çš„æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯åœ¨ä»£ç ä¸­ï¼Œå°†åŸæœ‰çš„å‡½æ•°è°ƒç”¨åˆæ’å…¥è°ƒç”¨çš„å‡½æ•°ä»£ç ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±å¯ä»¥å°†å…¶å½“åšæ™®é€šçš„ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚ä½†æ˜¯è¿™ä¸¤ç§æ–¹æ³•éƒ½æœ‰è°ƒè¯•çš„å±é™©æ€§ï¼Œåœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­ï¼Œè°ƒè¯•å™¨å°†æ— æ³•è¿½è¸ªè¯¥å‡½æ•°è°ƒç”¨ï¼Œä¹Ÿæ— æ³•åœ¨å‡½æ•°å†…éƒ¨è®¾ç½®æ–­ç‚¹ã€‚è¿˜æœ‰ï¼Œåœ¨ä½¿ç”¨ä»£ç å‰–æçš„æ–¹å¼æ¥è¯„ä¼°ç¨‹åºçš„æ€§èƒ½ï¼Œç”¨å†…è”æˆ–è€…å®å®šä¹‰çš„å‡½æ•°è°ƒç”¨æ˜¯æ— æ³•è¢«æ­£ç¡®å‰–æçš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;ç¨‹åºæ€§èƒ½çš„è¡¨è¿°&lt;/h2&gt;
&lt;p&gt;è¿™é‡Œå¼•ç”¨åº¦é‡æ ‡æ³¨ &lt;strong&gt;å…ƒç´ çš„å‘¨æœŸæ•°ï¼ˆCycles Per Elementï¼ŒCPEï¼‰&lt;/strong&gt;ï¼Œä½œä¸ºä¸€ç§è¡¨ç¤ºç¨‹åºæ€§èƒ½å’Œç›´åˆ°æˆ‘ä»¬æ”¹è¿›ä»£ç çš„æ–¹æ³•ã€‚ç”¨æ—¶é’Ÿå‘¨æœŸæ¥è¡¨ç¤ºï¼Œåº¦é‡å€¼è¡¨ç¤ºçš„æ˜¯æ‰§è¡Œäº†å¤šå°‘æ¡æŒ‡ä»¤ï¼Œè€Œä¸æ˜¯æ—¶é’Ÿè¿è¡Œçš„æœ‰å¤šå¿«ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æä¾›ä¸¤ä¸ªä¸åŒçš„å‡½æ•° &lt;code&gt;psum1&lt;/code&gt; &lt;code&gt;psum2&lt;/code&gt;ï¼Œä»–ä»¬éƒ½æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼Œå°±æ˜¯å¯¹äºä¸€ä¸ªå‘é‡å‰ n ä¸ªå…ƒç´ æ±‚å’Œï¼Œä½†æ˜¯å¯¹åº”çš„é‡‡ç”¨çš„ä»£ç ä¸åŒï¼Œé€šè¿‡æ¯”è¾ƒä¸¤ä¸ªå‡½æ•°çš„ CPE å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä»€ä¹ˆ CPE æ˜¯è¡¡é‡ç¨‹åºæ€§èƒ½çš„æŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¡ç®—ä¸€ä¸ªå‘é‡çš„ n å‰åºå’Œ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;psum1&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;float&lt;/span&gt; a[], &lt;span style=&#34;color:#66d9ef&#34;&gt;float&lt;/span&gt; p[], &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; n)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; i;
    p[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;];
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; n; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
        p[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; p[i&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; a[i];
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; psum2(&lt;span style=&#34;color:#66d9ef&#34;&gt;float&lt;/span&gt; a[]; &lt;span style=&#34;color:#66d9ef&#34;&gt;float&lt;/span&gt; p[]; &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; n)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; i;
    p[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;];
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; n&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) {
        &lt;span style=&#34;color:#66d9ef&#34;&gt;float&lt;/span&gt; mid_val &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; p[i&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; a[i];
        p[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mid_val;
        p[i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mid_val &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; a[i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;];
    }
    &lt;span style=&#34;color:#75715e&#34;&gt;/* å¯¹äº n ä¸ºå¶æ•°çš„æƒ…å†µ */&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; n)
        p[i] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; p[i&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; a[i];
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éšç€ n å€¼çš„å˜åŒ–ï¼Œä»¥ä¸Šä¸¤ä¸ªå‡½æ•°çš„è®¡ç®—æ‰€éœ€å‘¨æœŸä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬é€šè¿‡æµ‹è¯•ä¸åŒçš„ n å€¼çš„æƒ…å†µä¸‹çš„è¿è¡Œå‘¨æœŸï¼Œä½¿ç”¨æœ€å°äºŒä¹˜æ³•ï¼Œè·å¾—ä¸¤ç§å‡½æ•°çš„ &lt;strong&gt;å‘¨æœŸ - n&lt;/strong&gt; å¤šé¡¹å¼ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;psum1: 368 + 9.0n&lt;/li&gt;
&lt;li&gt;psum2: 368 + 6.0n&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼Œ&lt;code&gt;psum2&lt;/code&gt; çš„æ–œç‡ï¼ˆä¸€æ¬¡é¡¹ï¼‰ç³»æ•°è¦å°äº &lt;code&gt;psum1&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯åœ¨ n è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œ&lt;code&gt;psum2&lt;/code&gt; çš„æ€§èƒ½è¦å¥½äº &lt;code&gt;psum1&lt;/code&gt;ã€‚è€Œè¿™ç§ä¼˜åŒ–çš„æ–¹æ³•åˆè¢«ç§°ä½œ &lt;strong&gt;å¾ªç¯å±•å¼€ï¼ˆloop unrollingï¼‰&lt;/strong&gt; æŠ€æœ¯ï¼Œè‡³äºä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åšé€šè¿‡å¢åŠ æ¯æ¬¡å¾ªç¯çš„è®¡ç®—é‡ï¼Œå‡å°‘äº†æµ‹è¯•ç¯èŠ‚çš„æ¬¡æ•°ï¼Œè®¡ç®—åœ¨å¾ªç¯ä¸­çš„å æ¯”å¢åŠ ï¼Œè¿™æ ·å¤„ç†å™¨å¯ä»¥ç”¨æ›´å¤šçš„å‘¨æœŸè¿›è¡Œè®¡ç®—ã€‚&lt;/p&gt;
&lt;h3 id=&#34;heading-3&#34;&gt;ç¨‹åºç¤ºä¾‹&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è¯´æ˜ä¸€ä¸ªæŠ½è±¡çš„ç¨‹åºæ˜¯å¦‚ä½•è¢«ç³»ç»Ÿå¾—è½¬æ¢æˆä¸ºæ›´åŠ æœ‰æ•ˆåœ°ä»£ç çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåŸºäºå‘é‡æ•°æ®ç»“æ„çš„è¿è¡Œç¤ºä¾‹ã€‚å‘é‡ç”±ä¸¤ä¸ªå†…å­˜å—ç»„æˆï¼šå¤´éƒ¨å’Œæ•°æ®æ•°ç»„ã€‚å¤´ä¸æ˜¯ä¸€ä¸ªç”Ÿå‘½å¦‚ä¸‹çš„ç»“æ„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; len;
    data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;data;
} vec_rec, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;vec_ptr;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“ç„¶ï¼Œæˆ‘ä»¬ä¼šç»™è¿™ä¸ªç»“æ„åˆ†é…ä¸€ä¸ª len ä¸ª data_t ç±»å‹å¯¹è±¡çš„æ•°ç»„ï¼Œç”¨æ¥å­˜æ”¾å®é™…çš„å‘é‡å…ƒç´ ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸‹é¢æˆ‘ä»¬ä¼šç»™å‡ºä¸€äº›å¸¸è§çš„ç”Ÿæˆå‘é‡ã€è®¿é—®å‘é‡å’Œç¡®å®šå‘é‡é•¿åº¦ç­‰åŸºæœ¬è¿‡ç¨‹ã€‚è¯·æ³¨æ„åœ¨ä¸‹é¢çš„å‘é‡è®¿é—®ç¨‹åº get_vec_elementï¼Œå®ƒä¼šå¯¹æ¯ä¸ªå‘é‡å¼•ç”¨è¿›è¡Œè¾¹ç•Œæ£€æŸ¥ï¼Œè¾¹ç•Œæ£€æŸ¥å‡å°‘äº†å‡ºé”™çš„æœºä¼šï¼Œä½†æ˜¯å®ƒä¹Ÿä¼šå‡ç¼“ç¨‹åºçš„æ‰§è¡Œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* åˆ›é€ ä¸€ä¸ªç‰¹å®šé•¿åº¦çš„å‘é‡ */&lt;/span&gt;
vec_ptr &lt;span style=&#34;color:#a6e22e&#34;&gt;new_vec&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; len)
{
    &lt;span style=&#34;color:#75715e&#34;&gt;/* åˆ†é…ç»“æ„ç©ºé—´ */&lt;/span&gt;
    vec_ptr result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (vec_ptr) malloc(&lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(vec_rec));
    data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; NULL;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;result)
        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; NULL; &lt;span style=&#34;color:#75715e&#34;&gt;/* åˆ†é…å¤±è´¥ */&lt;/span&gt;
    result&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;len &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; len;
    &lt;span style=&#34;color:#75715e&#34;&gt;/* åˆ†é…å‘é‡ç©ºé—´ */&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (len &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) {
        data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)calloc(len, &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(data_t));
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;data) {
            free((&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;) result);
            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; NULL; &lt;span style=&#34;color:#75715e&#34;&gt;/* åˆ†é…å¤±è´¥ */&lt;/span&gt;
        }
    }
    &lt;span style=&#34;color:#75715e&#34;&gt;/* data æŒ‡é’ˆæŒ‡å‘ç©ºæˆ–è€…åˆ†é…çš„å‘é‡ */&lt;/span&gt;
    result&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; data;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; result;
}

&lt;span style=&#34;color:#75715e&#34;&gt;/* è·å¾—å‘é‡å…ƒç´ å¹¶å°†å…¶å‚¨å­˜åœ¨ dest *
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; * è¿”å› 0ï¼ˆè¶Šç•Œï¼‰æˆ–è€… 1ï¼ˆæˆåŠŸï¼‰  */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;get_vec_element&lt;/span&gt;(vec_ptr v, &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; index, data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (index &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; index &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; v&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;len)
        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; v&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;data[index];
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
}

&lt;span style=&#34;color:#75715e&#34;&gt;/* è¿”å›å‘é‡çš„é•¿åº¦ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;vec_length&lt;/span&gt;(vec_ptr v)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; v&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;len;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨ä¸€ç§ä»£ç æè¿°å¤šç§è¿ç®—è¿‡ç¨‹ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†å¦‚ä¸‹çš„ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* åˆå¹¶è¿ç®—çš„åˆå§‹å®ç° */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* åŠ æ³•è¿ç®— */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define IDENT 0&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define OP +&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ä¹˜æ³•è¿ç®— */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;// #define IDENT 1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// #define OP *
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;combine1&lt;/span&gt;(vec_ptr, data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; i;

    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDENT;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; vec_length(v); i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {
        data_t val;
        get_vec_element(v, i, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;val);
        &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest OP val;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æ¥ä¸‹æ¥çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå¯¹ä»£ç è¿›è¡Œä¸€äº›å˜æ¢ï¼Œæœ‰äº›äº‹æœ‰æ•ˆçš„æœ‰äº›äº‹æ— æ•ˆçš„ï¼Œè€Œå¦‚ä½•ç¡®å®šå˜æ¢çš„ç»„åˆä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œå®ƒä»¬èƒ½ä½¿ç¼–è¯‘å™¨å¯¹äºä»£ç è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚åœ¨ä¸‹é¢æˆ‘ä»¬ç»™å‡ºåœ¨ Intel Core i7 Haswell å¤„ç†å™¨çš„æœºå™¨ä¸Šè¿è¡Œæ­¤æ±‚å’Œå’Œæ±‚ç§¯å‡½æ•°çš„ CPE æ€§èƒ½ï¼Œè¿™ä¸ªæœºå™¨åˆè¢«ç§°ä½œå‚è€ƒæœºã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;å‡½æ•°&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ–¹æ³•&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ•´æ•° CPE&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æµ®ç‚¹æ•° CPE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;æŠ½è±¡æœªä¼˜åŒ–çš„&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;22.68(+) 20.02(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;19.98(+) 20.18(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;æŠ½è±¡ -O1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10.12(+) 10.12(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10.17(+) 11.14(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºç®€å•çš„ &amp;ldquo;-O1&amp;rdquo; ä¼˜åŒ–å°±å¯ä»¥æœ‰æ•ˆæé«˜ç¨‹åºçš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-4&#34;&gt;æ¶ˆé™¤å¾ªç¯çš„ä½æ•ˆç‡&lt;/h2&gt;
&lt;p&gt;åœ¨è®¡ç®—å…ƒç´ çš„ä¹˜ç§¯å’Œç®—æ•°å’Œçš„æ—¶å€™ï¼Œè¿‡ç¨‹ &lt;code&gt;combine1&lt;/code&gt; è°ƒç”¨å‡½æ•° &lt;code&gt;vec_length&lt;/code&gt; ä½œä¸º &lt;code&gt;for&lt;/code&gt; å¾ªç¯çš„æµ‹è¯•æ¡ä»¶ã€‚è€Œåœ¨ç¼–è¯‘ç« èŠ‚ï¼Œæˆ‘ä»¬äº†è§£äº† &lt;code&gt;for&lt;/code&gt; å¾ªç¯åœ¨æœºå™¨çº§ç¨‹åºä¸­çš„ç¿»è¯‘ç»“æœï¼Œå®ƒä¼šåœ¨æ¯ä¸€æ¬¡å¾ªç¯æ—¶è®¡ç®—æµ‹è¯•æ¡ä»¶çš„å€¼ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸ç®¡å¾ªç¯è¿›è¡Œåˆ°å“ªé‡Œï¼Œæµ‹è¯•æ¡ä»¶çš„å€¼ä¿æŒä¸å˜ã€‚å› æ­¤æˆ‘ä»¬åªéœ€è¦åœ¨å¾ªç¯å‰è°ƒç”¨ä¸€æ¬¡ &lt;code&gt;vec_length&lt;/code&gt;ï¼Œå¹¶ä¸”åœ¨æµ‹è¯•æ¡ä»¶ä¸­ä¸€ç›´ä½¿ç”¨æ­¤å€¼å³å¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;Â·&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;Â·&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;Â·&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; combine2(vec_ptr, data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; i;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; length &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; vec_length(v);

    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDENT;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; length; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {
        data_t val;
        get_vec_element(v, i, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;val);
        &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest OP val;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;å‡½æ•°&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ–¹æ³•&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ•´æ•° CPE&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æµ®ç‚¹æ•° CPE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;æŠ½è±¡ -O1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10.12(+) 10.12(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10.17(+) 11.14(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ç§»åŠ¨ vec_length&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.02(+) 9.03(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.02(+) 11.03(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿™ä¸€ç±»ä¼˜åŒ–æ˜¯æ¯”è¾ƒå¸¸è§çš„ä¼˜åŒ–æ–¹æ³•ï¼Œè¢«ç§°ä½œ &lt;strong&gt;ä»£ç ç§»åŠ¨&lt;/strong&gt;ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šå°è¯•è¿›è¡Œè¿™ç§ä¼˜åŒ–ï¼Œä½†æ˜¯åœ¨æœ¬ä¾‹ä¸­ï¼Œæ¶‰åŠåˆ°è°ƒç”¨å‡½æ•°ï¼Œå‚è§ä»¥ä¸Šçš„å†…å®¹æˆ‘ä»¬çŸ¥é“ï¼Œç¼–è¯‘å™¨ä¼šå‡è®¾è°ƒç”¨çš„å‡½æ•°æœ‰å…¨å±€çš„å‰¯ä½œç”¨ï¼Œæ•…å¹¶ä¸ä¼šå¯¹å…¶è¿›è¡Œä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-5&#34;&gt;å‡å°‘è¿‡ç¨‹è°ƒç”¨&lt;/h2&gt;
&lt;p&gt;é€šè¿‡ä¹‹å‰è®²è§£ï¼Œæˆ‘ä»¬çŸ¥é“è¿‡ç¨‹è°ƒç”¨ä¼šäº§ç”Ÿå¼€é”€ï¼Œè€Œä¸”å¦¨ç¢ç¨‹åºä¼˜åŒ–ã€‚åœ¨ &lt;code&gt;combine2&lt;/code&gt; ç¨‹åºä¸­æˆ‘ä»¬å‘ç°åœ¨å¾ªç¯ä½“å†…ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡è°ƒç”¨ &lt;code&gt;get_vec_element()&lt;/code&gt; æ¥è·å–ä¸‹ä¸€ä¸ªå‘é‡å…ƒç´ çš„å€¼ã€‚åœ¨è¿™ä¸ªè°ƒç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯æ¬¡éƒ½ä¼šå¯¹å‘é‡ç´¢å¼• i å’Œè¾¹ç•Œæ¯”è¾ƒæ£€æŸ¥ i åˆæ³•æ€§ï¼Œè€Œé€šè¿‡å¯¹äºä»£ç ä¸Šä¸‹æ–‡çš„è§‚å¯Ÿï¼Œåœ¨è¿™ä¸ªç¯å¢ƒä¸­ï¼Œæ¯æ¬¡çš„å¼•ç”¨éƒ½æ˜¯åˆæ³•çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ–°çš„å‡½æ•° &lt;code&gt;get_vec_start()&lt;/code&gt;ï¼Œè¿™ä¸ªå‡½æ•°è·å–å‘é‡çš„é¦–åœ°å€ï¼Œåœ¨åç»­è®¡ç®—ä¸­ï¼Œç›´æ¥è®¿é—®åœ°å€ï¼Œè€Œä¸é€šè¿‡è°ƒç”¨è·å–å…ƒç´ ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;get_vec_start&lt;/span&gt;(vec_ptr v)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; v&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;data;
}
&lt;span style=&#34;color:#75715e&#34;&gt;/* é€šè¿‡è®¿é—®çŸ¢é‡æ•°æ®ç›´æ¥è®¿é—® */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;combine3&lt;/span&gt;(vec_ptr v,data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; i;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; length &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; vec_length(v);
    data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; get_vec_start(v);

    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDENT;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; length; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;){
        &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest OP data[i];
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;å‡½æ•°&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ–¹æ³•&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ•´æ•° CPE&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æµ®ç‚¹æ•° CPE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ç§»åŠ¨ vec_length&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.02(+) 9.03(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.02(+) 11.03(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;å‡å°‘è¿‡ç¨‹è°ƒç”¨&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.17(+) 9.02(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.02(+) 11.04(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æœ‰è¡¨å¯è§ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æå‡ã€‚æ˜¾ç„¶ï¼Œå¾ªç¯ä¸­çš„å…¶ä»–æ“ä½œå½¢æˆäº†ç“¶é¢ˆï¼Œé™åˆ¶æ€§èƒ½è¶…è¿‡è°ƒç”¨ &lt;code&gt;get_vec_element()&lt;/code&gt;ã€‚ä½†æ˜¯è¿™ç§è½¬æ¢å¸¦æ¥äº†ä¸€äº›å…¶ä»–çš„å¥½å¤„ï¼Œæˆ‘ä»¬å°†å…¶è§†ä½œä¼˜åŒ–çš„ä¸€ä¸ªç¯èŠ‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-6&#34;&gt;æ¶ˆé™¤ä¸å¿…è¦çš„å†…å­˜å¼•ç”¨&lt;/h2&gt;
&lt;p&gt;åœ¨ä»¥ä¸Šçš„ &lt;code&gt;combine3()&lt;/code&gt; ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°† *dest è§†ä½œç´¯ç§¯å€¼çš„å­˜æ”¾ç›®æ ‡ã€‚é€šè¿‡æ£€æŸ¥å†…å¾ªç¯ç¼–è¯‘åçš„æ±‡ç¼–ä»£ç ï¼Œå¯ä»¥çœ‹å‡ºè¿™ä¸ªå±æ€§ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;combine3 çš„å†…å¾ªç¯ã€‚data_t æ˜¯åŒæµ®ç‚¹å‹ï¼ŒOP = *
dest åœ¨ %rbx ä¸­ï¼Œdata + i åœ¨ %rdx ä¸­ï¼Œdata + length åœ¨ %rax ä¸­

.L17:                           loop:
    vmovsd (%rbx), %xmm0            *dest -&amp;gt; %xmm0
    vmulsd (%rdx), %xmm0, %xmm0     data[i] * %xmm0 -&amp;gt; %xmm0
    vmovsd %xmm0, (%rbx)            %xmm0 -&amp;gt; *dest
    addq $8, %rdx                   i += 8
    cmpq %rax, %rdx                 if (!(%rdx - %rax)) set ZF
    jne .L17                        if (~ZF) loop:
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨æ¯æ¬¡å†…å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬éƒ½è¦ç»å† &lt;code&gt;*dest -&amp;gt; %xmm0&lt;/code&gt; å’Œ &lt;code&gt;%xmm0 -&amp;gt; *dest&lt;/code&gt; ä¸¤ä¸ªè®¿å­˜è¿‡ç¨‹ï¼Œä¸€æ¬¡è¯»å–ä¸€æ¬¡å†™å…¥ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è®¡ç®—å®Œçš„ç»“æœè¦å…ˆå†™å…¥å†…å­˜åï¼Œä¸‹ä¸€æ¬¡å¾ªç¯å†è¿›è¡Œè¯»å–åˆ°å¯„å­˜å™¨å†è®¡ç®—ã€‚è¿™ä¸ªè¿‡ç¨‹å…¶å®æ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥å°†æ•°ä¸€ç›´æ”¾åœ¨ä¹˜æ³•å¯„å­˜å™¨ä¸­ï¼Œç­‰å¾…è®¡ç®—å¾ªç¯å®Œå…¨å®Œæˆåå†å°†å€¼å†™å›å†…å­˜ï¼Œè¿™æ ·å¯ä»¥å‡å°‘è®¸å¤šä¸å¿…è¦çš„å†…å­˜è®¿é—®æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹è¿‡çš„æ±‡ç¼–ä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;combine3 çš„å†…å¾ªç¯ã€‚data_t æ˜¯åŒæµ®ç‚¹å‹ï¼ŒOP = *
acc åœ¨ %xmm0 ä¸­ï¼Œdata + i åœ¨ %rdx ä¸­ï¼Œdata + length åœ¨ %rax ä¸­
.L25:                           loop:
    vmulsd (%rdx), %xmm0, %xmm0     data[i] * %xmm0 -&amp;gt; %xmm0
    addq $8, %rdx                   i += 8
    cmpq %rax, %rdx                 if (!(%rdx - %rax)) set ZF
    jne .L25                        if (~ZF) loop:
&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;combine4&lt;/span&gt;(vec_ptr v, data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest)
{
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; i;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;long&lt;/span&gt; length &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; vec_length(v);
    data_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; get_vec_start(v);
    data_t acc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; IDENT;

    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; length; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {
        acc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; acc OP data[i];
    }
    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; acc;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœè¢«ç§¯ç´¯åœ¨ä¸´æ—¶å˜é‡ acc ä¸­ï¼Œæ¶ˆé™¤äº†æ¯æ¬¡å¾ªç¯ä¸­ä»å†…å­˜è¯»å‡ºå¹¶æ›´æ–°çš„è¿‡ç¨‹ã€‚è¿™ä¸ªæ”¹å˜ä½¿ç¨‹åºçš„é€Ÿåº¦æœ‰äº†è¾ƒå¤§çš„æå‡ï¼Œå¦‚ä¸‹è¡¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;å‡½æ•°&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ–¹æ³•&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ•´æ•° CPE&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æµ®ç‚¹æ•° CPE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;å‡å°‘è¿‡ç¨‹è°ƒç”¨&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.17(+) 9.02(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.02(+) 11.04(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ç´¯è®¡åœ¨ä¸´æ—¶å˜é‡ä¸­&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.27(+) 3.01(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.01(+) 5.01(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æœ‰äººè§‰å¾—ï¼Œç¼–è¯‘å™¨åº”è¯¥åšåˆ°ç›´æ¥ä¼˜åŒ–æˆä¸º &lt;code&gt;combine4&lt;/code&gt; ä¸­ä»£ç çš„æ ¼å¼ï¼Œä½†æ˜¯åœ¨å®é™…çš„è¿‡ç¨‹ä¸­ï¼Œdest æŒ‡é’ˆä¸ä¸€å®šæ˜¯å¦å’Œæ•°ç»„åäº§ç”Ÿé‡åï¼Œæ•…ç¼–è¯‘å™¨å¹¶ä¸ä¼šåšå‡ºä¼˜åŒ–çš„æªæ–½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨ &amp;lsquo;-O2&amp;rsquo; çš„å‘½ä»¤è¡Œé€‰é¡¹ç¼–è¯‘ &lt;code&gt;combine3&lt;/code&gt; æ—¶ï¼Œç¨‹åºçš„æ•ˆç‡æé«˜è®¸å¤šï¼Œå°½ç®¡è¿˜æ˜¯æ²¡æœ‰ &lt;code&gt;combine4&lt;/code&gt; æ•ˆç‡é«˜ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;å‡½æ•°&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ–¹æ³•&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ•´æ•° CPE&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æµ®ç‚¹æ•° CPE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-O1 ç¼–è¯‘&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.17(+) 9.02(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.02(+) 11.04(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-O2 ç¼–è¯‘&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.60(+) 3.01(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.01(+) 5.01(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ç´¯è®¡åœ¨ä¸´æ—¶å˜é‡ä¸­&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.27(+) 3.01(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.01(+) 5.01(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åœ¨æ£€æŸ¥ç¼–è¯‘å™¨äº§ç”Ÿçš„æ±‡ç¼–ä»£ç æ—¶ï¼Œæˆ‘ä»¬å‘ç°å†…å¾ªç¯æ±‡ç¼–ä»£ç å‘ç”Ÿäº†ä¸€ä¸ªæœ‰è¶£çš„å˜åŒ–ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;combine3 çš„ -O2 å†…å¾ªç¯ã€‚data_t æ˜¯åŒæµ®ç‚¹å‹ï¼ŒOP = *
dest åœ¨ %rbx ä¸­ï¼Œdata + i åœ¨ %rdx ä¸­ï¼Œdata + length åœ¨ %rax ä¸­

.L22:                           loop:
    vmulsd (%rdx), %xmm0, %xmm0     data[i] * %xmm0 -&amp;gt; %xmm0
    addq $8, %rdx                   i += 8
    cmpq %rax, %rdx                 if (!(%rdx - %rax)) set ZF
    vmovsd %xmm0, (%rbx)            %xmm0 -&amp;gt; *dest
    jne .L22                        if (~ZF) loop:
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é€šè¿‡è°ƒæ•´å†™å›çš„ä½ç½®ï¼Œå‡å°‘äº†ä¸€æ¬¡è¯»å–å†…å­˜çš„æ“ä½œï¼Œæé«˜äº†æ•ˆç‡ï¼Œå¹¶ä¸”ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿å‡ºç°å†…å­˜é‡åï¼Œä¹Ÿè¿˜æ˜¯å¯ä»¥ä¿è¯å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-7&#34;&gt;ç†è§£ç°ä»£å¤„ç†å™¨&lt;/h2&gt;
&lt;p&gt;ç”±äºå¤§é‡çš„æ™¶ä½“è¢«é›†æˆåœ¨ä¸€å—èŠ¯ç‰‡ä¸Šï¼Œç°ä»£å¾®å¤„ç†å™¨é‡‡ç”¨äº†å¤æ‚çš„ç¡¬ä»¶ï¼Œè¯•å›¾ä½¿å¾—ç¨‹åºçš„æ€§èƒ½æœ€å¤§åŒ–ã€‚åœ¨ä»£ç çº§åˆ«ä¸Šï¼Œçœ‹èµ·æ¥æ˜¯ä¸€æ¬¡æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ï¼Œä½†æ˜¯åœ¨å®é™…çš„å¤„ç†å™¨ä¸­ï¼Œæ˜¯åŒæ—¶å¯¹å¤šæ¡æŒ‡ä»¤æ±‚å€¼çš„ï¼Œè¿™ä¸ªç°è±¡è¢«ç§°ä½œ &lt;em&gt;æŒ‡ä»¤çº§å¹¶è¡Œ&lt;/em&gt;ã€‚ç°ä»£å¤„ç†å™¨å–å¾—çš„äº†ä¸èµ·çš„åŠŸç»©ä¹‹ä¸€æ˜¯ï¼šä»–ä»¬é‡‡ç”¨å¤æ‚è€Œå¥‡å¼‚çš„å¤„ç†å™¨ç»“æ„ï¼Œå…¶ä¸­å¤šæ¡æŒ‡ä»¤å¯ä»¥å¹¶è¡Œçš„æ‰§è¡Œï¼ŒåŒæ—¶åˆå‘ˆç°å‡ºä¸€ç§ç®€å•çš„é¡ºåºæ‰§è¡ŒæŒ‡ä»¤çš„ç°è±¡ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä¸€ç³»åˆ—æ“ä½œå¿…é¡»ä¸¥æ ¼æŒ‰ç…§é¡ºåºæ‰§è¡Œæ—¶ï¼Œå°±ä¼šé‡åˆ° &lt;em&gt;å»¶è¿Ÿç•Œé™&lt;/em&gt;ï¼Œå› ä¸ºåœ¨ä¸‹ä¸€æ¡æŒ‡ä»¤å¼€å§‹ä¹‹å‰ï¼Œè¿™æ¡æŒ‡ä»¤å¿…é¡»ç»“æŸã€‚å½“ä»£ç ä¸­çš„æ•°æ®ç›¸å…³é™åˆ¶äº†å¤„ç†å™¨æŒ‡ä»¤çº§å¹¶è¡Œæ‰§è¡Œèƒ½åŠ›æ—¶ï¼Œå»¶è¿Ÿç•Œé™èƒ½å¤Ÿé™åˆ¶ç¨‹åºæ€§èƒ½ã€‚&lt;em&gt;ååé‡ç•Œé™&lt;/em&gt; åˆ»ç”»äº†å¤„ç†å™¨åŠŸèƒ½å•å…ƒçš„åŸå§‹è®¡ç®—èƒ½åŠ›ã€‚è¿™ä¸ªç•Œé™æ˜¯ç¨‹åºæ€§èƒ½çš„ç»ˆæé™åˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-8&#34;&gt;æ•´ä½“æ“ä½œ&lt;/h2&gt;
&lt;p&gt;åœ¨è¿™é‡Œå±•ç¤ºä¸€ä¸ªè¿‘æœŸçš„ Intel å¤„ç†å™¨çš„ç»“æ„ã€‚è¿™äº›å¤„ç†å™¨åœ¨å·¥ä¸šä¸­è¢«ç§°ä¸º &lt;em&gt;è¶…æ ‡é‡&lt;/em&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¯ä»¥åœ¨æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸæ‰§è¡Œå¤šä¸ªæ“ä½œï¼Œè€Œä¸”æ˜¯ &lt;strong&gt;ä¹±åºçš„&lt;/strong&gt;ã€‚æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºä¸ä¸€å®šè¦ä¸ä»–ä»¬åœ¨æœºå™¨çº§ç¨‹åºä¸­çš„é¡ºåºä¸€è‡´ã€‚æ•´ä¸ªè®¾è®¡æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼š&lt;strong&gt;æŒ‡ä»¤æ§åˆ¶å•å…ƒï¼ˆInstruction Control Unitï¼ŒICUï¼‰&lt;/strong&gt; å’Œ &lt;strong&gt;æ‰§è¡Œå•å…ƒï¼ˆExecution Unitï¼ŒEUï¼‰&lt;/strong&gt;ã€‚å‰è€…è´Ÿè´£åœ¨å†…å­˜ä¸­è¯»å‡ºæŒ‡ä»¤åºåˆ—ï¼Œå¹¶ä¸”æ ¹æ®è¿™äº›æŒ‡ä»¤åºåˆ—äº§ç”Ÿä¸€ç»„é’ˆå¯¹ç¨‹åºæ•°æ®çš„åŸºæœ¬æ“ä½œï¼›åè€…æ‰§è¡Œè¿™äº›æ“ä½œã€‚å’Œæˆ‘ä»¬ä¹‹å‰ç ”ç©¶è¿‡çš„ SEQ å’Œ PIPE æµæ°´çº¿ç›¸æ¯”ï¼Œä¹±åºå¤„ç†å™¨éœ€è¦æ›´å¤§ã€æ›´å¤æ‚çš„ç¡¬ä»¶ï¼Œä½†æ˜¯å®ƒä»¬èƒ½å¤Ÿæ›´å¥½åœ°è¾¾åˆ°æ›´é«˜çš„æŒ‡ä»¤çº§å¹¶è¡Œåº¦ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-5-optimize-your-c-code/ooo_CPU.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚å›¾æ‰€ç¤ºï¼ŒæŒ‡ä»¤æ§åˆ¶å•å…ƒ ICU è´Ÿè´£ä»å†…å­˜ä¸­è¯»å‡ºæŒ‡ä»¤ï¼Œå¹¶äº§ç”Ÿä¸€ç³»åˆ—åŸºæœ¬æ“ä½œã€‚ç„¶åæ‰§è¡Œå•å…ƒ EU å®Œæˆè¿™äº›æ“ä½œï¼Œå¹¶æŒ‡å‡ºåˆ†æ”¯é¢„æµ‹æ˜¯å¦æ­£ç¡®ã€‚ICU ä¼šæå‰å¾ˆæ—©å¯¹äºå½“å‰æ‰§è¡Œçš„æŒ‡ä»¤è¿›è¡Œå–æŒ‡ï¼Œè¿™æ ·å®ƒæ‰æœ‰è¶³å¤Ÿçš„æ—¶é—´å¯¹äºå…¶è¿›è¡ŒæŒ‡ä»¤è¯‘ç ï¼Œå¹¶æŠŠæ“ä½œå‘ç»™ EUã€‚&lt;/p&gt;
&lt;p&gt;EU æ¥æ”¶å®é™…çš„ç¨‹åºæŒ‡ä»¤ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ç³»åˆ—åŸºæœ¬æ“ä½œï¼ˆä¹Ÿæˆå¾®æ“ä½œï¼‰ã€‚å¯¹äºæœ‰å¤æ‚æŒ‡ä»¤çš„æœºå™¨ï¼Œä¾‹å¦‚ x86 å¤„ç†å™¨ï¼Œä¸€æ¡æŒ‡ä»¤å¯ä»¥è¢«è¯‘ç æˆä¸ºå¤šä¸ªæ“ä½œï¼Œè€ŒæŒ‡ä»¤å¦‚ä½•è¢«è¯‘ç æˆä¸ºæ“ä½œåºåˆ—çš„ç»†èŠ‚ï¼Œä¸åŒçš„æœºå™¨éƒ½ä¸åŒï¼Œè¿™ä¸ªä¿¡æ¯æ˜¯é«˜åº¦æœºå¯†ã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸éœ€è¦çŸ¥é“è¿™äº›åº•å±‚ç»†èŠ‚ï¼Œä¹Ÿå¯ä»¥ä¼˜åŒ–è‡ªå·±çš„ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;**é€€å½¹å•å…ƒï¼ˆretirement unitï¼‰**è®°å½•æ­£åœ¨è¿›è¡Œçš„å¤„ç†ã€‚é€€å½¹å•å…ƒæ§åˆ¶å†…éƒ¨å¯„å­˜å™¨çš„æ›´æ–°ã€‚æŒ‡ä»¤åœ¨è¢«è¯‘ç å®Œæˆåï¼ŒæŒ‡ä»¤çš„ä¿¡æ¯å°†ä¼šè¢«æ”¾ç½®åœ¨ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ä¸­ã€‚è€Œé˜Ÿåˆ—æ›´æ–°åªæœ‰åœ¨ä»¥ä¸‹ä¸¤ç§æ¡ä»¶ä¸‹è¢«å®Œæˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿™æ¡ä¿¡æ¯çš„æ‰€æœ‰æ“ä½œå®Œæˆäº†ï¼Œå¹¶ä¸”å¼•èµ·è¿™æ¡æŒ‡ä»¤çš„é¢„æµ‹è¢«åˆ¤æ–­æ­£ç¡®ï¼Œå¯¹å¯„å­˜å™¨æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;å¼•èµ·è¿™æ¡æŒ‡ä»¤çš„æŸä¸ªåˆ†æ”¯é¢„æµ‹ç‚¹é”™è¯¯ï¼Œè¯¥æŒ‡ä»¤è¢«æ¸…ç©ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ç§æ–¹æ³•å¯¼è‡´é¢„æµ‹çš„é”™è¯¯æƒ…å†µå‘ç”Ÿåï¼Œç¨‹åºçš„çŠ¶æ€ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºåŠŸèƒ½å•å…ƒï¼Œæˆ‘ä»¬çš„ Intel Core i7 Haswell å‚è€ƒæœºå…·æœ‰ 8 ä¸ªåŠŸèƒ½å•å…ƒï¼Œæ¯ä¸ªå•å…ƒçš„åŠŸèƒ½æœ‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ•´æ•°è¿ç®—ã€æµ®ç‚¹ä¹˜ã€æ•´æ•°å’Œæµ®ç‚¹æ•°é™¤æ³•ã€åˆ†æ”¯&lt;/li&gt;
&lt;li&gt;è¯ä¹¦è¿ç®—ã€æµ®ç‚¹åŠ ã€æ•´æ•°ä¹˜ã€æµ®ç‚¹ä¹˜&lt;/li&gt;
&lt;li&gt;åŠ è½½ã€åœ°å€è®¡ç®—&lt;/li&gt;
&lt;li&gt;åŠ è½½ã€åœ°å€è®¡ç®—&lt;/li&gt;
&lt;li&gt;å‚¨å­˜&lt;/li&gt;
&lt;li&gt;æ•´æ•°è¿ç®—&lt;/li&gt;
&lt;li&gt;æ•´æ•°è¿ç®—ã€åˆ†æ”¯&lt;/li&gt;
&lt;li&gt;å‚¨å­˜ã€åœ°å€è¿ç®—&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;heading-9&#34;&gt;åŠŸèƒ½å•å…ƒçš„æ€§èƒ½&lt;/h2&gt;
&lt;p&gt;å¯¹äºä¸åŒçš„åŠŸèƒ½å•å…ƒï¼Œç”±äºå…¶è´Ÿè´£ä¸åŒçš„ç®—æ•°è¿ç®—ï¼Œæ•…å„ä¸ªåŠŸèƒ½å•å…ƒçš„æ€§èƒ½å¹¶ä¸ç›¸åŒï¼Œè¿™äº›æ€§èƒ½æ˜¯é€šè¿‡ä»¥ä¸‹çš„è¿™äº›æ•°å€¼è¿›è¡Œåˆ»ç”»çš„ï¼ˆå•ä½ä¸ºæ—¶é’Ÿå‘¨æœŸï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å»¶è¿Ÿï¼ˆlatencyï¼‰&lt;/strong&gt;ï¼Œå®Œæˆè¿ç®—æ‰€éœ€çš„æ€»æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‘å°„æ—¶é—´ï¼ˆissue timeï¼‰&lt;/strong&gt;ï¼Œä¸¤ä¸ªè¿ç»­åŒç±»å‹è¿ç®—ä¹‹é—´éœ€è¦çš„æœ€å°å‘¨æœŸæ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¹é‡ï¼ˆcapacityï¼‰&lt;/strong&gt;ï¼Œæ‰§è¡Œè¯¥è¿ç®—çš„åŠŸèƒ½å•å…ƒçš„æ•°é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;è¿ç®—&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ•´æ•°&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æµ®ç‚¹æ•°&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;å»¶è¿Ÿ&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;å‘å°„&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;å®¹é‡&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;å»¶è¿Ÿ&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;å‘å°„&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;å®¹é‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;åŠ æ³•&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;ä¹˜æ³•&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;é™¤æ³•&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3~30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3~30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3~15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3~15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨ç°å‘å°„æ—¶é—´çš„ä¸€ç§æ›´å¸¸è§çš„æ–¹æ³•æ˜¯æŒ‡æ˜è¿™ä¸ªåŠŸèƒ½å•å…ƒçš„æœ€å¤§ &lt;em&gt;ååé‡&lt;/em&gt;ï¼Œå®šä¹‰ä¸ºå‘å°„æ—¶é—´çš„å€’æ•°ã€‚å¯¹äºä¸€ä¸ªå®¹é‡ä¸º &lt;em&gt;C&lt;/em&gt;ï¼Œå‘å°„æ—¶é—´ä¸º &lt;em&gt;I&lt;/em&gt; çš„æ“ä½œæ¥è¯´ï¼Œå¤„ç†å™¨å¯èƒ½è·å¾—çš„ååé‡ä¸ºæ¯æ—¶é’Ÿå‘¨æœŸ &lt;em&gt;C/I&lt;/em&gt; ä¸ªæ“ä½œï¼Œè€Œæœ€å°çš„ CPE ååç•Œé™å°±æ˜¯ &lt;em&gt;I/C&lt;/em&gt; ä¸ªå‘¨æœŸã€‚æˆ‘ä»¬çš„å‚è€ƒæœºå¯ä»¥æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸæ‰§è¡Œä¸¤ä¸ªæµ®ç‚¹ä¹˜æ³•è¿ç®—ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªèƒ½åŠ›æ¥æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚æ ¹æ®è®¡ç®—ï¼Œå¾—å‡ºå¤„ç†å™¨çš„ç†è®ºæœ€å° CPE å‚æ•°ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;å‡½æ•°&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ–¹æ³•&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ•´æ•° CPE&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æµ®ç‚¹æ•° CPE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;combine4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ç´¯è®¡åœ¨ä¸´æ—¶å˜é‡ä¸­&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.27(+) 3.01(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.01(+) 5.01(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;å»¶è¿Ÿ&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.00(+) 3.00(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.00(+) 5.00(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;ååé‡&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.50(+) 1.00(*)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.00(+) 0.50(*)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†æ•´æ•°åŠ æ³•ä¹‹å¤–çš„è¿ç®—éƒ½å·²ç»åŸºæœ¬è¾¾åˆ°äº†å»¶è¿Ÿ CPE çš„ç¡¬ä»¶ç•Œé™ï¼Œåœ¨æ¥ä¸‹æ¥çš„å†…å®¹é‡Œï¼Œæˆ‘ä»¬å°†ä¼šç€æ‰‹äºåˆ›å»ºå¤„ç†å™¨æ“ä½œçš„æŠ½è±¡æ¨¡å‹ï¼Œå¯¹äºä»£ç çš„æ‰§è¡Œè¿‡ç¨‹åœ¨å¤„ç†å™¨å±‚é¢è¿›è¡Œè¯¦ç»†æ¢ç©¶ã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-10&#34;&gt;æœºå™¨çº§ä»£ç åˆ°æ•°æ®æµå›¾&lt;/h4&gt;
&lt;p&gt;ç»¼ä¸Šæ‰€è¿°ï¼Œç¨‹åºä»£ç çš„æ•°æ®æµä¸èƒ½ä½“ç°åœ¨å¤„ç†å™¨å±‚é¢ä¸Šé¢ã€‚æˆ‘ä»¬å°†æ³¨æ„åŠ›é›†ä¸­åœ¨å¯¹äºå†…å¾ªç¯çš„è¿‡ç¨‹ï¼Œå› ä¸ºå¯¹äºä¸€ä¸ªå·¨å¤§çš„ n å€¼ï¼Œå†…å¾ªç¯çš„è®¡ç®—æ—¶é—´ï¼Œä¹Ÿå³æ˜¯å¾ªç¯çš„ CPE å€¼æ˜¯å†³å®šæ€§èƒ½çš„ä¸»è¦å› ç´ ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;combine3 çš„å†…å¾ªç¯ã€‚data_t æ˜¯åŒæµ®ç‚¹å‹ï¼ŒOP = *
acc åœ¨ %xmm0 ä¸­ï¼Œdata + i åœ¨ %rdx ä¸­ï¼Œdata + length åœ¨ %rax ä¸­
.L25:                           loop:
    vmulsd (%rdx), %xmm0, %xmm0     data[i] * %xmm0 -&amp;gt; %xmm0
    addq $8, %rdx                   i += 8
    cmpq %rax, %rdx                 if (!(%rdx - %rax)) set ZF
    jne .L25                        if (~ZF) loop:
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯¹äºå½¢æˆå¾ªç¯çš„ä»£ç ç‰‡æ®µï¼Œæˆ‘ä»¬å¯ä»¥å°†è®¿é—®åˆ°çš„å¯„å­˜å™¨åˆ†ä¸ºå››ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªè¯»ï¼šè¿™äº›å¯„å­˜å™¨åªä½œä¸ºè¿ç®—çš„æºå€¼ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè®¡ç®—çš„å†…å­˜åœ°å€ï¼Œåœ¨å¾ªç¯çš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä¸­çš„å€¼ä¿æŒä¸ä¸å˜ï¼Œåœ¨ &lt;code&gt;combine4&lt;/code&gt; å¾ªç¯ä¸­ï¼Œ%rax å¯„å­˜å™¨ä¸ºåªè¯»ç±»å‹çš„ã€‚&lt;/li&gt;
&lt;li&gt;åªå†™ï¼šè¿™äº›å¯„å­˜å™¨è¢«ä½œä¸ºæ•°æ®ä¼ é€æ“ä½œçš„ç›®çš„ã€‚æœ¬å¾ªç¯ä¸­æ²¡æœ‰æ­¤ç±»å¯„å­˜å™¨ã€‚&lt;/li&gt;
&lt;li&gt;å±€éƒ¨ï¼šåœ¨å¾ªç¯å†…éƒ¨è¢«ä¿®æ”¹å’Œä½¿ç”¨ã€‚æœ¬ä¾‹ä¸­çš„æ¡ä»¶ç å¯„å­˜å™¨å°±æ˜¯è¿™ç±»å¯„å­˜å™¨ï¼Œcmp æ“ä½œä¼šä¿®æ”¹ä»–ä»¬ï¼Œjne æ“ä½œåˆä¼šä½¿ç”¨åˆ°ä»–ä»¬ã€‚&lt;/li&gt;
&lt;li&gt;å¾ªç¯ï¼šå¯¹äºå¾ªç¯æ¥è¯´ï¼Œè¿™äº›å¯„å­˜å™¨ä¼šåœ¨æœ¬æ¬¡å¾ªç¯ä¸­ä¿®æ”¹ï¼Œåœ¨ä¸‹æ¬¡å¾ªç¯ä¸­ç”¨åˆ°ã€‚æœ¬ä¾‹ä¸­çš„ %rdx å’Œ %xmm0 æ˜¯ &lt;code&gt;combine4&lt;/code&gt; çš„å¾ªç¯å¯„å­˜å™¨ï¼Œå¯¹åº”å˜é‡ &lt;code&gt;data+i&lt;/code&gt; å’Œ &lt;code&gt;acc&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2018-7-5-optimize-your-c-code/combine4_data_flow.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ ¹æ®æ±‡ç¼–ä»£ç ç”»å‡ºå¯¹åº”çš„æ•°æ®æµå›¾ï¼Œç”±äºæ¯”è¾ƒ cmp å’Œåˆ†æ”¯ jne æ“ä½œä¸ç›´æ¥å½±å“æ•°æ®æµã€‚å¤„ç†å™¨ä¼šä¸­çš„æŒ‡ä»¤æ§åˆ¶å•å…ƒä¼šé¢„æµ‹åˆ†æ”¯ï¼Œä½¿ç¨‹åºç»§ç»­è¿›è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æ•…æˆ‘ä»¬å¾ªç¯çš„ä¸»è¦å»¶è¿Ÿæ¥è‡ªäºä¸‰ä¸ªæ“ä½œï¼Œmulã€addã€load æ“ä½œï¼Œè€Œåœ¨è¿™äº›æ“ä½œä¹‹ä¸­ï¼Œmul æ“ä½œçš„å»¶è¿Ÿæœ€é•¿ï¼Œä¸º 3 ä¸ªæ—¶é’Ÿå‘¨æœŸï¼ˆæˆ–è€… 5 ä¸ªæ—¶é’Ÿå‘¨æœŸï¼‰ï¼Œæˆ‘ä»¬å°†å…¶è§†ä½œ &lt;strong&gt;å…³é”®è·¯å¾„ï¼ˆCritical Pathï¼‰&lt;/strong&gt;ã€‚å‰©ä½™çš„ä¸¤ä¸ªæ“ä½œå¯ä»¥è§†ä½œåœ¨ mul æ“ä½œè¿è¡Œæ—¶å¹¶è¡Œè¿›è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æ¯æ¬¡å¾ªç¯ä¸­ï¼Œload æŒ‡ä»¤ä¼šåœ¨ mul æŒ‡ä»¤å¼€å§‹å‰å°±åŠ è½½å¥½æ•°å­—ï¼Œè€Œ add æŒ‡ä»¤éœ€è¦ç­‰å¾… mul æŒ‡ä»¤å®Œæˆåæ‰èƒ½è¿›è¡ŒåŠ æ³•çš„æ“ä½œã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¯¥ç¨‹åºçš„ç†è®º CPE ç•Œé™å€¼ä¸º 3.00 æˆ–è€… 5.00ï¼Œä¹Ÿå°±æ˜¯ mul æŒ‡ä»¤çš„ CPE ç•Œé™å€¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-11&#34;&gt;å¢åŠ å¹¶è¡Œæ€§&lt;/h2&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨å¢åŠ ç´¯ç§¯æ ‡é‡çš„æ–¹å¼è¿›è¡Œå¹¶è¡Œçš„è®¡ç®—ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨ Intel å¤„ç†å™¨æœ€æ–°çš„ SSE æŒ‡ä»¤ï¼Œè¿›è¡Œ AVX å¯„å­˜å™¨æ”¯æŒçš„å‘é‡è®¡ç®—æ–¹å¼å¢åŠ å¹¶è¡Œæ€§ã€‚ï¼ˆå…·ä½“æ€ä¹ˆç”¨ä¸ä»‹ç»äº†ï¼Œå¤ªé•¿äº†ï¼‰&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šä¸¤ç§æ–¹å¼éƒ½ä¼šä½¿å¾—ç¨‹åºè¶…è¿‡ CPE å»¶è¿Ÿç•Œé™ï¼Œé€¼è¿‘ CPE ååé‡ç•Œé™ï¼Œä½†æ˜¯æ— æ³•è¶…è¶Šååç•Œé™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-12&#34;&gt;ä¸€äº›é™åˆ¶å› ç´ &lt;/h2&gt;
&lt;h4 id=&#34;heading-13&#34;&gt;å¯„å­˜å™¨æº¢å‡º&lt;/h4&gt;
&lt;p&gt;åœ¨å¢åŠ å¹¶è¡Œæ€§çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¢åŠ äº†å¾ªç¯å¯„å­˜å™¨çš„ä½¿ç”¨çš„é‡ï¼Œè€Œå‚è€ƒæœºä¸­çš„ xmm å’Œ ymm å¯„å­˜å™¨éƒ½æ˜¯åªæœ‰ 16 ä¸ªï¼Œä¸€æ—¦åœ¨å†™ç¨‹åºçš„è¿‡ç¨‹ä¸­è¶…è¿‡äº†è¯¥å€¼ï¼Œå°±ä¼šå°†å˜é‡å‚¨å­˜åœ¨ä¸´æ—¶æ ˆä¸­ï¼Œè€Œè¿™æ ·çš„æ“ä½œä¼šä½¿ CPE å€¼ç•¥å¾®ä¸Šå‡ï¼Œé€ æˆä¸å¿…è¦çš„æ€§èƒ½æŸå¤±ã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-14&#34;&gt;åˆ†æ”¯é¢„æµ‹å’Œé¢„æµ‹é”™è¯¯æƒ©ç½š&lt;/h4&gt;
&lt;p&gt;ä¸è¦è¿‡åˆ†å…³å¿ƒå¯é¢„æµ‹çš„åˆ†æ”¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¹¦å†™é€‚åˆç”¨æ¡ä»¶ä¼ é€å®ç°çš„ä»£ç ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;heading-15&#34;&gt;ç†è§£å†…å­˜æ€§èƒ½&lt;/h2&gt;</description>
    </item>
    <item>
      <title>CAN Protocol Tuturial</title>
      <link>https://xiahualiu.github.io/posts/2017-12-12-can_bus/</link>
      <pubDate>Tue, 12 Dec 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-12-12-can_bus/</guid>
      <description>&lt;p&gt;æœ¬æ–‡çš„é¦–è¦ç›®æ ‡æ˜¯å¸®åŠ©è®°å¿†ä¸€ä¸‹æœ‰å…³ CAN æ€»çº¿ä¸Šé¢çš„çŸ¥è¯†ï¼Œå¹¶ä¸”ä¹Ÿå¸®åŠ©ä¸€ä¸‹æ„Ÿå…´è¶£çš„åŒå­¦ï¼Œä»æµ…å…¥æ·±çš„äº†è§£ä¸€ä¸‹ CAN æ€»çº¿çš„ä¸€äº›çŸ¥è¯†ï¼Œç›¸æ¯”å…¶ä»–çš„æ•™ç¨‹ï¼Œæˆ‘çš„åˆè¡·æ˜¯å°†æœ¬æ–‡å†™çš„å°½é‡æ¥åœ°æ°”ï¼Œç®€å•æ˜äº†ï¼Œå› ä¸ºè‡ªå·±ä¹Ÿå•ƒè¿‡ä¸å°‘çš„æŠ€æœ¯æ–‡ç« ï¼Œä½†æ˜¯ä»ä¸€ä¸ªè¯»è€…çš„è§’åº¦ï¼Œæœ‰äº› CAN åè®®å†…å®¹ç›¸å½“æ™¦æ¶©éš¾æ‡‚ã€‚å¦‚æœæœ¬æ–‡å‡ºç°é”™è¯¯ï¼ˆè‚¯å®šæœ‰é”™è¯¯ï¼‰ï¼Œå¤§å®¶å¯ä»¥åœ¨ä¸‹è¾¹çš„è¯„è®ºæ ä¸­å›å¤å…·ä½“å†…å®¹ï¼Œä»¥ä¾¿äºæˆ‘åŠæ—¶æ›´æ”¹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;heading&#34;&gt;ç®€ä»‹&lt;/h1&gt;
&lt;p&gt;CAN åè®®å…¨ç§° Controller Area Network protocolï¼Œè‡ªä» CAN åè®®ä» 1986 å¹´è¢«æ­£å¼æ¨å‡ºåï¼Œå°±ä¸€ç›´åœ¨ä¸æ–­åœ°æ›´æ–°å…¶æ ‡å‡†ç»†èŠ‚ã€‚å®˜æ–¹çš„æ–‡çŒ® ISO11898 åªæä¾›äº†ä¸€äº›éå¸¸ç²—æµ…çš„ç›¸å…³ä¿¡æ¯ï¼Œç„¶è€Œåœ¨å·¥ä¸šç”¨é€”ä¸Šï¼ŒCAN ç½‘ç»œè¿˜æœ‰è®¸å¤šä¸æ˜¯è¢«è§„å®šè¦†ç›–çš„å†…å®¹ï¼Œéœ€è¦è‡ªå·±é’ˆå¯¹ç‰¹å®šçš„ç¯å¢ƒç†è§£ã€‚&lt;/p&gt;
&lt;h1 id=&#34;can-&#34;&gt;CAN ç½‘ç»œçš„ç»“æ„&lt;/h1&gt;
&lt;p&gt;CAN æ˜¯ä¸€ä¸ªå¤šä¸»æœºä¸²è¡Œæ€»çº¿ï¼Œåœ¨ CAN æ€»çº¿ä¸Šçš„ ECU è¢«ç§°ä½œèŠ‚ç‚¹ã€‚åœ¨ç½‘ç»œä¸Šå¿…é¡»æœ‰ä¸¤ä¸ªæˆ–è€…å¤šä¸ªèŠ‚ç‚¹æ‰èƒ½ç›¸äº’äº¤æµã€‚èŠ‚ç‚¹çš„å¤æ‚åº¦ä»ç®€å•çš„ I/O è®¾å¤‡åˆ°æ‹¥æœ‰ CAN ç•Œé¢çš„åµŒå…¥å¼ç”µè„‘ã€‚èŠ‚ç‚¹åŒæ—¶ä¹Ÿæœ‰å¯èƒ½æ˜¯ CAN ç½‘å…³ï¼Œå…è®¸ç”µè„‘é€šè¿‡ USB æˆ–è€…ä»¥å¤ªç½‘ç«¯å£è¿›è¡Œç½‘ç»œäº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½é€šè¿‡ä¸¤æ ¹çº¿ç›¸è¿æ¥ï¼Œçº¿ç¼†å¿…é¡»ä¸º 120Î© çš„æ ‡ç§°åŒç»çº¿ã€‚æ ¹æ® &lt;strong&gt;ISO 11898-2&lt;/strong&gt; æ ‡å‡†ï¼Œé«˜é€Ÿ CAN æ€»çº¿å¿…é¡»åœ¨ä¸¤æ ¹çº¿çš„æœ«ç«¯ç”¨ 120Î© çš„ç”µé˜»ç›¸äº’è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_ISO11898-2_Network.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;CAN ç½‘ç»œä¸­ï¼Œè¿™ä¸¤æ ¹çº¿çš„åç§°åˆ†ä¸ºåˆ«ï¼ŒCAN High å’Œ CAN Lowï¼Œç®€ç§°ä¸º CAN_H å’Œ CAN_Lï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æŸèŠ‚ç‚¹å‘é€ &lt;code&gt;0&lt;/code&gt; çš„çŠ¶æ€ä¸‹ï¼ŒCAN_H ä¼šè¢«è¯¥èŠ‚ç‚¹é©±åŠ¨å‘ 5Vï¼ŒCAN_L ä¼šè¢«é©±åŠ¨å‘ 0Vï¼Œç›´åˆ°ä¸¤æ ¹çº¿é—´æ‹¥æœ‰äº† 2V çš„ç”µåŠ¿å·®ï¼Œé€šå¸¸æ­¤æ—¶ CAN_H ä¸º 3.5Vï¼ŒCAN_L ä¸º 1.5Vã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ€»çº¿ç©ºé—²æˆ–è€…æŸèŠ‚ç‚¹åœ¨å‘é€ &lt;code&gt;1&lt;/code&gt; çš„çŠ¶æ€ä¸‹ï¼ŒCAN_H å’Œ CAN_L ä¸ä¼šè¢«é©±åŠ¨ï¼Œä¸¤æ ¹çº¿çš„ç”µå‹åœ¨çº¿è·¯ä¸Šç”µé˜»çš„ä½œç”¨ä¸‹ç»´æŒç›¸åŒçš„ç”µå‹ã€‚ï¼ˆé€šå¸¸æ˜¯ 2.5Vï¼‰&lt;/li&gt;
&lt;li&gt;åœ¨éšæ€§çŠ¶æ€ä¸‹çš„ç”µå‹å€¼éœ€è¦ä¿æŒåœ¨ -12~+12V ä¹‹é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/ISO11898-2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ä¸­çš„é»‘çº¿ä¸ºé€»è¾‘ç”µå¹³å€¼ï¼Œçº¢çº¿å³ä¸º CAN_H ç”µå¹³ï¼Œç»¿çº¿ä¸º CAN_L ç”µå¹³ã€‚
æˆ‘ä»¬é€šå¸¸ç§° CAN æ€»çº¿ä¸Šçš„ &lt;code&gt;0&lt;/code&gt; ä¸ºæ˜¾æ€§çš„ï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªè®¾å¤‡å‘é€äº† &lt;code&gt;0&lt;/code&gt; æ€»çº¿å³å‘ç”Ÿæ”¹å˜ï¼Œè€Œæ€»çº¿ä¸Šçš„ &lt;code&gt;1&lt;/code&gt; æ˜¯éšæ€§çš„ï¼Œ&lt;code&gt;1&lt;/code&gt; ä¿¡å·å¯ä»¥å½“åšä»€ä¹ˆä¹Ÿæ²¡å¹²ï¼Œ&lt;code&gt;0&lt;/code&gt; ä¿¡å·å¯ä»¥è¦†ç›– &lt;code&gt;1&lt;/code&gt; ä¿¡å·ã€‚éšæ€§çŠ¶æ€å¯ä»¥ä¸ºç©ºé—²çŠ¶æ€ï¼Œæˆ–è€…ä¸ºå‘é€ &lt;code&gt;1&lt;/code&gt; çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ISO 11898-3&lt;/strong&gt; è¿˜æœ‰è§„å®šäº†å¦å¤–ä¸€ç§ç±»å‹çš„ CAN æ€»çº¿ï¼Œå«åš&lt;strong&gt;ä½é€Ÿ CAN æ€»çº¿&lt;/strong&gt;ï¼Œæˆ–è€…é”™è¯¯åŒ…å®¹ CAN æ€»çº¿ï¼Œåœ¨è¿™ç§æ€»çº¿ä¸Šé¢ï¼Œå„ä¸ªèŠ‚ç‚¹åœ¨æ€»çº¿çš„ç»ˆç«¯ï¼ŒèŠ‚ç‚¹ç”µé˜»çš„å¹¶è”ç”µé˜»å³ä¸ºåŸæœ‰çš„æœ«ç«¯ç”µé˜»ï¼Œè¿™ä¸ªç”µé˜»å€¼åº”è¯¥ä¸º 100Î© å·¦å³ï¼Œä½†æ˜¯ä¸èƒ½ä½äº 100Î©ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_ISO11898-3_Network.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä½é€Ÿ CAN æ€»çº¿ä¸Šçš„ CAN_L åœ¨éšæ€§çŠ¶æ€ä¸‹å¹¶ä¸ä¸ CAN_H ç›¸åŒï¼Œç›¸åéšæ€§çŠ¶æ€ä¸‹ä¸¤æ ¹çº¿çš„ç”µå¹³ä¹‹å·®æœ€å¤§ï¼Œå…·ä½“çš„æ—¶åºå›¾è§ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/ISO11898-3_Waveform.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç§æ€»çº¿ç±»å‹ä¸‹ï¼Œæ˜¾æ€§ä½æ—¶ï¼ŒCAN_H å¿…é¡»é«˜äº CAN_L è¶…è¿‡ 2.3Vï¼ˆåœ¨ 5V çš„ VCC ä¸‹ï¼‰ï¼Œéšæ€§æ¡ä»¶æ—¶ï¼ŒCAN_H ä¸º 4.7V(VCC - 0.3V)ï¼ŒåŒç† CAN_L ä¸º 0.3V(VCC + 0.3V)ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äº CAN æ€»çº¿åœ¨éšæ€§ä½å‘æ˜¾æ€§ä½è½¬å˜çš„æ—¶å€™æ˜¯è¢«èŠ‚ç‚¹é©±åŠ¨çš„ï¼Œæ•…è¿™ç§è½¬å˜è¦å¿«äºæ˜¾æ€§ä½å‘éšæ€§ä½è½¬å˜ï¼Œåè€…æ˜¯ç”±ä¸¤æ ¹çº¿çš„ç”µæ°”ç‰¹æ€§å†³å®šçš„ï¼Œæ•…é€Ÿåº¦å’Œ CAN_Hï¼ŒCAN_L çº¿ä¹‹é—´çš„ç­‰æ•ˆç”µå®¹æœ‰å…³ï¼Œé«˜é€Ÿ CAN é€šå¸¸ç”¨äºæ±½è½¦å’Œå·¥ä¸šï¼ŒèŠ‚ç‚¹è¾ƒå°‘çš„ç¯å¢ƒä¸‹ï¼Œä½é€Ÿ CAN é€šå¸¸ç”¨äºå¤šä¸ªèŠ‚ç‚¹è¿æ¥åœ¨åŒä¸€ä½ç½®çš„æƒ…å†µä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¸¸è§çš„ CAN æ¥å£æ²¡æœ‰è¢«è§„å®šï¼Œä½ å¯ä»¥ç”¨ä»»ä½•æ¥å£ï¼Œä½†æ˜¯æœ€å¸¸è§çš„ CAN æ¥å£æ˜¯ DB9ï¼Œå…·æœ‰å››ä¸ªå¼•è„šï¼Œå…·æœ‰ä¸€ä¸ªä¾›ç”µç«¯å’Œåœ°ç«¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CAN-Low(CAN_L)&lt;/li&gt;
&lt;li&gt;GND(Ground)&lt;/li&gt;
&lt;li&gt;CAN-High(CAN_H)&lt;/li&gt;
&lt;li&gt;CAN V+(Power)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/9_pin_d-sub_connector_male_closeup.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™å°±æ˜¯æ ‡å‡†çš„ DB9 å…¬æ¥å¤´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;can--1&#34;&gt;CAN èŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;ä¸€ä¸ªæ ‡å‡†çš„ CAN èŠ‚ç‚¹åº”è¯¥æœ‰ä»¥ä¸‹çš„å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¾®å¤„ç†å™¨ MCU
&lt;ul&gt;
&lt;li&gt;å†³å®šæ¥æ”¶çš„ CAN æŠ¥æ–‡çš„å†…å®¹å’Œéœ€è¦å‘é€çš„ CAN æŠ¥æ–‡å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;ä¼ æ„Ÿå™¨å’Œå…¶ä»–ä¿¡å·è®¾å¤‡éœ€è¦è¿æ¥åœ¨å¾®å¤„ç†å™¨ä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;CAN æ§åˆ¶å™¨ï¼ˆä¸€èˆ¬ç”± MCU é›†æˆï¼‰
&lt;ul&gt;
&lt;li&gt;æŒ‰ä½æ¥æ”¶æ•°æ®ï¼Œå¹¶ä¸”å›é¦ˆç»™å¾®å¤„ç†å™¨ï¼ˆé€šå¸¸é€šè¿‡ä¸­æ–­ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æŒ‰ä½å‘é€æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;CAN æ”¶å‘å™¨ ISO 11898-2/3 Medium Access Unit [MAU] æ ‡å‡†
&lt;ul&gt;
&lt;li&gt;æ¥æ”¶ CAN æ€»çº¿ä¸Šçš„ç”µä½å€¼ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ•°å­—ä¿¡å· 1/0 é€šå¸¸å…·æœ‰ç”µè·¯ä¿æŠ¤ä½œç”¨ï¼Œé˜²æ­¢æŸå CAN æ§åˆ¶å™¨ã€‚&lt;/li&gt;
&lt;li&gt;å°†æ•°æ®æŒ‰ä½è§£ç®—æˆä¸º CAN ç”µæ°”ä¿¡å·ï¼Œå‘é€åˆ°æ€»çº¿ä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_Node.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;CAN æ€»çº¿å…·æœ‰ä¸€ä¸ªç‰¹æ€§å°±æ˜¯åªå•å‘ä»éšæ€§çŠ¶æ€é©±åŠ¨è‡³æ˜¾æ€§çŠ¶æ€ï¼Œæ¯ä¸ª CAN èŠ‚ç‚¹å°±åƒæ˜¯ä¸€ä¸ªæ‰“æ°”ç­’ä¸€æ ·ï¼ŒåªæŠŠ CAN çº¿è·¯ä» 1 æ‰“æ°”é©±åŠ¨åˆ° 0 ï¼Œç„¶åä¸é©±åŠ¨æ—¶æ€»çº¿å°±ä¼šè‡ªåŠ¨æ¼æ°”å½’ 1ï¼ˆå› ä¸ºä¸¤æ ¹çº¿æ˜¯é€šè¿‡ç”µé˜»è¿æ¥åœ¨ä¸€èµ·çš„ï¼‰ã€‚&lt;/p&gt;
&lt;h1 id=&#34;can--2&#34;&gt;CAN çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹&lt;/h1&gt;
&lt;p&gt;ä¸Šé¢è®²çš„éƒ½æ˜¯ä¸€äº›ç‰©ç†å±‚çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬åªè®¨è®ºäº† 1 å’Œ 0 çŠ¶æ€ï¼ŒCAN æ€»çº¿æ˜¯ä¸²è¡Œæ€»çº¿ï¼Œæ•°æ®å°±æ˜¯æŒ‰ç…§ä½ä¸€ä½ä¸€ä½å‘é€çš„ï¼Œä¸å…¶ä»–çš„ä¸²è¡Œåè®®ï¼ˆI2C, SPI, UARTï¼‰åŸºæœ¬ç±»ä¼¼ï¼ŒCAN åŒæ—¶ä¹Ÿæ˜¯å¼‚æ­¥é€šä¿¡åè®®ï¼Œæ²¡æœ‰åƒ SPI ä¸€æ ·æ‹¥æœ‰ä¸€æ ¹æ—¶é’Ÿçº¿ï¼Œæ‰€ä»¥ CAN ä¼ è¾“è¿‡ç¨‹ä¸­çš„æ³¢ç‰¹ç‡å¿…é¡»æ¥æ”¶æ–¹å’Œå‘é€æ–¹ä¸€è‡´æ‰å¯ä»¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;æ•°æ®å¸§&lt;/h2&gt;
&lt;p&gt;CAN å‘é€çš„æœ€å°ä¿¡æ¯å•ä½å«åšå¸§ï¼Œæˆ‘ä»¬å…ˆä»¥æœ€åŸºç¡€çš„ CAN æ•°æ®å¸§è®²è§£ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_data_frame.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œå¦‚æœä¸€ä¸ªè®¾å¤‡è¦å‘é€æ•°æ®æ—¶ï¼Œé¦–å…ˆå‘æ€»çº¿å‘é€ä¸€ä¸ªä½çš„æ˜¾æ€§ä½ï¼ˆ0ï¼‰ï¼Œæˆ‘ä»¬åˆç§° &lt;strong&gt;å¸§èµ·å§‹/SOF(Start-of-Frame)&lt;/strong&gt;ï¼Œè¿™ä¸ªæ˜¾æ€§ä½çš„ä½œç”¨æ˜¯å£°æ˜è‡ªå·±å·²ç»å æœ‰äº†æ€»çº¿ï¼Œåœ¨å‘é€æ˜¾æ€§ä½ &lt;strong&gt;ä¹‹å&lt;/strong&gt;ï¼Œå…¶ä»–çš„è®¾å¤‡å°±çŸ¥é“äº†ï¼Œå“¦ç°åœ¨æ€»çº¿æœ‰äººäº†ï¼Œä¸èƒ½å†å‘é€æ•°æ®äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯åœ¨è¿™ä¸ªæ˜¾æ€§ä½å‘é€çš„åŒæ—¶ï¼Œå·§äº†ï¼Œä¹Ÿæœ‰ä¸€ä¸ªè®¾å¤‡ä¹ŸåŒæ—¶å‘é€äº†ä¸€ä¸ª &lt;strong&gt;å¸§èµ·å§‹&lt;/strong&gt;ï¼Œè¿™å°±ä¼šå¯¼è‡´ï¼Œè¿™ä¿©è®¾å¤‡éƒ½ä»¥ä¸ºè‡ªå·±æ˜¯ç°åœ¨çš„æ€»çº¿å æœ‰è€…ï¼Œé‚£è¿™æ ·ä¸å°±ä¹±äº†ä¹ˆï¼Ÿè¿™æ—¶å°±è¦ä»‹ç»ä¸€ä¸‹ CAN çš„ä»²è£æœºåˆ¶ï¼ŒCAN é‡‡ç”¨äº†ä¸€ç§éå¸¸å·§å¦™çš„ä»²è£æœºåˆ¶ï¼Œå«åš &lt;strong&gt;æ— æŸæŒ‰ä½ä»²è£ï¼ˆLossless Bitwise Arbitrationï¼‰&lt;/strong&gt; å®ƒçš„ä½œç”¨å°±æ˜¯ä¿è¯åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè®¾å¤‡åœ¨å‘é€æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;strong&gt;å¸§èµ·å§‹&lt;/strong&gt; åï¼Œæ¥ç€æ˜¯ &lt;strong&gt;ä»²è£æ®µ(Arbitration Field)&lt;/strong&gt; ï¼Œæœ‰ä¸€ä¸ªé•¿è¾¾ 11 ä½çš„ &lt;strong&gt;CAN ID/CAN æ ‡è¯†æ®µ&lt;/strong&gt;ã€‚åœ¨è¿™æ®µï¼Œå°±å¼€å§‹äº†æ¯”è°æ›´ä¼˜å…ˆçš„æ¸¸æˆï¼Œè¿™ä¸ªæ¸¸æˆçš„ä¼˜å…ˆè§„åˆ™å°±æ˜¯ï¼Œè°å…ˆæ˜¾æ€§è°ä¼˜å…ˆã€‚è®¾å¤‡åœ¨ä»²è£æ®µå‘é€æ¯ä¸€ä½ä¼šæ—¶åˆ»æ³¨æ„ CAN æ€»çº¿çš„çŠ¶æ€ï¼Œæˆ‘ä»¬çŸ¥é“æ˜¾æ€§ä½å¯ä»¥è¦†ç›–éšæ€§ä½ï¼Œä¸€æ—¦è®¾å¤‡å®ƒè‡ªå·±å‘ç°è‡ªå·±å‘é€çš„éšæ€§ä½è¢«åˆ«çš„è®¾å¤‡è¦†ç›–æˆäº†æ˜¾æ€§äº†ï¼Œè¿™ä¸ªè®¾å¤‡å°±çŸ¥é“è‡ªå·±è¾“äº†ï¼Œå°±ä¸ä¼šç»§ç»­å‘é€æ•°æ®äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/arbitration_method.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šä¸Šå›¾ä¸­çš„ç”µå¹³ä¸ºé€»è¾‘ç”µå¹³ï¼Œ0 å¯¹åº”æˆ‘ä»¬çš„æ˜¾æ€§ä½ï¼Œ1 å¯¹åº”æˆ‘ä»¬çš„éšæ€§ä½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;strong&gt;CAN ID&lt;/strong&gt; çš„åè¾¹æ˜¯ &lt;strong&gt;RTR&lt;/strong&gt;(Remote Transmission Request) &lt;strong&gt;è¿œç¨‹è¯·æ±‚ä½&lt;/strong&gt;ï¼Œè¿™ä¸€ä½ä¹Ÿåœ¨ä¼˜å…ˆçº§çš„æ¯”èµ›å†…ï¼Œè¿™ä¸€ä½çš„ä½œç”¨å°±æ˜¯æ ‡è¯†æœ¬å¸§æ˜¯ä¸æ˜¯è¿œç¨‹å¸§ï¼Œæ•°æ®å¸§è¿™ä¸€ä½ä¸º 0ï¼›è¿œç¨‹å¸§ä¸º 1ã€‚æ‰€ä»¥å¦‚æœä¹‹å‰éƒ½æ˜¯å¹³å±€ï¼Œåœ¨è¿™ä¸€ä½åˆ°æ¥æ—¶ï¼Œæ•°æ®å¸§å°±è¦ä¼˜å…ˆäºè¿œç¨‹å¸§ï¼Œè¿œç¨‹å¸§æ˜¯æ²¡æœ‰æ•°æ®çš„å¸§å“ˆï¼ˆåè¾¹è¯¦ç»†ä»‹ç»ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°æ­¤ä¸ºæ­¢ï¼Œ&lt;strong&gt;ä»²è£æ®µ(Arbitration Field)&lt;/strong&gt; å°±å·²ç»ç»“æŸäº†ï¼ŒæˆåŠŸå æ®æ€»çº¿çš„è®¾å¤‡å°±å¼€å§‹äº†å‘é€ &lt;strong&gt;æ§åˆ¶æ®µ(Control Field)&lt;/strong&gt;ï¼Œæ§åˆ¶æ®µå†…å®¹æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;IDE(Identifier Extension Bit)&lt;/strong&gt;ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä½œ CAN æ‹“å±•å¸§ä½¿èƒ½ä½ï¼Œè¿™ä¸€ä½çš„éšæ€§ä½ä¹Ÿå³æ˜¯ 1 æ„å‘³ç€æ­¤ CAN å¸§ä¸æ˜¯æ ‡å‡†çš„ï¼Œè€Œæ˜¯æ‹“å±•çš„ï¼Œæ‹“å±•çš„ CAN å¸§å…·æœ‰ 29 ä½çš„ CAN ID è€Œä¸æ˜¯æ ‡å‡†çš„ 11 ä½ï¼ˆåè¾¹ä»‹ç»ï¼‰ï¼Œåœ¨æ ‡å‡†çš„ CAN2.0A å¸§ä¸Šæ­¤ä½ä¸º 0ï¼ŒCAN2.0B ä¹Ÿå³æ˜¯æ‹“å±•å¸§æ­¤ä½ä¸º 1ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Reserved bit&lt;/strong&gt; æ­¤ä½ä¸ºä¿ç•™ä½ï¼Œä¹Ÿå¯ä»¥ç§°ä½œ &lt;strong&gt;r1, r0&lt;/strong&gt; é€šå¸¸æƒ…å†µä¸‹ä¿ç•™ä¸€ä¸ªæ˜¾æ€§ä½ï¼Œä¹Ÿå³æ˜¯ &lt;strong&gt;r0&lt;/strong&gt;ï¼Œä½†æ˜¯æ¥æ”¶è®¾å¤‡æ¥æ”¶åˆ° &lt;strong&gt;r1&lt;/strong&gt; ä¸ä¼šè®¤ä½œé”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DLC(Data length code)&lt;/strong&gt; åç»­æ•°æ®å­—èŠ‚çš„æ•°é‡ï¼Œä¸€å…±æœ‰ 4 ä½ï¼Œä½†æ˜¯åªèƒ½ 0-8ï¼Œåœ¨ç‰©ç†ä¸Šè¡¨ç¤º 9-15 æ˜¯å¯è¡Œçš„ï¼Œä½† DLC&amp;gt;8 æ—¶è¿˜æ˜¯æŒ‰ç…§ 8 å­—èŠ‚å‘é€å’Œæ¥æ”¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°±æ˜¯æ•°æ®æ®µäº†ï¼Œé•¿åº¦ä¸å®šï¼Œæ ¹æ®æ§åˆ¶æ®µçš„ DLC å˜åŒ–ï¼Œé•¿åº¦åªèƒ½åœ¨ 0-64bits æˆ–è€… 0-8bytes ä¹‹é—´ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥æ˜¯ &lt;strong&gt;CRC æ®µ&lt;/strong&gt;ï¼Œè¿™ä¸€éƒ¨åˆ†çš„å†…å®¹ä½œä¸ºæ ¡éªŒç ï¼Œæ¥æ”¶æ–¹å¯ä»¥æ ¹æ®åœ¨æ­¤ä¹‹å‰çš„æ¥æ”¶æ•°æ®ï¼ˆä» SOF åˆ° CRC æ®µå¼€å§‹ï¼‰ä¸»åŠ¨è®¡ç®—å‡ºä¸€ä¸ª CRC ç ï¼Œç„¶åç”¨è‡ªå·±è®¡ç®—çš„ CRC å’Œè¢«åŠ¨æ¥æ”¶çš„ CRC æ¯”è¾ƒå†…å®¹ï¼Œå¦‚æœä¸ä¸€è‡´å°±è¯´æ˜ä¹‹å‰æ¥å—çš„æ•°æ®å‡ºç°é”™è¯¯ï¼Œå…·ä½“æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡ŒæŸ¥è¯¢ CRC ç®—æ³•ï¼Œå¾ˆç¥å¥‡ï¼Œåªè¦ç”¨ä¸€ä¸ªå¯„å­˜å™¨çš„ä½ç§»å°±å¯ä»¥å®ç°è®¡ç®—ã€‚æ³¨æ„åœ¨ CRC æ¥æ”¶æœ«å°¾æœ‰ä¸€ä¸ª CRC è¾¹ç•Œä½ï¼Œè¾¹ç•Œä½å¿…é¡»ä¸ºéšæ€§ä½ï¼Œæ˜¯ä¸ºäº†ç»™åè¾¹çš„åº”ç­”åšå‡†å¤‡ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥æ˜¯ &lt;strong&gt;ACK Field åº”ç­”æ®µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åº”ç­”æ§½(ACK Slot)&lt;/strong&gt;ï¼Œè¿™ä¸€ä½å‘é€æ–¹ä¼šå‘é€ä¸€ä¸ªéšæ€§ä½ï¼Œåº”ç­”æ–¹éœ€è¦å‘é€ä¸€ä¸ªä½çš„æ˜¾æ€§ä½ï¼Œè¿™æ ·å‘é€æ–¹æ‰çŸ¥é“æ•°æ®å‘é€æˆåŠŸäº†ï¼Œå’Œ I2C çš„åº”ç­”æœ‰ç‚¹ç±»ä¼¼ã€‚å¦‚æœæ¥æ”¶æ–¹æ¥æ”¶å‡ºç°é”™è¯¯ï¼Œæ¥æ”¶æ–¹å¿…é¡»ä¿æŒæ²‰é»˜ï¼Œè¿™æ ·å‘é€æ–¹ä¼šçŸ¥é“è‡ªå·±çš„å‘é€å¤±è´¥äº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœæœ‰å¾ˆå¤šæ¥æ”¶æ–¹ï¼Œå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†æ¥æ”¶å¤±è´¥äº†ï¼Œå¦ä¸€éƒ¨åˆ†æ¥æ”¶æˆåŠŸäº†å¹¶ä¸”åº”ç­”ï¼Œå‘é€æ–¹ä¾æ—§ä¼šæ£€æµ‹åˆ°åº”ç­”ï¼Œå¹¶è®¤ä¸ºè‡ªå·±å‘é€æˆåŠŸï¼Œ&lt;strong&gt;å‘é€æ–¹å¹¶ä¸çŸ¥é“åº”ç­”æ˜¯ç”±å“ªä¸€ä¸ªè®¾å¤‡å‘å‡ºçš„&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº”ç­”è¾¹ç•Œ(ACK Delimiter)&lt;/strong&gt; å› ä¸ºä¹‹å‰åº”ç­”äº†ä¸€ä½æ˜¾æ€§ä½ï¼Œè¦ä¿è¯åº”ç­”æ•°æ®ä¸å½±å“åè¾¹å‘é€çš„æ•°æ®ï¼Œå°±è¦ç­‰å¾…ä¸€ä½ä»¥ç¡®ä¿åº”ç­”ä½ä¸å› ä¸ºé”™ä½ï¼Œè€Œå½±å“åˆ°åç»­ä¿¡æ¯çš„å‘é€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ€åæ˜¯ &lt;strong&gt;å¸§ç»“æŸ/EOF(End-of-Frame)&lt;/strong&gt;ï¼Œå…¶å®å°±æ˜¯ 7 ä¸ªè¿ç»­çš„éšæ€§ä½ã€‚åœ¨å¸§ç»“æŸåï¼Œè¿˜æœ‰ä¸€ä¸ª &lt;strong&gt;å¸§é—´ç©ºç™½/IFS(Interframe Spacing)&lt;/strong&gt; ç›´æ¥ç¿»è¯‘æ˜¯å¸§ä¹‹é—´çš„ç©ºç™½ï¼ŒIFS ä¿è¯åœ¨å‰ä¸€å¸§æ•°æ®å’Œåä¸€å¸§æ•°æ®é—´è¦ä¿è¯æœ‰ 3 ä¸ªéšæ€§ä½çš„é•¿åº¦ï¼Œè¿™ä¸€æ®µç©ºç™½æ˜¯å¿…é¡»çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;æ‹“å±•å¸§&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_data_frame.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ‹“å±•å¸§ä¸­ CAN ID è¢«åˆ†ä½œä¸¤éƒ¨åˆ†ï¼Œåˆå¹¶èµ·æ¥ä¸€å…±æœ‰ 29 ä½ï¼Œå°±æ˜¯æ‹“å±•å¸§çš„ CAN IDï¼Œæ‹“å±•å¸§å¹¶ä¸æ˜¯æ•°æ®é•¿åº¦å˜é•¿äº†ï¼Œè€Œæ˜¯ CAN ID å˜é•¿äº†ï¼ŒåŸæœ‰çš„ &lt;strong&gt;RTR&lt;/strong&gt; ä½ç½®è¢« &lt;strong&gt;SRR(Substitute Remote Request)&lt;/strong&gt; å–ä»£äº†ï¼ŒSRR æ˜¯ä¸€ä¸ªå›ºå®šçš„æ˜¾æ€§ä½ï¼ŒåŸæ¥çš„ RTR è·‘åˆ° CAN ID B çš„åè¾¹å»äº†ã€‚å…·ä½“å¯ä»¥çœ‹åšæ˜¯æ ‡å‡†çš„ CAN æ›´æ¢äº†ä¸€æ®µé¢å¤–çš„ SRR å’Œå¢åŠ äº†ä¸€ä¸ª 18 ä½çš„ CAN ID B æ®µã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè¦æ‹“å±•å‘¢ï¼Œå› ä¸ºæœ‰äº›æ—¶å€™ï¼ŒCAN ID ä¹Ÿæ˜¯æœ‰ä¸€å®šä½œç”¨çš„ï¼Œè­¬å¦‚æ¥æ”¶æ–¹ä¸€èˆ¬å¹¶ä¸æ˜¯æ¥æ”¶æ‰€æœ‰çš„ CAN ä¿¡æ¯ï¼Œè€Œæ˜¯è¿‡æ»¤åªæ„Ÿå…´è¶£çš„ CAN ID å¸§ã€‚æœ‰äº›æ—¶å€™ CAN ID ä¼šè¢«åˆ†æˆä¸¤ç«¯ï¼Œä¸€æ®µæ˜¯å‘é€æ–¹çš„åœ°å€ï¼Œä¸€æ®µæ˜¯æ¥æ”¶æ–¹çš„åœ°å€ï¼Œè¿™æ ·å°±éœ€è¦æ›´é•¿çš„ CAN IDï¼Œä½†æ˜¯ CAN ID å¤ªé•¿çš„è¯ï¼Œæ•°æ®å‘é€çš„æ•ˆç‡å°±ä¼šå˜ä½ï¼ˆæ‹“å±•å¸§å¸§ä¸€å…± 100 å¤šä½ï¼Œæœ€å¤šåªæœ‰ 60 ä½æ•°æ®ï¼‰ï¼Œæ‰€ä»¥æ‹“å±•å¸§ä½œä¸ºä¸€ç§é€‰æ‹©äº§ç”Ÿäº†ï¼Œä»¥æ»¡è¶³æŸäº›ç‰¹æ®Šéœ€è¦ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œä¸æ˜¯æ‰€æœ‰çš„ CAN ç½‘ç»œå‡æ”¯æŒæ‹“å±•å¸§ï¼Œåªæœ‰æ”¯æŒ CAN2.0B æ ‡å‡†çš„ CAN ç½‘ç»œæ‰æ”¯æŒæ‹“å±•å¸§ï¼Œä»…æ”¯æŒ CAN2.0A æ ‡å‡†çš„ CAN ç½‘ç»œåªèƒ½ä½¿ç”¨æ ‡å‡†æ•°æ®å¸§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-3&#34;&gt;è¿œç¨‹å¸§&lt;/h2&gt;
&lt;p&gt;è¿œç¨‹å¸§è‹±æ–‡åŸæ„ï¼Œæ˜¯è¿œç¨‹è¯·æ±‚å¸§ï¼Œé¡¾åæ€ä¹‰ï¼Œå‘é€æ­¤å¸§çš„è®¾å¤‡è¯·æ±‚å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹å‘é€æ•°æ®ã€‚è¿œç¨‹å¸§ä¸åŒ…å«æ•°æ®æ®µï¼Œä½†æ˜¯ä¾æ—§æœ‰ DLC æ®µï¼ŒDLC ä¸ºè¯·æ±‚çš„æ•°æ®å­—èŠ‚æ•°ã€‚åœ¨è¿œç¨‹å¸§åï¼Œä¸€èˆ¬ä¼šè·Ÿéšç€ä¸€ä¸ªæ•°æ®å¸§ï¼Œç”±å“åº”çš„èŠ‚ç‚¹å‘é€ã€‚&lt;/p&gt;
&lt;p&gt;è¿œç¨‹å¸§çš„ç»“æ„ä¸æ ‡å‡†çš„æ•°æ®å¸§æˆ–è€…æ‹“å±•çš„æ•°æ®å¸§åŸºæœ¬ä¸€è‡´ï¼Œåªæœ‰ä¸€ä¸ªåŒºåˆ«å°±æ˜¯æ²¡æœ‰æ•°æ®æ®µï¼Œåœ¨ DLC åç´§è·Ÿç€çš„å°±æ˜¯ CRC æ®µã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-4&#34;&gt;é”™è¯¯å¸§&lt;/h2&gt;
&lt;p&gt;é”™è¯¯å¸§å’Œä¸Šè¿°çš„ CAN å¸§ä¸åŒï¼Œé”™è¯¯å¸§æœ‰ä¸¤ä¸ªä½æ®µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å åŠ çš„é”™è¯¯æ ‡å¿—ï¼ˆ6-12bitsï¼‰æ®µï¼Œç”±å„ä¸ªè®¾å¤‡å‘é€çš„é”™è¯¯å åŠ è€Œæˆã€‚&lt;/li&gt;
&lt;li&gt;é”™è¯¯è¾¹ç•Œæ®µï¼Œç”± 8 ä¸ªéšæ€§ä½ç»„æˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é”™è¯¯æ ‡å¿—åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š&lt;/p&gt;
&lt;h4 id=&#34;heading-5&#34;&gt;ä¸»åŠ¨é”™è¯¯æ ‡å¿—&lt;/h4&gt;
&lt;p&gt;ç”± 6 ä¸ªæ˜¾æ€§ä½ç»„æˆï¼Œç”±è¢«æ£€æµ‹åˆ°é”™è¯¯çš„èŠ‚ç‚¹ï¼ˆå¤„äºä¸»åŠ¨é”™è¯¯çŠ¶æ€ï¼‰å‘é€ã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-6&#34;&gt;è¢«åŠ¨é”™è¯¯æ ‡å¿—&lt;/h4&gt;
&lt;p&gt;ç”± 6 ä¸ªéšæ€§ä½ç»„æˆï¼Œç”±è¢«æ£€æµ‹åˆ°é”™è¯¯çš„èŠ‚ç‚¹ï¼ˆå¤„äºè¢«åŠ¨é”™è¯¯çŠ¶æ€ï¼‰å‘é€ã€‚&lt;/p&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯ä¸»åŠ¨é”™è¯¯çŠ¶æ€å’Œè¢«åŠ¨é”™è¯¯çŠ¶æ€å‘¢ï¼Ÿè¿™ä¸ªå’Œ CAN ç½‘ç»œä¸­çš„é”™è¯¯è®¡æ•°å™¨æœ‰å…³ï¼Œæ¯ä¸ª CAN èŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªè®¡æ•°å™¨ï¼Œä¸€ä¸ªæ˜¯ &lt;strong&gt;å‘é€é”™è¯¯è®¡æ•°å™¨(TEC)&lt;/strong&gt;ï¼Œä¸€ä¸ªæ˜¯ &lt;strong&gt;æ¥æ”¶é”™è¯¯è®¡æ•°å™¨(REC)&lt;/strong&gt;ï¼Œå½“èŠ‚ç‚¹çš„é”™è¯¯è®¡æ•°å€¼ä¸åŒæ—¶ï¼ŒèŠ‚ç‚¹ä¼šè¿›å…¥ä¸åŒçš„è®¡æ•°çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ TEC æˆ–è€… REC å°äº 128ï¼ŒèŠ‚ç‚¹å¤„äºä¸»åŠ¨é”™è¯¯çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;å½“ TEC æˆ–è€… REC å¤§äº 127 å¹¶ä¸”å°äº 255ï¼ŒèŠ‚ç‚¹è¿›å…¥è¢«åŠ¨é”™è¯¯çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;å½“ TEC å¤§äº 255ï¼ŒèŠ‚ç‚¹è¿›å…¥ Bus Off çŠ¶æ€ï¼Œä¸å†å‘é€æ¥æ”¶ä»»ä½•å¸§ï¼Œä¸å¯¹æ€»çº¿æœ‰ä»»ä½•å½±å“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é”™è¯¯å¸§åªä¼šåœ¨ CAN æ€»çº¿æ­£åœ¨å‘é€çš„æ—¶å€™æ‰èƒ½äº§ç”Ÿï¼Œä¹Ÿå°±æ˜¯è¯´ä¸»åŠ¨é”™è¯¯ä¼šç›´æ¥æ‰“æ–­å½“å‰å‘é€çš„æ•°æ®ï¼Œè¢«åŠ¨é”™è¯¯æ ‡å¿—ä¸ä¼šæ‰“æ–­æ€»çº¿çš„ä¼ è¾“ã€‚é”™è¯¯è®¡æ•°å™¨çš„ç´¯åŠ å’Œå¾ˆå¤šç§æƒ…å†µæœ‰å…³ï¼Œä½†æ˜¯è§„åˆ™å¾ˆç®€å•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘é€é”™è¯¯ä¼šå¯¼è‡´ TEC åŠ  8&lt;/li&gt;
&lt;li&gt;æ¥æ”¶é”™è¯¯ä¼šå¯¼è‡´ REC åŠ  1&lt;/li&gt;
&lt;li&gt;æ­£ç¡®çš„å‘é€å’Œæ¥å—ä¼šä½¿ TEC å’Œ REC é€’å‡æˆ–è€…æ¸… 0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;CAN æ§åˆ¶å™¨ä¸€èˆ¬ä¼šæä¾›ä¸€ä¸ªå¼•è„šæ¥åé¦ˆé”™è¯¯ï¼Œé€šå¸¸æ˜¯ç»è¿‡ä¸­æ–­æ–¹å¼é€šçŸ¥ MCU è¯¥èŠ‚ç‚¹è¿›å…¥äº† Bus Off çŠ¶æ€æˆ–è€…æ£€æµ‹åˆ°é”™è¯¯ï¼Œä½†æ˜¯æœ‰äº›èŠ¯ç‰‡ä¼šæä¾›å®Œå…¨çš„é”™è¯¯æ§åˆ¶ï¼Œè­¬å¦‚æœ€å¸¸è§çš„ Philips SJA1000ã€‚&lt;/p&gt;
&lt;p&gt;åº”è¯¥çŸ¥é“çš„æ˜¯ï¼Œé”™è¯¯çš„ç§ç±»æœ‰å“ªäº›å‘¢ï¼Ÿ
CAN ä¸€å…±æä¾›äº†ä¸å°‘äº 5 ç§çš„é”™è¯¯æ£€æµ‹æ–¹å¼ï¼Œå‰ä¸¤ç§å·¥ä½œåœ¨ç‰©ç†å±‚å±‚é¢ï¼Œå 3 ç§å·¥ä½œåœ¨ä¿¡æ¯å±‚ã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-7&#34;&gt;ä½é”™è¯¯&lt;/h4&gt;
&lt;p&gt;å‘é€æ–¹ç‹¬æœ‰é”™è¯¯ï¼ŒæŸä¸ªèŠ‚ç‚¹åœ¨æ€»çº¿ä¸Šå‘é€æ•°æ®çš„æ—¶å€™æ˜¯æŒ‰ä½å‘é€çš„ï¼ŒèŠ‚ç‚¹ä¼šè‡ªåŠ¨åœ¨å‘é€åï¼Œä¹Ÿåƒæ¥æ”¶æ–¹ä¸€æ ·å¯¹æ€»çº¿ä¸Šçš„çŠ¶æ€é‡‡æ ·ï¼Œä¸€æ—¦å‘ç°å’Œè‡ªå·±çš„å‘é€æ‰€éœ€çŠ¶æ€ä¸åŒï¼Œå³æˆ‘å‘çš„æ•°å’Œæ€»çº¿ä¸Šçš„ä¸ä¸€æ ·ï¼Œï¼ˆä¸¾ä¸ªä¾‹å­ï¼šæˆ‘å‘çš„éšæ€§ä½ï¼Œæˆ‘å‘å®Œä¸€æ£€æµ‹ï¼Œæ€»çº¿ä¸Šå´æ˜¯ä¸€ä¸ªæ˜¾æ€§ä½ï¼Œé”™è¯¯äº§ç”Ÿï¼‰å°±æ˜¯äº§ç”Ÿäº†ä¸€ä¸ªä½é”™è¯¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-8&#34;&gt;ä½å¡«å……é”™è¯¯&lt;/h4&gt;
&lt;p&gt;åœ¨è¿™ä¸ªåœ°æ–¹éœ€è¦ä»‹ç»ä¸€ä¸‹ CAN ç½‘ç»œä¸­çš„ä¸€ä¸ªç‰¹æœ‰çš„ç‰¹æ€§ï¼Œå°±æ˜¯ &lt;strong&gt;ä½å¡«å……(Bit stuffing)&lt;/strong&gt; ä¸åŒäºä¸€èˆ¬çš„å¼‚æ­¥æ€»çº¿ï¼ŒCAN æ€»çº¿éœ€è¦è¿ç»­å‘é€å¾ˆé•¿çš„ä¸€ä¸²ä½æµï¼Œè¿™å°±ä¼šå¯¼è‡´åœ¨è¿ç»­å‘é€åŒä¸€çŠ¶æ€å€¼ï¼ˆ0 æˆ– 1ï¼‰æ—¶çš„æ—¶é—´é”™ä½ç´¯åŠ ï¼Œè¿™ç§é”™ä½ä¸èƒ½åœ¨æ¥æ”¶æ–¹è¢«æ£€æµ‹åˆ°ï¼Œè¿™æ ·å¾ˆæœ‰å¯èƒ½å‘é€å’Œæ¥æ”¶æ—¶å‡ºç°é”™ä½çŠ¶æ€ï¼Œæ‰€ä»¥ CAN å®šä¹‰äº†å¦‚æœæ€»çº¿ä¸Šæœ‰&lt;strong&gt;è¿ç»­ 5 ä¸ª&lt;/strong&gt;çš„ 0 æˆ–è€… 1 æ—¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç›¸åææ€§çš„ä½å¡«å……åœ¨åè¾¹ï¼Œä¹Ÿç›¸å½“äºä¸€ä¸ªè¾¹ç•Œï¼Œé˜²æ­¢è¿ç»­è¿‡é•¿ç›¸åŒä½å‡ºç°ï¼Œä¸¾ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;11111000011110000&amp;hellip;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨ä¼ è¾“æ—¶ï¼Œå…¶å®æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;11111&lt;strong&gt;0&lt;/strong&gt;0000&lt;strong&gt;1&lt;/strong&gt;1111&lt;strong&gt;0&lt;/strong&gt;0000&lt;strong&gt;1&lt;/strong&gt;&amp;hellip;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ª 0 è¢«å¡«å……åï¼Œå¯¼è‡´åç»­çš„æ•°æ®å‡ºç°äº† 5 ä¸ªè¿ç»­ç›¸åŒçŠ¶æ€ï¼Œæ‰€ä»¥åˆäº§ç”Ÿäº†ä¸€è¿ä¸²ä½å¡«å……ã€‚&lt;/p&gt;
&lt;p&gt;ä½å¡«å……åœ¨æ¥æ”¶çš„æ—¶å€™ä¼šè¢«ç¡¬ä»¶å¿½è§†ï¼Œä½†æ˜¯ç¡¬ä»¶åŒæ—¶ä¼šæ£€æµ‹æœ‰æ— å¡«å……ï¼Œå¦‚æœ 5 ä¸ªè¿ç»­ç›¸åŒä½åè¿˜æ˜¯ç›¸åŒä½ï¼ŒèŠ‚ç‚¹ä¼šè®¤ä¸ºäº§ç”Ÿäº†ä½å¡«å……é”™è¯¯ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½æ˜¯åˆ«çš„èŠ‚ç‚¹äº§ç”Ÿäº†ä¸»åŠ¨é”™è¯¯å¸§ï¼Œæ— è®ºæ˜¯å“ªä¸ªï¼Œéƒ½ä¼šä½¿æ€»çº¿ä¸Šçš„æ•°æ®ä¼ è¾“æŒ‚èµ·ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼ŒCAN ç½‘ç»œåœ¨ CRC æ®µæ—¶æ˜¯æ²¡æœ‰ä½å¡«å……çš„ï¼Œåœ¨è¿™é‡Œä¸ä¼šäº§ç”Ÿä½å¡«å……é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;ä½å¡«å……é”™è¯¯ä¹Ÿä¼šåœ¨ä¸»åŠ¨é”™è¯¯æ ‡å¿—äº§ç”Ÿæ—¶äº§ç”Ÿï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰æ£€æµ‹åˆ°é”™è¯¯ï¼ŒåŒæ—¶åˆ«çš„èŠ‚ç‚¹å‘å‡ºä¸»åŠ¨é”™è¯¯æ ‡å¿—å¸§ï¼Œåˆ™è¯¥èŠ‚ç‚¹å°±ä¼šæ£€æµ‹åˆ°ä½å¡«å……é”™è¯¯ï¼ŒåŒæ—¶äº§ç”Ÿé”™è¯¯ï¼Œå®ç°æ€»çº¿ä¸Šè®¾å¤‡é”™è¯¯åŒæ­¥ï¼Œä¿è¯äº§ç”Ÿé”™è¯¯çš„å¸§ä¸è¢«æ‰€æœ‰è®¾å¤‡æ¥æ”¶ã€‚&lt;/p&gt;
&lt;h4 id=&#34;crc-&#34;&gt;CRC é”™è¯¯&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªä¸ç”¨å¤šè¯´äº†ï¼Œæ˜¯æ¥æ”¶æ–¹äº§ç”Ÿçš„é”™è¯¯ï¼ŒCRC æ ¡éªŒä¸ç¬¦ï¼Œè¯´æ˜è¯¥å¸§ä¹‹å‰æ¥æ”¶çš„æ•°æ®ä¸å¯é ã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-9&#34;&gt;åº”ç­”é”™è¯¯&lt;/h4&gt;
&lt;p&gt;å‘é€æ–¹ç‹¬æœ‰é”™è¯¯ï¼Œæ£€æµ‹åˆ°åº”ç­”ä½ä¸ºéšæ€§ï¼Œä¹Ÿå³æ— åº”ç­”ã€‚ï¼ˆCAN æ€»çº¿ä¸èƒ½åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™ä¼šæ— é™äº§ç”Ÿåº”ç­”é”™è¯¯ï¼‰&lt;/p&gt;
&lt;h4 id=&#34;heading-10&#34;&gt;æ ¼å¼é”™è¯¯&lt;/h4&gt;
&lt;p&gt;æ¥æ”¶çš„æ•°æ®å¸§æ²¡æœ‰æŒ‰ç…§æ ‡å‡†çš„æ ¼å¼ï¼Œè­¬å¦‚ CRC è¾¹ç•Œä½æˆ–è€… ACK è¾¹ç•Œä½ä¸æ˜¯éšæ€§ï¼ŒEOF æ®µå‡ºç°äº†æ˜¾æ€§ä½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;heading-11&#34;&gt;é”™è¯¯åŒæ­¥&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸Šäº”ç§é”™è¯¯éƒ½ä¼šä½¿ä¸»åŠ¨çŠ¶æ€ä¸‹çš„èŠ‚ç‚¹è§¦å‘ä¸»åŠ¨é”™è¯¯æ ‡å¿—ï¼Œè¿ç»­çš„ 6 ä¸ªä¸»åŠ¨é”™è¯¯æ ‡å¿—ä¼šç›´æ¥è¦†ç›–æ¯æ‰æ•°æ®çš„å‘é€ï¼Œè¿™æ—¶å¦‚æœå…¶ä½™èŠ‚ç‚¹æ²¡æœ‰æ£€æµ‹åˆ°é”™è¯¯æ—¶ä¹Ÿä¼šç”±äºä¸»åŠ¨é”™è¯¯æ ‡å¿—çš„ç ´åè€Œæ£€æµ‹åˆ°ä½å¡«å……é”™è¯¯ï¼Œè¿™æ ·æ‰€æœ‰çš„è®¾å¤‡éƒ½ä¼šåŒæ—¶æ£€æµ‹åˆ°é”™è¯¯è€Œä¸¢å¼ƒä¹‹å‰çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;é”™è¯¯å¸§ä¸å…¶è¯´æ˜¯ä¸€ä¸ªå¸§ï¼Œä¸å¦‚è¯´æ˜¯å¾ˆå¤šé”™è¯¯å¸§çš„å åŠ ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_error_frame.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;bus-failure-modes&#34;&gt;*æ€»çº¿å¤±è´¥é”™è¯¯(Bus Failure Modes)&lt;/h4&gt;
&lt;p&gt;è¿™ç§é”™è¯¯æ˜¯ç‰©ç†å±‚é”™è¯¯ï¼Œå¹¶ä¸åœ¨ä¸Šåˆ—é”™è¯¯ä¹‹ä¸­ï¼Œä½†æ˜¯ä¹Ÿè¦çŸ¥é“ï¼Œå¦‚æœ CAN çº¿è·¯ä¸ç¬¦åˆ ISO è¦æ±‚çš„ç”µæ°”æ ‡å‡†æ—¶ä¼šäº§ç”Ÿè¯¥é”™è¯¯ï¼Œåœ¨ ISO 11898 ä¸­è§„å®šäº†ä»¥ä¸‹çš„æ€»çº¿å¤±è´¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;CAN_H æ–­è·¯&lt;/li&gt;
&lt;li&gt;CAN_L æ–­è·¯&lt;/li&gt;
&lt;li&gt;CAN_H å’Œç”µæ± æ­£æçŸ­è·¯&lt;/li&gt;
&lt;li&gt;CAN_L å’Œåœ°çŸ­è·¯&lt;/li&gt;
&lt;li&gt;CAN_H å’Œåœ°çŸ­è·¯&lt;/li&gt;
&lt;li&gt;CAN_L å’Œç”µæ± æ­£æçŸ­è·¯&lt;/li&gt;
&lt;li&gt;CAN_L å’Œ CAN_H çŸ­è·¯&lt;/li&gt;
&lt;li&gt;CAN_L å’Œ CAN_H åŒåœ°ç‚¹æ–­è·¯&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹æ— æ³•è¿æ¥æ€»çº¿&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨å®é™…ç¯å¢ƒä¸‹ï¼ŒæŸäº›é”™è¯¯åŒ…å®¹å‹ CAN æ”¶å‘å™¨ï¼ˆè­¬å¦‚ TJA1053ï¼‰å¯ä»¥å¤„ç†ä»¥ä¸Šçš„æ‰€æœ‰æ€»çº¿å¤±è´¥ï¼Œä½†æ˜¯å…¶æ•°æ®é€Ÿåº¦ä¼šå—åˆ°å½±å“ï¼ˆ125bits/s)ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-12&#34;&gt;è¿‡è½½å¸§&lt;/h2&gt;
&lt;p&gt;åœ¨è¿‡å»ï¼Œå½“è®¾å¤‡çš„æ€§èƒ½ä¸æ˜¯å¾ˆå¥½çš„æ—¶å€™ï¼ŒCAN æ€»çº¿ä½œä¸ºä¸€ä¸ªé«˜é€Ÿæ€»çº¿ï¼Œæœ‰äº›èŠ‚ç‚¹è¿˜ååçˆ±ä¸€è¿ä¸²å‘æ•°æ®å¸§ï¼Œç›¸é‚»ä¸¤å¸§é—´åªæœ‰ 3 ä½çš„ IFS å¸§é—´ç©ºç™½æ—¶é—´å†…ä¾›å…¶ä½™èŠ‚ç‚¹å¤„ç†æ•°æ®ï¼Œæœ‰äº›èŠ‚ç‚¹çš„æ•°æ®å¤„ç†èƒ½åŠ›è¾ƒå·®ï¼Œéœ€è¦å»¶é•¿ IFS æ—¶é—´ï¼Œè¿‡è½½å¸§å› æ­¤è€Œç”Ÿï¼Œè¿‡è½½å¸§ç”±ä¸¤æ®µç»„æˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å åŠ çš„è¿‡è½½æ ‡å¿—ï¼ˆ6-7bitsï¼‰æ®µï¼Œä¸ºæ˜¾æ€§ï¼Œç”±å„ä¸ªè®¾å¤‡å‘é€çš„è¿‡è½½æ ‡å¿—å åŠ è€Œæˆã€‚&lt;/li&gt;
&lt;li&gt;è¿‡è½½è¾¹ç•Œæ®µï¼Œç”± 8 ä¸ªéšæ€§ä½ç»„æˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ä¸ªå¸§å¾ˆç¥å¥‡ï¼Œæ€ä¹ˆç¥å¥‡å‘¢ï¼Œå®ƒæ ¼å¼è·Ÿä¸»åŠ¨é”™è¯¯å¸§éƒ½ä¸€æ¨¡ä¸€æ ·ï¼Œç”šè‡³ä¹Ÿæœ‰åŒæ­¥çš„ä½œç”¨ï¼Œï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹å’Œé”™è¯¯å¸§ä¸åŒï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿‡è½½å¸§åœ¨å¸§é—´ç©ºç™½ IFS æ®µå†…ç¬¬ä¸€ä½å¼€å§‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªè®¾å¤‡ä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹å‘é€è¿‡è½½å¸§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”±äºè®¾å¤‡å†…éƒ¨çŠ¶æ€éœ€è¦æ€»çº¿å»¶è¿Ÿä¸‹ä¸€å¸§çš„æ•°æ®å‘é€ï¼Œåœ¨ IFS æ®µç¬¬ä¸€ä½å¼€å§‹äº§ç”Ÿè¿‡è½½æ ‡å¿—ã€‚&lt;/li&gt;
&lt;li&gt;æŸè®¾å¤‡æ£€æµ‹åˆ° IFS æ®µå†…æœ‰æ˜¾æ€§ä½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ç¬¬äºŒä¸ªå‘é€è¿‡è½½å¸§çš„æ¡ä»¶ä½¿æ€»çº¿ä¸Šæ‰€æœ‰çš„è¿‡è½½å¸§éƒ½ä¼šåŒæ­¥ï¼Œæ²¡æœ‰å‘é€è¿‡è½½å¸§çš„èŠ‚ç‚¹ä¼šå› ä¸ºæ£€æµ‹åˆ°è¿‡è½½å¸§è€Œäº§ç”Ÿè¿‡è½½å¸§ã€‚&lt;/p&gt;
&lt;p&gt;è¿‡è½½å¸§ä¸æ˜¯é”™è¯¯å¸§ï¼Œä¸ä¼šå¯¼è‡´å†…éƒ¨çš„é”™è¯¯è®¡æ•°å™¨ç´¯åŠ ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_overload_frame.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿‡è½½å¸§å°†ä¼šä½¿ä¸‹ä¸€å¸§çš„å‘é€æ—¶é—´æ¨è¿Ÿï¼Œå…·ä½“æ¨è¿Ÿå¤šå°‘ï¼Œå‘é€èŠ‚ç‚¹æ ¹æ®è§„å®šè‡ªè¡Œé€‰æ‹©ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°æ­¤ä¸ºæ­¢ï¼Œæ‰€æœ‰çš„ CAN è§„å®šçš„å¸§éƒ½å·²ç»ä»‹ç»å®Œæ¯•äº†ï¼Œåˆ°è¿™é‡Œå·²ç»åŸºæœ¬ä¸Šå¯ä»¥è¯´äº†è§£äº† CAN çš„åŸºæœ¬å†…å®¹äº†ï¼Œä½†æ˜¯è¿˜æœ‰äº›ç»†èŠ‚ï¼Œè¿™äº›ç»†èŠ‚ä¸å½±å“ä½¿ç”¨ CANï¼Œä½†æ˜¯äº†è§£ä¸€äº›ä¹Ÿä¼šæœ‰å¥½å¤„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-13&#34;&gt;ä½æ—¶é—´åˆ†é…&lt;/h2&gt;
&lt;p&gt;CAN åœ¨ä¼ è¾“æ¯ä¸€ä½çš„æ—¶å€™ï¼Œåœ¨è¿™ä¸€ä½çš„æ—¶é—´å†…ï¼Œä¼šåšä¸€ç³»åˆ—çš„äº‹æƒ…ï¼Œå¹¶ä¸æ˜¯å‘é€å°±å®Œäº‹äº†ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒCAN èŠ‚ç‚¹åœ¨å‘é€æ•°æ®çš„åŒæ—¶è¿˜ä¼šæœ‰æ£€éªŒä½é”™è¯¯ï¼Œåœ¨ä»€ä¹ˆæ—¶å€™æ£€æµ‹ï¼Ÿåœ¨æ¥æ”¶çš„æ—¶å€™è¿˜è¦æœ‰ä½æ—¶é—´çš„æ ¡å‡†é˜²æ­¢é”™ä½ï¼Œå¦‚ä½•è‡ªåŠ¨æ ¡å‡†ï¼Ÿæ¥æ”¶æ–¹åœ¨ä»€ä¹ˆæ—¶åˆ»é‡‡æ ·æ•è·æ€»çº¿ä¸Šçš„çŠ¶æ€ï¼Ÿè¿™ä¸€éƒ¨åˆ†çš„åŠŸèƒ½éƒ½åœ¨ä½æ—¶é—´å†…è¡¨ç°å‡ºæ¥ï¼š&lt;/p&gt;
&lt;p&gt;CAN æ€»çº¿æ¯ä¸€ä½çš„æ—¶é—´ï¼Œéƒ½å¯ä»¥åˆ†æˆä»¥ä¸‹çš„å‡ ä¸ªéƒ¨åˆ†ï¼Œåœ¨ä¸åŒçš„éƒ¨åˆ†å†…ï¼ŒCAN æ§åˆ¶å™¨ä¼šåšä¸åŒçš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_bit_time.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªä½çš„æ—¶é—´å…¶å®å¯ä»¥è¢«åˆ†æˆæ›´å°çš„ 10 å°ä»½æ—¶é—´ï¼Œå…¶ä¸­ç¬¬ä¸€å°ä»½æ˜¯ &lt;strong&gt;SYNCHRONIZATION&lt;/strong&gt; éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯åŒæ­¥éƒ¨åˆ†ï¼Œè¿™ä¸€éƒ¨åˆ†ä¸»è¦ç”¨äºæ•è·ä»éšæ€§ä½åˆ°æ˜¾æ€§ä½çš„è·³å˜æ²¿ã€‚&lt;/p&gt;
&lt;h4 id=&#34;hard-synchronization--&#34;&gt;HARD SYNCHRONIZATION  ç¡¬åŒæ­¥&lt;/h4&gt;
&lt;p&gt;åœ¨æ¯ä¸ª CAN å¸§ä¼ è¾“çš„å¼€å¤´ï¼Œæˆ‘ä»¬çŸ¥é“æœ‰ä¸€ä½çš„ SOF å¸§èµ·å§‹ï¼Œä»æ€»çº¿ç©ºé—²çŠ¶æ€çš„éšæ€§ï¼Œå‘æ˜¾æ€§ä½è·³å˜ä¸€æ¬¡ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ€»çº¿ä¸Šæ‰€æœ‰çš„è®¾å¤‡è¿›å…¥äº† HARD SYNCHRONIZATION çŠ¶æ€ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ•è·åˆ°è·³å˜åï¼Œéƒ½å°†è¿™ä¸ªè·³å˜çš„æ—¶åˆ»å®šä¹‰åœ¨ç¬¬ä¸€ä½çš„ SYNCHRONIZATION å†…ï¼Œå®ç° CAN å¸§å¼€å§‹çš„åŒæ­¥ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ CAN æ²¡æœ‰ä¸€æ ¹æ—¶é’ŸåŒæ­¥çº¿ï¼Œæ‰€ä»¥ CAN æ€»çº¿ç©ºé—²çš„æ—¶å€™ï¼Œæ˜¯å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å‘èµ·ä¼ è¾“çš„ï¼Œè¿™ä¸ªç¡¬ä»¶åŒæ­¥ç¡®ä¿äº†ä¼ è¾“å‘èµ·æ—¶çš„åŒæ­¥æ€§ï¼Œå³æ‰€æœ‰è®¾å¤‡åœ¨ç¬¬ä¸€ä¸ªéš-&amp;gt;æ˜¾è·³å˜æ²¿åŒæ­¥ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒä¸ªé˜¶æ®µæ˜¯ &lt;strong&gt;Propagation Segment&lt;/strong&gt; éƒ¨åˆ†ï¼Œè¿™ä¸€éƒ¨åˆ†å’Œåç»­çš„ &lt;strong&gt;Phase 1 Segment(ç›¸ä½ç¼“å†² 1)&lt;/strong&gt; å’Œ &lt;strong&gt;Phase 2 Segment(ç›¸ä½ç¼“å†² 2)&lt;/strong&gt; éƒ½æ˜¯å¯ä»¥æ›´æ”¹çš„ï¼Œåœ¨è¿™é‡Œçš„é•¿åº¦åªæ˜¯ä¸€èˆ¬æƒ…å†µä¸‹çš„é•¿åº¦ 3 3 3 å¹³å‡åˆ†å¸ƒã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-14&#34;&gt;ä½åŒæ­¥&lt;/h4&gt;
&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯æ¬¡éšæ€§åˆ°æ˜¾æ€§çš„è·³å˜æ²¿éƒ½åœ¨å¼€å§‹çš„ SYNC æ®µå†…è¢«æ•è·ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¹¶ä¸ä¼šè§¦å‘ä½åŒæ­¥ï¼Œè€Œä¸€æ—¦æ£€æµ‹åˆ°éš-&amp;gt;æ˜¾è·³å˜æ²¿è¶…å‡º SYNC èŒƒå›´ï¼Œè­¬å¦‚æå‰åˆ°å‰ä¸€å¸§çš„ Phase 2 ä¸­æˆ–è€…æ¨è¿Ÿåˆ° SYNC åçš„ Propagation Segment æ®µå†…ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘ä½åŒæ­¥åŠŸèƒ½ï¼Œè¿™æ—¶ CAN ä¼šè‡ªåŠ¨è°ƒæ•´ Phase 1 Segment(ç›¸ä½ç¼“å†² 1) æˆ–è€… Phase 2 Segment(ç›¸ä½ç¼“å†² 2) çš„é•¿åº¦ï¼Œä»¥ä½¿ä¸‹ä¸€æ¬¡è·³å˜æ²¿åœ¨ SYNC æ®µå†…æ•è·ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼š
&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_sync1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæ¥æ”¶æ–¹å‘ç°è‡ªå·±ç›¸ä½é å‰äº†ï¼Œéš-&amp;gt;æ˜¾è·³è¾¹æ²¿åˆ° Prop æ®µäº†ï¼Œå°±ä¼šè‡ªåŠ¨åœ¨ Phase 1 ç¼“å†²ä¸­å¢åŠ è¿™ä¸ªé å‰çš„æ—¶é•¿ï¼Œè¿™æ ·å½“é‡‡æ ·çš„æ—¶å€™ï¼Œæ¥æ”¶æ–¹å’Œå‘é€æ–¹å·²ç»åšåˆ°äº†åŒæ­¥ï¼Œå¢åŠ çš„è¿™ä¸ªæ—¶é•¿ä½¿å¾—æ¥æ”¶æ–¹çš„æ­¤ä½æ—¶é—´é•¿äº†ä¸€ä¸ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-12-CAN_Bus/CAN_sync2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæ¥æ”¶æ–¹å‰ä¸€ä½è¿˜æœªç»“æŸï¼Œåœ¨ Phase 2 ç¼“å†²åŒºå†…å°±æ£€æµ‹åˆ°äº†éš-&amp;gt;æ˜¾è·³å˜ï¼Œåˆ™æ¥æ”¶æ–¹æ­¤æ—¶å¼ºåˆ¶è¿›å…¥ä¸‹ä¸€ä½çš„ SYNC çŠ¶æ€ï¼Œè¿™å¯¼è‡´äº†ä¸Šä¸€ä½çš„æ¥æ”¶æ—¶é—´ç¨å¾®çŸ­äº†ä¸€ç‚¹ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ SYNC æ®µåªèƒ½æ•è·éš-&amp;gt;æ˜¾è·³å˜ï¼Œæ˜¾-&amp;gt;éšè·³å˜ç”±äºæ—¶é—´ä¸€èˆ¬è¾ƒé•¿ï¼Œä¸ä¼šè§†ä½œä½åŒæ­¥çš„ä¾æ®ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°æ­¤ä¸ºæ­¢ï¼Œæ–‡ç« å†…å®¹å°±å·²ç»å…¨éƒ¨ç»“æŸäº†ï¼Œå¦‚æœæœ‰ä»€ä¹ˆç–‘é—®æˆ–è€…æœ¬æ–‡æœ‰ä»€ä¹ˆé”™è¯¯å¯ä»¥ç›´æ¥åœ¨ä¸‹æ–¹ç•™è¨€ï¼Œæ„Ÿè°¢æ‚¨çš„äº¤æµï¼&lt;/p&gt;
&lt;h3 id=&#34;heading-15&#34;&gt;è¯¾åä¹ é¢˜ï¼š&lt;/h3&gt;
&lt;p&gt;å“ˆï¼Œè¿˜æœ‰è¯¾åä¹ é¢˜ï¼Ÿè¯¾åä¹ é¢˜æ˜¯ä¸€ç§åé¦ˆï¼Œåœ¨å­¦ä¹ ä¸­éå¸¸é‡è¦ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;DLC ä¸º 0 çš„æ•°æ®å¸§å’Œè¿œç¨‹å¸§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;DLC ä¸º 0 çš„æ•°æ®å¸§æ²¡æœ‰æ•°æ®æ®µï¼Œè™½ç„¶è¿œç¨‹å¸§ä¹Ÿæ²¡æœ‰æ•°æ®æ®µï¼Œä½†æ˜¯è¿œç¨‹å¸§çš„ DLC ä¸€èˆ¬éƒ½ä¸ç­‰äº 0ï¼Œåœ¨è¿œç¨‹å¸§ä¸­ï¼ŒDLC å¯¹åº”çš„æ˜¯è¯·æ±‚çš„æ•°æ®å¸§çš„æ•°æ®æ®µé•¿åº¦ã€‚å½“ç„¶è¿˜æœ‰ RTR ä½ä¸¤è€…çš„åŒºåˆ«ï¼Œåœ¨ä»²è£çš„æ—¶å€™ï¼Œè¿œç¨‹å¸§å’Œæ•°æ®å¸§åœ¨ CAN ID ä¼˜å…ˆçº§ç›¸åŒçš„æ¡ä»¶ä¸‹ç”±äº RTR ä½æ•°æ®å¸§ä¸º 0 æ‰€ä»¥ä¼˜å…ˆäºè¿œç¨‹å¸§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</description>
    </item>
    <item>
      <title>Deep Understanding of C pointers</title>
      <link>https://xiahualiu.github.io/posts/2017-12-07-c-pointer/</link>
      <pubDate>Thu, 07 Dec 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-12-07-c-pointer/</guid>
      <description>&lt;p&gt;åœ¨ C è¯­è¨€ä¸­ï¼Œè¦è¯´ä»€ä¹ˆæ¦‚å¿µæœ€éš¾ç†è§£ï¼Œé‚£æŒ‡é’ˆå½“ä»ä¸è®©å¤„äºç¬¬ä¸€çš„ä½ç½®ï¼Œåˆå­¦è€…å¯¹äºæŒ‡é’ˆæ˜¯å«è‹¦ä¸å ªï¼Œå³ä½¿æ˜¯ç†Ÿç»ƒåœ°ç¨‹åºå‘˜åœ¨å†™ç¨‹åºçš„æ—¶å€™ï¼Œå¤æ‚çš„æŒ‡é’ˆä¹Ÿä¼šä½¿ç¨‹åºçš„å¯è¯»æ€§å¤§å¤§é™ä½ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æŒ‡é’ˆåˆæ˜¯ C è¯­è¨€çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œä½¿ç”¨æŒ‡é’ˆå¯ä»¥ä½¿ç¼–ç¨‹æ›´åŠ å®¹æ˜“ã€‚è€Œä¸”æœ‰äº›ä»»åŠ¡ï¼Œè­¬å¦‚åŠ¨æ€å†…å­˜åˆ†é…ï¼Œå¦‚ &lt;code&gt;malloc&lt;/code&gt; &lt;code&gt;calloc&lt;/code&gt; &lt;code&gt;realloc&lt;/code&gt; å‡½æ•°çš„ä½¿ç”¨åˆå¿…é¡»ä¾èµ–æŒ‡é’ˆï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦æˆä¸ºä¸€ä¸ªç†Ÿç»ƒçš„ C ç¨‹åºå‘˜ï¼Œç†è§£ç†Ÿç»ƒä½¿ç”¨æŒ‡é’ˆæ˜¯éå¸¸å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading&#34;&gt;ä»€ä¹ˆæ˜¯æŒ‡é’ˆ&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆï¼Œåœ¨ç¨‹åºè¿è¡Œä¸­ï¼Œå˜é‡éƒ½æ˜¯å­˜åœ¨è®¡ç®—æœºçš„å†…å­˜ä¸­çš„ã€‚æŒ‡é’ˆæ˜¯ä¸€ç§å˜é‡ï¼Œå®ƒçš„å€¼æ˜¯&lt;strong&gt;å¦å¤–ä¸€ä¸ªå˜é‡çš„åœ°å€&lt;/strong&gt;ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥çš„å†…å­˜åœ°å€ï¼Œåœ¨ 32 ä½ç³»ç»Ÿä¸­ï¼ŒæŒ‡é’ˆçš„å¤§å°ä¸º 4 å­—èŠ‚ï¼ˆåœ¨è¿œå¤æ—¶æœŸçš„è¿œæŒ‡é’ˆï¼Œè¿‘æŒ‡é’ˆï¼Œå·¨æŒ‡é’ˆï¼Œç­‰ä¸å‚åŠ è®¨è®ºï¼‰ï¼Œå¾ˆå¥½ç†è§£ï¼Œä¸€ä¸ªå­—èŠ‚é•¿åº¦ä¸º 8 bitsï¼Œ4 bytes = 32 bitsï¼Œå¦‚æœåœ¨æœ€æ–°çš„ 64 ä½ç³»ç»Ÿä¸­ç¼–è¯‘å¹¶ä¸”è¿è¡Œçš„è¯ï¼ŒæŒ‡é’ˆä¼šå˜æˆ 8 å­—èŠ‚çš„é•¿åº¦ï¼Œå› ä¸ºå¯¹åº”çš„åœ°å€ä½å®½å¢åŠ äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œä»¥ä¸‹çš„å†…å®¹å°±å¯ä»¥å‘ç°, æ‰“å°çš„æ˜¯ 8 ä¸ª 16 è¿›åˆ¶çš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ 4 ä¸ªå­—èŠ‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt; () {

   &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;  var1;
   &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; var2[&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;];

   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Address of var1 variable: %x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;var1  );
   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Address of var2 variable: %x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;var2  );

   &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$gcc -o main *.c
$main
Address of var1 variable: 9f98435c
Address of var2 variable: 9f984352
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ä¸Šè¾¹çš„ä¾‹å­ä¸­ï¼Œ&lt;code&gt;var1&lt;/code&gt; å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒå†…éƒ¨å­˜æœ‰ä¸€ä¸ª &lt;code&gt;int&lt;/code&gt; å‹å˜é‡çš„åœ°å€ï¼Œ è€Œ &lt;code&gt;var2&lt;/code&gt; å­˜ç€ä¸€ä¸ª &lt;code&gt;char[10]&lt;/code&gt; æ•°ç»„çš„åœ°å€ã€‚åœ¨å¹³å¸¸æè¿°ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ã€&lt;strong&gt;æŒ‡å‘&lt;/strong&gt;ã€è¿™ä¸ªåŠ¨è¯æ¥æè¿°æŒ‡é’ˆä¸å¯¹åº”å˜é‡çš„å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥è¯´ &lt;code&gt;var1&lt;/code&gt; æŒ‡é’ˆæŒ‡å‘æŸä¸ªï¼ˆå› ä¸ºè¿˜æœªå®šä¹‰å“ªä¸ªï¼‰ &lt;code&gt;int&lt;/code&gt; å‹çš„å˜é‡ã€‚é€šè¿‡è¿™ä¸ªä¾‹å­çš„æ‰“å°ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡æŒ‡é’ˆæŒ‡å‘ä»€ä¹ˆç±»å‹çš„å˜é‡ï¼Œå®ƒçš„æœ¬èº«é•¿åº¦ï¼Œå§‹ç»ˆéƒ½æ˜¯å›ºå®šçš„å€¼ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º 4bytesï¼Œä¸åŒæŒ‡é’ˆå”¯ä¸€çš„ä¸åŒå°±æ˜¯æŒ‡é’ˆå˜é‡å†…éƒ¨å­˜çš„å€¼çš„ä¸åŒï¼Œä¹Ÿå³æ˜¯æŒ‡é’ˆæ‰€å¯¹åº”çš„åœ°å€ä¸åŒã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-1&#34;&gt;å¦‚ä½•ä½¿ç”¨æŒ‡é’ˆ&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;æŒ‡é’ˆçš„æ“ä½œç¬¦å¾ˆå°‘ï¼Œåªæœ‰ &lt;code&gt;&amp;amp;&lt;/code&gt; &lt;code&gt;*&lt;/code&gt; ä¸¤ç§ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;amp;&lt;/code&gt; æ˜¯å¼•ç”¨ç¬¦å·ï¼Œå¯¹ä¸€ä¸ªæ™®é€šçš„å˜é‡ï¼Œæ•°ç»„ï¼Œç»“æ„ï¼Œç­‰ç±»å‹ä½¿ç”¨å¯ä»¥å–å¾—å…¶åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;*&lt;/code&gt; æ˜¯è§£é™¤å¼•ç”¨ç¬¦å·ï¼Œå¯¹äºæŒ‡é’ˆä½¿ç”¨å¯ä»¥è¿”å›å…¶æŒ‡å‘çš„å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt; () {
   &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;  var &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;;   &lt;span style=&#34;color:#75715e&#34;&gt;/* æ•´å½¢å˜é‡å£°æ˜å®šä¹‰ */&lt;/span&gt;
   &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ip;        &lt;span style=&#34;color:#75715e&#34;&gt;/* æŒ‡é’ˆå£°æ˜ */&lt;/span&gt;
   ip &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;var;  &lt;span style=&#34;color:#75715e&#34;&gt;/* å°† var å˜é‡çš„å€¼èµ‹ç»™ ip*/&lt;/span&gt;

   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;var çš„åœ°å€æ˜¯: %x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;var  );
   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ip ä¸­å‚¨å­˜çš„åœ°å€æ˜¯: %x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, ip );
   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;åŸæœ¬ *ip çš„å€¼æ˜¯: %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ip );
   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;åŸæœ¬ var çš„å€¼æ˜¯: %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, var );

   &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ip&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;;

   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;*ip ç°åœ¨çš„å€¼æ˜¯: %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ip );
   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;var ç°åœ¨çš„å€¼æ˜¯: %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, var );
   &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœ:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$gcc -o main *.c
$main
var çš„åœ°å€æ˜¯: f977beb4
ip ä¸­å‚¨å­˜çš„åœ°å€æ˜¯: f977beb4
åŸæœ¬ *ip çš„å€¼æ˜¯: &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;
åŸæœ¬ var çš„å€¼æ˜¯: &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;
*ip ç°åœ¨çš„å€¼æ˜¯: &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
var ç°åœ¨çš„å€¼æ˜¯: &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä¿®æ”¹ &lt;code&gt;*ip&lt;/code&gt; çš„å€¼çš„æ—¶å€™ï¼Œ &lt;code&gt;var&lt;/code&gt; æ•´å½¢å˜é‡çš„å€¼ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ˜¯é€šè¿‡ &lt;code&gt;ip&lt;/code&gt; è¿™ä¸ªæŒ‡é’ˆä¿®æ”¹çš„ï¼Œç¨‹åºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆä¸­çš„åœ°å€æ‰¾åˆ°äº†å¯¹åº”çš„å†…å­˜ï¼ˆvar æ‰€åœ¨ï¼‰ï¼Œç„¶åå°†è¿™æ®µå†…å­˜ä¿®æ”¹æˆä¸ºäº† 10 ï¼Œè¿™ä¸ªè¿‡ç¨‹ç›¸å½“äºç›´æ¥ä¿®æ”¹äº†åœ¨å†…å­˜ä¸­ &lt;code&gt;var&lt;/code&gt; å¯¹åº”çš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯·ä¸è¦ç›´æ¥å°†å˜é‡çš„å€¼ç›´æ¥èµ‹å€¼ç»™æŒ‡é’ˆæœ¬èº«ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é”™è¯¯ç”¨æ³•ï¼š&lt;code&gt;ip = (int)10;&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;warning: assignment makes pointer from integer without a cast &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;-Wint-conversion&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
    ip&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;int&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;10;
      ^
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŒ‡é’ˆå˜é‡çš„ç±»å‹å’Œä¸€èˆ¬çš„å˜é‡ä¸åŒï¼Œç›´æ¥è¿™æ ·èµ‹å€¼ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼Œè€Œä¸”è¿™ç§æ“ä½œæ¯«æ— æ„ä¹‰ã€‚&lt;/p&gt;
&lt;p&gt;æŒ‡é’ˆæ˜¯å¯ä»¥èµ‹ç»™å¦å¤–ä¸€ä¸ªæŒ‡é’ˆçš„ï¼Œè¿™æ ·ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘äº†åŒä¸€ä¸ªåœ°æ–¹ï¼Œä½†æ˜¯è¿™ç§ä¸€ä¸ªåœ°å€å¯¹åº”ä¸¤ä¸ªæŒ‡é’ˆçš„æ“ä½œåœ¨æŸç§æ„ä¹‰ä¸Šæ˜¯æ¯”è¾ƒå±é™©çš„ï¼Œå› ä¸ºè¿™æ ·å¯¹åº”çš„å€¼å¾ˆæœ‰å¯èƒ½è¢«è¯¯ä¿®æ”¹ï¼Œæˆ–è€…å†…å­˜è¢«é‡Šæ”¾åå¯¼è‡´&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E8%BF%B7%E9%80%94%E6%8C%87%E9%92%88&#34;&gt;è¿·é€”æŒ‡é’ˆ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;null-&#34;&gt;NULL æŒ‡é’ˆ&lt;/h2&gt;
&lt;p&gt;åˆå&lt;strong&gt;ç©ºæŒ‡é’ˆ&lt;/strong&gt;ï¼ŒæŒ‡é’ˆå†…çš„å€¼ä¸º NULLï¼ŒæŒ‡é’ˆè¿˜æ²¡æœ‰åˆ†é…æŒ‡å‘çš„å®ä½“ï¼ŒNULL æŒ‡é’ˆä¼šå‡ºç°åœ¨æŒ‡é’ˆçš„å£°æ˜æ—¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç¬¬ä¸€ä¸ªä¾‹å­ä¸­çš„ä¸¤ä¸ªæŒ‡é’ˆï¼Œåªå£°æ˜äº†å¯¹åº”çš„ç±»å‹ï¼Œæ²¡æœ‰å®é™…èµ‹äºˆå…¶åœ°å€ï¼Œåˆç§°æ²¡æœ‰è¢«åˆå§‹åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;ç©ºæŒ‡é’ˆä¸­çš„å€¼æ˜¯ 4 ä¸ªå­—èŠ‚çš„ 0ï¼Œè€Œåœ¨è®¡ç®—æœºç³»ç»Ÿç»“æ„ä¸­ï¼Œ0 åœ°å€çš„å†…å­˜ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯è¢«ä¿ç•™ç»™æ“ä½œç³»ç»Ÿè¿è¡Œçš„ï¼Œé‡Œé¢å·²ç»æœ‰äº†ä¸€äº›æ“ä½œç³»ç»Ÿè¿è¡Œä¸­æ‰€éœ€è¦çš„å€¼ï¼Œæ‰€ä»¥åˆ©ç”¨ NULL æŒ‡é’ˆä¿®æ”¹å¯¹åº”çš„å†…å­˜çš„è¯ï¼Œåæœå¯æƒ³è€ŒçŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³ç©ºæŒ‡é’ˆçš„åŠæ³•å°±æ˜¯åœ¨æŒ‡é’ˆå£°æ˜åï¼Œè¿›è¡Œèµ‹å€¼ï¼Œå°†æŒ‡é’ˆå˜æˆä¸€ä¸ªæŒ‡å‘å›ºå®šåœ°å€çš„å˜é‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;æŒ‡é’ˆè¿ç®—&lt;/h2&gt;
&lt;p&gt;æŒ‡é’ˆçš„è¿ç®—ç¬¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;++&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;+&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬ä¸»è¦å°± +/- è¿ç®—è¿›è¡Œè®²è§£ï¼Œå› ä¸º ++/&amp;ndash; ä¸å°±æ˜¯ +1/-1 ä¹ˆã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ª int å‹å˜é‡ï¼ˆ4 å­—èŠ‚é•¿åº¦ï¼‰ï¼Œè¯·åœ¨è„‘ä¸­æ„æ€è¿™ä¸ªåˆ›å»ºæŒ‡é’ˆå’Œå®šä¹‰çš„è¿‡ç¨‹ï¼Œç„¶åæˆ‘ä»¬å¯¹è¿™ä¸ªæŒ‡é’ˆåŠ  1ã€‚&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Šï¼ŒæŒ‡é’ˆå†…éƒ¨çš„åœ°å€å¹¶ä¸æ˜¯ç®€å•çš„åŠ  1ï¼Œè€Œæ˜¯åŠ äº† 4ï¼Œä¹Ÿå°±æ˜¯åœ¨å†…å­˜ä¸­ç§»åŠ¨åˆ°äº† 4 ä¸ªå­—èŠ‚åçš„ä¸‹ä¸€ä¸ª int å˜é‡ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªç‰¹æ€§ä½¿å¾—æˆ‘ä»¬ä¸ç”¨å»æ³¨æ„ä¸€äº›éå¸¸åº•å±‚çš„æ¦‚å¿µï¼Œæœ€æ™®éçš„ä½¿ç”¨åœ°ç‚¹å°±æ˜¯åœ¨ä¸€ä¸²åŒç±»æ•°æ®ä¸­åˆ‡æ¢æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åœ¨æ•°ç»„ä¸­ä½¿ç”¨æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨è¿™ä¸ªçš„è¿‡ç¨‹ä¸­ï¼Œè¯·ä¿è¯è‡ªå·±ä¸ä¼šå°†æŒ‡é’ˆç§»åŠ¨åˆ°æœªå£°æ˜çš„å†…å­˜ç©ºé—´ä¸­ï¼Œè­¬å¦‚ä¸Šè¿°å•ä¸ª int å˜é‡çš„æŒ‡é’ˆåç§»ï¼Œå¦åˆ™å°†æœ‰å¤§å‡ ç‡æŸåå…¶ä»–å˜é‡æ•°æ®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; MAX &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;;

&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt; () {

   &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;  var[] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;};
   &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;  i, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ptr;
    
   ptr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; var;

   &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ( i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; MAX; i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;) {

      printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;var[%d] åœ°å€ = %x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, i, ptr );
      printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;var[%d] å€¼ = %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, i, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ptr );

      ptr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ptr&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;      &lt;span style=&#34;color:#75715e&#34;&gt;//ç­‰äº ptr++
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;   }
	
   &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœ:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$gcc -o main *.c
$main
var&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;0&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; åœ°å€ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 220fe454
var&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;0&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; å€¼ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
var&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;1&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; åœ°å€ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 220fe458
var&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;1&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; å€¼ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;
var&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;2&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; åœ°å€ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 220fe45c
var&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;2&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; å€¼ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°åœ°å€æ¯æ¬¡å¢åŠ çš„å€¼æ˜¯ 4ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœä½ ä»”ç»†è¯»ä»£ç åˆ™ä¼šå‘ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å¦‚ä¸‹çš„ä»£ç &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;   ptr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; var;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è€Œåœ¨ç¼–è¯‘è¿è¡Œçš„è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰é”™è¯¯äº§ç”Ÿï¼Œè¿™æ˜¯åº”ä¸ºå®ƒæœ¬èº«å°±æ²¡æœ‰é”™è¯¯ï¼Œåœ¨ c è¯­è¨€ä¸­ï¼Œæ•°ç»„çš„åå­—ä¼šè¢«å½“åšä¸€ä¸ªæŒ‡é’ˆå¤„ç†ï¼Œå…¶ä¸­çš„ var å¯ä»¥è¢«çœ‹åš &lt;code&gt;int * const var_name = &amp;amp;var[0];&lt;/code&gt; ä¸­çš„ &lt;code&gt;var_name&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°ç»„åå…¶å®æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè€Œå®ƒå¯¹åº”çš„åœ°å€å°±æ˜¯ var[0] çš„åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºè¿™æ˜¯ä¸€ä¸ªå¸¸é‡æŒ‡é’ˆï¼Œå…¶ç‰¹ç‚¹æ˜¯æŒ‡é’ˆå†…çš„åœ°å€ä¸å¯ä»¥å˜åŠ¨ï¼Œä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªæŒ‡é’ˆä¸èƒ½å¤ŸæŒ‡å‘å…¶ä»–çš„ int å˜é‡äº†ã€‚ä¹Ÿå°±æ˜¯:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; var_name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;var[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;];
var_name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ˜¯é”™è¯¯çš„:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;error: assignment of read-only variable â€˜var_nameâ€™
    var_name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;int *&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;10;
             ^
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘è¯•äº†ç›´æ¥ç»™ var = å¦å¤–çš„æŒ‡é’ˆï¼Œä½†æ˜¯æ˜¾ç¤ºé”™è¯¯ä¸æ˜¯è¿™ä¸ªï¼Œæ˜¾ç¤ºçš„æ˜¯ &lt;code&gt;error: assignment to expression with array type&lt;/code&gt; ï¼Œä½†æ˜¯åŸç†æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ç§æ•°ç»„ï¼Œå«åšå­—ç¬¦æ•°ç»„ï¼Œå…¶ä¸»è¦å½¢å¼æ˜¯ä»¥ä¸‹å½¢å¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; ch[&lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;hello world&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;};
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å¥è¯ï¼Œå®šä¹‰äº†ä¸€ä¸ªå…·æœ‰ 20 ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œå…ƒç´ çš„ç±»å‹ä¸º char å‹ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦å‹ï¼Œæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ hï¼Œç¬¬äºŒä¸ªæ˜¯ eï¼Œæ•°ç»„è¢«ä¾æ¬¡å¡«å…¥&amp;quot;hello world\0&amp;rdquo;ï¼Œå…¶ä¸­ &lt;code&gt;\0&lt;/code&gt; ä¸ºç»ˆæ­¢ç¬¦ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ C è¯­è¨€ä¸­ï¼Œ&amp;ldquo;hello world&amp;rdquo; è¿™æ ·çš„å­—ç¬¦ä¸²å…¶å®æœ¬è´¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å­—ç¬¦ä¸²å¼€å¤´çš„åœ°å€ã€‚åœ¨èµ‹å€¼æˆ–è€…æ‰“å°çš„æ—¶å€™ï¼ŒC è¯­è¨€ä¼šä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆè‡ªåŠ¨çš„å°†å­—ç¬¦ä¸²ä»å¤´è¯»å–åˆ°ç»ˆæ­¢ç¬¦ã€‚&lt;/p&gt;
&lt;p&gt;ä»ä¸‹è¾¹è¿™ä¸ªä¾‹å­æ¥è§£é‡Šï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; MAX &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;;

&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt; () {

   &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ptr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Hello world&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;;
   printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,ptr);

   &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœæ˜¯æ‰“å°äº† Hello worldï¼Œåœ¨è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨å­—ç¬¦ä¸²ç»™ä¸€ä¸ªæŒ‡é’ˆèµ‹å€¼äº†ï¼Œä½†æ˜¯ç¼–è¯‘å™¨å¹¶æ²¡æœ‰æŠ¥é”™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-3&#34;&gt;äºŒçº§æŒ‡é’ˆ&lt;/h2&gt;
&lt;p&gt;å› ä¸ºæŒ‡é’ˆæ˜¯ä¸€ä¸ªå˜é‡ï¼Œæ•…å…¶åœ¨å†…å­˜ä¸­ä¹Ÿæœ‰ä¸€ä¸ªå‚¨å­˜çš„åœ°å€ï¼Œè€Œè¿™ä¸ªåœ°å€å¯ä»¥èµ‹å€¼ç»™å¦å¤–ä¸€ä¸ªæŒ‡é’ˆã€‚å½“ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¦å¤–ä¸€ä¸ªæŒ‡é’ˆçš„æ—¶å€™ï¼Œæ­¤æŒ‡é’ˆå°±æ˜¯äºŒçº§æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;p&gt;äºŒçº§æŒ‡é’ˆçš„å£°æ˜å¦‚ä¸‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;var;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœä½ è§‰å¾—ä¹‹å‰çš„å†…å®¹å¾ˆç®€å•ï¼ŒæŒ‡é’ˆç°åœ¨çš„ææ€–ä¹‹å¤„æ‰ä½“ç°å‡ºæ¥ï¼Œå¯¹äºäºŒçº§æŒ‡é’ˆçš„è§£é™¤å¼•ç”¨ &lt;code&gt;*&lt;/code&gt; ä¸€æ¬¡ä¹‹åè¿˜æ˜¯æŒ‡é’ˆï¼Œåªæœ‰è§£é™¤ä¸¤æ¬¡ä¹‹åæ‰èƒ½æˆä¸ºçœŸæ­£çš„æŒ‡å‘çš„æ•°å€¼å˜é‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-4&#34;&gt;å‡½æ•°æŒ‡é’ˆ&lt;/h2&gt;
&lt;p&gt;åœ¨ C è¯­è¨€ä¸­ï¼Œå‡½æ•°æŒ‡é’ˆä¸€ç›´å°±æ˜¯ä¸€ä¸ªå¾ˆç¥å¥‡çš„ä¸œè¥¿ï¼Œå› ä¸ºå®ƒæœ‰å¾ˆå¤šè¿åå¸¸è§„çš„è®¾å®šï¼Œå‡½æ•°å…¶å®å’Œå˜é‡ä¸€æ ·ï¼Œéƒ½å‚¨å­˜åœ¨å†…å­˜ä¸­ï¼Œåªä¸è¿‡è¿™éƒ¨åˆ†å†…å­˜å­˜çš„æ˜¯ä¸€äº›å‘½ä»¤è€Œä¸æ˜¯å€¼ï¼Œå‡½æ•°åå°±åƒæ˜¯æ•°ç»„åä¸€æ ·å¯¹åº”ç€å®ƒçš„å…¥å£åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å‡½æ•°ï¼Œè¿™æ ·æŒ‡é’ˆå°±èƒ½ä»£è¡¨å‡½æ•°äº†ã€‚&lt;/p&gt;
&lt;p&gt;å‡½æ•°æŒ‡é’ˆå’Œæ™®é€šæŒ‡é’ˆä¸åŒçš„æ˜¯ï¼Œå‡½æ•°æŒ‡é’ˆå£°æ˜çš„æ˜¯å‡½æ•°çš„&lt;strong&gt;è¿”å›å€¼&lt;/strong&gt;å’Œ&lt;strong&gt;å‚æ•°&lt;/strong&gt;ï¼Œè€Œä¸æ˜¯ä»…ä»…å˜é‡ç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;è­¬å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;p)(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å£°æ˜äº†è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å…·æœ‰ int è¿”å›å€¼å’Œ const char * ï¼ˆåœ¨ C ä¸­é‡åˆ°å®ƒï¼Œ99% å¯¹åº”å­—ç¬¦ä¸²ï¼‰çš„å‚æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;string_print&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;s){
    printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,s);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(){

    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; a;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;p)(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;);
    
    p&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;string_print;

    a&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;string_print(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;WINNER WINNER CHIKEN DINNER!&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
    a&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;p(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;WINNER WINNER CHIKEN DINNER!&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);

    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$gcc -o main *.c
$main
WINNER WINNER CHIKEN DINNER!
WINNER WINNER CHIKEN DINNER!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ‹ï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å‡½æ•°åï¼Œç”¨æŒ‡é’ˆåå°±å¯ä»¥ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå¦‚æœæœ‰å¾ˆå¤šå‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿è¡Œçš„æ—¶å€™åŠ¨æ€çš„è°ƒç”¨ä¸åŒçš„å‡½æ•°äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çœ¼ç›å¤Ÿå°–ï¼Œæˆ–è€…ä½ è®¤çœŸçœ‹äº†æˆ‘ä¸Šé¢çš„æ‰€æœ‰å†…å®¹çš„è¯ï¼Œä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘è¿™ä¸ªåœ°æ–¹ç»™æŒ‡é’ˆèµ‹å€¼ç”¨çš„æ˜¯:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;    p&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;string_print;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‡½æ•°åä¸å°±æ˜¯åœ°å€ä¹ˆï¼Ÿå†å–åœ°å€ä¸å°±æ˜¯äºŒçº§æŒ‡é’ˆäº†ä¹ˆï¼Ÿä½ æƒ³çš„ä¸é”™ï¼Œè¿™ä¸ªåœ°æ–¹å…¶å®è¯´æ˜äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœå‡½æ•°åæ˜¯åœ°å€çš„è¯ï¼Œæˆ‘ä»¬è°ƒç”¨å°±è¦ç”¨ &lt;code&gt;*&lt;/code&gt; æ¥è§£é™¤å¼•ç”¨åæ‰èƒ½å£°æ˜å’Œå®šä¹‰å‡½æ•°ï¼Œä½†æ˜¯ C ä¸ºäº†ä½¿å¤§å®¶ä½¿ç”¨æ–¹ä¾¿å°±å»æ‰äº†å‡½æ•°è°ƒç”¨å®šä¹‰æ—¶åŠ  &lt;code&gt;*&lt;/code&gt; çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨å‡½æ•°åå…¶å®å°±å·²ç»æ˜¯è§£é™¤å¼•ç”¨åçš„åœ°å€äº†ï¼Œè¿™æ ·è¯´å¯èƒ½çœ‹èµ·æ¥æ¯”è¾ƒéš¾å—ï¼Œå…¶å®ï¼Œ&lt;code&gt;p=&amp;amp;string_print;&lt;/code&gt; å’Œ &lt;code&gt;p=string_print;&lt;/code&gt; è¿™ä¸¤å¥è¯åœ¨è¿™é‡Œæ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œå“ˆå“ˆï¼Œä¸ä¿¡ä½ è¯•è¯•ï¼Œè¾“å‡ºç»“æœå®Œå…¨ä¸€æ ·ï¼Œç¼–è¯‘ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚ä¹Ÿå°±æ˜¯è¯´å‡½æ•°åæ—¢å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªå®é™…çš„å®ä½“ï¼Œä¹Ÿå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªåœ°å€ï¼Œä½†æ˜¯åœ¨å®šä¹‰ä»¥åŠå£°æ˜å‡½æ•°çš„æ—¶å€™ï¼Œä¸èƒ½å®šä¹‰å‡½æ•°åå‰é¢åŠ  &lt;code&gt;*&lt;/code&gt;ï¼Œå› ä¸ºè¿™æ ·å°±å˜æˆå‡½æ•°æŒ‡é’ˆäº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;string_print)(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;s){
    printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,s);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ˜¯é”™è¯¯çš„ï¼Œæ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œå› ä¸ºè¿™æ ·çš„ &lt;code&gt;string_print&lt;/code&gt; å°±æ˜¯å‡½æ•°æŒ‡é’ˆäº†å“¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-5&#34;&gt;æŒ‡é’ˆç»“åˆ&lt;/h2&gt;
&lt;p&gt;åˆ°æ­¤ä¸ºæ­¢ï¼Œä¸€èˆ¬çš„æŒ‡é’ˆç±»å‹éƒ½å·²ç»ä»‹ç»å®Œæ¯•äº†ï¼Œä½†æ˜¯è¿™ä»…ä»…æ˜¯æŒ‡é’ˆçš„åŸºç¡€çŸ¥è¯†ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€äº›æ›´åŠ å¤æ‚çš„æŒ‡é’ˆç±»å‹ï¼Œè­¬å¦‚æˆ‘æƒ³è®© &lt;code&gt;p&lt;/code&gt; æ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œåœ¨æ•°ç»„ä¸­çš„å…ƒç´ å‡ä¸ºæŒ‡å‘ &lt;code&gt;int&lt;/code&gt; çš„æŒ‡é’ˆã€‚é‚£è¿™ä¸ªæŒ‡é’ˆè¯¥æ€ä¹ˆå£°æ˜å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä»‹ç»äº†å‡½æ•°æŒ‡é’ˆï¼Œåœ¨ä¸Šä¸ªç« èŠ‚ï¼Œæœ‰äººä¼šå‘ç°æˆ‘åœ¨å£°æ˜æŒ‡é’ˆæ—¶ï¼Œç”¨å°æ‹¬å·åœˆèµ·æ¥äº†æŒ‡é’ˆï¼ˆ&lt;code&gt;int (*p)(const char *);&lt;/code&gt;ï¼‰,å¯èƒ½ä½ ä¼šæƒ³ä¸ºä»€ä¹ˆè¦å¤šæ¬¡ä¸€ä¸¾çš„åŠ ä¸Šä¸€ä¸ªæ‹¬å·å‘¢ï¼Œè¿™ä¸ªåœ°æ–¹å°±ç‰µæ¶‰åˆ°äº†æŒ‡é’ˆä¸­è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§çš„é—®é¢˜ã€‚ï¼ˆè¿™ä¸ªæ‹¬å·æ˜¯å¿…é¡»çš„ï¼Œæ²¡æœ‰å°±ä¸æ˜¯å‡½æ•°æŒ‡é’ˆäº†ï¼Œè€Œæ˜¯è¿”å›æŒ‡é’ˆçš„å‡½æ•°äº†ï¼‰&lt;/p&gt;
&lt;p&gt;åœ¨å­¦ä¹ æŒ‡é’ˆç»“åˆçš„å¼€å§‹ï¼Œæˆ‘ä»¬è¦é¦–å…ˆäº†è§£ C è¯­è¨€ä¸­çš„è¿ç®—ç¬¦çš„ç»“åˆä¼˜å…ˆçº§ï¼ŒæŒ‡é’ˆç»“åˆçš„ä¼˜å…ˆçº§ä½¿ç”¨ C è¯­è¨€ä¸­è§„å®šçš„è¿ç®—ç¬¦ä¼˜å…ˆçº§ã€‚&lt;/p&gt;
&lt;p&gt;å‚é˜…&lt;a href=&#34;http://zh.cppreference.com/w/cpp/language/operator_precedence&#34;&gt;C++ è¿ç®—ç¬¦ä¼˜å…ˆçº§&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¤§æ¦‚æµè§ˆä¸€ä¸‹å°±å¯ä»¥å’¯ï¼Œä¸‹é¢è®©æˆ‘ä»¬å…ˆä»ç®€å•çš„ç±»å‹å¼€å§‹æ…¢æ…¢åˆ†æå§:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;int ptr;&lt;/code&gt; è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•´å‹å˜é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int *ptr;&lt;/code&gt; ä» ptr å¤„å¼€å§‹ï¼Œå…ˆä¸ * ç»“åˆï¼Œè¯´æ˜ ptr æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œç„¶åå†ä¸ int ç»“åˆï¼Œè¯´æ˜æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å®¹çš„ç±»å‹ä¸º int å‹ã€‚æ‰€ä»¥ ptr æ˜¯ä¸€ä¸ªè¿”å›æ•´å‹æ•°æ®çš„æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int ptr[3];&lt;/code&gt;  ä» ptr å¤„å¼€å§‹ï¼Œå…ˆä¸ [] ç»“åˆï¼Œè¯´æ˜ ptr æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åä¸ int ç»“åˆï¼Œè¯´æ˜æ•°ç»„é‡Œé¢çš„å…ƒç´ ç±»å‹æ˜¯æ•´å‹çš„ï¼Œæ‰€ä»¥ ptr æ˜¯ä¸€ä¸ªç”±æ•´å‹æ•°æ®ç»„æˆçš„æ•°ç»„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int *ptr[3];&lt;/code&gt; ä» ptr å¼€å§‹ï¼Œå·¦è¾¹æ˜¯ * è¿ç®—ï¼Œå³è¾¹æ˜¯ [] è¿ç®—ï¼Œç”±äº [] è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§æ¯” * é«˜ï¼Œæ‰€ä»¥å…ˆä¸ [] ç»“åˆï¼Œè¯´æ˜ ptr æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åå†ä¸ * ç»“åˆï¼Œè¯´æ˜æ•°ç»„å…ƒç´ çš„ç±»å‹æ˜¯æŒ‡é’ˆç±»å‹ï¼Œæœ€åä¸ int ç»“åˆï¼Œè¯´æ˜æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å®¹çš„ç±»å‹æ˜¯æ•´å‹æ•°æ®ã€‚
æ‰€ä»¥ ptr æ˜¯ä¸€ä¸ª&lt;strong&gt;æ•´å‹æ•°æ®çš„æŒ‡é’ˆ&lt;/strong&gt;æ‰€ç»„æˆçš„&lt;strong&gt;æ•°ç»„&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int (*ptr)[3];&lt;/code&gt; ä» ptr å¼€å§‹ï¼Œé¦–å…ˆä¸ * ç»“åˆï¼Œ() æ˜¯ä¸ºäº†æé«˜ * ç›¸å¯¹äº [] çš„ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥ ptr æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œç„¶åä¸ [] ç»“åˆï¼Œè¯´æ˜ ptr æ˜¯æŒ‡é’ˆï¼ŒæŒ‡å‘çš„å†…å®¹æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæœ€åä¸ int ç»“åˆï¼Œè¯´æ˜æ•°ç»„é‡Œçš„å…ƒç´ æ˜¯æ•´å‹çš„ã€‚
æ‰€ä»¥ ptr æ˜¯ä¸€ä¸ª&lt;strong&gt;æŒ‡å‘ç”±æ•´å‹æ•°æ®ç»„æˆçš„æ•°ç»„&lt;/strong&gt;çš„&lt;strong&gt;æŒ‡é’ˆ&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int **ptr;&lt;/code&gt; ä» ptr å¼€å§‹ï¼Œå…ˆä¸ * ç»“åˆï¼Œè¯´æ˜¯ ptr æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œç„¶åå†ä¸ * ç»“åˆï¼Œè¯´æ˜æŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ æ˜¯æŒ‡é’ˆï¼Œç„¶åå†ä¸ int ç»“åˆï¼Œè¯´æ˜è¯¥æŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ æ˜¯æ•´å‹æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int ptr(int);&lt;/code&gt; ä» ptr å¤„èµ·ï¼Œå…ˆä¸ () ç»“åˆï¼Œè¯´æ˜ ptr æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åè¿›å…¥ () é‡Œåˆ†æï¼Œè¯´æ˜è¯¥å‡½æ•°æœ‰ä¸€ä¸ªæ•´å‹å˜é‡çš„å‚æ•°ï¼Œç„¶åå†ä¸å¤–é¢çš„ int ç»“åˆï¼Œè¯´æ˜å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•´å‹æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int (*ptr)(int);&lt;/code&gt; ä» ptr å¤„å¼€å§‹ï¼Œå…ˆä¸æŒ‡é’ˆç»“åˆï¼Œè¯´æ˜ ptr æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œç„¶åä¸ () ç»“åˆï¼Œè¯´æ˜æŒ‡é’ˆæŒ‡å‘çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åå†ä¸ () é‡Œçš„ int ç»“åˆï¼Œè¯´æ˜å‡½æ•°æœ‰ä¸€ä¸ª int å‹çš„å‚æ•°ï¼Œå†ä¸æœ€å¤–å±‚çš„ int ç»“åˆ,è¯´æ˜å‡½æ•°çš„è¿”å›ç±»å‹æ˜¯æ•´å‹ã€‚
æ‰€ä»¥ ptr æ˜¯ä¸€ä¸ªæŒ‡å‘&lt;strong&gt;æœ‰ä¸€ä¸ªæ•´å‹å‚æ•°ä¸”è¿”å›ç±»å‹ä¸ºæ•´å‹çš„å‡½æ•°&lt;/strong&gt;çš„æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int *ptr(int);&lt;/code&gt; ä» ptr å¤„å¼€å§‹ï¼Œå…ˆä¸ () ç»“åˆï¼Œè¯´æ˜ ptr æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åä¸ * ç»“åˆï¼Œè¯´æ˜å‡½æ•°è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œç„¶åå†ä¸ int ç»“åˆï¼Œè¯´æ˜å‡½æ•°è¿”å›æŒ‡é’ˆæŒ‡å‘ intã€‚
æ‰€ä»¥ ptr æ˜¯ä¸€ä¸ª&lt;strong&gt;æœ‰ä¸€ä¸ªæ•´å‹å‚æ•°ä¸”è¿”å›ç±»å‹ä¸ºæŒ‡å‘æ•´å‹çš„æŒ‡é’ˆ&lt;/strong&gt;çš„&lt;strong&gt;å‡½æ•°&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int *(*ptr(int))[3];&lt;/code&gt; éš¾åº¦ MAXï¼Œä» ptr å¼€å§‹ï¼Œå…ˆä¸ () ç»“åˆï¼Œè¯´æ˜ ptr æ˜¯ä¸€ä¸ªå‡½æ•°,ç„¶åè¿›å…¥ () é‡Œé¢ï¼Œä¸ int ç»“åˆï¼Œè¯´æ˜å‡½æ•°æœ‰ä¸€ä¸ªæ•´å‹å˜é‡å‚æ•°ï¼Œç„¶åå†ä¸å¤–é¢çš„ * ç»“åˆï¼Œè¯´æ˜å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ˆå‚è€ƒä¸Šè¾¹çš„ç¬¬9æ¡ï¼‰ï¼Œç„¶ååˆ°æœ€å¤–é¢ä¸€å±‚ï¼Œå…ˆä¸ [] ç»“åˆï¼Œè¯´æ˜è¿”å›çš„æŒ‡é’ˆæŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åå†ä¸ * ç»“åˆï¼Œè¯´æ˜æ•°ç»„é‡Œçš„å…ƒç´ æ˜¯æŒ‡é’ˆï¼Œç„¶åå†ä¸ int ç»“åˆï¼Œè¯´æ˜æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹æ˜¯æ•´å‹æ•°æ®ã€‚
æ‰€ä»¥ ptr æ˜¯ä¸€ä¸ªæŒ‡å‘&lt;strong&gt;å‚æ•°ä¸ºä¸€ä¸ª int ä¸”è¿”å›ä¸€ä¸ªæŒ‡å‘ç”±æ•´å‹æŒ‡é’ˆå˜é‡ç»„æˆçš„æ•°ç»„çš„æŒ‡é’ˆå˜é‡&lt;/strong&gt;çš„&lt;strong&gt;å‡½æ•°&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸Šåˆ—ä¸­çš„ &lt;strong&gt;4. 5.&lt;/strong&gt; æ˜¯å¾ˆå¤šè€ƒè¯•çš„è€ƒç‚¹ï¼Œå…¶ä¸­ &lt;code&gt;int *ptr[3];&lt;/code&gt; ä¸­ ptr æœ‰ä¸ªç§°å·å«åš &lt;strong&gt;æŒ‡é’ˆæ•°ç»„&lt;/strong&gt; ï¼Œ&lt;code&gt;int (*ptr)[3];&lt;/code&gt; ä¸­ ptr æœ‰ä¸ªç§°å·å«åš &lt;strong&gt;æ•°ç»„æŒ‡é’ˆ&lt;/strong&gt;ï¼Œè¿åå­—éƒ½å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œæ–°æ‰‹å¤§å¤šå¤´ç–¼è¿™ä¸¤ä¸ªçš„åˆ¤æ–­ï¼Œå…¶å®æŒ‰ç…§ä¸Šè¿°çš„æ–¹æ³•æ¥å¤„ç†æŒ‡é’ˆç»“åˆçš„è¯ï¼Œä¸¤ç§ç±»å‹çš„åŒºåˆ«è¿˜æ˜¯å¾ˆå¥½åˆ¤æ–­çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ•°ç»„æŒ‡é’ˆï¼Œæ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œæ³¨æ„è¿™é‡Œçš„æŒ‡é’ˆä¸ç­‰åŒä¸æ•°ç»„åæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„ï¼Œæ˜¯ä¸€ä¸ªæ•´ä½“æ•°ç»„ï¼Œè€Œæ•°ç»„åæŒ‡é’ˆæŒ‡å‘çš„æ˜¯æ•°ç»„ä¸­çš„å…ƒç´ ã€‚æ•°ç»„æŒ‡é’ˆåŠ  1 åï¼Œä¼šè·¨è¿‡æ•´ä¸ªæ•°ç»„é•¿åº¦æ€»å’Œï¼Œè€Œæ•°ç»„ååŠ  1 åªä¼šå¢åŠ ä¸€ä¸ªå…ƒç´ çš„é•¿åº¦ã€‚ä¸¾ä¸ªä¾‹å­å°±æ˜¯ï¼šæ•°ç»„æŒ‡é’ˆæ˜¯ç­å·ï¼ŒåŠ  1 åç§»åŠ¨åˆ°ä¸‹ä¸ªç­ï¼Œæ•°ç»„åæ˜¯ç­çº§å†…çš„å­¦å·ï¼ŒåŠ  1 åç§»åŠ¨åˆ°ä¸‹ä¸ªå­¦ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-12-7-C-pointer/ap&amp;amp;pa.png&#34; alt=&#34;ap&amp;pa.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ p ä¸ºæ™®é€šå‡½æ•°åæŒ‡é’ˆï¼Œptr ä¸ºæ•°ç»„æŒ‡é’ˆã€‚
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•°ç»„æŒ‡é’ˆå¯ä»¥è·³è¿‡ä¸€æ•´ä¸ªè¡Œæ•°ç»„ï¼Œç”¨é€”åœ¨å“ªé‡Œæœ€æ™®éï¼ŸäºŒç»´æ•°ç»„ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æŒ‡é’ˆæ•°ç»„ä¸ç”¨å¤šä»‹ç»äº†ï¼Œå°±æ˜¯ä¸ªæ™®é€šæ•°ç»„ï¼Œé‡Œé¢è£…çš„å…¨æ˜¯æŒ‡é’ˆè€Œå·²ã€‚&lt;/p&gt;
&lt;h2 id=&#34;--&#34;&gt;å¸¸é‡æŒ‡é’ˆ &amp;amp; æŒ‡é’ˆå¸¸é‡&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ä»‹ç»æ•°ç»„åæ˜¯æŒ‡é’ˆçš„æ—¶å€™ç”¨åˆ°äº†ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼Œå«åšâ€œæŒ‡é’ˆå¸¸é‡â€ï¼Œä¹Ÿå°±æ˜¯ &lt;code&gt;int * const var_name = &amp;amp;var[0];&lt;/code&gt; ä¸­çš„æŒ‡é’ˆï¼Œè¿™ç§æŒ‡é’ˆå†…éƒ¨çš„åœ°å€ä¸èƒ½å˜åŠ¨ï¼Œåªèƒ½åœ¨å£°æ˜çš„æ—¶å€™å®šä¹‰ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½æŒ‡å‘åˆ«çš„å˜é‡äº†ã€‚&lt;strong&gt;æŒ‡é’ˆæœ¬èº«æ˜¯ä¸€ä¸ªå¸¸é‡&lt;/strong&gt;å°±ç§°ä½œ&lt;strong&gt;æŒ‡é’ˆå¸¸é‡&lt;/strong&gt;æˆ‘ä»¬ç§°ï¼Œæ•°ç»„åå°±æ˜¯ä¸€ç§æŒ‡é’ˆå¸¸é‡ã€‚å­—ç¬¦ä¸²ï¼Œä¹Ÿæ˜¯ä¸€ç§æŒ‡é’ˆå¸¸é‡ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ç§æŒ‡é’ˆï¼Œå®ƒæœ¬èº«ä¸æ˜¯å¸¸é‡ï¼Œä½†å®ƒæŒ‡å‘çš„æ˜¯å¸¸é‡ï¼Œå¤§å®¶æƒ³ä¸€æƒ³ï¼Œè¿™ä¸ªæŒ‡é’ˆçš„å£°æ˜è¯¥æ€ä¹ˆå†™ï¼Ÿ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; c&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ptr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;c;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–è€…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; c&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;;
&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ptr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;c;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯è¦æ¸…æ¥šä¸€ç‚¹ï¼Œè¿™ä¸ªå¸¸é‡çš„å®šä¹‰ï¼Œæ˜¯æŒ‡ä¸èƒ½é€šè¿‡ ptr è¿™ä¸ªæŒ‡é’ˆæ¥ä¿®æ”¹ c ä¸­çš„å€¼äº†ï¼ˆ&lt;code&gt;*ptr=20;&lt;/code&gt; ä¼šæç¤ºé”™è¯¯ï¼‰ï¼Œä½†æ˜¯ c æœ¬èº«ä¸æ˜¯å¸¸é‡ï¼Œç”¨å…¶ä»–çš„æŒ‡é’ˆæˆ–è€…ï¼Œç›´æ¥é€šè¿‡ &lt;code&gt;c=20;&lt;/code&gt; éƒ½æ˜¯å¯ä»¥ä¿®æ”¹ c çš„å€¼çš„ã€‚è¿™ç§&lt;strong&gt;æŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆ&lt;/strong&gt;å°±å«åš&lt;strong&gt;å¸¸é‡æŒ‡é’ˆ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æŒ‡é’ˆå¸¸é‡/å¸¸é‡æŒ‡é’ˆ&lt;/strong&gt; è¿™ä¸¤ç§æ˜¯ä¸æ˜¯ç‰¹åˆ«å®¹æ˜“ææ··å•Šï¼Ÿè€ƒè¯•å°±è€ƒè¿™ä¸ªäº†ï¼å…¶å®æŒ‰ç…§æˆ‘ä»¬çš„ç»“åˆå¾‹æ¥åˆ¤æ–­ä¹Ÿéå¸¸å¥½åˆ¤æ–­ï¼Œå¦‚æœæŒ‡é’ˆåå…ˆè·Ÿ const ç»“åˆäº†ï¼Œè¿™ä¸ªæŒ‡é’ˆå†…çš„åœ°å€å°±ä¸èƒ½å˜äº†ï¼Œé‚£å°±æ˜¯æŒ‡é’ˆå¸¸é‡ï¼Œè€Œå¦‚æœæŒ‡é’ˆåå…ˆè·Ÿ * ç»“åˆäº†ï¼Œè¿™å°±è¯´æ˜æŒ‡é’ˆæ˜¯å¯å˜çš„ï¼Œç„¶åé‡åˆ°äº† const å’ŒæŸç§ç±»å‹ï¼Œé‚£å°±è¯´æ˜æŒ‡é’ˆæŒ‡å‘äº†æŸç§å¸¸é‡ï¼Œæ˜¯å¸¸é‡æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸€ä¸ªéš¾ä¸€ç‚¹çš„åˆ¤æ–­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;test)();
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é¦–å…ˆä»åå­—å…¥æ‰‹ï¼Œ&lt;code&gt;(*test)&lt;/code&gt; è¯´æ˜ test æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œç„¶åå‘å¤–ï¼Œ() ä¼˜å…ˆçº§è¾ƒé«˜ï¼Œå…ˆåˆ¤æ–­åé¢çš„å°æ‹¬å·ï¼Œè¯´å test æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„å‡½æ•°ï¼Œå…¶è¿”å›å€¼ç›®å‰æœªçŸ¥ï¼Œç„¶åå‘å‰åˆ¤æ–­ï¼Œé¦–å…ˆé‡åˆ°äº†ä¸€ä¸ª *ï¼Œè¯´æ˜è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘äº†å‰é¢çš„ &lt;code&gt;(int * const)&lt;/code&gt; ï¼Œæ¥ç€è·Ÿ const ç»“åˆï¼Œè¿”å›æŒ‡é’ˆä¸ºæŒ‡é’ˆå¸¸é‡ï¼Œæ¥ç€æ˜¯ &lt;code&gt;(int *)&lt;/code&gt; è¯´æ˜è¿™ä¸ªæŒ‡é’ˆå¸¸é‡æ˜¯ä¸€ä¸ªäºŒçº§æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘äº†ä¸€ä¸ªæŒ‡å‘ int å‹çš„æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ &lt;code&gt;test&lt;/code&gt; æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘äº†ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°ä¸æ¥å—å‚æ•°ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªäºŒçº§æŒ‡é’ˆï¼Œè¿™ä¸ªäºŒçº§æŒ‡é’ˆæ˜¯ä¸ªæŒ‡é’ˆå¸¸é‡ï¼Œè§£é™¤å¼•ç”¨ä¸€æ¬¡åçš„æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ª int å‹å˜é‡ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ â€œå¸¸é‡æŒ‡é’ˆå¸¸é‡â€ è¿™ç§å˜æ€ä¹Ÿæ˜¯å­˜åœ¨çš„ï¼Œè¿™ç§æŒ‡é’ˆä¸èƒ½ä¿®æ”¹åœ°å€ï¼Œå…¶å¯¹åº”çš„å˜é‡ä¹Ÿä¸èƒ½é€šè¿‡æ­¤æŒ‡é’ˆæ”¹å˜ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; ptr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;)&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœä½ ä¹‹å‰å†™è¿‡ç¨‹åºï¼Œæˆ–è€…çœ‹æˆ‘ä¸Šæ–‡çš„å‡½æ•°æŒ‡é’ˆä¾‹å­ä¸­ï¼Œå‘ç°å¾ˆå¤šå­—ç¬¦ä¸²å¤„ç†å‡½æ•°çš„å­—ç¬¦ä¸²å‚æ•°éƒ½æ˜¯ &lt;code&gt;const char *&lt;/code&gt; è¿™ç§ç±»å‹ï¼Œä½ å°±åº”è¯¥æ˜ç™½äº†ï¼Œå­—ç¬¦ä¸²è­¬å¦‚ &lt;code&gt;&amp;quot;Hello world&amp;quot;&lt;/code&gt; æœ¬è´¨å…¶å®å°±æ˜¯ä¸€ä¸ªå¸¸é‡æŒ‡é’ˆï¼Œ&lt;code&gt;const char *&lt;/code&gt; çš„å­˜åœ¨æ˜¯ä¸ºäº†ä¿è¯å†…éƒ¨çš„å­—ç¬¦ä¸ä¼šå› ä¸ºè¿™ä¸ªæŒ‡é’ˆè€Œå‘ç”Ÿæ”¹å˜ã€‚æ³¨æ„ï¼Œå¦‚æœä½ ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²ç»™æŒ‡é’ˆèµ‹å€¼çš„è¯ï¼Œè¿™ä¸ªæŒ‡é’ˆæ˜¯ä¸èƒ½ä¿®æ”¹å­—ç¬¦ä¸²çš„å†…å®¹çš„ï¼Œå¦åˆ™ä¼šæŠ¥é”™å“¦ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å¸¸é‡æŒ‡é’ˆçš„å­˜åœ¨æ„ä¹‰å…¶å®æ˜¯ä¸ºäº†ä¿æŠ¤æ•°æ®ï¼Œåœ¨æ“ä½œçš„è¿‡ç¨‹ä¸­ä¸ä¼šå› ä¸ºä¸€äº›é”™è¯¯ä¿®æ”¹è€Œæ”¹å˜äº†å†…å­˜ä¸­å¯¹åº”çš„æ•°æ®çš„å€¼ã€‚å…¶æ„ä¹‰è¿˜æ˜¯ååˆ†é‡å¤§çš„ï¼&lt;/p&gt;
&lt;p&gt;åˆ°æ­¤ä¸ºæ­¢ï¼Œå¦‚æœä½ å…¨éƒ¨æŒæ¡äº†ä»¥ä¸Šçš„å†…å®¹ï¼Œæ­å–œï¼Œä½ å·²ç»ç†Ÿç»ƒæŒæ¡æŒ‡é’ˆçš„æ“ä½œäº†ï¼&lt;/p&gt;
&lt;p&gt;æœ€åç•™ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæœ¬æ–‡æœ€åçš„ test æŒ‡é’ˆï¼Œæˆ‘æƒ³è®©ä»–çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªäºŒçº§æŒ‡é’ˆï¼Œä½†è¿™ä¸ªäºŒçº§æŒ‡é’ˆçš„è§£å¼•ç”¨ä¸€æ¬¡ä¹‹åæ‰æ˜¯ä¸€ä¸ªå¸¸é‡æŒ‡é’ˆè¯¥æ€ä¹ˆæ”¹å†™è¿™ä¸ªå£°æ˜å‘¢ï¼Ÿéå¸¸ç®€å•å•Šå“ˆå“ˆï¼&lt;/p&gt;</description>
    </item>
    <item>
      <title>FT_Write Commands</title>
      <link>https://xiahualiu.github.io/posts/2017-11-28-ft232h-command/</link>
      <pubDate>Tue, 28 Nov 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-11-28-ft232h-command/</guid>
      <description>&lt;p&gt;åœ¨ä½¿ç”¨ &lt;code&gt;FT_Write&lt;/code&gt; å‘é€å‘½ä»¤çš„æ—¶å€™åº”è¯¥æ³¨æ„ï¼Œä¸€ä¸ªæ ‡å‡†çš„å‘½ä»¤åŒ…å«ä¸€ä¸ªæ“ä½œå­—èŠ‚ï¼ˆOPCODEï¼‰å’Œå‡ ä¸ªä»å±çš„å­—èŠ‚ï¼Œæ‰€æœ‰çš„å‘½ä»¤éƒ½æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½å‘é€çš„ã€‚&lt;/p&gt;
&lt;h1 id=&#34;heading&#34;&gt;æ•°æ®å‘é€å‘½ä»¤&lt;/h1&gt;
&lt;p&gt;è¿™ä¸ªæ˜¯æ§åˆ¶ MPSSE å‘é€æ•°æ®æ—¶å€™çš„è®¾ç½®å­—èŠ‚ç»„æˆ:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Bit 0 : åœ¨ä¸‹é™æ²¿å‘é€&lt;/li&gt;
&lt;li&gt;Bit 1 : 1 ä¸º bits å‘é€ï¼Œå…¶ä»–ä¸º bytes å‘é€&lt;/li&gt;
&lt;li&gt;Bit 2 : åœ¨ä¸‹é™æ²¿è¯»å–&lt;/li&gt;
&lt;li&gt;Bit 3 : 1ä¸ºLSB first, å…¶ä»–ä¸º MSB first&lt;/li&gt;
&lt;li&gt;Bit 4 : å…è®¸å†™ TDIï¼ˆå…è®¸å‘é€æ•°æ®ï¼‰&lt;/li&gt;
&lt;li&gt;Bit 5 : å…è®¸è¯» TDOï¼ˆå…è®¸æ¥æ”¶æ•°æ®ï¼‰&lt;/li&gt;
&lt;li&gt;Bit 6 : å¼€å¯å†™å…¥æ—¶çš„ TMSï¼ˆç‰‡é€‰ï¼‰&lt;/li&gt;
&lt;li&gt;Bit 7 : 0&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;msb-&#34;&gt;MSB é¦–å…ˆ&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;è®¾ç½®å­—èŠ‚&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ•°æ®æ˜¯å¦æ¥æ”¶&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ•°æ®æ˜¯å¦å‘é€&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;ä½/å­—èŠ‚&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ¥æ”¶æ•°æ®çš„&lt;strong&gt;æ•è·&lt;/strong&gt;æ—¶é’Ÿæ²¿&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;å‘é€æ•°æ®çš„&lt;strong&gt;å˜åŒ–&lt;/strong&gt;æ—¶é’Ÿæ²¿&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x10&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x20&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x22&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x26&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x31&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x34&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x33&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;heading-1&#34;&gt;ä¸¾ä¾‹å­:&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœå‘é€å­—èŠ‚åœ¨ä¸Šå‡æ²¿ï¼ŒMSBï¼Œä¸è¯»å–ï¼Œåˆ™å‘é€çš„å­—èŠ‚é¡ºåºä¸º:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;0x10,
LengthL,
LengthH,
Byte1
..
Byte65536 (max)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é•¿åº¦ &lt;code&gt;0x0000&lt;/code&gt; ä¸º 1 å­—èŠ‚ï¼Œ&lt;code&gt;0xffff&lt;/code&gt; ä¸º 65536 å­—èŠ‚ï¼Œæœ€å¤šä¸€æ¬¡å¯ä»¥å‘é€ 65536ï¼Œå› ä¸ºç¼“å­˜åªæœ‰ 64KBã€‚ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¬¬ 7 ä½ï¼Œä¹Ÿå°±æ˜¯é¦–å…ˆè¦å‘é€çš„ä½ä¼šè¢«æ”¾ç½®åœ¨ TDI/DO ä¸Šï¼Œç„¶åæ—¶é’Ÿä¼šå¼€å§‹ç¬¬ä¸€ä¸ªè·³å˜ï¼Œæ•°æ®ä¼šåœ¨ä¸‹ä¸€ä¸ªä¸Šå‡æ²¿å˜åŒ–ã€‚&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å¦‚æœè¯»å–å­—èŠ‚åœ¨ä¸Šå‡æ²¿ï¼ŒMSBï¼Œä¸å‘é€ï¼Œåˆ™å‘é€çš„å­—èŠ‚é¡ºåºä¸º:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;0x20,
LengthL,
LengthH
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™ä¸ªè®¾ç½®å­—èŠ‚ä¼šåœ¨ TDO/DI ç«¯å£æ¥æ”¶ 1 - 65536 ä¸ªå­—èŠ‚ï¼Œç¬¬ä¸€ä¸ªä½ä¼šæ˜¯ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ MSBï¼ˆæœ€é«˜ä½ï¼‰ï¼Œæ•°æ®ä¼šåœ¨æ¯ä¸ª CLK çš„ä¸Šå‡æ²¿è¿›è¡Œæ•è·ã€‚&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;æ¥æ”¶æ•°æ®å¹¶ä¸”å‘é€æ•°æ®ï¼ŒMSB é¦–å…ˆ:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;0x31,   // å‘é€æ•°æ®åœ¨ä¸‹é™æ²¿è·³å˜ï¼Œæ¥æ”¶æ•°æ®åœ¨ä¸Šå‡æ²¿æ•è·
LengthL,
LengthH,
Byte1
..
Byte65536 (max)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;lsb-&#34;&gt;LSB é¦–å…ˆ&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;è®¾ç½®å­—èŠ‚&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ•°æ®æ˜¯å¦æ¥æ”¶&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ•°æ®æ˜¯å¦å‘é€&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;ä½/å­—èŠ‚&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ¥æ”¶æ•°æ®çš„&lt;strong&gt;æ•è·&lt;/strong&gt;æ—¶é’Ÿæ²¿&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;å‘é€æ•°æ®çš„&lt;strong&gt;å˜åŒ–&lt;/strong&gt;æ—¶é’Ÿæ²¿&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x18&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x19&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x1A&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x1B&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x28&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x2C&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x2A&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x2E&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x39&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x3C&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYTES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x3B&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x3E&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BITS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸‹é™æ²¿&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸Šå‡æ²¿&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å…·ä½“ä¾‹å­å¯ä»¥å‚è€ƒä¸Šè¿°çš„ MSB ç« èŠ‚ï¼Œå‡ ä¹ä¸€æ¨¡ä¸€æ ·ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-2&#34;&gt;åˆå§‹åŒ–ç«¯å£çŠ¶æ€&lt;/h2&gt;
&lt;p&gt;ç«¯å£åˆ†ä¸ºé«˜ 8 ä½å’Œä½ 8 ä½ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;è®¾ç½®å­—èŠ‚&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;è®¾ç½®çŠ¶æ€&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;è¯»å–çŠ¶æ€&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;é«˜ 8 ä½&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;ä½ 8 ä½&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x80&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x82&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x81&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x83&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;heading-3&#34;&gt;è®¾ç½®çŠ¶æ€å€¼å’Œæ–¹å‘&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;0x80,
0xValue,
0xDirection
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¼šè®¾ç½®ä½ 8 ä½ç«¯å£çš„æ–¹å‘å’ŒçŠ¶æ€å€¼ã€‚&lt;br&gt;
1 ä¸ºè¾“å‡ºæ–¹å‘ï¼Œ0 ä¸ºè¾“å…¥æ–¹å‘ã€‚&lt;/p&gt;
&lt;h3 id=&#34;heading-4&#34;&gt;è¯»å–å€¼&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;0x81,
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¼šè¯»å–å½“å‰çš„ç«¯å£çŠ¶æ€å€¼ï¼Œè¿”å›ä¸€ä¸ªå­—èŠ‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heading-5&#34;&gt;å†…éƒ¨å›ç¯&lt;/h2&gt;
&lt;p&gt;å†…éƒ¨çŸ­æ¥ TDI/DO å’Œ TDO/DIï¼Œä»¥æµ‹è¯•ä¼ è¾“ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;è®¾ç½®å­—èŠ‚&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ˜¯å¦å›ç¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x84&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x85&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;NO&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;heading-6&#34;&gt;è®¾ç½®åˆ†é¢‘å› å­&lt;/h2&gt;
&lt;p&gt;å¯¹äº FT232H/FT2232H/FT4232H å‹å·ï¼Œå‘é€ &lt;code&gt;0x8A&lt;/code&gt; å¯ä»¥å…³é—­å†…éƒ¨çš„ 5 é¢„åˆ†é¢‘å™¨ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;0x86,
0xValueL,
0xValueH,
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;TCK period = 60MHz / (( 1 +[ (0xValueH * 256) OR 0xValueL] ) * 2)&lt;/p&gt;
&lt;h2 id=&#34;ft232hft2232hft4232h-&#34;&gt;FT232H/FT2232H/FT4232H ç‰¹æ®Šçš„æŒ‡ä»¤&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;æ“ä½œå­—èŠ‚&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;åŠŸèƒ½&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x8A&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;å…³é—­ 5 é¢„åˆ†é¢‘å™¨ï¼Œä¸»æ—¶é’Ÿé¢‘ç‡ä¸º 60MHz&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x8B&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;å¼€å¯ 5 é¢„åˆ†é¢‘ï¼Œä»¥ä¾¿äºé€‚åº” FT2232D&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x8C&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;å¼€å¯ä¸‰ç›¸æ•°æ®æ—¶é’Ÿï¼Œ&lt;!-- raw HTML omitted --&gt;ä½¿ç”¨ I2C æ€»çº¿ä¼šä½¿æ•°æ®åœ¨åŒæ—¶é’Ÿæ²¿ä¼ é€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x8D&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;å…³é—­ä¸‰ç›¸æ•°æ®æ—¶é’Ÿ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x8E&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;å…è®¸æ—¶é’Ÿåœ¨æ— æ•°æ®è¾“å‡ºçš„æ—¶å€™è¾“å‡ºï¼Œ&lt;!-- raw HTML omitted --&gt;é€šå¸¸ç”¨äº JTAG çŠ¶æ€æœºï¼Œæ—¶é’ŸæŒ‰ä½è®¡ç®—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x8F&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;å…è®¸æ—¶é’Ÿåœ¨æ— æ•°æ®è¾“å‡ºçš„æ—¶å€™è¾“å‡ºï¼Œ&lt;!-- raw HTML omitted --&gt;é€šå¸¸ç”¨äº JTAG çŠ¶æ€æœºï¼Œæ—¶é’ŸæŒ‰å­—èŠ‚è®¡ç®—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x94&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;å…è®¸æ—¶é’Ÿåœ¨æ— æ•°æ®è¾“å‡ºçš„æ—¶å€™è¾“å‡ºï¼Œ&lt;!-- raw HTML omitted --&gt;ç›´åˆ° GPIOL1 è¾“å…¥ 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x95&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;å…è®¸æ—¶é’Ÿåœ¨æ— æ•°æ®è¾“å‡ºçš„æ—¶å€™è¾“å‡ºï¼Œ&lt;!-- raw HTML omitted --&gt;ç›´åˆ° GPIOL1 è¾“å…¥ 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x96&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;å¼€å¯é€‚åº”æ€§æ—¶é’Ÿ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x97&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;å…³é—­é€‚åº”æ€§æ—¶é’Ÿ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x9C&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;å…è®¸æ—¶é’Ÿåœ¨æ— æ•°æ®è¾“å‡ºçš„æ—¶å€™è¾“å‡ºï¼Œ&lt;!-- raw HTML omitted --&gt;ç›´åˆ° GPIOL1 è¾“å…¥ 1 æˆ–è€…ä¸€å®šæ•°é‡çš„æ—¶é’Ÿè¢«å‘é€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0x9C&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;å…è®¸æ—¶é’Ÿåœ¨æ— æ•°æ®è¾“å‡ºçš„æ—¶å€™è¾“å‡ºï¼Œ&lt;!-- raw HTML omitted --&gt;ç›´åˆ° GPIOL1 è¾“å…¥ 0 æˆ–è€…ä¸€å®šæ•°é‡çš„æ—¶é’Ÿè¢«å‘é€&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;ftstatus-&#34;&gt;ftStatus é”™è¯¯çŠ¶æ€åˆ†æï¼š&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;é”™è¯¯ç &lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;é”™è¯¯ç±»å‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;æ— é”™è¯¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;æ— æ•ˆçš„ HANDLE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;æœªæ‰¾åˆ°è®¾å¤‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;è®¾å¤‡æœªè¢«æ‰“å¼€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;è®¾å¤‡ IO é”™è¯¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;èµ„æºä¸è¶³&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;å‚æ•°æ— æ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;æ— æ•ˆæ³¢ç‰¹ç‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;è®¾å¤‡æ“¦æ‹­æœªæ‰“å¼€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;è®¾å¤‡å†™å…¥æœªæ‰“å¼€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;å†™å…¥è®¾å¤‡æ— æ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EEPROM è¯»å–å¤±è´¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EEPROM å†™å…¥å¤±è´¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EEPROM æ“¦æ‹­å¤±è´¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;14&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EEPROM ä¸å­˜åœ¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EEPROM æœªæ ¼å¼åŒ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;æ— æ•ˆçš„å‚æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸æ”¯æŒçš„ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;18&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;å…¶ä»–é”™è¯¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</description>
    </item>
    <item>
      <title>FT232H Notes</title>
      <link>https://xiahualiu.github.io/posts/2017-11-13-ft232h-1/</link>
      <pubDate>Mon, 13 Nov 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-11-13-ft232h-1/</guid>
      <description>&lt;p&gt;å¥½ä¹…ä¸è§äº†æœ‹å‹ä»¬ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ®µæ—¶é—´å¿™äºé¡¹ç›®è®¾è®¡ä¸Šé¢çš„é—®é¢˜ï¼Œå‰ä¸€æ®µæ—¶é—´åœ¨ S32K144 ä¸Šé¢è¿›è¡Œäº†é’ˆå¯¹ W5500 ä»¥å¤ªç½‘æ¨¡å—çš„é€‚é…ï¼Œç»“æœä¸å°½äººæ„ï¼Œé€Ÿåº¦æœ€å¿«ä¹Ÿåªèƒ½åˆ°è¾¾ 520KB/s çš„é€Ÿåº¦ï¼ˆåœ¨ 20MHz çš„ LPSPI æ—¶é’Ÿé¢‘ç‡ä¸‹ï¼‰ï¼Œç”±äºé¡¹ç›®è¦æ±‚è‡³å°‘èƒ½å¤Ÿè¾¾åˆ° 1Mb/s çš„é€Ÿåº¦ï¼Œæ‰€ä»¥åªèƒ½æ¢ä¸€ä¸ªèŠ¯ç‰‡ï¼Œäºæ˜¯æˆ‘å‘ç°äº†è¿™ä¸€å—èŠ¯ç‰‡ï¼Œè‹±å›½ FTDI åŠå¯¼ä½“å…¬å¸ç”Ÿäº§çš„ FT232H èŠ¯ç‰‡ï¼Œä¸»è¦æ˜¯å®ç°äº† USB åˆ°å„ä¸ªå•ç‰‡æœºå…¶ä»–åè®®çš„è½¬æ¢åŠŸèƒ½ï¼Œæ ¹æ®å…¶å®˜æ–¹æ•°æ®ï¼Œå…¶ SPI ç«¯å£æœ€å¤šå¯ä»¥æ”¯æŒ 30MHz çš„æ—¶é’Ÿé¢‘ç‡ï¼Œè¿™ä¸ªé€Ÿåº¦ç›¸å½“å¯è§‚ï¼Œå› ä¸ºåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒSPI çš„æ—¶é’Ÿé¢‘ç‡éƒ½ä¸ä¼šè¶…è¿‡è¿™ä¸ªå€¼ï¼Œç›¸å½“äº SPI çš„ç‰©ç†æé™äº†ã€‚ä½†æ˜¯è¿™å—èŠ¯ç‰‡çš„èµ„æ–™å®åœ¨æ˜¯å°‘ä¹‹åˆå°‘ï¼Œå¤§éƒ¨åˆ†äººä½¿ç”¨è¿™å—èŠ¯ç‰‡éƒ½æ˜¯åœ¨ FPGA ä¸Šè®¾è®¡ FIFO è½¬ USB åŠŸèƒ½çš„ï¼Œæ‰€ä»¥åˆå›åˆ°äº†æœ€è‰°è‹¦å¥‹æ–—çš„çŠ¶æ€â€”â€”â€”â€”è¯»æ–‡æ¡£ï¼Œå¹¸å¥½æœ¬æ¸£è‹±è¯­å¥½ï¼ŒåŠ ä¸Š S32K144 2000 é¡µçš„æ–‡æ¡£éƒ½æå®šäº†ï¼Œè¿™ä¸ªå‡ ç™¾é¡µçš„åŸºæœ¬ä¸Šä¸ç®—é—®é¢˜äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ft232h-&#34;&gt;FT232H åŸºæœ¬ä¿¡æ¯&lt;/h3&gt;
&lt;p&gt;ï¼ˆå…¨éƒ¨ç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•é€šé“çš„ USB to ä¸²/å¹¶å£&lt;/li&gt;
&lt;li&gt;ç‰‡å†… USB å…¨åè®®å¤„ç†ï¼Œä¸éœ€è¦é¢å¤–çš„ç¡¬ä»¶ç¼–ç¨‹éœ€è¦&lt;/li&gt;
&lt;li&gt;æ”¯æŒ USB2.0(480Mbits/s) å’Œ USB Full-Speed(8Mbits/s)&lt;/li&gt;
&lt;li&gt;å¤šåè®®åŒæ­¥ä¸²å£å¼•æ“ï¼ˆMPSSEï¼‰ç®€åŒ–äº†åŒæ­¥ä¸²å£åè®®çš„è®¾è®¡æµç¨‹&lt;/li&gt;
&lt;li&gt;UART ä¼ è¾“é€Ÿç‡å¯è¾¾ 12Mbaudï¼ˆRS232 ä¼ è¾“é€Ÿåº¦å—åˆ°å¤–éƒ¨çš„ç”µå¹³è½¬å˜å™¨çš„é™åˆ¶ï¼‰&lt;/li&gt;
&lt;li&gt;USB to å¼‚æ­¥ 245 FIFO æ¨¡å¼å¯è¾¾ 8Mbytes/s çš„é€Ÿåº¦&lt;/li&gt;
&lt;li&gt;USB to åŒæ­¥ 245 FIFO æ¨¡å¼å¯è¾¾ 40Mbytes/s çš„é€Ÿåº¦&lt;/li&gt;
&lt;li&gt;æ”¯æŒä¸€ä¸ªåŠåŒå·¥ FT1248 ç•Œé¢ï¼Œå¯ä»¥è®¾ç½®çš„æ•°æ®æ€»çº¿å®½åº¦(1, 2, 4 or 8 bits wide)&lt;/li&gt;
&lt;li&gt;CPU-style FIFO ç•Œé¢ç®€åŒ– CPU ç•Œé¢è®¾è®¡&lt;/li&gt;
&lt;li&gt;å¿«é€Ÿä¸²å£ç•Œé¢é€‰é¡¹&lt;/li&gt;
&lt;li&gt;FTDI çš‡å®¶è‡ªç”±è™šæ‹Ÿä¸²å£ï¼ˆVCPï¼‰ï¼Œå’Œç›´æ¥ï¼ˆD2XXï¼‰é™ä½äº†å¼€å‘ USB é©±åŠ¨çš„è®¾è®¡éœ€æ±‚&lt;/li&gt;
&lt;li&gt;å¯è°ƒæ•´çš„æ¥å—æ•°æ®ç¼“å†²è¶…æ—¶&lt;/li&gt;
&lt;li&gt;å‘é€æˆ–è€…æ¥å— LED é©±åŠ¨ä¿¡å·&lt;/li&gt;
&lt;li&gt;Bit-Bang æ¨¡å¼ç•Œé¢è®¾ç½®é€šè¿‡ RD# å’Œ WR# é¢‘é—ª&lt;/li&gt;
&lt;li&gt;é«˜åº¦é›†æˆåŒ–è®¾è®¡ï¼ŒåŒ…å«äº† 5V åˆ° 3.3V æˆ– +1.8V çš„ LDO çº¿æ€§ç¨³å‹å™¨ç»™ VCORE ä¾›ç”µï¼Œå¹¶é›†æˆ POR ä¸Šç”µå¤ä½åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥ UART ç•Œé¢é€‰é¡¹ï¼ŒåŒ…å«å®Œå…¨çš„ç¡¬ä»¶æ¡æ‰‹å’Œè°ƒåˆ¶ä¿¡å·åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;æ”¯æŒç¡¬ä»¶ X-ON å’Œ X-OFF æ¡æ‰‹&lt;/li&gt;
&lt;li&gt;UART æ”¯æŒ 7/8 bits æ•°æ®ä½ 1/2 bits åœæ­¢ä½å’Œï¼Œå¥‡æ ¡éªŒ/å¶æ ¡éªŒ/Mark&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;/Space&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;/æ— æ ¡éªŒä½ æ ¡éªŒæ–¹å¼&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨å‘é€æ§åˆ¶ RS485 ä¸²å£åº”ç”¨é€šè¿‡ TXDEN ç®¡è„š&lt;/li&gt;
&lt;li&gt;æ“ä½œæ¨¡å¼è®¾ç½®å’Œ USB æè¿°å­—ç¬¦ä¸²è®¾ç½®åœ¨å¤–éƒ¨çš„ EEPROM é€šè¿‡ USB ç•Œé¢è¿›è¡Œè®¾ç½®&lt;/li&gt;
&lt;li&gt;å¯è®¾ç½®çš„ I/O é©±åŠ¨åŠ›ï¼ˆ4, 8, 12 or 16mAï¼‰å’Œæ‘†åŠ¨é€Ÿåº¦&lt;/li&gt;
&lt;li&gt;ä½å·¥ä½œåŠŸç‡å’Œé—²ç½®åŠŸç‡&lt;/li&gt;
&lt;li&gt;æ”¯æŒè‡ªæˆ‘ä¾›ç”µï¼Œæ€»çº¿ä¾›ç”µï¼Œé«˜åŠŸç‡æ€»çº¿ä¾›ç”µ&lt;/li&gt;
&lt;li&gt;UHCI/OHCI/EHCI ä¸»æœºæ§åˆ¶å™¨æ”¯æŒ&lt;/li&gt;
&lt;li&gt;USB å—æ•°æ®ä¼ è¾“åŠŸèƒ½ï¼Œä¸€æ¬¡ä¼ è¾“ 512 å­—èŠ‚åŒ…ï¼ˆåœ¨é«˜é€Ÿä¼ è¾“æ¨¡å¼ä¸‹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;+1.8V æ ¸å¿ƒç”µå‹å’Œ 3.3V I/O ç•Œé¢ç”µå‹ï¼ˆè€å‹ 5Vï¼‰&lt;/li&gt;
&lt;li&gt;-40Â°C to 85Â°C å·¥ä¸šçº§å·¥ä½œèŒƒå›´&lt;/li&gt;
&lt;li&gt;ç´§å‡‘ 48 ç®¡è„šæ— é“… LQFP å°è£…æˆ– QFN å°è£…&lt;/li&gt;
&lt;li&gt;å¯è®¾ç½®çš„ ACBUS I/O ç®¡è„š&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;heading&#34;&gt;é©±åŠ¨è®¾ç½®&lt;/h3&gt;
&lt;p&gt;FT232H éœ€è¦ä¸€ä¸ª USB é©±åŠ¨ï¼Œæœ‰ VCP å’Œ D2XX ä¸¤ç§ï¼ŒVCP ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿä¸²å£ï¼Œå…è®¸ä¸²å£æ“ä½œåº”ç”¨æ“ä½œï¼ŒD2XX åˆ™æ˜¯ä½¿ç”¨ DLL æ¥ç›´æ¥æ“ä½œ FT232H&lt;/p&gt;
&lt;h3 id=&#34;heading-1&#34;&gt;æ¨¡å—å›¾&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-11-13-FT232H_1/FT232H_Block.png&#34; alt=&#34;FT232H block diagram&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;mpsse&#34;&gt;å¼•è„šå›¾ï¼ˆMPSSEï¼‰&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;ç®¡è„šå·&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;ç®¡è„šåç§°&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;MPSSE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TCK/SK&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;14&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDI/DO&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDO/DI&lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TMS/CS&lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOL0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;18&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOL1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;19&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOL2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;20&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ADBUS7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOL3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;25&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;26&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;27&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;28&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;29&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;31&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;GPIOH7&lt;sup id=&#34;fnref:7&#34;&gt;&lt;a href=&#34;#fn:7&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;7&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS8&lt;sup id=&#34;fnref:8&#34;&gt;&lt;a href=&#34;#fn:8&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;8&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;33&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACBUS9&lt;sup id=&#34;fnref:9&#34;&gt;&lt;a href=&#34;#fn:9&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;9&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;mpsse-&#34;&gt;MPSSE ç®€ä»‹&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå°±æ˜¯æˆ‘æƒ³è¦çš„åŠŸèƒ½äº†ï¼ŒMPSSE æ¨¡å¼å…è®¸ FT232H æœ‰æ•ˆçš„å’ŒåŒæ­¥ä¸²å£åè®®ï¼ˆJTAG, I2C, SPI(MASTER)ï¼‰æ€»çº¿äº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;MPSSE æ˜¯å®Œå…¨å¯è®¾ç½®çš„ï¼Œè®¾ç½®éœ€è¦é€šè¿‡æ²¿ç€æ•°æ®æµå‘é€å‘½ä»¤ã€‚è¿™äº›å‘½ä»¤å¯ä»¥è¢«å•ç‹¬å‘é€æˆ–è€…æ‰“åŒ…æˆä¸ºæ•°æ®åŒ…å‘é€ï¼ŒMPSSE æœ€å¤šæ”¯æŒæ•°æ®é€Ÿåº¦ä¸º 30Mbits/sã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„åœ¨ä½¿ç”¨ MPSSE æ¨¡æ‹Ÿ SPI æ€»çº¿çš„æ—¶å€™ï¼ŒFT232H æ˜¯å¤„äºä¸»æœºæ¨¡å¼çŠ¶æ€ä¸‹çš„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨äº§å“ä»‹ç»å½“ä¸­ï¼ŒFT232H ä¸»è¦æ˜¯ä½œä¸º PC ç«¯é€šè¿‡ USB æ¥ä¸‹è½½ä»£ç æˆ–è€…ä¸‹å‘½ä»¤ä½¿ç”¨çš„ï¼Œæ‰€ä»¥åœ¨è½¯ä»¶çš„è®¾è®¡ä¸­ï¼Œä¹Ÿä¸»è¦æ˜¯é›†ä¸­åœ¨ PC ç«¯è¿›è¡Œè®¾è®¡è¯´æ˜çš„ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šç»™æˆ‘ä»¬æœªæ¥çš„è½¯ä»¶å¼€å‘å¸¦æ¥äº†ä¸€å®šçš„ä¾¿åˆ©ã€‚ä½†æ˜¯åœ¨ç¡¬ä»¶å¼€å‘å±‚é¢ï¼Œå¯èƒ½ä¼šå¸¦æ¥ä¸€å®šç¨‹åº¦ä¸Šçš„å›°éš¾ï¼Œå› ä¸ºæˆ‘ä¸»è¦æ˜¯å°†å•ç‰‡æœºä½œä¸ºæ•°æ®è¾“å‡ºçš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;mpsse--1&#34;&gt;MPSSE æ³¢å½¢å›¾&lt;/h4&gt;
&lt;p&gt;MPSSE çš„æ³¢å½¢å¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™æ˜¯ä¸€ä¸ªåŒæ­¥ä¸²å£é€šç”¨æ³¢å½¢ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è®¾è®¡çš„æ—¶å€™è¦é’ˆå¯¹åè®®è¿›è¡Œæ³¢å½¢æ§åˆ¶ã€‚
&lt;img src=&#34;https://xiahualiu.github.io/img/2017-11-13-FT232H_1/MPSSE_Waveform.png&#34; alt=&#34;MPSSE_Waveform&#34;&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Min&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Typ&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Max&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Units&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Comments&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;t1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;15.15&lt;sup id=&#34;fnref:10&#34;&gt;&lt;a href=&#34;#fn:10&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;10&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;16.67&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ns&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLKOUT æ€»å‘¨æœŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;t2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8.33&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ns&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLKOUT é«˜ä½æ—¶é•¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;t3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8.33&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ns&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLKOUT ä½ä½æ—¶é•¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;t4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ns&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLKOUT to TDI/DO å»¶è¿Ÿ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;t5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ns&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDI/DO ç»´æŒæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;t6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8.33&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ns&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDI/DO è®¾ç½®æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;fineï¼Œæˆ‘æ‰¿è®¤è¿™ä¸ªæ—¶åºå›¾å®Œå…¨æ²¡çœ‹æ‡‚ï¼Œä¸ç®¡äº†ï¼Œåœ¨ä¸‹é¢æœ‰ MPSSE å¯¹åº”åè®®çš„è®¾ç½®æ¨èï¼Œç›´æ¥å»çœ‹æˆ‘æƒ³ç”¨çš„ SPI ç« èŠ‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;mpsse--2&#34;&gt;MPSSE è®¾ç½®&lt;/h3&gt;
&lt;p&gt;æ‰€æœ‰çš„ MPSSE å‘½ä»¤æˆ–è€…æ˜¯ GPIO å‘½ä»¤ï¼Œéƒ½æ˜¯é€šè¿‡ USB æ€»çº¿ä» PC ç«¯å‘é€åˆ° FT ä¸²å£ç«¯ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ &lt;strong&gt;å¿…é¡»ä½¿ç”¨ D2XX API&lt;/strong&gt;ï¼Œå¹¶ä¸”æ‰€æœ‰çš„ MPSSE å‘½ä»¤éƒ½æ˜¯é€šè¿‡è¯»å†™å‘½ä»¤å®ç°çš„ï¼Œå¹¶ä¸”åº”å½“æ³¨æ„éœ€è¦çš„æ¨¡å—å’Œé©±åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ä¸€æ—¦ç¡¬ä»¶è¿æ¥è¢«å»ºç«‹ï¼Œå·¥ç¨‹å¸ˆå¿…é¡»å†³å®šå¦‚ä½•è®¾ç½® MPSSE è®©å…¶ä¸ç›®æ ‡ç¡¬ä»¶å•ä½æ²Ÿé€šï¼Œä¸‹åˆ—æ˜¯éœ€è¦è®¾ç½®çš„å‚æ•°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;msblsb--&#34;&gt;MSB/LSB å’Œ æ•°æ®é•¿åº¦&lt;/h4&gt;
&lt;p&gt;è¯·ç¡®å®šç›®æ ‡è®¾å¤‡çš„ MSB/LSB æ–¹å‘ä»¥åŠä¼ è¾“æ•°æ®çš„é•¿åº¦ã€‚
MPSSE å‘½ä»¤è¿è¡Œåœ¨å­—èŠ‚å±‚é¢ä¸Šï¼Œä¾‹å¦‚ä¼ è¾“åè¿›åˆ¶ 16 ï¼Œå°†ä¼šå…ˆå‘é€ä¸€ä¸ª &lt;code&gt;0x00&lt;/code&gt; å­—èŠ‚ï¼Œåœ¨å‘é€ &lt;code&gt;0x01&lt;/code&gt; å­—èŠ‚ï¼ˆMSBï¼‰ã€‚ä½†æ˜¯ä¹Ÿå¯ä»¥è®¾ç½®æˆä¸ºåŸºäºä½çš„ä¼ è¾“æ–¹å¼ï¼Œä»¥é€‚åº”ä¸é€‚åº”å­—èŠ‚ä¼ è¾“çš„è®¾å¤‡ä¸Šã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-2&#34;&gt;æ—¶é’Ÿ&lt;/h4&gt;
&lt;p&gt;å’Œæ•°æ®ä¼ è¾“æ–¹å‘ä¸€æ ·ï¼Œè®¾å®šæ—¶é’Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚&lt;/p&gt;
&lt;h5 id=&#34;heading-3&#34;&gt;åˆ†é¢‘å› å­&lt;/h5&gt;
&lt;p&gt;$$Data Speed=\frac{60MHz}{((1+Divisor) \times 2)}$$&lt;/p&gt;
&lt;p&gt;FTx232H çš„åˆ†é¢‘å› å­æ˜¯ä¸€ä¸ªä» &lt;code&gt;0x0000&lt;/code&gt; åˆ° &lt;code&gt;0xFFFF&lt;/code&gt; çš„æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®çš„çš„é€Ÿåº¦ä» 30MHz åˆ° 460Hz ä¹‹é—´ã€‚å¹¶ä¸”åœ¨ FTx232H ä¸Šæœ‰ä¸€ä¸ª 5 çš„åˆ†é¢‘ç³»æ•°é€‰é¡¹ä»¥ç»´æŒç¨³å®šæ€§ã€‚å½“å¼€å¯çš„æ—¶å€™ï¼Œå°†ä¸Šå¼ä¸­çš„ &lt;code&gt;60MHz&lt;/code&gt; æ›´æ¢ä¸º &lt;code&gt;12MHz&lt;/code&gt; å³å¯ã€‚&lt;/p&gt;
&lt;h5 id=&#34;heading-4&#34;&gt;æ²¿è®¾ç½®&lt;/h5&gt;
&lt;p&gt;æ•°æ®åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯åœ¨æ—¶é’Ÿçš„è¾¹æ²¿è¿›è¡Œè¯»å–å’Œæ›´æ”¹çš„ï¼Œæ‰€ä»¥æ²¿è®¾ç½®æ˜¯å¿…é¡»çš„ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;ä¼ è¾“æ—¶é’Ÿæ²¿&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ¥æ”¶æ—¶é’Ÿæ²¿&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;ç©ºé—²æ—¶é’ŸçŠ¶æ€&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Rising&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rising&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Not Valid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Rising&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Falling&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Low&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Falling&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rising&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;High&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Falling&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Falling&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Not Valid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Rising&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;No data transfer&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Low&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Falling&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;No data transfer&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;High&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;No data transfer&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Rising&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Low&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;No data transfer&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Falling&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;High&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;heading-5&#34;&gt;æ‚é¡¹&lt;/h4&gt;
&lt;h5 id=&#34;heading-6&#34;&gt;åˆå§‹ç®¡è„šçŠ¶æ€&lt;/h5&gt;
&lt;p&gt;è®¾å®šåˆå§‹çš„æ—¶é’ŸçŠ¶æ€ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;åˆå§‹ SK çŠ¶æ€&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;äº§ç”Ÿçš„æ—¶é’Ÿè„‰å†²&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;ä½&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä½-é«˜-ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;é«˜&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;é«˜-ä½-é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åœ¨å‘é€å’Œæ¥å—ä»»ä½•æ•°æ®å‰ï¼Œå››ä¸ª MPSSE ç®¡è„šå’Œ GPIO ç®¡è„šéƒ½åº”è¯¥è®¾ç½®ä¸ºæ­£ç¡®çš„æ•°æ®æ–¹å‘ï¼Œå¦‚æœæ˜¯è¾“å‡ºçŠ¶æ€ï¼Œåˆ™åº”è¯¥è®¾ç½®å…¶åˆå§‹çŠ¶æ€ã€‚&lt;/p&gt;
&lt;h5 id=&#34;buffer-sizes&#34;&gt;Buffer Sizes&lt;/h5&gt;
&lt;p&gt;MPSSE æ•°æ®å’Œå‘½ä»¤éƒ½æ··åˆåœ¨ä¸€ä¸ªå•ç‹¬çš„ Buffer ä¸‹ï¼Œå¤šå‘½ä»¤å¯ä»¥è¢«é€åˆ° MPSSE é€šè¿‡ç®€å•çš„è°ƒç”¨ &lt;code&gt;FT_Write&lt;/code&gt;ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åº”ç”¨ç¼“å­˜å¿…é¡»æœ‰å……è¶³çš„å¤§å°æ‰èƒ½ä¸€æ¬¡æ€§å¤„ç†å¤šå‘½ä»¤å’Œæ•°æ®ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;æ•°æ®ç±»å‹&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æ•°æ®é•¿åº¦ï¼ˆbytesï¼‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Command&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Data length&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Data payload&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1 åˆ° 65536&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;strong&gt;Total&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;strong&gt;4 åˆ° 65539&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸Šè¡¨ä¸º Buffer åˆ†é…åˆ¶åº¦ã€‚&lt;/p&gt;
&lt;h3 id=&#34;mpsse--3&#34;&gt;MPSSE è½¯ä»¶è®¾ç½®&lt;/h3&gt;
&lt;p&gt;æ‰€æœ‰çš„ MPSSE äº¤æµéƒ½æ˜¯é€šè¿‡ FTDI D2XX API å®ç°çš„ï¼Œå…¶å®˜æ–¹æ‰‹å†Œå¦‚ä¸‹ &lt;a href=&#34;http://www.ftdichip.com/Support/Documents/ProgramGuides/D2XX_Programmer&#39;s_Guide(FT_000071).pdf&#34;&gt;FTDI D2XX Programmerâ€™s Guide&lt;/a&gt;ï¼Œå®ç°çš„å¿…é¡»æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-11-13-FT232H_1/MPSSE_Flow_Chart.png&#34; alt=&#34;MPSSE_Flow_Chart&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;heading-7&#34;&gt;ç¡®è®¤è®¾å¤‡è¿æ¥å¹¶æ‰“å¼€å¤„ç†&lt;/h4&gt;
&lt;p&gt;åœ¨ä½¿ç”¨ MPSSE å‰ï¼Œåº”ç”¨ç¨‹åºéœ€è¦äº†è§£æœ‰å¤šå°‘ FT ç³»åˆ—è®¾å¤‡è¢«è¿æ¥åœ¨äº†ä¸»æœºç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”é€‰æ‹©å…¶ä¸­æ­£ç¡®çš„ä¸€ä¸ªã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ D2XX API è°ƒç”¨å®ç°çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;FT_CreateDeviceInfoList&lt;/code&gt; è¿™ä¸ªè°ƒç”¨è¿”å›å¯ç”¨çš„ FT ç³»åˆ—è®¾å¤‡æ•°é‡ï¼Œ&lt;strong&gt;é‡è¦&lt;/strong&gt;ï¼šå¤šç«¯å£çš„è®¾å¤‡çš„æ¯ä¸ªç«¯å£éƒ½ä¼šè¢«ç»Ÿè®¡åˆ°è¿™ä¸ªæ•°å€¼å†…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_GetDeviceInfoList&lt;/code&gt; æˆ–è€… &lt;code&gt;FT_GetDeviceInfoListDetail&lt;/code&gt; å–å†³äºä½¿ç”¨æ–¹æ³•ï¼Œè¿™ä¸ªè°ƒç”¨è¿”å›æ¯ä¸ªå¯ç”¨è®¾å¤‡çš„ä¿¡æ¯ï¼Œä¾‹å¦‚è®¾å¤‡åç§°ï¼Œç«¯å£åï¼ˆä¾‹å¦‚ â€œFT2232H Aâ€ æˆ– â€œFT2232H Bâ€ï¼‰ï¼Œå¯¹åº”çš„ USB åœ°å€ IDï¼ŒUSB ä¸²å£åºå·ï¼Œè¿˜æœ‰æœ€é‡è¦çš„ &lt;strong&gt;USB Handle&lt;/strong&gt; å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_Open&lt;/code&gt; æˆ– &lt;code&gt;FT_OpenEx&lt;/code&gt; ä¸€æ—¦ç«¯å£ä¿¡æ¯è¢«ç¡®å®šï¼Œä¸‹ä¸€æ­¥åˆ™å¯ä»¥æ‰“å¼€ç«¯å£ï¼ŒåŸºäºç«¯å£å¯¹åº”çš„ &lt;strong&gt;USB Handle&lt;/strong&gt; å€¼ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;-ftdi--mpsse-&#34;&gt;è®¾ç½® FTDI ç«¯å£ä¸º MPSSE åŠŸèƒ½&lt;/h4&gt;
&lt;p&gt;åœ¨æ‰“å¼€ç«¯å£åï¼Œä¸€äº›å‚æ•°éœ€è¦è¢«è®¾ç½®æ‰èƒ½å¤Ÿæ­£å¼æ‰“å¼€ MPSSEï¼Œè¿™ä¸ªæ­¥éª¤åŒ…æ‹¬ä»¥ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;FT_ResetDevice&lt;/code&gt; é‡ç½® FTDI å¤–å›´ç«¯å£&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetUSBParameters&lt;/code&gt; è®¾ç½®æœ€å¤§çš„ USB ä¼ è¾“å­—èŠ‚ï¼Œè¿™ä¸ªå€¼å¯ä»¥è¢«è®¾ç½®æˆä¸º 64 bytes åˆ° 64 Kbytesï¼Œå–å†³äºéœ€è¦ä¼ è¾“çš„æ•°æ®æ€»é‡ï¼Œè¾“å…¥å’Œè¾“å‡ºçš„å¤§å°å¯ä»¥åˆ†åˆ«è®¾ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetChars&lt;/code&gt; è®¾ç½®äº‹ä»¶å’Œé”™è¯¯ç ï¼Œå¤§å¤šæ•°åº”ç”¨ä¼šç¦ç”¨äº‹ä»¶å’Œé”™è¯¯ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetTimeouts&lt;/code&gt; è®¾ç½®è¯»å–å’Œå†™å…¥çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…æ—¶é€‰é¡¹åœ¨é»˜è®¤çŠ¶æ€ä¸‹æ˜¯ç¦ç”¨çš„ï¼Œè¿™ä¸ªé€‰é¡¹ä¸»è¦æ˜¯ç»™é©±åŠ¨ä¸€ä¸ªçªç ´é”™è¯¯ä¼ è¾“çš„æ‰‹æ®µã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetLatencyTimer&lt;/code&gt; è¿™ä¸ªè®¾ç½®åœ¨å‘é€ä¸€ä¸ªä¸å®Œå…¨çš„ USB æ•°æ®åŒ…å‰çš„ç­‰å¾…æ—¶é—´ï¼Œå¦‚æœéœ€è¦çš„å¿«é€Ÿååº”ï¼Œè¯·å°†æ­¤å€¼è®¾ç½®æˆä¸ºè¾ƒå°çš„å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetFlowControl&lt;/code&gt; è®¾ç½® RTS/CTS æµæ§åˆ¶ä»¥ç¡®è®¤é©±åŠ¨ä¸ä¼šå“åº” IN è¯·æ±‚å¦‚æœ buffer æ— æ³•æ¥å—æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetBitMode&lt;/code&gt; è®¾ç½® &lt;code&gt;mode = 0, mask = 0&lt;/code&gt; ä»¥é‡ç½® MPSSE æ§åˆ¶å™¨ï¼Œä½†ä¸ä¼šç»™ç«¯å£é‡ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FT_SetBitMode&lt;/code&gt; è®¾ç½® &lt;code&gt;mode = 2, mask = 0&lt;/code&gt; å¯ç”¨ MPSSE æ§åˆ¶å™¨ï¼Œå¼•è„šæ–¹å‘ä¼šåœ¨æ¥ä¸‹æ¥çš„ MPSSE å‘½ä»¤ä¸­è®¾ç½®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;-mpsse&#34;&gt;è®¾ç½® MPSSE&lt;/h4&gt;
&lt;p&gt;åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼ŒMPSSE å·²ç»å¯ä»¥æ¥å—å‘½ä»¤äº†ï¼ŒMPSSE å‘½ä»¤åŒ…å«ä¸€ä¸ª op-code å’Œä¸€åˆ°å¤šä¸ªå‚æ•°ï¼Œå‚æ•°å·²ç»è¢« &lt;a href=&#34;http://www.ftdichip.com/Support/Documents/ProgramGuides/D2XX_Programmer&#39;s_Guide(FT_000071).pdf&#34;&gt;FTDI D2XX Programmerâ€™s Guide&lt;/a&gt; ä¸­å®šä¹‰äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;FT_Write&lt;/code&gt; ç”¨äºå‘ MPSSE å‘é€å‘½ä»¤ï¼Œåé¦ˆåˆ™ä½¿ç”¨ &lt;code&gt;FT_Read&lt;/code&gt; è¯»å–ã€‚&lt;/p&gt;
&lt;h5 id=&#34;heading-8&#34;&gt;åŒæ­¥å’Œåå‘½ä»¤ä¾¦æµ‹&lt;/h5&gt;
&lt;p&gt;å¦‚æœæœ‰ä¸€ä¸ªåå‘½ä»¤è¢«ä¾¦æµ‹åˆ°ï¼ŒMPSSE å°†ä¼šè¿”å› &lt;code&gt;0xFA&lt;/code&gt; åŒæ—¶è·Ÿç€é”™è¯¯å­—èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨åå‘½ä»¤ä¾¦æµ‹æ˜¯å†³å®š MPSSE æ˜¯å¦å’Œåº”ç”¨åŒæ­¥çš„æ¨èæ–¹æ³•ï¼Œé€šè¿‡æ•…æ„å‘é€ä¸€ä¸ªåå‘½ä»¤ï¼Œç­‰å¾… &lt;code&gt;0xFA&lt;/code&gt; åº”ç”¨å¯ä»¥ç¡®å®šä¸ MPSSE ä¹‹é—´çš„æ²Ÿé€šæ˜¯å¦æœ‰æ•ˆã€‚&lt;/p&gt;
&lt;h5 id=&#34;mpsse--4&#34;&gt;MPSSE å»ºç«‹&lt;/h5&gt;
&lt;p&gt;é€šè¿‡è¿æ¥å»ºç«‹ï¼ŒMPSSE å¿…é¡»è®¾ç½®æ—¶é’Ÿé€Ÿåº¦ï¼Œç®¡è„šæ–¹å‘å’Œåˆå§‹ç®¡è„šçŠ¶æ€ã€‚FTx232H æœ‰ä¸€ä¸ªé¢å¤–çš„å‚æ•°æ˜¯ 5 åˆ†é¢‘å™¨ï¼Œ3 ç›¸æ—¶é’Ÿå’Œ JTAG é€‚åº”æ€§æ—¶é’Ÿã€‚è™½ç„¶é»˜è®¤çš„è®¾ç½®å¯èƒ½å¯¹ç‰¹å®šåº”ç”¨æœ‰æ•ˆï¼Œä½†æ˜¯å‘é€ op-code è®¾ç½®æ‰€æœ‰çš„ç‰¹æ€§ä¼šè®©ç¨‹åºæ›´å¯é ã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-9&#34;&gt;ä¸²å£äº¤æµ&lt;/h4&gt;
&lt;p&gt;ä¸€æ—¦æ‰€æœ‰çš„å‚æ•°è¢«è®¾ç½®åï¼Œä¸å¤–å›´çš„æ²Ÿé€šæœ‰å¯èƒ½ä¼šå‘ç”Ÿï¼ŒMPSSE ä¸ºäº†è¯Šæ–­è¿æ¥ç›®çš„å¯ä»¥è¢«è®¾ç½®ä¸º loop-back æ¨¡å¼ï¼Œæ•°æ®ä¼šè¢«ä¼ è¾“åˆ° DO ç®¡è„šï¼ŒåŒæ—¶ä¹Ÿä¼šè¢«ä¼ è¾“åˆ° DI ç®¡è„šã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­£å¸¸æ¨¡å¼å’Œå›é€æ¨¡å¼ä¸‹ï¼Œä¸€å…±æœ‰ 32 ç§ æ•°æ®çš„å‘é€å’Œæ¥æ”¶é€‰æ‹©ï¼Œé€‰æ‹©çš„ op-codee å†³å®šäºä»¥ä¸‹çš„é€‰é¡¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MSB æˆ–è€…æ˜¯ LSB ä¼ è¾“ï¼Œæ³¨æ„è¿™ä¸ªæ˜¯å­—èŠ‚çš„ä¼ è¾“é¡ºåºï¼Œå¦‚æœæ•°æ®é•¿äº 8-bitsï¼Œåˆ™éœ€è¦æ³¨æ„æ¯ä¸ªå­—èŠ‚åœ¨ buffer ä¸­çš„å­˜æ”¾é¡ºåºæ˜¯å¦æ­£ç¡®ã€‚&lt;/li&gt;
&lt;li&gt;åªå‘é€æ•°æ®ã€åªæ¥æ”¶æ•°æ®ã€æ—¢æ¥æ”¶åˆå‘é€æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;å‘é€æ•°æ®æ²¿ï¼Œæ¥æ”¶æ•°æ®æ²¿&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;FT_Write&lt;/code&gt; å‘é€å‘½ä»¤åˆ° Buffer ä¸­éœ€è¦è·Ÿéš &lt;code&gt;FT_GetStatus&lt;/code&gt; å’Œ &lt;code&gt;FT_Read&lt;/code&gt; å»è¯»å–å¤–å›´çš„åé¦ˆä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;gpio-&#34;&gt;GPIO è®¿é—®&lt;/h4&gt;
&lt;p&gt;æ¯ä¸ªå¸¦æœ‰ MPSSE çš„ FTDI èŠ¯ç‰‡éƒ½æœ‰ä¸€äº›ç®¡è„šå¯ä»¥ç”¨äºé€šç”¨ç›®çš„è¾“å…¥æˆ–è€…è¾“å‡ºã€‚åœ¨ä¸²å£é€šä¿¡çš„æ—¶å€™ï¼Œ&lt;code&gt;FT_Write&lt;/code&gt; ç”¨äºè®¾ç½®æ–¹å‘å’Œè¾“å‡ºå€¼ä½¿ MPSSE è¿”å›çœŸå®çš„ç®¡è„šçŠ¶æ€ã€‚åœ¨å¯¹ MPSSE ä½¿ç”¨ &lt;code&gt;read GPIO&lt;/code&gt; å‘½ä»¤åï¼Œ&lt;code&gt;FT_Read&lt;/code&gt; å°†ä¼šå–å›åŒ…å«å¼•è„šçŠ¶æ€çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-10&#34;&gt;å…³é—­å¤„ç†ç¨‹åº&lt;/h4&gt;
&lt;p&gt;å½“åº”ç”¨å®Œæˆä¸å¤–å›´çš„æ²Ÿé€šçš„æ—¶å€™ï¼Œå¤„ç†ç¨‹åºå¿…é¡»è¢«æ­£ç¡®å…³é—­ã€‚è™½ç„¶ä¸æ˜¯é¢å¤–çš„éœ€è¦ï¼Œä½†æ˜¯é‡å¯ MPSSE å¹¶å°†ç®¡è„šç½®ä¸ºç©ºé—²çŠ¶æ€æ˜¯ä¸€ä¸ªæ¨èçš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-11&#34;&gt;ä¾‹ç¨‹&lt;/h4&gt;
&lt;h5 id=&#34;heading-12&#34;&gt;ç¬¬ä¸€æ®µè®¾ç½®äº†ä¸€äº›å˜é‡ç”¨äºä»¥åä½¿ç”¨&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_tmain&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; argc, _TCHAR&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; argv[])
{
&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Variables
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;FT_HANDLE ftHandle; &lt;span style=&#34;color:#75715e&#34;&gt;/* FTDI device å¤„ç†å¯¹è±¡ */&lt;/span&gt;
FT_STATUS ftStatus; &lt;span style=&#34;color:#75715e&#34;&gt;/* æ¯ä¸ª D2XX è°ƒç”¨çš„ç»“æœ */&lt;/span&gt;
DWORD dwNumDevs; &lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾å¤‡æ•°é‡ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; uiDevIndex &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xF&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* è¦ç”¨åˆ°çš„è®¾å¤‡ç´¢å¼• */&lt;/span&gt;
BYTE byOutputBuffer[&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;]; &lt;span style=&#34;color:#75715e&#34;&gt;/* MPSSE å‘½ä»¤å’Œæ•°æ®ç¼“å­˜ï¼ˆå‘é€ï¼‰ */&lt;/span&gt;
BYTE byInputBuffer[&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;]; &lt;span style=&#34;color:#75715e&#34;&gt;/* MPSSE å‘½ä»¤å’Œæ•°æ®ç¼“å­˜ï¼ˆæ¥æ”¶ï¼‰ */&lt;/span&gt;
DWORD dwCount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* å¾ªç¯è®¡æ•° */&lt;/span&gt;
DWORD dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* è¾“å‡ºç¼“å­˜ç´¢å¼• */&lt;/span&gt;
DWORD dwNumBytesSent &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* FT_Write å®é™…è¾“å‡ºå­—èŠ‚ç»Ÿè®¡ */&lt;/span&gt;
DWORD dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* ç›®å‰æ¥æ”¶ç¼“å­˜ä¸­çš„å­—èŠ‚ */&lt;/span&gt;
DWORD dwNumBytesRead &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* FT_Read å®é™…è¯»å–çš„å­—èŠ‚ç»Ÿè®¡ */&lt;/span&gt;
DWORD dwClockDivisor &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x05DB&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* æ—¶é’Ÿåˆ†é¢‘å› å­, SCL Frequency = 60/((1+0x05DB)*2) (MHz) = 1Mhz */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;heading-13&#34;&gt;ç¡®è®¤è®¾å¤‡å­˜åœ¨å¹¶æ‰“å¼€å¤„ç†&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Does an FTDI device exist?
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Checking for FTDI devices...&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_CreateDeviceInfoList(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumDevs);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å–å¾— FTDI è®¾å¤‡æ•°é‡ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_OK) &lt;span style=&#34;color:#75715e&#34;&gt;/* å‘½ä»¤æ˜¯å¦æ­£ç¡®æ‰§è¡Œ */&lt;/span&gt;
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error in getting the number of devices&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é”™è¯¯é€€å‡º */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (dwNumDevs &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;/* å¦‚æœæ— è®¾å¤‡åˆ™é€€å‡º */&lt;/span&gt;
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;There are no FTDI devices installed&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é”™è¯¯é€€å‡º */&lt;/span&gt;
}
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;%d FTDI devices found &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;- the count includes individual ports on a single chip&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, dwNumDevs);
&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// æ‰“å¼€ç«¯å£ - è¿™ä¸ªåº”ç”¨é»˜è®¤ç¬¬ä¸€ä¸ªè®¾å¤‡æ˜¯ FTx232H è®¾å¤‡
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// åœ¨æ‰“å¼€ç«¯å£å‰ï¼Œå¯ä»¥æ£€æŸ¥è®¾å¤‡çš„æè¿°ï¼Œåœ°ç‚¹ï¼Œä¸²å£å·ï¼Œç­‰ç­‰
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Assume first device has the MPSSE and open it...&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Open(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;ftHandle);
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_OK)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Open Failed with error %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, ftStatus);
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é”™è¯¯é€€å‡º */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;-ftdi--mpsse&#34;&gt;è®¾ç½® FTDI ç«¯å£ä¸º MPSSE&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½®ç«¯å£å‚æ•° */&lt;/span&gt;
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Configuring port for MPSSE use...&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_ResetDevice(ftHandle);
&lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½® USB ç«¯å£ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* é¦–å…ˆé€šè¿‡è¯»å– FT232H æ¥æ”¶ç¼“å­˜ï¼Œæ¸…ç©º USB æ¥æ”¶ç¼“å­˜ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/* è¯»å–æ¥æ”¶ç¼“å­˜ä¸­çš„å­—èŠ‚æ•° */&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ((ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_OK) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; (dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;))
FT_Read(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;byInputBuffer, dwNumBytesToRead, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/* è¯»å–æ‰€æœ‰çš„ FT232H æ¥æ”¶ç¼“å­˜ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetUSBParameters(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;65536&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;65535&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½® USB è¯·æ±‚å‘é€å¤§å°ä¸º 64KB */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetChars(ftHandle, false, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, false, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å…³é—­é”™è¯¯äº‹ä»¶ç  */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetTimeouts(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;5000&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½®è¯»å–å’Œå†™å…¥è¶…æ—¶æ—¶é•¿ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetLatencyTimer(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½®å‘é€å»¶æ—¶ä¸º 1ms */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetFlowControl(ftHandle, FT_FLOW_RTS_CTS, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å¼€å¯æµæ§åˆ¶ä»¥åŒæ­¥ IN è¯·æ±‚ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½® MPSSE æ§åˆ¶å™¨ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x02&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å¼€å¯ MPSSE æ§åˆ¶å™¨ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_OK)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error in initializing the MPSSE %d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, ftStatus);
FT_Close(ftHandle);
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é”™è¯¯é€€å‡º */&lt;/span&gt;
}
Sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* ç­‰å¾… USB å®Œæˆè®¾ç½®å¹¶å‡†å¤‡å·¥ä½œ */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼š D2XX ä¸­ &lt;code&gt;ftStatus&lt;/code&gt; çš„è¿”å›å€¼å¯ä»¥åœ¨ä¸Šè¿°æ‰€æœ‰çš„ API è°ƒç”¨å®Œæˆåå½“åšæ€»æ£€æŸ¥ã€‚æ‰€ä»¥åœ¨æ¥ä¸‹æ¥çš„ä¾‹ç¨‹ä¸­ï¼Œ&lt;code&gt;ftStatus&lt;/code&gt; ä¸ä¼šåœ¨æ¯ä¸ªè°ƒç”¨ä»»åŠ¡åéƒ½è¢«æ£€æŸ¥ï¼Œè¯·æ³¨æ„ã€‚&lt;/p&gt;
&lt;h5 id=&#34;-mpsse-1&#34;&gt;è®¾ç½® MPSSE&lt;/h5&gt;
&lt;p&gt;åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ MPSSE å·²ç»å¯ä»¥æ¥å—å‘½ä»¤äº†ï¼Œæ¯ä¸ªå‘½ä»¤åŒ…å«ä¸€ä¸ª co-code ç´§è·Ÿç€ä¸€äº›å¿…é¡»çš„å‚æ•°æˆ–è€…æ•°æ®ã€‚ä¸ºäº†ä½¿ç¨‹åºæ¸…æ™°æ˜äº†ï¼Œæ¯ä¸ªå‘½ä»¤éƒ½å¿…é¡»ç‹¬è‡ªä½¿ç”¨ä¸€ä¸ª &lt;code&gt;FT_Write&lt;/code&gt; è°ƒç”¨ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæœ‰æ—¶å€™éœ€è¦å°†å¤šä¸ªå‘½ä»¤åˆå¹¶å¹¶ä½¿ç”¨ä¸€ä¸ª &lt;code&gt;FT_Write&lt;/code&gt; è°ƒç”¨ã€‚&lt;/p&gt;
&lt;h6 id=&#34;heading-14&#34;&gt;åŒæ­¥å’Œåå‘½ä»¤æ£€æµ‹&lt;/h6&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* å†…éƒ¨å›ç¯è¿æ¥æµ‹è¯• */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x84&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* å¼€å¯å›ç¯è¿æ¥ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, \
dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å‘é€å›ç¯å‘½ä»¤ */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½®è¾“å‡ºç¼“å­˜æŒ‡é’ˆ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ£€æŸ¥æ¥æ”¶ç¼“å­˜ï¼Œåº”è¯¥æ˜¯ç©º */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å–å¾—æ¥æ”¶ç¼“å­˜çš„å­—èŠ‚æ•° */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error - MPSSE receive buffer should be empty&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, ftStatus);
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½®ç«¯å£ä»¥å…³é—­ MPSSE */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/* å…³é—­ USB ç«¯å£ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é”™è¯¯é€€å‡º */&lt;/span&gt;
}
&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// åŒæ­¥ MPSSE é€šè¿‡å‘é€ä¸€ä¸ªå‡ op-code å­—èŠ‚ (0xAB),
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// MPSSE å°†ä¼šç›¸åº” &amp;#34;åå‘½ä»¤&amp;#34; (0xFA) 
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// å’Œå¯¹åº”çš„ op-code æœ¬èº«å‘é€åˆ°åº”ç”¨ä¸Šã€‚
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xAB&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* å¢åŠ å‡ op-code å­—èŠ‚ (0xAB) åˆ°é˜Ÿåˆ—ä¸­ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å‘é€å‡å­—èŠ‚ */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½®è¾“å‡ºç¼“å­˜æŒ‡é’ˆ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
{
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å¾—åˆ°æ¥æ”¶ç¼“å­˜ä¸­çš„å­—èŠ‚æ•° */&lt;/span&gt;
} &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; ((dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; (ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_OK));
&lt;span style=&#34;color:#75715e&#34;&gt;/* è¶…æ—¶è·³å‡º */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; bCommandEchod &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; false;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Read(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;byInputBuffer, dwNumBytesToRead, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/* ä»è¾“å…¥ç¼“å­˜ä¸­è¯»å–ç›¸åº”æ•°é‡å­—èŠ‚ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (dwCount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; dwCount &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; dwNumBytesRead &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; dwCount&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ£€æŸ¥æ˜¯å¦æœ‰åå‘½ä»¤ä¿¡æ¯ */&lt;/span&gt;
{
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ((byInputBuffer[dwCount] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xFA&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; (byInputBuffer[dwCount&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xAB&lt;/span&gt;))
{
bCommandEchod &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; true;
&lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
}
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (bCommandEchod &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; false)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error in synchronizing the MPSSE&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
FT_Close(ftHandle);
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é”™è¯¯é€€å‡º */&lt;/span&gt;
}

&lt;span style=&#34;color:#75715e&#34;&gt;/* å…³é—­å†…éƒ¨å›ç¯è¿æ¥ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x85&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* å…³é—­å›ç¯å‘½ä»¤å†™å…¥ç¼“å­˜ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer,\
dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å‘é€å…³é—­å›ç¯å‘½ä»¤ */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½®è¾“å‡ºç¼“å­˜æŒ‡é’ˆ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ£€æŸ¥è¾“å‡ºç¼“å­˜æ˜¯å¦æœ‰å­—èŠ‚ - åº”å½“æ²¡æœ‰ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å–å¾—æ¥æ”¶ç¼“å­˜ä¸­çš„å­—èŠ‚æ•° */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error - MPSSE receive buffer should be empty&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, ftStatus);
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½® MPSSE ä»¥å…³é—­ç«¯å£ */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/* å…³é—­ USB ç«¯å£ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é”™è¯¯é€€å‡º */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h6 id=&#34;mpsse--5&#34;&gt;MPSSE å»ºç«‹&lt;/h6&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// è®¾ç½® MPSSE ä¸º JTAG
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// å¯ä»¥åœ¨ä¸€ä¸ª FT_Write ä¸­å‘é€å¤šä¸ªæŒ‡ä»¤
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* å¼€å¯ä¸€ä¸ªæ–°çš„å‘é€ç´¢å¼•æ•° */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½®é«˜é€Ÿæ¨¡å¼çš„ FTx232H */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x8A&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ä½¿ç”¨ 60MHz æ—¶é’Ÿä¸»é¢‘ - å…³é—­ 5 åˆ†é¢‘å™¨ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x97&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* å…³é—­é€‚åº”æ€§æ—¶é’Ÿ(å¯èƒ½å¯¹äº ARM èŠ¯ç‰‡éœ€è¦å¼€å¯) */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x8D&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* å…³é—­ä¸‰ç›¸æ—¶é’Ÿ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å‘é€ä»¥ä¸Šçš„å‘½ä»¤ */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½®è¾“å‡ºç¼“å­˜æŒ‡é’ˆ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½®åˆ†é¢‘å› å­ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TCK = 60MHz /((1 + [(1 +0xValueH*256) OR 0xValueL])*2) */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;\x86&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½®æ—¶é’Ÿåˆ†é¢‘å› å­çš„æŒ‡ä»¤ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dwClockDivisor &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xFF&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½® 0xValueL çš„åˆ†é¢‘å› å­ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (dwClockDivisor &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xFF&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½® 0xValueH çš„åˆ†é¢‘å› å­ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å‘é€ä»¥ä¸Šçš„åˆ†é¢‘å› å­è®¾ç½®æŒ‡ä»¤ */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½®è¾“å‡ºç¼“å­˜æŒ‡é’ˆ */&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;// åˆå§‹åŒ– MPSSE ç•Œé¢ - P1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// - ä½å­—èŠ‚, å¯¹åº”ç®¡è„šæ–¹å‘å’Œè¾“å‡ºå€¼
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Pin name Signal Direction Config Initial State Config
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS0   TCK/SK output    1      high          1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS1   TDI/DO output    1      low           0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS2   TDO/DI input     0                    0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS3   TMS/CS output    1      high          1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS4   GPIOL0 output    1      low           0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS5   GPIOL1 output    1      low           0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS6   GPIOL2 output    1      high          1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ADBUS7   GPIOL3 output    1      high          1
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x80&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½® MPSSE ç®¡è„šä½å­—èŠ‚ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xC9&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½®ä¸Šè¡¨çš„ Initial State åˆå§‹çŠ¶æ€ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xFB&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½®ä¸Šè¡¨çš„ Direction æ–¹å‘ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å‘é€ä¸Šè¿°å‘½ä»¤ */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½®è¾“å‡ºç¼“å­˜æŒ‡é’ˆ */&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;/* è¯·æ³¨æ„æ•°æ®åœ¨ä¸‹è¿°éƒ¨åˆ†å°†ä¼šåœ¨ä¸Šå‡æ²¿éœ‡è¡ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* åˆå§‹æ—¶é’ŸçŠ¶æ€ä¸ºé«˜ - æ—¶é’Ÿä¿¡å·ä¸º é«˜-ä½-é«˜ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨è¿™ä¸ªç¨‹åºä¸­ï¼Œä¿¡æ¯åœ¨ä¸Šå‡æ²¿æ”¹å˜ï¼Œä¸ºäº†ç»™å…¶è¶³å¤Ÿçš„æ—¶é—´è®©å…¶æœ‰æ•ˆï¼Œæ‰€ä»¥ä¼šåœ¨ä¸‹é™æ²¿æ¥æ”¶æ•°æ® */&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;// åˆå§‹åŒ– MPSSE ç•Œé¢ - P2
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// - é«˜å­—èŠ‚, å¯¹åº”ç®¡è„šæ–¹å‘å’Œè¾“å‡ºå€¼
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Pin name Signal Direction Config Initial State Config
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS0   GPIOH0 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS1   GPIOH1 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS2   GPIOH2 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS3   GPIOH3 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS4   GPIOH4 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS5   GPIOH5 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS6   GPIOH6 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ACBUS7   GPIOH7 input     0      0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x82&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½® MPSSE ç®¡è„šé«˜å­—èŠ‚ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½®ä¸Šè¡¨çš„ Initial State åˆå§‹çŠ¶æ€ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* è®¾ç½®ä¸Šè¡¨çš„ Direction æ–¹å‘ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å‘é€ä¸Šè¿°å‘½ä»¤ */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½®è¾“å‡ºç¼“å­˜æŒ‡é’ˆ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(dwCount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; dwCount &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;; dwCount&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
{ &lt;span style=&#34;color:#75715e&#34;&gt;/* æ¸…ç©ºè¾“å…¥å’Œè¾“å‡ºç¼“å­˜ */&lt;/span&gt;
byInputBuffer[dwCount] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;;
byOutputBuffer[dwCount] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;heading-15&#34;&gt;ä¸²å£äº¤æµç¨‹åº&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* æ•°æ®åªå‘é€ä¸æ¥æ”¶ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x10&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* è¾“å‡ºåœ¨ä¸Šå‡æ²¿ï¼Œä¸è¾“å…¥ï¼ŒMSB é¦–å…ˆå‘é€ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ—¶é’Ÿåœ¨å‘é€åç©ºé—²ï¼ˆé«˜ï¼‰ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x01&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* å­—èŠ‚é•¿åº¦ - ä½å­—èŠ‚ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* å­—èŠ‚é•¿åº¦ - é«˜å­—èŠ‚ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* å­—èŠ‚é•¿åº¦ = 0x0001+1 = 2 bytes */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xA5&lt;/span&gt;;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0F&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ•°æ® = 0xA50F */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ•°æ®å‘å°„ */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½®è¾“å‡ºç¼“å­˜æŒ‡é’ˆ */&lt;/span&gt;
Sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* ç­‰å¾…å‘é€å®Œæ¯• æ£€æŸ¥çŠ¶æ€ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ•°æ®åŒ…å‘é€å»¶æ—¶ 1ms æ•…æ­¤å¤„è¦ç­‰å¾…å¤§äº 1ms */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ£€æŸ¥è¾“å‡ºç¼“å­˜æ˜¯å¦æœ‰å­—èŠ‚ - åº”å½“æ²¡æœ‰ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ£€æŸ¥æ¥æ”¶ç¼“å­˜æ˜¯å¦æœ‰å­—èŠ‚ - åº”å½“æ²¡æœ‰ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æœ¬æ®µç¨‹åºç¬¬ä¸€å¥è®¾ç½®ä¸ºæ•°æ®åªå‘é€ä¸æ¥æ”¶ */&lt;/span&gt;
FT_Read(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;byInputBuffer, dwNumBytesToRead, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesRead);
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error - MPSSE receive buffer should be empty&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, ftStatus);
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½® MPSSE ä»¥å…³é—­ç«¯å£ */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/* å…³é—­ USB ç«¯å£ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é”™è¯¯é€€å‡º */&lt;/span&gt;
}

&lt;span style=&#34;color:#75715e&#34;&gt;/* ç»§ç»­ */&lt;/span&gt;

printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Press &amp;lt;Enter&amp;gt; to continue&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
getchar(); &lt;span style=&#34;color:#75715e&#34;&gt;/* æ•è·ä¸€ä¸ªå­—ç¬¦è¾“å…¥ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ›´æ”¹å‘é€è®¾ç½®ï¼Œé‡å¤å‘é€è¿‡ç¨‹ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ—¢å‘é€æ•°æ®ï¼Œåˆæ¥æ”¶æ•°æ® */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x34&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* è¾“å‡ºåœ¨ä¸Šå‡æ²¿ï¼Œè¾“å…¥åœ¨ä¸‹é™æ²¿ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MSB é¦–å…ˆå‘é€ï¼Œæ—¶é’Ÿåœ¨å‘é€åç©ºé—²ï¼ˆé«˜ï¼‰ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x01&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* å­—èŠ‚é•¿åº¦ - ä½å­—èŠ‚ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* å­—èŠ‚é•¿åº¦ - é«˜å­—èŠ‚ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* å­—èŠ‚é•¿åº¦ = 0x0001+1 = 2 bytes */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xA5&lt;/span&gt;;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0F&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ•°æ® = 0xA50F */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å‘å°„æ•°æ® */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½®è¾“å‡ºç¼“å­˜æŒ‡é’ˆ */&lt;/span&gt;
Sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* ç­‰å¾…å‘é€å®Œæ¯• æ£€æŸ¥çŠ¶æ€ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ•°æ®åŒ…å‘é€å»¶æ—¶ 1ms æ•…æ­¤å¤„è¦ç­‰å¾…å¤§äº 1ms */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ£€æŸ¥è¾“å‡ºç¼“å­˜æ˜¯å¦æœ‰å­—èŠ‚ - åº”å½“æœ‰ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ£€æŸ¥æ¥æ”¶ç¼“å­˜æ˜¯å¦æœ‰å­—èŠ‚ - åº”å½“æœ‰ä¸¤ä¸ª */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* å› ä¸ºç›®å‰æ˜¯å›ç¯çŠ¶æ€ */&lt;/span&gt;
FT_Read(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;byInputBuffer, dwNumBytesToRead, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/* åº”å½“æœ‰ä¸¤ä¸ª */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error - MPSSE receive buffer should have the looped-back data&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½® MPSSE ä»¥å…³é—­ç«¯å£ */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/* å…³é—­ USB ç«¯å£ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é”™è¯¯é€€å‡º */&lt;/span&gt;
}
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;The correct number of bytes have been received&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ£€æŸ¥å‘é€ä¸æ¥æ”¶æ•°æ®æ˜¯å¦ä¸€è‡´ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(dwCount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; dwCount &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dwNumBytesRead &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; dwCount&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
{
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (byInputBuffer[dwCount] &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; byOutputBuffer[dwCount &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;])
&lt;span style=&#34;color:#75715e&#34;&gt;/* è¾“å‡ºæ•°ç»„ä»ç´¢å¼• 3 åå¼€å§‹æ‰æ˜¯æ•°æ® */&lt;/span&gt;

{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error - Data received does not match data output&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½® MPSSE ä»¥å…³é—­ç«¯å£ */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/* å…³é—­ USB ç«¯å£ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é”™è¯¯é€€å‡º */&lt;/span&gt;
}
}
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;The input data matches the output data&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);

&lt;span style=&#34;color:#75715e&#34;&gt;/* ç»§ç»­ */&lt;/span&gt;

printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Press &amp;lt;Enter&amp;gt; to continue&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
getchar(); &lt;span style=&#34;color:#75715e&#34;&gt;/* æ•è·ä¸€ä¸ªå­—ç¬¦è¾“å…¥ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(dwCount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; dwCount &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;; dwCount&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;)
{ &lt;span style=&#34;color:#75715e&#34;&gt;/* æ¸…ç©ºè¾“å…¥å’Œè¾“å‡ºæ•°ç»„ */&lt;/span&gt;
byInputBuffer[dwCount] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;;
byOutputBuffer[dwCount] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;gpio--1&#34;&gt;GPIO ä¾‹ç¨‹&lt;/h4&gt;
&lt;p&gt;æœ‰äº› FTDI MPSSE ç®¡è„šä¸æ˜¯ä¸“ç”¨ç®¡è„šï¼Œè¿™äº›ç®¡è„šå¯ä»¥ç”¨äº GPIOã€‚è¿™äº›ç®¡è„šå¯ä»¥ä½œä¸º SPI é€šä¿¡ä¸­çš„ç‰‡é€‰ä¿¡å·ï¼Œç½®ä½æˆ–è€…æ¸…é›¶è¿™äº›ç®¡è„šçš„æ–¹æ³•ä¹Ÿå¾ˆæµè¡Œã€‚å¦‚æœæ¯ä¸ªå‘½ä»¤å•ç‹¬ä½¿ç”¨ &lt;code&gt;FT_Write&lt;/code&gt; æ¥æ§åˆ¶ GPIOï¼ŒGPIO çš„é€Ÿåº¦å°†ä¼šå—åˆ°å¾ˆå¤§çš„é™åˆ¶ï¼ˆç”±äºå‘é€å»¶æ—¶çš„å­˜åœ¨ï¼‰ï¼Œä»¥ä¸‹ä¾‹ç¨‹å±•ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ª &lt;code&gt;FT_Write&lt;/code&gt; ä¸­å‘é€å¤šä¸ªå‘½ä»¤ã€‚ç‰‡é€‰ä¿¡å·è¢«å‘é€æœ‰æ•ˆä½ï¼ˆä½ï¼‰ï¼Œæ¥ç€å‘é€æ•°æ®æµï¼Œæœ€åç‰‡é€‰ä¿¡å·å‘é€æ— æ•ˆä½ï¼ˆé«˜ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹åˆ—ä»£ç å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„ &lt;strong&gt;è¯»-ä¿®æ”¹-å†™&lt;/strong&gt; çš„åºåˆ—ï¼Œä»¥ç¡®ä¿æ¯ä¸ª GPIO ä½å®Œæ•´æœ‰æ•ˆã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Read From GPIO low byte
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// *************************************************
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Change scope trigger to channel 4 (TMS/CS) falling edge
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// *************************************************
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x81&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ¥æ”¶ä½æ•°æ® - è¿”å›çŠ¶æ€å€¼ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ—¢è¿”å›è¾“å…¥ä¹Ÿè¿”å›è¾“å‡º */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ä½å­—èŠ‚çš„ GPIO */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/* è¯»å– GPIO ä½ä½å­—èŠ‚ */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½®è¾“å‡ºç¼“å­˜æŒ‡é’ˆ */&lt;/span&gt;
Sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* ç­‰å¾…å‘é€å®Œæ¯• æ£€æŸ¥çŠ¶æ€ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ•°æ®åŒ…å‘é€å»¶æ—¶ 1ms æ•…æ­¤å¤„è¦ç­‰å¾…å¤§äº 1ms */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ£€æŸ¥è¾“å‡ºç¼“å­˜æ˜¯å¦æœ‰å­—èŠ‚ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_GetQueueStatus(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesToRead);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å¾—åˆ° FTx232H çš„æ¥æ”¶ç¼“å­˜å­—èŠ‚æ•° */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Read(ftHandle, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;byInputBuffer, dwNumBytesToRead, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesRead);
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ((ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_OK) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; (dwNumBytesToRead &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;))
{
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Error - GPIO cannot be read&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½® MPSSE ä»¥å…³é—­ç«¯å£ */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/* å…³é—­ USB ç«¯å£ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* é”™è¯¯é€€å‡º */&lt;/span&gt;
}
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;The GPIO low-byte = 0x%X&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, byInputBuffer[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]);
&lt;span style=&#34;color:#75715e&#34;&gt;/* è¾“å…¥åº”å½“åªæœ‰ä¸€ä¸ªå­—èŠ‚ */&lt;/span&gt;
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Press &amp;lt;Enter&amp;gt; to continue&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
getchar(); &lt;span style=&#34;color:#75715e&#34;&gt;/* æ•è·ä¸€ä¸ªå­—ç¬¦è¾“å…¥ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ä¿®æ”¹ GPIO å­—èŠ‚å¹¶å‘é€ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x80&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ä¿®æ”¹ GPIO ä½ä½å­—èŠ‚ */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; byInputBuffer[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xF7&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ä»…ä»…å°†ç‰‡é€‰ä¿¡å·ç½® 0 */&lt;/span&gt;
byOutputBuffer[dwNumBytesToSend&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xFB&lt;/span&gt;;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ä»ç„¶éœ€è¦å†™å…¥ GPIO æ–¹å‘ */&lt;/span&gt;
ftStatus &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FT_Write(ftHandle, byOutputBuffer, dwNumBytesToSend, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;dwNumBytesSent);
&lt;span style=&#34;color:#75715e&#34;&gt;/* å‘å°„æ•°æ® */&lt;/span&gt;
dwNumBytesToSend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// Reset output buffer pointer
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;Sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* ç­‰å¾…å‘é€å®Œæ¯• æ£€æŸ¥çŠ¶æ€ */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ•°æ®åŒ…å‘é€å»¶æ—¶ 1ms æ•…æ­¤å¤„è¦ç­‰å¾…å¤§äº 1ms */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* æ£€æŸ¥è¾“å‡ºç¼“å­˜æ˜¯å¦æœ‰å­—èŠ‚ */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;heading-16&#34;&gt;å…³é—­å¤„ç†ç¨‹åº&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Start closing everything down
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// -----------------------------------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;AN_135 example program executed successfully.&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
printf(&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Press &amp;lt;Enter&amp;gt; to continue&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;);
getchar(); &lt;span style=&#34;color:#75715e&#34;&gt;/* æ•è·ä¸€ä¸ªå­—ç¬¦è¾“å…¥ */&lt;/span&gt;
FT_SetBitMode(ftHandle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00&lt;/span&gt;);
&lt;span style=&#34;color:#75715e&#34;&gt;/* é‡ç½® MPSSE ä»¥å…³é—­ç«¯å£ */&lt;/span&gt;
FT_Close(ftHandle); &lt;span style=&#34;color:#75715e&#34;&gt;/* å…³é—­ USB ç«¯å£ */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* æˆåŠŸé€€å‡º */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ FT232H ä¸­çš„ MPSSE ç®€å•ä½¿ç”¨æ–¹æ³•ã€‚&lt;/p&gt;
&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;æŒ‡æ ¡éªŒä½å§‹ç»ˆä¸º 1 çš„æ ¡éªŒæ–¹å¼ã€‚ &lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;æŒ‡æ ¡éªŒä½å§‹ç»ˆä¸º 0 çš„æ ¡éªŒæ–¹å¼ã€‚ &lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Clock Signal Output. &lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Serial Data Output. &lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:5&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Serial Data Input. &lt;a href=&#34;#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:6&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Output Signal Select. &lt;a href=&#34;#fnref:6&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:7&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;æ­¤ GPIO ç®¡è„šå†…éƒ¨æœ‰ä¸€ä¸ªçº¦ä¸º 75KÎ© çš„ä¸‹æ‹‰ç”µé˜»è¿æ¥åˆ°åœ°ï¼Œå¦‚æœä½¿ç”¨ EEPROM æ­¤ç®¡è„šå¯è¢«è®¾ç½®æˆä¸º USBVCC æ¨¡å¼è€Œä¸æ˜¯ GPIO æ¨¡å¼ã€‚ &lt;a href=&#34;#fnref:7&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:8&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;æ­¤ç®¡è„šé»˜è®¤ä¸ºä¸‰æ€è¾“å…¥ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªçº¦ä¸º 75KÎ© çš„ä¸Šæ‹‰ç”µé˜»è¿æ¥åˆ° VCCIOã€‚ &lt;a href=&#34;#fnref:8&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:9&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;æ­¤ç®¡è„šé»˜è®¤ä¸ºä¸‰æ€è¾“å…¥ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªçº¦ä¸º 75KÎ© çš„ä¸Šæ‹‰ç”µé˜»è¿æ¥åˆ° VCCIOã€‚ &lt;a href=&#34;#fnref:9&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:10&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;åœ¨å®˜æ–¹æ–‡æ¡£ä¸­è¿™ä¸ªå€¼æ˜¯åœ¨ t1 çš„ Max æ ä¸‹çš„ï¼Œæˆ‘è®¤ä¸ºæ˜¯ typo å°†å…¶å½’ç±»åœ¨äº† Min æ ä¸‹ã€‚ &lt;a href=&#34;#fnref:10&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 8 Systick</title>
      <link>https://xiahualiu.github.io/posts/2017-10-26-s32k144_8/</link>
      <pubDate>Thu, 26 Oct 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-10-26-s32k144_8/</guid>
      <description>&lt;p&gt;æœ¬ç« çš„å†…å®¹æ˜¯å…³äº Cortex M4F å†…æ ¸ä¸­çš„ SysTick æ—¶é’Ÿçš„è¿ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ¨¡å—ï¼Œå¯ä»¥å®ç°é«˜ç²¾åº¦çš„å»¶æ—¶å’Œå¿«é€Ÿä¸­æ–­çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿™ä¸ªå†…æ ¸åŠŸèƒ½åœ¨ MCU OEM å‚å•†çš„ Reference Manual ä¸­ä¸€èˆ¬éƒ½æ²¡æœ‰ç»™å‡ºå…·ä½“çš„å®ç°æ–¹æ³•ï¼Œä»Šå¤©æˆ‘ä»¬é’ˆå¯¹å†…æ ¸æ¥è¿›è¡Œåˆ†æã€‚&lt;/p&gt;
&lt;p&gt;SysTick åœ¨å‚è€ƒæ‰‹å†Œä¸­æåˆ°çš„å°±æ˜¯æœ‰å…³ä¸­æ–­ä¼˜å…ˆçº§çš„é‚£ä¸€ç« ï¼ŒSysTick ç±»ä¼¼äº LPIT è®¡æ—¶å™¨ï¼Œä½†æ˜¯ç›´æ¥ä½¿ç”¨çš„æ˜¯å†…æ ¸çš„æ—¶é’Ÿè¿›è¡Œè®¡æ•°ï¼Œä¸­æ–­ä¼˜å…ˆçº§åœ¨å†…æ ¸ä¸­æ˜¯æœ€ä½çš„ï¼Œä½†æ˜¯ç›¸å¯¹äºå¤–å›´æ˜¯é«˜çš„ã€‚è¿™ä¸ªæ¨¡å—çš„ä½¿ç”¨ä¸»è¦é›†ä¸­åœ¨ 4 ä¸ªå¯„å­˜å™¨å†…ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** S32_SysTick - Register Layout Typedef */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
  __IO uint32_t CSR;                               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; SysTick Control and Status Register, offset: 0x0 */&lt;/span&gt;
  __IO uint32_t RVR;                               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; SysTick Reload Value Register, offset: 0x4 */&lt;/span&gt;
  __IO uint32_t CVR;                               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; SysTick Current Value Register, offset: 0x8 */&lt;/span&gt;
  __I  uint32_t CALIB;                             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; SysTick Calibration Value Register, offset: 0xC */&lt;/span&gt;
} S32_SysTick_Type, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;S32_SysTick_MemMapPtr;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ˜¯ 4 ä¸ª 32 ä½çš„å¯„å­˜å™¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;systick-control-and-status-register-systick-csr&#34;&gt;SysTick Control and Status Register (SysTick_CSR)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;COUNTFLAG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SysTick è®¡æ•°æ¯”è¾ƒæ ‡å¿—&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;å¦‚æœåœ¨ä¸Šæ¬¡è¯»å–æœ¬å¯„å­˜å™¨åï¼ŒSysTick å·²ç»æ•°åˆ°äº†0ï¼Œåˆ™è¯¥ä½ä¸º1&lt;!-- raw HTML omitted --&gt;å¦‚æœè¯»å–è¯¥ä½ï¼Œè¯¥ä½å°†è‡ªåŠ¨æ¸…é›¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLKSOURCE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SysTick æ—¶é’Ÿæºé€‰æ‹©&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 é€‰æ‹©å†…æ ¸æ—¶é’Ÿ&lt;!-- raw HTML omitted --&gt;1 é€‰æ‹©å†…æ ¸æ—¶é’Ÿ&lt;!-- raw HTML omitted --&gt;éœ‡æƒŠä¸ï¼Œäº‹å®å°±æ˜¯è¿™æ ·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TICKINT&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SysTick ä¸­æ–­ä½¿èƒ½ä½&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 ç¦ç”¨&lt;!-- raw HTML omitted --&gt;1 å¼€å¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ENABLE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SysTick ä½¿èƒ½ä½&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 å…³é—­ SysTick&lt;!-- raw HTML omitted --&gt;1 å¼€å¯ SysTick&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;systick-reload-value-register-systick-rvr&#34;&gt;SysTick Reload Value Register (SysTick_RVR)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;23-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RELOAD&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SysTick é‡è½½å¯„å­˜å™¨&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;å¦‚æœ SysTick å·²ç»æ•°åˆ°äº†0&lt;!-- raw HTML omitted --&gt;åˆ™é‡æ–°è£…è½½è¿›æ­¤å¯„å­˜å™¨çš„å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;systick-current-value-register-systick-cvr&#34;&gt;SysTick Current Value Register (SysTick_CVR)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;23-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CURRENT&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SysTick å½“å‰å€¼å¯„å­˜å™¨&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;è¯»å–æ—¶è¿”å›å½“å‰è®¡æ•°å€¼å¹¶å°†å…¶æ¸…é›¶&lt;!-- raw HTML omitted --&gt;åŒæ—¶æ¸…é™¤ COUNTFLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;systick-calibration-value-register-systick-calib&#34;&gt;SysTick Calibration Value Register (SysTick_CALIB)&lt;/h3&gt;
&lt;p&gt;æ ¡å‡†å¯„å­˜å™¨ï¼Œä¸çŸ¥é“å’‹ç”¨ã€‚å¥½åƒåœ¨ä½¿ç”¨è¯´æ˜ä¸­è¯´äº†è¿™ä¸€éƒ¨åˆ†çš„å€¼å¿…é¡»å–å…¨ 0ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨æ¥è®²è§£è¿™ä¸ªä¸œè¥¿ç©¶ç«Ÿæ€ä¹ˆç”¨å•Šï¼Œä»ä¸Šé¢çš„æè¿°æˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™å°±æ˜¯ä¸€ä¸ªå†…æ ¸å±‚é¢çš„è®¡æ—¶å™¨ï¼Œå¯ä»¥è§¦å‘ä¸­æ–­ï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡ä½œä¸ºè®¡æ•°å€¼ï¼Œåœ¨å»¶æ—¶å­ç¨‹åºä¸­ç»™è¿™ä¸ªå˜é‡ä¼ é€’ä¸€ä¸ªå€¼ç„¶åå¾ªç¯åˆ¤æ–­æ­¤å€¼æ˜¯å¦ä¸º 1ï¼Œç„¶ååœ¨ä¸­æ–­æœåŠ¡ç¨‹åºä¸­æ¯æ¬¡è§¦å‘å°±å°†æ­¤å€¼å‡ä¸€å°±å¯ä»¥åšåˆ°ç²¾ç¡®å»¶æ—¶çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å†™ä¸€ä¸‹æˆ‘è‡ªå·±å†™çš„å»¶æ—¶ç¨‹åºï¼Œå·²ç»éªŒè¯èƒ½å¤Ÿä½¿ç”¨ã€‚ä½¿ç”¨æ–¹æ³•å°±æ˜¯ &lt;code&gt;include&lt;/code&gt; ä½ è‡ªå·±å†™çš„å¤´æ–‡ä»¶ç„¶åä½¿ç”¨ &lt;code&gt;delay_ms()&lt;/code&gt; å³å¯ã€‚&lt;em&gt;å¤´æ–‡ä»¶æ€ä¹ˆå†™ä¸ç”¨æ•™å§&amp;hellip;&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* delay.c              Eggycat
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; * Description:  Use SysTick function to perform millisecond-level (us-level also if you like) delay in S32K144 Landzo-FRDM
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; * 2017 10 25 initial version
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; */&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;delay.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
uint32_t Systok &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// declare Systok as an extern parameter
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; idle_counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SysTick_init&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){ &lt;span style=&#34;color:#75715e&#34;&gt;// clock frequency=80MHz,
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// configure NVIC register
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    S32_NVIC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;ICPR[&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;31&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* IRQ-1-SysTick: clr any pending IRQ*/&lt;/span&gt;
    S32_NVIC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;ISER[&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;31&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* IRQ-1-SysTick: enable IRQ */&lt;/span&gt;
    S32_NVIC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;IP[&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x0A&lt;/span&gt;;

    S32_SysTick&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;RVR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;80000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// Reload 80000 = 1ms if you want a us change this value to 80.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    S32_SysTick&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CVR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// Initialize Current Value Register for a new reload on enable.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;delay_ms&lt;/span&gt;(uint32_t i){ &lt;span style=&#34;color:#75715e&#34;&gt;// delay_ms(time)
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    Systok &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; i;
    S32_SysTick&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// TICKINT=1 enable SysTick interrupt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;                        &lt;span style=&#34;color:#75715e&#34;&gt;// Enable=1 enable SysTick;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;                        &lt;span style=&#34;color:#75715e&#34;&gt;// CLKSOURCE=1 SysTick clock rate=80MHz=10MHz
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(Systok&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;){    &lt;span style=&#34;color:#75715e&#34;&gt;// Loop till Systok=0
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        idle_counter&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;; 
    }
    S32_SysTick&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// Disable SysTick interrupt.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    idle_counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; S32_SysTick&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CVR; &lt;span style=&#34;color:#75715e&#34;&gt;// Any reads from CVR clear both COUNTFLAG &amp;amp; CVR
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SysTick_Handler&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
    idle_counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; S32_SysTick&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CVR; &lt;span style=&#34;color:#75715e&#34;&gt;// Any reads from CVR clear both COUNTFLAG &amp;amp; CVR
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    Systok&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 7 SPI</title>
      <link>https://xiahualiu.github.io/posts/2017-10-20-s32k144_7/</link>
      <pubDate>Fri, 20 Oct 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-10-20-s32k144_7/</guid>
      <description>&lt;p&gt;æœ¬èŠ‚é’ˆå¯¹äº†æˆ‘åœ¨å·¥ç¨‹ä¸Šéœ€è¦äºŸå¾…ç€æ‰‹è§£å†³çš„ä¸€ä¸ªæ–¹é¢ä¹Ÿå°±æ˜¯ä½¿ç”¨å¤–æ¥ SPI ç½‘å¡è¿›è¡Œé«˜é€Ÿä¼ è¾“çš„ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨è¿™é‡Œæ‰“ç®—è¿›è¡Œä»”ç»†çš„è§£è¯»ä¸€ä¸‹æœ‰å…³ SPI åè®®ä½¿ç”¨çš„éƒ¨åˆ†ã€‚ä½†æ˜¯è¿˜æ˜¯è€æ ·å­ï¼Œæˆ‘ä»¬æ ¹æ®ä¾‹ç¨‹è¿›è¡Œåˆ†æç›¸å…³çš„å¯„å­˜å™¨å’Œä½¿ç”¨æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ä¾‹ç¨‹æ¥è‡ª NXP å®˜æ–¹ç»™å‡ºçš„ AN5413 Cookbook ä¸Šé¢çš„ç¨‹åºã€‚&lt;/p&gt;
&lt;h3 id=&#34;heading&#34;&gt;ä»‹ç»&lt;/h3&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ LPSPI ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä½¿ç”¨äº† FIFO å¯ä»¥æœ‰æ•ˆæé«˜ååé‡ã€‚ç»è¿‡åˆå§‹åŒ–ï¼Œä¸€ä¸ª 16-bit çš„å¸§å°†ä¼šä»¥ 1Mbps çš„é€Ÿåº¦è¿›è¡Œä¼ è¾“ã€‚åœ¨è¿™é‡Œä½¿ç”¨äº†è½¯ä»¶ä¸Šä¸‹æ‹‰æ ‡å¿—ä½è¿›è¡Œè¯»å–ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸­æ–­å’Œ DMAã€‚&lt;/p&gt;
&lt;p&gt;S32K144 è¯„ä¼°æ¿ä½¿ç”¨ LPSPI çš„è¯´æ˜ï¼šåœ¨ä¾‹ç¨‹ä¸­ä½¿ç”¨äº† LPSPI1 å’Œå¤–éƒ¨èŠ¯ç‰‡é€‰æ‹© 3ï¼Œé“¾æ¥åœ¨ MC33903 æˆ–è€…æ˜¯ UGA1169TK/F è¿™ä¸¤ä¸ª SBC(System Basis Chip) èŠ¯ç‰‡ä¸Šé¢(é»˜è®¤æ˜¯ä½¿ç”¨å‰è€…)ï¼Œå¦‚æœè¿™ä¸ªèŠ¯ç‰‡æ”¶åˆ°æ•°æ®è¢«æ¿€æ´»åï¼Œä¼šè¿”å›ä¸€ä¸ª Reading Status Register çš„å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“æˆ‘ä»¬åœ¨ LPSPI ä¸Šçš„æ•°æ®æ˜¯å¦è¢«å‘é€åˆ°ã€‚ä¸ºäº†ç»™è¿™ä¸ª SBC ä¾›ç”µï¼Œå¿…é¡»è¦è¿æ¥ä¸€ä¸ª 12V çš„ç”µæºä¾›åº”åˆ° EVB å¹¶ä¸”è¿æ¥ 1-2 ç®¡è„šåœ¨ J107 è·³çº¿éƒ¨åˆ†ã€‚åœ¨è¿™ä¸ªæ—¶å€™ä»æ—§å¯ä»¥ä½¿ç”¨ä¸€ä¸ª USB è¿æ¥åœ¨ EVB ä¸Šé¢ä»¥å…è®¸ EVB è°ƒè¯•åŠŸèƒ½å¼€å¯ã€‚å¦‚æœ SBC æ²¡æœ‰è¢«ä¾›ç”µçš„è¯ï¼Œæ‰€æœ‰çš„ LPSPI æ”¶åˆ°çš„æ•°æ®éƒ½ä¼šæ˜¯ 0ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ LPSPI1 è¦é¦–å…ˆåœ¨ PCC ä¸­é€‰æ‹©æ—¶é’Ÿï¼Œç„¶åæ ¹æ® æ‹©çš„æ—¶é’Ÿè¿›è¡Œåˆ†é¢‘ï¼Œæ³¢ç‰¹ç‡è®¡ç®—ï¼Œåœ¨ LPSPI1 ä¸­æœ‰ä¸¤ä¸ª FIFO å¯„å­˜å™¨ï¼Œåˆ†åˆ«ç®¡ç†è¾“å…¥å’Œè¾“å‡ºé˜Ÿåˆ—ã€‚LPSPI ä¸‹æ–¹æœ‰ä¸€ä¸ª SBC èŠ¯ç‰‡ï¼Œç”¨ä½œ Slave å™¨ä»¶ï¼Œæ¥æ”¶æ¥è‡ª LPSPI1 çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;heading-1&#34;&gt;è®¾è®¡æµç¨‹ï¼š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å…³ç‹—&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿæ—¶é’Ÿè®¾ç½®ï¼šåˆå§‹åŒ– SOSC ä¸º 8MHzï¼Œç³»ç»Ÿæ—¶é’Ÿä¸º 80MHzï¼ŒRUN æ¨¡å¼ä¸º 80MHz&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ– LPSPI1ï¼š
&lt;ul&gt;
&lt;li&gt;æ¨¡å—æ§åˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;å…³é—­æ¨¡å—ä»¥å…è®¸è®¾ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è®¾ç½® LPSPI1 ä¸ºä¸»æœº(Master)ï¼š&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–æ—¶é’Ÿæ‰€éœ€è¦çš„é…ç½®ä¸º 10MHz ä¸ºé¢„åˆ†é¢‘åŠŸèƒ½æ—¶é’Ÿ(100 å¾®ç§’å‘¨æœŸ)
&lt;ul&gt;
&lt;li&gt;é¢„åˆ†é¢‘åŠŸèƒ½æ—¶é’Ÿçš„é¢‘ç‡ = åŠŸèƒ½æ€§æ—¶é’Ÿ / é¢„åˆ†é¢‘å› å­ = 40MHz/4 = 10MHz&lt;/li&gt;
&lt;li&gt;SCK æ³¢ç‰¹ç‡ = (Functional clock / PRESCALE) / (SCKDIV+2) = (40 MHz / 4) / (8 + 2) = 10 MHz / 10 = 1 MHz&lt;/li&gt;
&lt;li&gt;SCK å’Œ PCS é—´éš” = 5 prescaled functional clocks = 50 nesc&lt;/li&gt;
&lt;li&gt;PCS å’Œ CSK é—´éš” = 10 prescaled functional clocks = 1 usec&lt;/li&gt;
&lt;li&gt;ç›¸é‚»ä¸¤æ¬¡ä¼ è¾“çš„æ—¶é—´é—´éš” = 10 prescaled functional clocks = 1 usec&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;FIFO æ§åˆ¶
&lt;ul&gt;
&lt;li&gt;RxFIFO: Receive Data Flag (RDF) æ¥æ”¶æ•°æ®æ ‡å¿—ä½ ç½®ä½ï¼Œå½“ FIFO&amp;gt;0&lt;/li&gt;
&lt;li&gt;TxFIFO: Transmit Data Flag (TDF) å‘é€æ•°æ®æ ‡å¿—ä½ ç½®ä½ï¼Œå½“ FIFO&amp;lt;=3&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è®¾ç½®å‘é€å‘½ä»¤ï¼ˆå¯ä»¥ä½¿ç”¨ä¸€äº›å…¶ä»–çš„è®¾ç½®åœ¨è¿™é‡Œï¼Œä¾‹å¦‚ä½¿ç”¨ä¸åŒçš„ç‰‡é€‰ä¿¡å·å’Œæ¯å¸§å­—èŠ‚ï¼‰
&lt;ul&gt;
&lt;li&gt;é¢„åˆ†é¢‘å› å­ä¸º 8ï¼Œ(80 MHz / 8 = 10 MHz é¢„åˆ†é¢‘æ—¶é’Ÿ)&lt;/li&gt;
&lt;li&gt;å¸§é•¿åº¦ = 16 bits&lt;/li&gt;
&lt;li&gt;PCS3 è¢«ç”¨ä½œç‰‡é€‰ä¿¡å·&lt;/li&gt;
&lt;li&gt;SCK ææ€§ä¸º Active Low&lt;/li&gt;
&lt;li&gt;ç›¸ä½ï¼šæ•°æ®åœ¨ SCK å‰æ²¿æ”¹å˜ï¼Œåœ¨åæ²¿æ•è·&lt;/li&gt;
&lt;li&gt;MSB é¦–å…ˆï¼ˆæœ€é«˜ä½å…ˆå‘ï¼‰ï¼Œå­—èŠ‚äº¤æ¢å…³é—­ï¼Œè¿ç»­ä¼ è¾“å…³é—­&lt;/li&gt;
&lt;li&gt;å•ä½å®½åº¦ä¼ é€&lt;/li&gt;
&lt;li&gt;æ­£å¸¸çš„ FIFO é…ç½®ï¼šæ”¶åˆ°çš„æ•°æ®åœ¨ Rx FIFOï¼Œå‘é€çš„æ•°æ®åœ¨ Tx FIFO&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¨¡å—ä½¿èƒ½
&lt;ul&gt;
&lt;li&gt;ä½¿èƒ½æ¨¡å—ï¼ŒåŒ…æ‹¬åœ¨è°ƒè¯•æ¨¡å¼å’Œ DOZE æ¨¡å¼ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ– PORT ç®¡è„šç»™ LPSPI1&lt;/li&gt;
&lt;li&gt;å¾ªç¯ï¼š
&lt;ul&gt;
&lt;li&gt;ç­‰å¾… TDF ç½®ä½ï¼ˆç¤ºæ„ Tx FIFO å¯ç”¨ï¼‰ï¼Œç„¶åå†™å…¥ä¸€å¸§åˆ° Tx FIFO å¹¶ä¸”æ¸…é™¤ TDF&lt;/li&gt;
&lt;li&gt;ç­‰å¾… RDF ç½®ä½ï¼ˆç¤ºæ„æ¥æ”¶åˆ°æ•°æ®ï¼‰ï¼Œç„¶åè¯»å–ä¸€å¸§å¹¶ä¸”æ¸…æ¥š RDF&lt;/li&gt;
&lt;li&gt;å‡å°‘ counter&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;heading-2&#34;&gt;ä»£ç &lt;/h3&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘å¤§å®¶çš„é˜…è¯»ç–²åŠ³ï¼Œè¿™æ¬¡ä»…ä»…æŒ‘å‡ºå‡ ä¸ªä¸æœ¬æ­¤ LPSPI é…ç½®è¾ƒä¸ºå¯†åˆ‡çš„å¯„å­˜å™¨ä»¥ä¾›å¤§å®¶å­¦ä¹ ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PORT_init&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_PORTB_INDEX ]&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clock for PORTB */&lt;/span&gt;
PORTB&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;14&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;PORT_PCR_MUX(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Port B14: MUX = ALT3, LPSPI1_SCK */&lt;/span&gt;
PORTB&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;PORT_PCR_MUX(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Port B15: MUX = ALT3, LPSPI1_SIN */&lt;/span&gt;
PORTB&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;PORT_PCR_MUX(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Port B16: MUX = ALT3, LPSPI1_SOUT */&lt;/span&gt;
PORTB&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;17&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;PORT_PCR_MUX(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Port B17: MUX = ALT3, LPSPI1_PCS3 */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªæ˜¯è®¾ç½® PORT MUX çš„ï¼Œå¦‚æœè¿™ä¸ªçœ‹ä¸æ‡‚çš„è¯å¯ä»¥ä»æˆ‘çš„ S32K ç¬¬ä¸€èŠ‚çš„ hello world ä¾‹ç¨‹å¼€å§‹çœ‹èµ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LPSPI1_init_master&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_LPSPI1_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable clocks to modify PCS ( default) */&lt;/span&gt;
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_LPSPI1_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xC6000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable PCS=SPLL_DIV2 (40 MHz func&amp;#39;l clock) */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable module for configuration */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;IER &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Interrupts not used */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;DER &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* DMA not used */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CFGR0 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Defaults: */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* RDM0=0: rec&amp;#39;d data to FIFO as normal */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* CIRFIFO=0; Circular FIFO is disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* HRSEL, HRPOL, HREN=0: Host request disabled */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CFGR1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Configurations: master mode*/&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* PCSCFG=0: PCS[3:2] are enabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* OUTCFG=0: Output data retains last value when CS negated */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* PINCFG=0: SIN is input, SOUT is output */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MATCFG=0: Match disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* PCSPOL=0: PCS is active low */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* NOSTALL=0: Stall if Tx FIFO empty or Rx FIFO full */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* AUTOPCS=0: does not apply for master mode */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SAMPLE=0: input data sampled on SCK edge */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MASTER=1: Master mode */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x5300000F&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Transmit cmd: PCS3, 16bits, prescale func&amp;#39;l clk by 4. */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* CPOL=0: SCK inactive state is low */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* CPHA=1: Change data on SCK lead&amp;#39;g, capture on trail&amp;#39;g edge*/&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* PRESCALE=2: Functional clock divided by 2**2 = 4 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* PCS=3: Transfer using PCS3 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* LSBF=0: Data is transferred MSB first */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* BYSW=0: Byte swap disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* CONT, CONTC=0: Continuous transfer disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* RXMSK=0: Normal transfer: rx data stored in rx FIFO */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TXMSK=0: Normal transfer: data loaded from tx FIFO */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* WIDTH=0: Single bit transfer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* FRAMESZ=15: # bits in frame = 15+1=16 */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CCR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x04090808&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clk dividers based on prescaled func&amp;#39;l clk of 100 nsec */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SCKPCS=4: SCK to PCS delay = 4+1 = 5 (500 nsec) */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* PCSSCK=4: PCS to SCK delay = 9+1 = 10 (1 usec) */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* DBT=8: Delay between Transfers = 8+2 = 10 (1 usec) */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SCKDIV=8: SCK divider =8+2 = 10 (1 usec: 1 MHz baud rate) */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;FCR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000003&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* RXWATER=0: Rx flags set when Rx FIFO &amp;gt;0 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TXWATER=3: Tx flags set when Tx FIFO &amp;lt;= 3 */&lt;/span&gt;
LPSPI1&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000009&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable module for operation */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* DBGEN=1: module enabled in debug mode */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* DOZEN=0: module enabled in Doze mode */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* RST=0: Master logic not reset */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MEN=1: Module is enabled */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªå°±æ˜¯ LPSPI çš„ä¸»è¦è®¾ç½®å†…å®¹äº†ï¼Œé‡Œé¢çš„ä¸œè¥¿è™½ç„¶ç¹æ‚ï¼Œä½†æ˜¯éƒ½éœ€è¦ä¸€ç‚¹ç‚¹å…¨éƒ¨å•ƒé€äº†æ‰èƒ½ç®—ç†è§£ï¼Œå› ä¸ºåœ¨å·¥ç¨‹ä¸­é‡åˆ°çš„ SPI åè®®æœ‰å¾ˆå¤šä¸åŒçš„è®¾ç½®ï¼ŒåŒ…æ‹¬æ•°æ®çš„æ•è·æ–¹å¼å’Œç‰‡é€‰æ–¹å¼ï¼Œå¦‚æœåˆ°æ—¶å€™è¿˜è¦æŸ¥æ•°æ®æ‰‹å†Œä¼šå¤§å¤§é™ä½æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°±è¯¦ç»†çš„ä»æœ€å¼€å§‹çš„ S32K144 LPSPI æ¨¡å—çš„åŸºæœ¬ç‰¹æ€§å¼€å§‹ä»‹ç»ï¼š&lt;/p&gt;
&lt;h3 id=&#34;lpspi-&#34;&gt;LPSPI ç‰¹æ€§&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Command/transmit FIFO é•¿åº¦ä¸º 4 ä¸ª dwords (1 dword = 32 bits)&lt;/li&gt;
&lt;li&gt;Receive FIFO ä¸º 4 ä¸ª words (1 dword = 32 bits)&lt;/li&gt;
&lt;li&gt;&amp;ldquo;ä¸»æœºè¾“å‡ºè¯·æ±‚ (Host request input)&amp;rdquo; å¯ä»¥è¢«ç”¨äºæ§åˆ¶ SPI æ€»çº¿ä¼ è¾“èµ·å§‹æ—¶é—´&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;lpspi--1&#34;&gt;LPSPI ç»“æ„&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-20-S32K144_7/LPSPI.png&#34; alt=&#34;LPSPI.png&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;lpspi--2&#34;&gt;LPSPI å·¥ä½œæ¨¡å¼&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Chip Mode&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;LPSPI Operation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Run&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;æ­£å¸¸&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Stop/Wait&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;èƒ½å¤Ÿç»§ç»­è¿è¡Œå¦‚æœ &lt;code&gt;Doze Enable&lt;/code&gt; ç½® 0 &lt;!-- raw HTML omitted --&gt;å¹¶ä¸” LPSPI ä½¿ç”¨ä¸€ä¸ªèƒ½å¤Ÿä¿æŒè¿è¡Œçš„æ—¶é’Ÿ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Low Leakage Stop&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;code&gt;Doze Enable&lt;/code&gt; è¢«å¿½è§†ï¼ŒLPSPI ç­‰å¾…å½“å‰çš„ä¼ é€ä»»åŠ¡å®Œæˆ&lt;!-- raw HTML omitted --&gt; ç„¶åè¿›å…¥è¯¥æ¨¡å¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Debug&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;èƒ½å¤Ÿç»§ç»­è¿è¡Œå¦‚æœ &lt;code&gt;Debug Enable&lt;/code&gt; ä½è¢«ç½®ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;heading-3&#34;&gt;ç”¨åˆ°çš„å¯„å­˜å™¨&lt;/h3&gt;
&lt;p&gt;ç”±äºå®åœ¨å¤ªå¤šäº†ï¼Œå¤§éƒ¨åˆ†å¯„å­˜å™¨éƒ½æ˜¯çŠ¶æ€å¯„å­˜å™¨ï¼Œæ‰€ä»¥å°±ç›´æ¥ä»‹ç»ä¸€ä¸‹è®¾ç½®å¯„å­˜å™¨ï¼Œå¯¹äºçŠ¶æ€å¯„å­˜å™¨æˆ‘ä»¬ä¸€æ¦‚è€Œè¿‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;control-register-lpspix-cr&#34;&gt;Control Register (LPSPIx_CR)&lt;/h3&gt;
&lt;p&gt;åŒ…å«ä¸€äº›åŸºæœ¬çš„å¯„å­˜å™¨æ“ä½œã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RRF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Reset Receive FIFO&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 æ²¡æœ‰ä½œç”¨&lt;!-- raw HTML omitted --&gt;1 Rx FIFO è¢«æ¸…ç©º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RTF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Reset Transmit FIFO&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 æ²¡æœ‰ä½œç”¨&lt;!-- raw HTML omitted --&gt;1 Tx FIFO è¢«æ¸…ç©º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DBGEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Debug Enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 æ¨¡å—åœ¨ Debug æ¨¡å¼ä¸‹å…³é—­&lt;!-- raw HTML omitted --&gt;1 æ¨¡å—åœ¨ Debug æ¨¡å¼ä¸‹å¼€å¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DOZEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Doze mode enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 æ¨¡å—åœ¨ Doze æ¨¡å¼ä¸‹å…³é—­&lt;!-- raw HTML omitted --&gt;1 æ¨¡å—åœ¨ Doze æ¨¡å¼ä¸‹å¼€å¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RST&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Software Reset&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;é‡ç½®æ‰€æœ‰çš„ SPI å†…éƒ¨å¯„å­˜å™¨ï¼ˆé™¤äº† CRï¼‰&lt;!-- raw HTML omitted --&gt;ä¿æŒç½®ä½ç›´åˆ°è¢«è½¯ä»¶æ¸…é›¶&lt;!-- raw HTML omitted --&gt;0 ä¸é‡ç½®&lt;!-- raw HTML omitted --&gt;1 é‡ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Module Enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 ä¸ä½¿èƒ½&lt;!-- raw HTML omitted --&gt;1 ä½¿èƒ½æ¨¡å—&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;status-register-lpspix-sr&#34;&gt;Status Register (LPSPIx_SR)&lt;/h3&gt;
&lt;p&gt;çŠ¶æ€æ˜¾ç¤ºå¯„å­˜å™¨ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MBF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Module Busy Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 LPSPI ç©ºé—²&lt;!-- raw HTML omitted --&gt;1 LPSPI å¿™ç¢Œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DMF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Data Match Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;æŒ‡ç¤ºæ¥æ”¶çš„æ•°æ®æ˜¯å¦æœ‰å’Œ MATCFG å¯„å­˜å™¨ä¸­è®¾ç½®çš„ä¸€è‡´&lt;!-- raw HTML omitted --&gt;0 LPSPI æœªæ¥æ”¶åˆ°åŒ¹é…æ•°æ®&lt;!-- raw HTML omitted --&gt;1 LPSPI å·²ç»æ¥æ”¶åˆ°åŒ¹é…æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;REF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Error Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;æŒ‡ç¤º Rx FIFO overflow&lt;!-- raw HTML omitted --&gt;0 Rx FIFO æ²¡æœ‰æº¢å‡º&lt;!-- raw HTML omitted --&gt;1 Rx FIFO æº¢å‡º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TEF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Error Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;æŒ‡ç¤º Tx FIFO underrun&lt;!-- raw HTML omitted --&gt;0 Tx FIFO æ²¡æœ‰ underrun&lt;!-- raw HTML omitted --&gt;1 Rx FIFO å‘ç”Ÿ underrun&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TCF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transfer Complete Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 æ‰€æœ‰ä¼ è¾“å®Œæˆ&lt;!-- raw HTML omitted --&gt;1 ä¼ è¾“æœªå®Œæˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FCF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Frame Complete Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 å½“å‰æ¥æ”¶/å‘é€å¸§æœªä¼ é€å®Œ&lt;!-- raw HTML omitted --&gt;1 å½“å‰æ¥æ”¶/å‘é€å¸§å·²ä¼ é€å®Œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;WCF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Word Complete Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 å½“å‰æ¥æ”¶/å‘é€å­—æœªä¼ é€å®Œ&lt;!-- raw HTML omitted --&gt;1 å½“å‰æ¥æ”¶/å‘é€å­—å·²ä¼ é€å®Œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RDF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Data Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;å½“ Rx FIFOä¸­å­—å¤šäº RXWATER æ—¶ç½®ä½&lt;!-- raw HTML omitted --&gt;0 æ¥æ”¶æ•°æ®å‡†å¤‡å¥½&lt;!-- raw HTML omitted --&gt;1 æ¥æ”¶æ•°æ®æœªå‡†å¤‡å¥½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Data Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;å½“ Tx FIFOä¸­å­—å°‘äº TXWATER æ—¶ç½®ä½&lt;!-- raw HTML omitted --&gt;0 å‘é€æ•°æ®æœªå‡†å¤‡å¥½&lt;!-- raw HTML omitted --&gt;1 è¯·æ±‚å‘é€æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;interrupt-enable-register-lpspix-ier&#34;&gt;Interrupt Enable Register (LPSPIx_IER)&lt;/h3&gt;
&lt;p&gt;ä¸­æ–­ä½¿èƒ½å¯„å­˜å™¨ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;13&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DMIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Data Match Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DMIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Error Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TEIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Error Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TCIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transfer Complete Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TEIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Error Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;WCIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Word Complete Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RDIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Data Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDIE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Data Interrupt Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;dma-enable-register-lpspix-der&#34;&gt;DMA Enable Register (LPSPIx_DER)&lt;/h3&gt;
&lt;p&gt;DMA ä½¿èƒ½å¯„å­˜å™¨ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RDDE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Data DMA Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TDDE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Data DMA Enable&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;configuration-register-0-lpspix-cfgr0&#34;&gt;Configuration Register 0 (LPSPIx_CFGR0)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªæ˜¯ä¸€äº›åŸºæœ¬çš„ SPI è®¾ç½®ï¼Œçœ‹åˆ° 0 äº†ä¹ˆï¼Œè¯´æ˜åé¢è¿˜æœ‰å¾ˆå¤š&amp;hellip;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RDMO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Data Match Only&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 æ­£å¸¸å­˜å–æ¥æ”¶çš„æ•°æ®åˆ° FIFO &lt;!-- raw HTML omitted --&gt;1 å¦‚æœæ¥æ”¶çš„æ•°æ®ä¸æ˜¯åŒ¹é…æ•°æ®å°±ä¸¢å¼ƒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CIRFIFO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Circular FIFO Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;å¼€å¯åå½“ Tx FIFO æ¸…ç©ºåä¼šå›å¤åŸçŠ¶å¾ªç¯å‘é€&lt;!-- raw HTML omitted --&gt;0 å…³é—­å¾ªç¯å‘é€&lt;!-- raw HTML omitted --&gt;1 å¼€å¯å¾ªç¯å‘é€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;HRSEL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Host Request Select&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 Host request è¾“å…¥æ˜¯ LPSPI_HREQ ç®¡è„š&lt;!-- raw HTML omitted --&gt;1 Host request è¾“å…¥æ˜¯è§¦å‘å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;HRPOL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Host Request Polarity&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 Active low&lt;!-- raw HTML omitted --&gt;1 Active high&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;HREN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Host Request Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;å½“åœ¨ä¸»æœºæ¨¡å¼ä¸‹çš„æ—¶å€™&lt;!-- raw HTML omitted --&gt;LPSPI åªä¼šå½“æ”¶åˆ° host request åå‘é€æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;configuration-register-1-lpspix-cfgr1&#34;&gt;Configuration Register 1 (LPSPIx_CFGR1)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨åº”å½“åœ¨ LPSPI å…³é—­çš„æ—¶å€™è¿›è¡Œå†™å…¥ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;27&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PCSCFG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Peripheral Chip Select Configuration&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;å¦‚æœåœ¨ä½¿ç”¨ 4-bit ä¼ è¾“ï¼Œæ­¤ä½å¿…é¡»ç½®ä½&lt;!-- raw HTML omitted --&gt;0 PCS[3:2] å¯ç”¨ &lt;!-- raw HTML omitted --&gt;1 PCS[3:2] ç¦ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;26&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;OUTCFG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Output Config&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;è®¾ç½®å¦‚æœç‰‡é€‰ä¸ºæ— æ•ˆæ€çš„è¯è¾“å‡ºæ•°æ® &lt;!-- raw HTML omitted --&gt;0 è¾“å‡ºçš„æ•°æ®ä¿ç•™æœ€å&lt;!-- raw HTML omitted --&gt;1 è¾“å‡ºçš„æ•°æ®æ˜¯ä¸‰æ€çš„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;25-24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PINCFG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Pin Configuration&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;00 SIN è¾“å…¥æ•°æ® SOUT è¾“å‡ºæ•°æ®&lt;!-- raw HTML omitted --&gt;01 SOUT æ—¢è¾“å…¥ä¹Ÿè¾“å‡º&lt;!-- raw HTML omitted --&gt;10 SDI æ—¢è¾“å…¥ä¹Ÿè¾“å‡º&lt;!-- raw HTML omitted --&gt;11 SIN è¾“å‡ºæ•°æ® SOUT è¾“å…¥æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;18-16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MATCFG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Match Configuration&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;è®¾ç½®èƒ½å¤Ÿå¼•èµ· DMF ç½®ä½çš„æƒ…å†µ&lt;!-- raw HTML omitted --&gt;000 Match disabled&lt;!-- raw HTML omitted --&gt;010 Match å¯ç”¨ (ç¬¬ä¸€ä¸ªæ•°æ®å­—å’Œ MATCH0 æˆ–è€… MATCH1 ä¸€è‡´)&lt;!-- raw HTML omitted --&gt;011 Match å¯ç”¨ (ä»»ä½•æ•°æ®å­—å’Œ MATCH0 æˆ–è€… MATCH1 ä¸€è‡´)&lt;!-- raw HTML omitted --&gt;100 Match å¯ç”¨ (ç¬¬ä¸€ä¸ªæ•°æ®å­—å’Œ MATCH0 ä¸” ç¬¬äºŒä¸ªå’Œ MATCH1 ä¸€è‡´)&lt;!-- raw HTML omitted --&gt;101 Match å¯ç”¨ (ä»»ä½•æ•°æ®å­—å’Œ MATCH0 ä¸” ä¸‹ä¸€ä¸ªå’Œ MATCH1 ä¸€è‡´)&lt;!-- raw HTML omitted --&gt;110 Match å¯ç”¨ (ç¬¬ä¸€ä¸ªæ•°æ®å­—å’Œ MATCH0 æŒ‰ä½ä¸ å’Œ MATCH0 å’Œ MATCH1 æŒ‰ä½ä¸ä¸€è‡´)&lt;!-- raw HTML omitted --&gt;111 Match å¯ç”¨ (ä»»ä½•æ•°æ®å­—å’Œ MATCH0 æŒ‰ä½ä¸ å’Œ MATCH0 å’Œ MATCH1 æŒ‰ä½ä¸ä¸€è‡´)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;11-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PCSPOL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Peripheral Chip Select Polarity&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 PCSx active low&lt;!-- raw HTML omitted --&gt;1 PCSx active high&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;NOSTALL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;NO STALL&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;å½“ Tx FIFO ä¸ºç©ºæˆ–è€… Rx FIFO ä¸ºæ»¡æ—¶é€šå¸¸ä¼šåœæ­¢&lt;!-- raw HTML omitted --&gt;0 åœæ­¢&lt;!-- raw HTML omitted --&gt;1 ä¸åœæ­¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;AUTOPCS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Automatic PCS&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;è‡ªåŠ¨è¢«ç‰‡é€‰ï¼Œä¸»æœºæ¨¡å¼ä¸‹æ— æ•ˆ&lt;!-- raw HTML omitted --&gt;0 ç¦ç”¨&lt;!-- raw HTML omitted --&gt;1 å¯ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SAMPLE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Sample Point&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 Input data sampled on SCK edge.&lt;!-- raw HTML omitted --&gt;0 ç¦ç”¨&lt;!-- raw HTML omitted --&gt;1 Input data sampled on delayed SCK edge&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MASTER&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Master Mode&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 Slave mode&lt;!-- raw HTML omitted --&gt;1 Master mode&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;data-match-register-01-lpspix-dmr01&#34;&gt;Data Match Register 0/1 (LPSPIx_DMR0/1)&lt;/h3&gt;
&lt;p&gt;ä¹‹å‰è¯´çš„ åŒ¹é…å€¼ å¯„å­˜å™¨ï¼Œæœ‰ä¸¤ä¸ªåˆ†åˆ«æ˜¯ 0/1ã€‚&lt;/p&gt;
&lt;h3 id=&#34;clock-configuration-register-lpspix-ccr&#34;&gt;Clock Configuration Register (LPSPIx_CCR)&lt;/h3&gt;
&lt;p&gt;ä¸€äº›ä¸æ—¶åºæœ‰å…³çš„è®¾ç½®ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;31-24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SCKPCS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SCK to PCS Delay&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;ä¸»æœºæ¨¡å¼ä¸‹çš„æœ€åä¸€ä¸ª SCK æ²¿å’Œ PCS æ— æ•ˆæ€çš„å»¶æ—¶&lt;!-- raw HTML omitted --&gt;Delay=(SCKPCS+1)*æ³¢ç‰¹ç‡æ—¶é’Ÿå‘¨æœŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;23-16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PCSSCK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;PCS to SCK Delay&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;ä¸»æœºæ¨¡å¼ä¸‹çš„ PCS æœ‰æ•ˆæ€å’Œ ç¬¬ä¸€ä¸ª SCK æ²¿çš„å»¶æ—¶&lt;!-- raw HTML omitted --&gt;Delay=(PCSSCK+1)*æ³¢ç‰¹ç‡æ—¶é’Ÿå‘¨æœŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DBT&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Delay Between Transfers&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;PCS æ— æ•ˆæ€åˆ°ä¸‹ä¸ªæœ‰æ•ˆæ€çš„é—´éš”&lt;!-- raw HTML omitted --&gt;Delay=(DBT+2)*æ³¢ç‰¹ç‡æ—¶é’Ÿå‘¨æœŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SCKDIV&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;SCK Divider&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;è®¾ç½® SCK çš„åˆ†é¢‘æ—¶é’Ÿ&lt;!-- raw HTML omitted --&gt;Divider=(SCKDIV+2)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;fifo-control-register-lpspix-fcr&#34;&gt;FIFO Control Register (LPSPIx_FCR)&lt;/h3&gt;
&lt;p&gt;æ§åˆ¶ FIFO çš„å‡†å¤‡æ ‡å¿—ä½ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;23-16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RXWATER&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive FIFO Watermark&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;å½“ Rx FIFO ä¸­è£…çš„å­—å¤šäºè¿™ä¸ªå€¼å°±ä¼šä½¿ RDF(Receive Data Flag) ç½®ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TXWATER&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit FIFO Watermark&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;å½“ Tx FIFO ä¸­è£…çš„å­—å°‘äºè¿™ä¸ªå€¼å°±ä¼šä½¿ TDF(Transmit Data Flag) ç½®ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;transmit-command-register-lpspix-tcr&#34;&gt;Transmit Command Register (LPSPIx_TCR)&lt;/h3&gt;
&lt;p&gt;é‡å¤´æˆï¼Œè¿™ä¸ªå¯„å­˜å™¨æ§åˆ¶å‘é€æ•°æ®çš„è¿‡ç¨‹ã€‚è¿™ä¸ªå«åšå‘é€å‘½ä»¤å¯„å­˜å™¨ï¼Œå¥½ç©çš„æ˜¯é‡Œé¢å­˜çš„éƒ½æ˜¯å‘½ä»¤ï¼Œå½“ä½ å†™å…¥å‘½ä»¤çš„æ—¶å€™ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šåƒæ•°æ®ä¸€æ ·è¢«å­˜å…¥ Tx FIFOï¼Œå½“å®ƒè¢«é¡¶ç½®åˆ° FIFO é¡¶çš„æ—¶å€™ï¼Œä¸€èˆ¬çš„æ•°æ®å¸§ä¼šè¢«å‘é€å‡ºå»ï¼Œä½†å®ƒä¸ä¼šå‘é€ï¼Œç›¸åçš„æ˜¯ï¼Œå®ƒä¼šæ”¹å˜åç»­çš„å‘é€æ•°æ®çš„å±æ€§ï¼Œè¿™ä¸ªç‰¹æ€§ä½¿ LPSPI å¯ä»¥åœ¨ä¿æŒå‘é€ä¸æ–­çš„æƒ…å†µä¸‹æ”¹å˜å‘é€çš„å±æ€§ï¼ˆè­¬å¦‚ç‰‡é€‰å’Œé•¿åº¦ï¼‰ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;31&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CPOL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Clock Polarity&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 ä¸æ´»è·ƒ SCK ä¸º low&lt;!-- raw HTML omitted --&gt;1 ä¸æ´»è·ƒ SCK ä¸º high&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CPHA&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Clock Phase&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 æ•°æ®åœ¨å‰æ²¿æ•è·åœ¨åæ²¿æ”¹å˜&lt;!-- raw HTML omitted --&gt;1 æ•°æ®åœ¨åæ²¿æ•è·åœ¨å‰æ²¿æ”¹å˜&lt;!-- raw HTML omitted --&gt;&lt;em&gt;å‰æ²¿æ˜¯æŒ‡ä»ä¸æ´»è·ƒåˆ°æ´»è·ƒçš„è·³å˜æ²¿&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;29-27&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PRESCALE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Prescaler Value&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;é¢„åˆ†é¢‘æ—¶é’Ÿ&lt;!-- raw HTML omitted --&gt;åˆ†é¢‘å› å­=2^(&lt;code&gt;PRESCALE&lt;/code&gt;+1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;25-24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PCS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Peripheral Chip Select&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;ç‰‡é€‰&lt;!-- raw HTML omitted --&gt;ä½¿ç”¨ PCS[&lt;code&gt;PCS&lt;/code&gt;]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;23&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;LSBF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;LSB First&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;å®šä¹‰å‘é€æ•°æ®çš„æ’åºæ–¹å¼&lt;!-- raw HTML omitted --&gt;0 MSB é«˜å­—èŠ‚ä¼˜å…ˆ&lt;!-- raw HTML omitted --&gt;1 LSB ä½å­—èŠ‚ä¼˜å…ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;22&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BYSW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Byte Swap&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;å†…å®¹ç½®æ¢ï¼Œå¼€å¯åå°†[31:24]å’Œ[7:0]äº’æ¢ï¼Œ[23:16]ä¸[15:8]äº’æ¢&lt;!-- raw HTML omitted --&gt;0 å†…å®¹ç½®æ¢å…³é—­&lt;!-- raw HTML omitted --&gt;1 å†…å®¹ç½®æ¢å¼€å¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;21&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CONT&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Continuous Transfer&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;å¼€å¯åä¸€ç›´ä¿æŒ PCS æœ‰æ•ˆ&lt;!-- raw HTML omitted --&gt;0 å¼€å¯&lt;!-- raw HTML omitted --&gt;1 å…³é—­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;20&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CONTC&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Continuing Command&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;è¿™ä¸ªæ˜¯å¼€å¯äº† &lt;code&gt;CONT=1&lt;/code&gt; åå¦‚æœæƒ³è¦æ”¹å˜å±æ€§ç”¨çš„&lt;!-- raw HTML omitted --&gt;ä¸‹ä¸€ä¸ªå‘½ä»¤å¿…é¡»å’Œä¸Šä¸€ä¸ªå‘½ä»¤è§„å®šçš„æ•°æ®å¸§é•¿åº¦ä¸€æ ·ï¼Œå¹¶ä¸”å°†æ­¤ä½ç½® 1&lt;!-- raw HTML omitted --&gt;0 å¼€å¯ä¸€ä¸ªæ–°çš„ä¼ è¾“è¿‡ç¨‹&lt;!-- raw HTML omitted --&gt;1 ç»§ç»­ä¸é—´æ–­ä¼ è¾“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;19&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RXMSK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Receive Data Mask&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;å¼€å¯åä¸å°†æ¥æ”¶åˆ°çš„æ•°æ®å­˜å…¥FIFO&lt;!-- raw HTML omitted --&gt;0 ç¦ç”¨&lt;!-- raw HTML omitted --&gt;1 å¼€å¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;18&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TXMSK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transmit Data Mask&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;å¼€å¯åä¸èƒ½å‘é€æ•°æ®&lt;!-- raw HTML omitted --&gt;0 ç¦ç”¨&lt;!-- raw HTML omitted --&gt;1 å¼€å¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;17-16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;WIDTH&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Transfer Width&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;ä¼ è¾“çš„ä½å®½&lt;!-- raw HTML omitted --&gt;00 å•ä½ä¼ è¾“&lt;!-- raw HTML omitted --&gt;01 ä¸¤ä½ä¼ è¾“&lt;!-- raw HTML omitted --&gt;10 å››ä½ä¼ è¾“&lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;11-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FRAMESZ&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Frame Size&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;å¸§çš„é•¿åº¦&lt;!-- raw HTML omitted --&gt;å¸§çš„é•¿åº¦=(&lt;code&gt;FRAMESZ&lt;/code&gt;+1)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;transmit-data-register-lpspix-tdr&#34;&gt;Transmit Data Register (LPSPIx_TDR)&lt;/h3&gt;
&lt;p&gt;32-bit å‘é€å¯„å­˜å™¨ï¼Œå½“å‘é€çš„æ•°æ®ä¸å¤Ÿ 32 ä½æ—¶ç”¨ 0 è¡¥é½ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€äº›ä¹±ä¸ƒå…«ç³Ÿçš„å¯„å­˜å™¨åƒæ˜¯ RDR ä»€ä¹ˆçš„ï¼Œéƒ½å’Œä¸Šé¢çš„ç±»ä¼¼ï¼Œå¾ˆå¥½ç†è§£ï¼Œå°±æ²¡æœ‰å†ç»™å‡ºäº†ã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 6 DMA</title>
      <link>https://xiahualiu.github.io/posts/2017-10-19-s32k144_6/</link>
      <pubDate>Thu, 19 Oct 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-10-19-s32k144_6/</guid>
      <description>&lt;p&gt;è¿™ä¸€èŠ‚çš„å†…å®¹æ˜¯æ ¹æ®å¯¹äºä¾‹ç¨‹çš„æ¢ç´¢ï¼Œäº†è§£ S32K ä¸Šçš„ DMA åŠŸèƒ½çš„ä½¿ç”¨æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;heading&#34;&gt;æœ¬ç« çš„ä»£ç æ¶‰åŠçš„å†…å®¹:&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆä»‹ç»ä¸€ä¸‹ï¼ŒDMA çš„ä¸»è¦ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-19-S32K144_6/DMA_layout.png&#34; alt=&#34;DMA_layout.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ç¨‹åºå°†åˆå§‹åŒ–ä¸€ä¸ª eDMA é€šé“çš„ Transfer Control Descriptor (TCD) ä¼ è¾“ä¸€ä¸ªå­—ç¬¦ä¸² &lt;code&gt;â€œHello worldâ€&lt;/code&gt; ä»å‘é‡ SRAM ç©ºé—´åˆ°ç‰¹å®šçš„ RAM åœ°å€ã€‚è¿™ä¸ªè¿‡ç¨‹ä»¿çœŸäº†ä¸€ä¸ªå¸¸è§çš„ DMA ä½¿ç”¨è¿‡ç¨‹ï¼Œå°†ä¸€ä¸²æ•°æ®æˆ–è€…å‘½ä»¤å†™å…¥å¤–å›´çš„å¯„å­˜å™¨ï¼Œè¿™ä¸ªä¾‹ç¨‹çš„ç›®çš„æ˜¯è¯´æ˜å¦‚ä½•åˆ›å»ºä¸€ä¸ª DMA ä¼ è¾“è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½¿ç”¨å¤–å›´å…ƒä»¶å’Œ DMA è¿›è¡Œäº¤æµçš„æ—¶å€™ï¼Œéœ€è¦è®¾ç½® DMA MUXï¼Œå¯¹åº”çš„å¤–å›´å…ƒä»¶å·åœ¨ RM é™„å½•ä¸­å¯ä»¥æŸ¥è¯¢åˆ°ï¼Œå½“ç„¶åœ¨è½¯ä»¶è§¦å‘çš„ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œä¸éœ€è¦ DMA MUX çš„è®¾ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸­æ–­è¿‡ç¨‹åœ¨è¿™ä¸ªä¾‹å­ä¸­å¹¶æ²¡æœ‰ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨å¸¸è§çš„ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæ˜¯éå¸¸æœ‰ç”¨çš„ç‰¹åˆ«æ˜¯å½“ä¼ è¾“ç»“æŸåæˆ–è€…è¿›è¡Œä¸­è¿›è¡Œæ“ä½œã€‚å…¶ä¸­çš„ä¸€ä¸ªä½¿ç”¨ä¾‹å­å°±æ˜¯ä½¿ç”¨ ADC ä¹‹ç±»çš„å¤–å›´å…ƒä»¶ï¼Œåœ¨è½¬æ¢å®Œæˆåäº§ç”Ÿäºä¸€ä¸ª DMA è¯·æ±‚ï¼ŒDMA æ§åˆ¶å™¨å°±å¯ä»¥è‡ªåŠ¨å°†è½¬æ¢ç»“æœä¼ è¾“è‡³ SRAMã€‚å½“ç»è¿‡äº†ä¸€æ®µæ—¶é—´çš„ä¼ è¾“ä¹‹åï¼ŒDMA ä¼šäº§ç”Ÿä¸­æ–­é€šçŸ¥ CPU å¯¹äºä¼ è¾“çš„æ•°æ®è¿›è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶è¿˜æœ‰æ›´é«˜çº§çš„ä½¿ç”¨æ–¹æ³•ï¼Œä¾‹å¦‚ Channel linking å’Œ Scatter-Gather (SGA)ï¼Œèƒ½å¤Ÿä½¿ä¸€ä¸ª DMA è¯·æ±‚å®Œæˆä¸åŒçš„ä¼ è¾“ä»»åŠ¡ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨ä¸åŒçš„ TCD é’ˆå¯¹æ¯ä¸€ä¸ª DMA è¯·æ±‚ï¼Œè¿™äº›å¼ºå¤§çš„ç‰¹æ€§å¯ä»¥ä½¿å¤–å›´å®ç°ç±»ä¼¼çŠ¶æ€æœºå™¨ç±»å‹çš„å­ç³»ç»Ÿï¼Œä¸€ä¸ªè¾“å…¥çš„ä¿¡å·å¯ä»¥ä¼ è¾“ä¸åŒçš„æ•°æ®ï¼Œç”¨äºåŒæ—¶åˆå§‹åŒ–å¤šä¸ªå¤–å›´å…ƒä»¶ã€‚Minor loop mapping ä¸€èˆ¬ä¸åœ¨ MCU çš„å±‚é¢ä¸Šè¿›è¡Œä½¿ç”¨ï¼Œä½†æ˜¯åœ¨å›¾åƒçš„ 45Â° æ—‹è½¬ä¸­éå¸¸æœ‰ç”¨ã€‚ä¸‹é¢ä¼šä»‹ç»åˆ°è¿™ä¸ªåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæ²¡æœ‰å¤–å›´çš„å…ƒä»¶å‚ä¸è¿™ä¸ªä¾‹å­ï¼Œè‡ªåŠ¨çš„ DMA æ¡æ‰‹ä¸ä¼šå‘ç”Ÿã€‚ç›¸åçš„ï¼Œè¿™é‡Œä½¿ç”¨çš„è½¯ä»¶æ¡æ‰‹éœ€è¦ä¸€äº›é¢å¤–çš„è®¾ç½®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘èµ·ä¸€ä¸ª DMA æœåŠ¡è¯·æ±‚ï¼ˆå°†éœ€è¦ä¼ è¾“é€šé“çš„ START ä½ç½®ä½ï¼‰&lt;/li&gt;
&lt;li&gt;ç­‰å¾…å±€éƒ¨ä¼ è¾“å®Œæ¯•&lt;/li&gt;
&lt;li&gt;é‡å¤ä»¥ä¸Šçš„ä¸¤ä¸ªæ­¥éª¤ç›´åˆ°ä¸»ç¯å¾ªç¯ç»“æŸ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªæ­¥éª¤æ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºä¸€æ¬¡å°±ä¼ è¾“ä¸€ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨å¤–éƒ¨å…ƒä»¶çš„æ—¶å€™ï¼Œè½¯ä»¶å¹¶ä¸éœ€è¦å®Œæˆä»¥ä¸Šçš„æ­¥éª¤ï¼Œä»–ä»¬æ˜¯è¢«ç¡¬ä»¶è‡ªåŠ¨å®Œæˆçš„ã€‚&lt;/p&gt;
&lt;p&gt;START ä½åœ¨ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯è¢«å¤–å›´çš„å…ƒä»¶è¯·æ±‚æœåŠ¡ç½®ä½çš„ã€‚åªè¦ DMA å¤„ç†å¼•æ“åœ¨é€šé“æ¿€æ´»ï¼ŒACTIVE ä½å°±ä¼šè¢«ç½®ä½ï¼Œå¦‚æœ DMA åœ¨å¿™ç¢Œçš„æ—¶å€™ï¼Œæ¸…é›¶ START å¯ä»¥ç»ˆæ­¢ä¼ è¾“è¿‡ç¨‹ï¼Œå†æ£€æŸ¥ä¸€é ACTIVE ç¡®è®¤æ²¡æœ‰æœåŠ¡æ­£åœ¨æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä½œä¸ºä¸€ä¸ªå°çš„ç»ƒä¹ ï¼ŒTCD å¯ä»¥è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥å¦‚æœæƒ³è®©ç›®æ ‡åœ°å€æ˜¯ä¸€ä¸ªå‘é‡è€Œä¸æ˜¯ä¸€ä¸ªå­—èŠ‚åœ°å€ã€‚å¯ä»¥å£°æ˜ç›®æ ‡åœ°å€æ˜¯ä¸€ä¸ªæ•°ç»„å¹¶ä¸”ä¿®æ”¹ &lt;code&gt;DOFF=1&lt;/code&gt; ç›®æ ‡åœ°å€åç§»é‡è¾¾åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;å†æ¥è¯´ä¸€ä¸‹ TCD(DMA Transfer Control Descriptor) æ˜¯ä»€ä¹ˆï¼ŒTCD å°±åƒæ˜¯ä¸€ä¸ª DMA ä»»åŠ¡è¯´æ˜ï¼Œä»–æ§åˆ¶è¢«ä¼ è¾“çš„æ•°æ®å’Œä¼ è¾“çš„è¿‡ç¨‹ï¼Œæ¯ä¸€ä¸ª TCD å æ® 8 ä¸ª 32-bit çš„ä½ç½®åœ¨å†…å­˜é‡Œé¢ï¼Œå¹¶ä¸”å…·æœ‰ä»¥ä¸‹çš„ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-19-S32K144_6/TCD.png&#34; alt=&#34;TCD.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»–çš„åˆå§‹åŒ–æ–¹æ³•æœ‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-19-S32K144_6/TCD_init.png&#34; alt=&#34;TCD_init.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯è§ä½¿ç”¨ DMA æ˜¯å¤šä¹ˆçš„å¤æ‚ã€‚:sweat_smile:
ä¸è¦è§‰å¾—æ²®ä¸§ï¼Œå…¶å®ä¸Šé¢è¿™ä¸ªå›¾æ ¹æœ¬å°±ä¸ç”¨è¯¦ç»†äº†è§£ã€‚çœ‹å®Œæœ¬ç¯‡æ–‡ç« ä½ å°±çŸ¥é“äº†æ‰€æœ‰çš„ TCD å’Œ DMA å¯„å­˜å™¨çš„è®¾ç½®ï¼Œç­‰åˆ°é‚£ä¸ªæ—¶å€™å†çœ‹è¿™ä¸ªå›¾å°±è§‰å¾—ç®€å•äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;heading-1&#34;&gt;æ­¥éª¤ï¼š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å…³ç‹—&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿæ—¶é’Ÿè®¾ç½®ï¼Œ SOSC 8MHzï¼ŒSYSCLK 80MHzï¼ŒRUN mode&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ– DMA æ§åˆ¶å™¨ï¼š
&lt;ul&gt;
&lt;li&gt;å¼€å¯æ—¶é’Ÿåˆ° DMA MUX æ¨¡å—ï¼ˆå…¶å®åœ¨è½¯ä»¶æ¨¡æ‹Ÿä¸­å¹¶ä¸éœ€è¦å› ä¸ºæˆ‘ä»¬æ‰‹åŠ¨å†™å…¥äº† START ä½ï¼‰&lt;/li&gt;
&lt;li&gt;å¼€å¯éœ€è¦çš„é€šé“ï¼ˆè½¯ä»¶æ¨¡æ‹Ÿä¸­å¹¶ä¸éœ€è¦ï¼Œå› ä¸ºæˆ‘ä»¬æ‰‹åŠ¨å†™å…¥äº† START ä½ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ– DMA TCDï¼ˆåœ¨è¿™é‡Œåªç”¨åˆ°äº† TCD0 ä¹Ÿå°±æ˜¯é€šé“ 0 å¯¹åº”çš„ TCDï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;æ•°æ®æ¥æº
&lt;ul&gt;
&lt;li&gt;Source address (SADDR): Use address of a string â€œHello Worldâ€&lt;/li&gt;
&lt;li&gt;Source offset (SOFF): Increment source address by 1 byte for each transfer&lt;/li&gt;
&lt;li&gt;Source modulo (SMOD): Feature not used here&lt;/li&gt;
&lt;li&gt;Source size (SSIZE): Read 1 byte at a time&lt;/li&gt;
&lt;li&gt;Source last address adjustment (SLAST): Decrement source address by 11 after major loop&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç›®æ ‡
&lt;ul&gt;
&lt;li&gt;Destination address (DADDR): Use address of a single byte&lt;/li&gt;
&lt;li&gt;Destination offset (DOFF): Do not add offset to destination address after minor loop&lt;/li&gt;
&lt;li&gt;Destination modulo (DMOD): Feature not used here&lt;/li&gt;
&lt;li&gt;Destination size (DSIZE): Write 1 byte at a time&lt;/li&gt;
&lt;li&gt;Destination last address adjustment (DLAST): Do not adjust address after major loop&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¯ä¸ª DMA è¯·æ±‚çš„ä¼ é€å­—èŠ‚æ•°ï¼ˆminor loppsï¼‰
&lt;ul&gt;
&lt;li&gt;Number of bytes to be transferred per DMA request (NBYTES): One byte&lt;/li&gt;
&lt;li&gt;Number of iterations/minor loops in major loop (CITER and BITER): 11&lt;/li&gt;
&lt;li&gt;Channel to channel linking for additional iterations after minor loop (BITER ELINK and CITER ELINK): Disabled&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ§åˆ¶ä¸çŠ¶æ€
&lt;ul&gt;
&lt;li&gt;Disable channel after major loop completes (DREQ): Disable channel&lt;/li&gt;
&lt;li&gt;Generate interrupt request half way through major loop (INTHALF): Disabled&lt;/li&gt;
&lt;li&gt;Generate interrupt request after completing major loop (INTMAJOR): Disabled&lt;/li&gt;
&lt;li&gt;Enable Scatter-Gather (ESG): Disabled. No other TCDs loaded to channel&lt;/li&gt;
&lt;li&gt;Enable channel link after major loop (MAJORLINK): Disabled&lt;/li&gt;
&lt;li&gt;Channel link number after major loop (MAJORLINKCH): Null - feature disabled&lt;/li&gt;
&lt;li&gt;Band Width Control (BWC): Set to 0 so there are no stalls after R/W&lt;/li&gt;
&lt;li&gt;Clear initial values of status flags (START, ACTIVE, DONE): Set to zero&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¼€å¯ç¬¬ä¸€ä¸ªä¼ è¾“è¿‡ç¨‹ï¼ˆç½® START ä¸º 1ï¼‰ï¼Œç­‰å¾…ä¼ è¾“å®Œæˆï¼ˆSTART=0ï¼ŒACTIVE=0ï¼‰&lt;/li&gt;
&lt;li&gt;å¾ªç¯ï¼šå½“é€šé“çš„ DONE æœªç½®ä½ï¼š
&lt;ul&gt;
&lt;li&gt;å¼€å§‹ä¸‹ä¸€ä¸ªä¼ è¾“ï¼ˆç½® START ä¸º 1ï¼‰ï¼Œç­‰å¾…ä¼ è¾“å®Œæˆï¼ˆSTART=0ï¼ŒACTIVE=0ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¸…ç©ºé¢‘é“çš„ DONE çŠ¶æ€ä½&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;heading-2&#34;&gt;ä»£ç &lt;/h3&gt;
&lt;h5 id=&#34;mainc&#34;&gt;main.c&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34; /* Include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;dma.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;clocks_and_modes.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WDOG_disable&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CNT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xD928C520&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Unlock watchdog */&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TOVAL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x0000FFFF&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Maximum timeout value */&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00002100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable watchdog */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
WDOG_disable();
SOSC_init_8MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize system oscillator for 8 MHz xtal */&lt;/span&gt;
SPLL_init_160MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize SPLL to 160 MHz with 8 MHz SOSC */&lt;/span&gt;
NormalRUNmode_80MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init clocks: 80 MHz SPLL &amp;amp; core, 40 MHz bus, 20 MHz flash */&lt;/span&gt;
DMA_init(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init DMA controller */&lt;/span&gt;
DMA_TCD_init(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init DMA Transfer Control Descriptor(s) */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SSRT &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Set chan 0 START bit to initiate first minor loop */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (((DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; DMA_TCD_CSR_START_SHIFT) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for START = 0 */&lt;/span&gt;
((DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; DMA_TCD_CSR_ACTIVE_SHIFT) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)) {} &lt;span style=&#34;color:#75715e&#34;&gt;/* and ACTIVE = 0 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* Now minor loop has completed */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;((DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; DMA_TCD_CSR_DONE_SHIFT) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) ) { &lt;span style=&#34;color:#75715e&#34;&gt;/* Loop till DONE = 1 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* Place breakpoint at next instruction &amp;amp; observe expressions TCD0_Source, TCD0_Dest */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SSRT &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Set chan 0 START bit to initiate next minor loop */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (((DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; DMA_TCD_CSR_START_SHIFT) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for START = 0 */&lt;/span&gt;
((DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; DMA_TCD_CSR_ACTIVE_SHIFT) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)) {} &lt;span style=&#34;color:#75715e&#34;&gt;/* and ACTIVE = 0 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* Now minor loop has completed */&lt;/span&gt;
}
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;(DMA_TCD_CSR_DONE_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear DONE bit */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) {} &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait forever */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;dmac&#34;&gt;DMA.c&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34; /* include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;dma.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;uint8_t TCD0_Source[] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Hello World&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;}; &lt;span style=&#34;color:#75715e&#34;&gt;/* TCD 0 source (11 byte string) */&lt;/span&gt;
uint8_t &lt;span style=&#34;color:#66d9ef&#34;&gt;volatile&lt;/span&gt; TCD0_Dest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* TCD 0 destination (1 byte) */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DMA_init&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
&lt;span style=&#34;color:#75715e&#34;&gt;/* This is an initialization place holder for: */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* 1. Enabling DMA MUX clock PCC_PCCn[PCC_DMAMUX_INDEX] (not needed when START bit used) */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* 2. Enabling desired channels by setting ERQ bit (not needed when START bit used) */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DMA_TCD_init&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
&lt;span style=&#34;color:#75715e&#34;&gt;/* TCD0: Transfers string to a single memory location */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].SADDR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_SADDR_SADDR((uint32_t &lt;span style=&#34;color:#66d9ef&#34;&gt;volatile&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;TCD0_Source); &lt;span style=&#34;color:#75715e&#34;&gt;/* Src */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].SOFF &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_SOFF_SOFF(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Src addr add 1 byte after transfer*/&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].ATTR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_ATTR_SMOD(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Src modulo feature not used */&lt;/span&gt;
DMA_TCD_ATTR_SSIZE(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Src read 2**0 =1 byte per transfer*/&lt;/span&gt;
DMA_TCD_ATTR_DMOD(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Dest modulo feature not used */&lt;/span&gt;
DMA_TCD_ATTR_DSIZE(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Dest write 2**0 =1 byte per trans.*/&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].NBYTES.MLNO &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_NBYTES_MLNO_NBYTES(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Transfer 1 byte /minor loop*/&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].SLAST &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_SLAST_SLAST(&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Src addr change after major loop*/&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].DADDR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_DADDR_DADDR((uint32_t &lt;span style=&#34;color:#66d9ef&#34;&gt;volatile&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;TCD0_Dest);&lt;span style=&#34;color:#75715e&#34;&gt;/* Dest. */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].DOFF &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_DOFF_DOFF(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* No dest adr offset after transfer*/&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CITER.ELINKNO&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_CITER_ELINKNO_CITER(&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* 11 minor loop iterations*/&lt;/span&gt;
DMA_TCD_CITER_ELINKNO_ELINK(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* No minor loop chan link */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].DLASTSGA &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_DLASTSGA_DLASTSGA(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* No dest chg after major loop*/&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].CSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_CSR_START(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear START status flag */&lt;/span&gt;
DMA_TCD_CSR_INTMAJOR(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* No IRQ after major loop */&lt;/span&gt;
DMA_TCD_CSR_INTHALF(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* No IRQ after 1/2 major loop */&lt;/span&gt;
DMA_TCD_CSR_DREQ(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable chan after major loop*/&lt;/span&gt;
DMA_TCD_CSR_ESG(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable Scatter Gather */&lt;/span&gt;
DMA_TCD_CSR_MAJORELINK(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* No major loop chan link */&lt;/span&gt;
DMA_TCD_CSR_ACTIVE(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear ACTIVE status flag */&lt;/span&gt;
DMA_TCD_CSR_DONE(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear DONE status flag */&lt;/span&gt;
DMA_TCD_CSR_MAJORLINKCH(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Chan # if major loop ch link */&lt;/span&gt;
DMA_TCD_CSR_BWC(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* No eDMA stalls after R/W */&lt;/span&gt;
DMA&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCD[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].BITER.ELINKNO&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMA_TCD_BITER_ELINKNO_BITER(&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* Initial iteration count*/&lt;/span&gt;
DMA_TCD_BITER_ELINKNO_ELINK(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* No minor loop chan link */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å“‡ï¼Œè¿™ä¸ªå¤§å®¶è‡ªå·±å¯¹ç…§é‚£ä¸ªè¡¨æ¥çœ‹å§ï¼Œå¤ªéº»çƒ¦äº†ã€‚
DMA åªè¦å‘å‡ºæŒ‡ä»¤åï¼ŒCPU æ˜¯ä¸éœ€è¦ä»»ä½•æ“ä½œçš„ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ä¸»å‡½æ•°é‡Œé¢æœ‰å‡ ä¸ªç©ºå¾ªç¯ç­‰å¾… DMA å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;DMA æ˜¯ä¸ªå¤§å·¥ç¨‹ï¼Œè¦æ˜¯æƒ³ç†è§£çš„è¯éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œä¸€å¼€å§‹çš„æ—¶å€™æˆ‘çœ‹è¿™ä¸€èŠ‚å¾ˆå¤´å¤§ï¼Œå› ä¸ºéœ€è¦ç†è§£çš„ä¸œè¥¿å¤ªå¤šäº†ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå…ˆä»ç¡¬ä»¶ä¸Šçš„ DMA MUX å¼€å§‹è®²èµ·ï¼ŒDMA MUX æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ç”¨æ¥è·¯ç”±ä¸€å…± 64 ä¸ª DMA æºï¼Œä¹Ÿå«åšæ§½ï¼Œåˆ° 16 ä¸ª DMA é€šé“çš„ä»»æ„ä¸€ä¸ªä½ç½®ä¸Šé¢ã€‚åœ¨è¿›è¡Œç¡¬ä»¶ DMA è¯·æ±‚çš„æ—¶å€™ï¼Œå…¶å®è¯·æ±‚æºæ˜¯å…ˆç»è¿‡ DMAMUX ï¼Œå¹¶è¢«æ˜ å°„åˆ° 16 ä¸ª DMA é€šé“ä¸Šé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è¿›è¡Œ DMA æ“ä½œçš„æ—¶å€™è¦é¦–å…ˆè®¾ç½® DMAMUXï¼Œä¸ç„¶ DMA è¯·æ±‚æ ¹æœ¬å°±æ— æ³•åˆ°è¾¾ DMAã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-19-S32K144_6/DMAMUX.png&#34; alt=&#34;DMAMUX.png&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;dmamux-&#34;&gt;DMAMUX çš„å·¥ä½œæ¨¡å¼ï¼š&lt;/h3&gt;
&lt;h4 id=&#34;heading-3&#34;&gt;å…³é—­æ¨¡å¼&lt;/h4&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼ŒDMA é€šé“æ˜¯å…³é—­çš„ã€‚å› ä¸ºå…³é—­æˆ–è€…å¼€å¯ DMA é€šé“æ˜¯åœ¨ä¿®æ”¹ DMA ç›¸å…³å¯„å­˜å™¨éœ€è¦é¦–å…ˆæ“ä½œçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ¨¡å¼ä¸»è¦æ˜¯ç”¨äºå°†ä¸€ä¸ª DMA é€šé“çš„çŠ¶æ€ä¿®æ”¹ä¸ºé»˜è®¤çŠ¶æ€ã€‚è¿˜æœ‰ä¸€ä¸ªç”¨é€”å°±æ˜¯ï¼Œå½“ä½ é‡æ–°è®¾ç½®ç³»ç»Ÿè®¾ç½®æ—¶å€™ç”¨äºæš‚æ—¶æŒ‚èµ·ä¸€ä¸ª DMA é€šé“ï¼Œå¦‚ä½ è¦ä¿®æ”¹ DMA è§¦å‘å™¨å‘¨æœŸã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-4&#34;&gt;æ­£å¸¸æ¨¡å¼&lt;/h4&gt;
&lt;p&gt;åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼ŒDMA æºæ˜¯è¢«è·¯ç”±åˆ°ç‰¹å®šçš„ DMA é€šé“ä¸Šã€‚åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹çš„ DMA MUX çš„è·¯ç”±åŠŸèƒ½æ˜¯è‡ªåŠ¨çš„ï¼Œå¯ä»¥è§†ä½œä¸€ä¸ªä¸å­˜åœ¨çš„æ¨¡å—ã€‚&lt;/p&gt;
&lt;h4 id=&#34;heading-5&#34;&gt;å‘¨æœŸè§¦å‘æ¨¡å¼&lt;/h4&gt;
&lt;p&gt;åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼ŒDMA æºå°†ä¼šå‘¨æœŸæ€§è¯·æ±‚ä¸€ä¸ª DMA è¯·æ±‚ï¼Œä¾‹å¦‚æ˜¯ä¸€ä¸ªæ¥æ”¶ Buffer è£…æ»¡æˆ–è€…æ˜¯å‘é€ Buffer å·²ç»è¢«æ¸…ç©ºã€‚&lt;/p&gt;
&lt;p&gt;è®¾ç½®å‘¨æœŸæ˜¯é€šè¿‡ä¿®æ”¹ LPIT çš„å¯„å­˜å™¨æ•°æ®è¿›è¡Œä¿®æ”¹çš„ã€‚è¿™ä¸ªæ¨¡å¼ä»…ä»…èƒ½å¤Ÿåœ¨ 0-3 è¿™å››ä¸ªé€šé“è¿›è¡Œçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;-dmamux&#34;&gt;è®¾ç½® DMAMUXï¼š&lt;/h3&gt;
&lt;h4 id=&#34;channel-configuration-register-dmamux-chcfgnn0-15&#34;&gt;Channel Configuration register (DMAMUX_CHCFGn)(n=0-15)&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;æ¯ä¸€ä¸ª DMA é€šé“éƒ½åªèƒ½å•ç‹¬çš„å¯¹åº”ä¸€ä¸ªæº&lt;/strong&gt;ã€‚å¦‚æœè®¾ç½®å¤šä¸ª CHCFG å¯„å­˜å™¨çš„å€¼å¯¹åº”åŒä¸€ä¸ªæºçš„è¯ä¼šå¯¼è‡´ä¸å¯é¢„æ–™çš„é”™è¯¯ï¼Œç”šè‡³æ˜¯ä½ å°†å…¶ä¸­ç›¸åŒæ˜ å°„é€šé“å…³é—­è¿˜æ˜¯ä¼šå¯¼è‡´é”™è¯¯çš„å‡ºç°ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ENBL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;DMA Channel Enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;é€šé“æ˜¯èƒ½å¼€å…³&lt;!-- raw HTML omitted --&gt;0 æ˜¯å…³é—­é€šé“ï¼Œ1 æ˜¯å¼€å¯é€šé“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TRIG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;DMA Channel Trigger Enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;å¼€å¯å‘¨æœŸæ€§å¼€å…³&lt;!-- raw HTML omitted --&gt;0 å…³é—­å‘¨æœŸæ€§å¼€å…³ï¼Œé€šé“å°†ä¼šæ­£å¸¸å¼€&lt;!-- raw HTML omitted --&gt;1 æ˜¯å¼€å¯è§¦å‘æ¨¡å¼ï¼Œåªæœ‰å½“æ¥æ”¶åˆ°å‡ºå‘çš„æ—¶å€™ï¼ŒDMA MUX æ‰ä¼šæ­£å¸¸å·¥ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOURCE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;æ­¤ä½ç”¨äºè®¾ç½®å¯¹åº”æºçš„åºå·&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;heading-6&#34;&gt;åŠŸèƒ½çš„æè¿°ï¼š&lt;/h3&gt;
&lt;p&gt;DMAMUX çš„åŠŸèƒ½æ˜¯ä¸ºäº†æä¾›ç»™ç³»ç»Ÿçµæ´»çš„ DMA ä½¿ç”¨æƒï¼Œé€šè¿‡ DMA é€šé“ã€‚&lt;/p&gt;
&lt;p&gt;DMAMUX çš„é€šé“å¯ä»¥åˆ’åˆ†æˆä¸ºä¸€ä¸‹çš„å‡ ä¸ªç±»åˆ«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šé“å¯ä»¥æ­£å¸¸çš„åœ¨è·¯ç”±é…ç½®ä¸‹è¿›è¡Œè·¯ç”±&lt;/li&gt;
&lt;li&gt;é€šé“åªæœ‰åœ¨è§¦å‘ä¿¡å·å’Œè·¯ç”±é…ç½®ä¸‹è¿›è¡Œè·¯ç”±&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è€Œä¸” DMAMUX æœ‰ä¸¤ä¸ªæºåœ°å€æ˜¯å¸¸å¼€çš„ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¸€ç›´å…è®¸æ•°æ®ä¼ è¾“ï¼Œè¿™ä¸ªç‰¹æ€§åœ¨è¯»å†™ GPIO æ•°æ®ï¼Œæˆ–è€…æ˜¯ä¸ºäº†ä¿è¯æ•°æ®ä¼ è¾“é€Ÿçš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨è½¯ä»¶æ¿€æ´» DMA ä¼ è¾“ï¼Œä¸éœ€è¦é¢‘ç¹çš„å¼€å…³ DMA é€šé“ï¼‰&lt;/p&gt;
&lt;h3 id=&#34;-dma-&#34;&gt;ä½¿ç”¨ï¼Œæ§åˆ¶ DMA æºçš„è¿‡ç¨‹&lt;/h3&gt;
&lt;h4 id=&#34;heading-7&#34;&gt;ä½¿ç”¨ä¸€ä¸ªå‘¨æœŸæ€§è§¦å‘çš„æºï¼š&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;å†³å®šä½¿ç”¨å“ªä¸€ä¸ª DMA æºï¼Œåœ¨è¿™ä¸ªæ—¶å€™åº”å½“æ³¨æ„åªæœ‰å‰ 4 ä¸ªé€šé“æ˜¯å‘¨æœŸæ€§é€šé“ã€‚&lt;/li&gt;
&lt;li&gt;æ¸…ç©ºå¯¹åº”é€šé“çš„ &lt;code&gt;CHCFG[ENBL]&lt;/code&gt; å’Œ &lt;code&gt;CHCFG[TRIG]&lt;/code&gt;  ã€‚&lt;/li&gt;
&lt;li&gt;ç¡®å®šåœ¨ DMA ä¸­ï¼Œç›¸åº”çš„é€šé“å·²ç»è¢«è®¾ç½®å®Œæˆï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥æ§åˆ¶å¼€å¯ DMA é€šé“ã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½®å¯¹åº”çš„æ—¶é’Ÿã€‚&lt;/li&gt;
&lt;li&gt;é€‰æ‹©åˆé€‚çš„æºåˆ° DMA é€šé“ä¸Šé¢å»ï¼Œå†™å…¥ç›¸å¯¹åº”çš„ &lt;code&gt;CHCFG[ENBL]&lt;/code&gt; å’Œ &lt;code&gt;CHCFG[TRIG]&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;heading-8&#34;&gt;ä¸¾ä¸ªä¾‹å­ä»¥ä¾¿äºå¤§å®¶ç†è§£ï¼š&lt;/h5&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨è¦è®¾ç½® 5# æºä½¿ç”¨ DMA é€šé“ 1ï¼Œå¹¶ä¸”ä½¿ç”¨å‘¨æœŸæ€§è§¦å‘çš„åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å‘ &lt;code&gt;CHCFG1&lt;/code&gt; å†™å…¥ 0x00&lt;/li&gt;
&lt;li&gt;è®¾ç½®é€šé“ 1 åœ¨ DMA è®¾ç½®ä¸­ï¼ŒåŒ…æ‹¬å¼€å¯è¯¥é€šé“&lt;/li&gt;
&lt;li&gt;è®¾ç½®ä¸€ä¸ªæ—¶é’Ÿç»™æ‰€éœ€è¦çš„è§¦å‘é—´éš”&lt;/li&gt;
&lt;li&gt;å‘ &lt;code&gt;CHCFG1&lt;/code&gt; å†™å…¥ç›¸åº”çš„å€¼&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ€åä¸€æ­¥è®¾ç½® DMAMUX çš„ä»£ç å¯ä»¥å†™æˆå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DMAMUX_Init&lt;/span&gt; (uint8_t DMA_CH, uint8_t DMAMUX_SOURCE)
{
    DMAMUX_0.CHCFG[DMA_CH].B.SOURCE &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DMAMUX_SOURCE;
    DMAMUX_0.CHCFG[DMA_CH].B.ENBL &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
    DMAMUX_0.CHCGF[DMA_CH].B.TRIG &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;heading-9&#34;&gt;ä½¿ç”¨ä¸€ä¸ªä¸æ˜¯å‘¨æœŸæ€§è§¦å‘çš„é€šé“ï¼š&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;å†³å®šä½¿ç”¨å“ªä¸€ä¸ª DMA æºï¼Œåœ¨è¿™ä¸ªæ—¶å€™åº”å½“æ³¨æ„åªæœ‰å‰ 4 ä¸ªé€šé“æ˜¯å‘¨æœŸæ€§é€šé“ã€‚&lt;/li&gt;
&lt;li&gt;æ¸…ç©ºå¯¹åº”é€šé“çš„ &lt;code&gt;CHCFG[ENBL]&lt;/code&gt; å’Œ &lt;code&gt;CHCFG[TRIG]&lt;/code&gt;  ã€‚&lt;/li&gt;
&lt;li&gt;ç¡®å®šåœ¨ DMA ä¸­ï¼Œç›¸åº”çš„é€šé“å·²ç»è¢«è®¾ç½®å®Œæˆï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥æ§åˆ¶å¼€å¯ DMA é€šé“ã€‚&lt;/li&gt;
&lt;li&gt;é€‰æ‹©åˆé€‚çš„æºåˆ° DMA é€šé“ä¸Šé¢å»ï¼Œå†™å…¥ç›¸å¯¹åº”çš„ &lt;code&gt;CHCFG[ENBL]&lt;/code&gt; å’Œ &lt;code&gt;CHCFG[TRIG]&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å°‘äº†ä¸€ä¸ªé…ç½®æ—¶é’Ÿçš„ç¯èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šæ˜¯ DMAMUX ä¹Ÿå³æ˜¯ DMA å¤šè·¯å¤ç”¨å™¨çš„è®¾ç½®æ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹ eDMA(Enhanced Direct Memory Access) æ¨¡å—ï¼Œç»“æ„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;edma-&#34;&gt;eDMA ç»„ä»¶&lt;/h3&gt;
&lt;p&gt;eDMA åˆ†ä¸ºä¸¤ä¸ªä¸»è¦çš„æ¨¡å—ï¼Œä¸€ä¸ªæ˜¯ eDMA å¼•æ“å’Œ TCDã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-19-S32K144_6/DMA_module.png&#34; alt=&#34;DMA_module.png&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;edma--1&#34;&gt;eDMA å·¥ä½œç‰¹ç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®ç§»åŠ¨è¿‡ç¨‹æ¶‰åŠåˆ°ä¸¤ä¸ªåœ°å€ï¼šä»æºåœ°å€è¯»å–æ•°æ®ï¼Œå†™å…¥ç›®æ ‡åœ°å€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯æ§åˆ¶çš„æºåœ°å€å’Œç›®æ ‡åœ°å€å’Œä¼ è¾“æ•°æ®å¤§å°&lt;/li&gt;
&lt;li&gt;æ”¯æŒåŠ å¼ºçš„åœ°å€æ¨¡å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;16 é€šé“æ‰§è¡Œå™¨ï¼Œå¯ä»¥å®ç°å¤æ‚çš„æ•°æ®ä¼ è¾“&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†…éƒ¨æ•°æ®ç¼“å­˜å™¨ï¼Œå¯ä»¥æš‚æ—¶å‚¨å­˜ 16 æˆ–è€… 32 å­—èŠ‚çš„ä¼ è¾“&lt;/li&gt;
&lt;li&gt;è¿æ¥åœ¨çºµæ¨ªå¼€å…³ï¼ˆå¤šç«¯å£é€‰æ‹©å¼€å…³ï¼‰è¿æ¥åœ¨å æ®æ€»çº¿å’Œæ•°æ®ç§»åŠ¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Transfer control descriptor (TCD) è¢«å‡çº§æˆä¸ºæ”¯æŒä¸¤ç§å†…åµŒçš„æ·±åº¦ä¼ è¾“æ“ä½œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸€ä¸ªé€šé“éƒ½å¯¹åº”ä¸€ä¸ª 32-byte TCD å‚¨å­˜åœ¨å†…å­˜ä¸­&lt;/li&gt;
&lt;li&gt;å†…éƒ¨æ•°æ®ä¼ è¾“å‰¯å¾ªç¯è¢«å®šä¹‰&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨æ•°æ®ä¼ è¾“ä¸»å¾ªç¯è¢«å®šä¹‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šé“æ¿€æ´»é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›´æ¥è½¯ä»¶åˆå§‹åŒ–&lt;/li&gt;
&lt;li&gt;é€šè¿‡é€šé“è¿æ¥æœºåˆ¶æ¿€æ´»&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨æ­¥è¿›è¯·æ±‚ç¡¬ä»¶æ¿€æ´»&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å›ºå®šä¼˜å…ˆçº§å’Œè½®è¯¢ä»²è£&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šé“æ•°æ®ä¼ è¾“å®Œæˆåå¯äº§ç”Ÿä¸­æ–­è¯·æ±‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªé€šé“ä¸€ä¸ªä¸­æ–­æºï¼Œå¯ä»¥å®ç°åœ¨ä¸»å¾ªç¯å®Œæˆåå‘èµ·ä¸­æ–­&lt;/li&gt;
&lt;li&gt;å¯ç¼–ç¨‹é”™è¯¯ç»ˆæ­¢ï¼Œå¹¶ä¸”äº§ç”Ÿç›¸åº”çš„ä¸­æ–­ç»™ä¸­æ–­æ§åˆ¶å™¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;dma-&#34;&gt;DMA å·¥ä½œæµç¨‹&lt;/h1&gt;
&lt;p&gt;é¦–å…ˆï¼Œå¤–å›´è®¾å¤‡å‘å‡º DMA è¯·æ±‚è¦æ±‚é€šé“ n æä¾› DMA æœåŠ¡ã€‚é¦–å…ˆæ˜¯é€šé“æ¿€æ´»é˜¶æ®µã€‚ eDMA
è¯·æ±‚çš„è¾“å…¥ä¿¡å·å…ˆåš DMA çš„å†…éƒ¨ç™»è®°ï¼Œç„¶åè¢«ä¼ é€åˆ° eDMA å¼•æ“ï¼šé¦–å…ˆé€šè¿‡æ§åˆ¶æ¨¡å—ï¼Œç„¶
åè¿›å…¥ç¼–ç¨‹æ¨¡å—è¿›è¡Œè£å†³ã€‚ä¸‹ä¸€æ­¥ï¼Œå¼€å§‹æ ¹æ®å›ºå®šä¼˜å…ˆçº§æˆ–è½®æµçš„æ–¹æ³•å¯¹ DMA è¯·æ±‚è£å†³ã€‚
è£å†³å®Œæ¯•ï¼Œè¢«æ¿€æ´»çš„é€šé“å·é€šè¿‡åœ°å€è·¯å¾„å¹¶è¢«è½¬æ¢æˆè®¿é—®å†…å­˜çš„åœ°å€ã€‚ä¸‹ä¸€æ­¥ï¼Œ TCD å­˜å‚¨å™¨
è¢«è®¿é—®ï¼Œå¯¹åº”çš„ TCD æè¿°ç¬¦è¢«è¯»å–å¹¶è½½å…¥åˆ° eDMA å¼•æ“ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;edma--2&#34;&gt;eDMA ç›¸å…³çš„å¯„å­˜å™¨ï¼é‡ä¸­ä¹‹é‡&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªæ˜¯ eDMA çš„ä¸€ä¸ªå…¸å‹çš„å·¥ä½œæµç¨‹ï¼Œè¯·å…ˆä¿è¯è‡ªå·±å¯¹äºå‰¯å¾ªç¯å’Œä¸»å¾ªç¯æœ‰ä¸€ä¸ªäº†è§£åœ¨è¿›è¡Œå¯„å­˜å™¨æ–¹é¢çš„è®¾ç½®
&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-19-S32K144_6/DMA_process.png&#34; alt=&#34;DMA_process.png&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;control-register-dma-cr&#34;&gt;Control Register (DMA_CR)&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨å®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„è®¾ç½®ã€‚å½“å†™å…¥è¿™ä¸ªå¯„å­˜å™¨çš„æ—¶å€™ï¼Œè¯·ä¿è¯ DMA é€šé“ä¸å¤„äºæ´»è·ƒçŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤å¯„å­˜å™¨å¯ä»¥è¿›è¡Œä»²è£æœºåˆ¶çš„è®¾ç½®ï¼Œä»²è£æœºåˆ¶å¯ä»¥è¢«è®¾ç½®æˆä¸ºä½¿ç”¨ä¸€ä¸ªå›ºå®šçš„ä¼˜å…ˆçº§çš„æˆ–è€…æ˜¯è½®è¯¢çš„æ–¹å¼ã€‚å½“æ—¶ç”¨è½®è¯¢æ–¹å¼è¿›è¡Œ DMA ä»²è£çš„æ—¶å€™ï¼Œä¼˜å…ˆçº§å°†ä¼šè¢«å¿½ç•¥ï¼ŒæŒ‰ç…§é€šé“çš„åºå·ä»é«˜åˆ°ä½è¿›è¡Œã€‚&lt;/p&gt;
&lt;p&gt;å‰¯å¾ªç¯åç§»é‡æ˜¯æŒ‡å½“å‰¯å¾ªç¯å®Œæˆçš„æ—¶å€™ï¼Œæºåœ°å€æˆ–è€…æ˜¯ç›®æ ‡åœ°å€çš„åç§»é‡ï¼Œè¿™ä¸ªåç§»é‡å¦‚æœè¢«å¼€å¯çš„çŠ¶æ€ä¸‹ï¼Œå½“ä¸€æ¬¡å‰¯å¾ªç¯ç»“æŸï¼ŒTCD å†…ç›®æ ‡æºåœ°å€ &lt;code&gt;TCDn_SADDR&lt;/code&gt; æˆ–è€…æ˜¯ç›®æ ‡åœ°å€ &lt;code&gt;TCDn_DADDR&lt;/code&gt; äº¦æˆ–æ˜¯ä¸¤è€…ï¼Œéƒ½ä¼šåœ¨åŠ ä¸Šä¸€ä¸ª minor loop offset (MLOFF) åè¢«é€å›å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»å¾ªç¯åç§»é‡ï¼Œå’Œå‰¯å¾ªç¯åç§»é‡åŸºæœ¬ä¸€è‡´ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œä¸»å¾ªç¯æœ€åå®Œæˆçš„å‰¯å¾ªç¯ï¼Œå…¶è®¾ç½®çš„å‰¯å¾ªç¯åç§»é‡å°†ä¼šè¢«å¿½è§†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸»å¾ªç¯åç§»é‡ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­å‰¯å¾ªç¯é‡å°±æ˜¯åœ¨è¯¥å¯„å­˜å™¨çš„ 7-EMLM å…¶ä¸­è®¾ç½® 1 å¼€å¯ Mapping åŠŸèƒ½ã€‚åœ¨ä¸€èˆ¬çš„æ“ä½œä¸­ï¼Œè¿™ä¸ªåŠŸèƒ½åŸºæœ¬ä¸Šç”¨ä¸åˆ°ï¼Œä½†æ˜¯å¿…é¡»çŸ¥é“ï¼Œä¸ç„¶æ²¡æ³•è®¾ç½®å¯„å­˜å™¨ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CX&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Cancel Transfer&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;æ­¤ä½å†™å…¥ 1 åå°†ä¼šå¼ºè¡Œåœæ­¢é€šé“å¹¶ä¸”å¼ºåˆ¶å‰¯å¾ªç¯ç»“æŸ&lt;!-- raw HTML omitted --&gt;ç»“æŸåï¼Œå°†ä¼šè‡ªåŠ¨æ¸…é›¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ECX&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Error Cancel Transfer&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;è¿™ä½çš„åŠŸèƒ½å’Œ CX ä¸€è‡´&lt;!-- raw HTML omitted --&gt;DMA å°†ä¼šè§†ä½œç»ˆæ­¢æ˜¯ç”±äºé”™è¯¯äº§ç”Ÿçš„&lt;!-- raw HTML omitted --&gt;&lt;code&gt;Error Status register (DMAx_ES)&lt;/code&gt; å°†ä¼šè¢«ç½® 1 å¹¶ä¸”å¯ä»¥äº§ç”Ÿä¸€ä¸ªä¸­æ–­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EMLM&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable Minor Loop Mapping&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;å‰¯å¾ªç¯åç§»é‡ä½¿èƒ½ä½&lt;!-- raw HTML omitted --&gt;å‰¯å¾ªç¯åç§»é‡ä½¿èƒ½ä½ï¼Œå½“ä¸º 1 çš„æ—¶å€™ï¼ŒTCDn.word2 ä¼šæœ‰ä¸åŒçš„å†…å®¹ï¼Œå…·ä½“åœ¨ä¸‹è¾¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLM&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Continuous Link Mode&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šè¯·ä¸è¦è®¾ç½®ä¸»å¾ªç¯å†…åªæœ‰ä¸€ä¸ªå‰¯å¾ªç¯çš„é€šé“æˆä¸ºè¿ç»­æ¨¡å¼&lt;!-- raw HTML omitted --&gt;å¦‚æœç½® 1ï¼Œåˆ™å‰¯å¾ªç¯ç»“æŸåï¼Œå¯ä»¥ä¸ç»è¿‡é€šé“ä»²è£å†æ¬¡è¢«æ¿€æ´» &lt;!-- raw HTML omitted --&gt;å¦‚æœç½® 0ï¼Œåˆ™å‰¯å¾ªç¯ç»“æŸåï¼Œå¿…é¡»åœ¨ç»è¿‡ä¸€ä¸ªé€šé“ä»²è£æ‰å¯ä»¥ç»§ç»­è¿è¡Œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;HALT&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Halt DMA Operations&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;ç½® 1 åæš‚åœæ‰€æœ‰æ–°çš„é€šé“&lt;!-- raw HTML omitted --&gt;æ‰§è¡Œä¸­çš„é€šé“å°†ä¼šç»§ç»­è¿è¡Œè‡³ç»“æŸ &lt;!-- raw HTML omitted --&gt;å†æ¬¡ç½® 0 å¯ä»¥æ¢å¤æ­£å¸¸&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;HOE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Halt On Error&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;å’Œä¸Šè¾¹çš„ HALT å¯„å­˜å™¨ä¸€è‡´ï¼Œä½†æ˜¯æ‹¥æœ‰é”™è¯¯å±æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ERCA&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable Round Robin Channel Arbitration&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;ç½® 1 å…è®¸é€šé“çš„è½®è¯¢æ¨¡å¼è¿›è¡Œä»²è£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EDBG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable Debug&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;ç½® 1 åï¼Œæ–°çš„é€šé“è¯·æ±‚å°†ä¼šè¢«æš‚åœï¼Œç›´åˆ°é€€å‡º Debug æ¨¡å¼&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;error-status-register-dma-es&#34;&gt;Error Status Register (DMA_ES)&lt;/h4&gt;
&lt;p&gt;é”™è¯¯å¯„å­˜å™¨ï¼Œå‚¨å­˜å„ç§ DMA é€šé“é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ OpenSDA è°ƒè¯•æŸ¥çœ‹è¿™ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œå¹³æ—¶ç”¨ä¸åˆ°ï¼Œå…ˆä¸ä»‹ç»ã€‚é”™è¯¯ç±»å‹ä¸€èˆ¬æœ‰ éæ³• TCDï¼Œé”™è¯¯çš„ä¼˜å…ˆçº§å¯„å­˜å™¨ï¼Œæ€»çº¿è¯»å†™é”™è¯¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;enable-request-register-dma-erq&#34;&gt;Enable Request Register (DMA_ERQ)&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨æ§åˆ¶ 16 ä¸ªé€šé“çš„è¯·æ±‚ä¿¡å·æ˜¯å¦è¢«æ¥æ”¶ã€‚å†™å…¥è¿™ä¸ªå¯„å­˜å™¨ä¸­ç›¸åº”çš„ä½å¯ä»¥ç›´æ¥æ§åˆ¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åç»­çš„ &lt;code&gt;DMA_SERQ&lt;/code&gt; å’Œ &lt;code&gt;DMA_CERQ&lt;/code&gt; æ“ä½œå¯„å­˜å™¨é—´æ¥å½±å“è¿™ä¸ªå¯„å­˜å™¨çš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å¦‚æœæ²¡æœ‰ DMA è¯·æ±‚äº§ç”Ÿçš„ DMA æœåŠ¡ï¼ˆè­¬å¦‚è½¯ä»¶æ§åˆ¶ DMAï¼‰åˆ™æ­¤ä½çš„çŠ¶æ€æ— è®ºå¦‚ä½•éƒ½å¯ä»¥äº§ç”Ÿ DMA æœåŠ¡ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ERQn&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable DMA Request n&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;ç½® 1 å¼€å¯ç›¸å¯¹åº”çš„é€šé“è¯·æ±‚æ¥æ”¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;enable-error-interrupt-register-dma-eei&#34;&gt;Enable Error Interrupt Register (DMA_EEI)&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨æ§åˆ¶ 16 ä¸ªé€šé“æ˜¯å¦äº§ç”Ÿé”™è¯¯ä¸­æ–­ã€‚å†™å…¥è¿™ä¸ªå¯„å­˜å™¨ä¸­ç›¸åº”çš„ä½å¯ä»¥ç›´æ¥æ§åˆ¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åç»­çš„ &lt;code&gt;DMA_SEEI&lt;/code&gt; å’Œ &lt;code&gt;DMA_CEEI&lt;/code&gt; æ“ä½œå¯„å­˜å™¨é—´æ¥å½±å“è¿™ä¸ªå¯„å­˜å™¨çš„å€¼ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EEIn&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable Error Interrupt n&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;ç½® 1 å¼€å¯ç›¸å¯¹åº”çš„é€šé“é”™è¯¯ä¸­æ–­&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id=&#34;interrupt-request-register-dma-int&#34;&gt;Interrupt Request Register (DMA_INT)&lt;/h5&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨æ§åˆ¶å„ä¸ªé€šé“çš„ä¸­æ–­è¯·æ±‚æ˜¯å¦äº§ç”Ÿï¼Œä¸­æ–­çš„äº§ç”Ÿæ¡ä»¶æ˜¯å†™åœ¨å¯¹åº”çš„é€šé“çš„ TCD ä¸­ï¼Œç„¶è€Œåœ¨ä¸­æ–­äº§ç”Ÿåï¼Œæˆ‘ä»¬éœ€è¦åŠæ—¶çš„å…³é—­å®ƒï¼Œå¸¸å¸¸åœ¨ &lt;code&gt;CINT&lt;/code&gt; æ“ä½œå¯„å­˜å™¨ä¸­è¿›è¡Œæ¸…é›¶æ“ä½œï¼Œåœ¨ä¸‹é¢æˆ‘ä»¬ä¼šä»‹ç»å¾ˆå¤šæ“ä½œå¯„å­˜å™¨ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;n&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;INTn&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Interrupt Request n&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;1 ç›®å‰é€šé“çš„ä¸­æ–­è¢«æ¿€æ´»&lt;!-- raw HTML omitted --&gt;0 ç›®å‰é€šé“ä¸­æ–­æœªæ¿€æ´»&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;channel-n-priority-register-dma-dchprin&#34;&gt;Channel n Priority Register (DMA_DCHPRIn)&lt;/h4&gt;
&lt;p&gt;DMA é€šé“ä¼˜å…ˆçº§å¯„å­˜å™¨&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ECP&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable Channel Preemption&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;è¿™ä¸ªæ˜¯è¢«æŠ¢å çš„å¼€å…³ï¼Œä¹Ÿå°±æ˜¯ç½® 1 åï¼Œè¯¥é€šé“ä¼šè¢«æ›´é«˜ä¼˜å…ˆçº§çš„é€šé“æŠ¢æ–­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DPA&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Disable Preempt Ability&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;è¿™ä¸ªæ˜¯ä¸èƒ½æŠ¢å çš„å¼€å…³ï¼Œä¹Ÿå°±æ˜¯ç½® 1 åï¼Œè¯¥é€šé“è¢«å‰¥å¤ºæŠ¢å ä½ä¼˜å…ˆçº§é€šé“çš„æƒåˆ©&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CHPRI&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Channel n Arbitration Priority&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;è¿™ä¸ªå°±æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„é€šé“ä¼˜å…ˆçº§äº†&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h1 id=&#34;-dma--1&#34;&gt;ä¸‹é¢æ˜¯ DMA æ“ä½œå¯„å­˜å™¨&lt;/h1&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨æœ‰å¾ˆå¤šç±»ä¼¼çš„ï¼ŒåŸºæœ¬çš„åŠŸèƒ½ä¸æ˜¯ Clear å°±æ˜¯ Setï¼Œä¸ºä»€ä¹ˆæˆ‘ç§°ä¹‹ä¸ºæ“ä½œå¯„å­˜å™¨å°±æ˜¯ä¿®æ”¹é‡Œé¢çš„å€¼ï¼Œå¸¦æ¥çš„ç»“æœæ˜¯å¯¹åº”çš„é…ç½®å¯„å­˜å™¨çš„å€¼çš„æ”¹å˜ï¼Œå…¶æœ¬èº«ä¸å¯¹åº”é…ç½®ã€‚&lt;/p&gt;
&lt;h4 id=&#34;clear-enable-error-interrupt-register-dma-ceei&#34;&gt;Clear Enable Error Interrupt Register (DMA_CEEI)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;NOP&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;No Op enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;ç½® 1 åï¼Œè¯¥å¯„å­˜å™¨æ‰€æœ‰æ“ä½œå‡è¢«å¿½è§†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CAFE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Clear All Enable Error Interrupt&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;ç½® 1 åï¼Œ&lt;code&gt;DMA_EEI&lt;/code&gt; æ‰€æœ‰ EEI ä½å‡è¢«æ¸…é›¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CEEI&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Clear Enable Error Interrupt&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;åœ¨è¿™ä¸ªåŸŸå†…å¡«å†™ï¼ˆ0-15ï¼‰å°†ä¼šå¯¼è‡´å¯¹åº”çš„ EEIn æ¸…é›¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;set-enable-error-interrupt-register-dma-seei&#34;&gt;Set Enable Error Interrupt Register (DMA_SEEI)&lt;/h4&gt;
&lt;p&gt;å’Œä¸Šé¢çš„ä¸€æ ·ï¼Œåªä¸è¿‡æ˜¯æ¸…é›¶æ”¹æˆç½®ä½ã€‚&lt;/p&gt;
&lt;h4 id=&#34;clear-enable-request-register-dma-cerq&#34;&gt;Clear Enable Request Register (DMA_CERQ)&lt;/h4&gt;
&lt;p&gt;æ¸…é›¶ ERQ ä½ã€‚&lt;/p&gt;
&lt;h4 id=&#34;set-enable-request-register-dma-serq&#34;&gt;Set Enable Request Register (DMA_SERQ)&lt;/h4&gt;
&lt;p&gt;ç½®ä½ ERQ ä½ã€‚&lt;/p&gt;
&lt;h4 id=&#34;clear-done-status-bit-register-dma-cdne&#34;&gt;Clear DONE Status Bit Register (DMA_CDNE)&lt;/h4&gt;
&lt;p&gt;æ¸…é›¶é€šé“çš„ TCD ä¸­çš„ DONE ä½ã€‚&lt;/p&gt;
&lt;h4 id=&#34;set-start-bit-register-dma-ssrt&#34;&gt;Set START Bit Register (DMA_SSRT)&lt;/h4&gt;
&lt;p&gt;å°†é€šé“ TCD ä¸­çš„ START ä½ç½®ä½ã€‚&lt;/p&gt;
&lt;h4 id=&#34;clear-error-register-dma-cerr&#34;&gt;Clear Error Register (DMA_CERR)&lt;/h4&gt;
&lt;p&gt;å°†é€šé“ä¸­çš„é”™è¯¯å¯„å­˜å™¨æ¸…é›¶ã€‚&lt;/p&gt;
&lt;h4 id=&#34;clear-interrupt-request-register-dma-cint&#34;&gt;Clear Interrupt Request Register (DMA_CINT)&lt;/h4&gt;
&lt;p&gt;å°†é€šé“ä¸­çš„ä¸­æ–­è¯·æ±‚æ¸…é›¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;tcd&#34;&gt;TCDç›¸å…³å¯„å­˜å™¨&lt;/h2&gt;
&lt;p&gt;æ³¨æ„ï¼Œä»¥ä¸‹å¯„å­˜å™¨å‡æœ‰ 16 ä¸ªï¼Œå¯¹åº” 16 ä¸ªé€šé“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;tcd-source-address-dma-tcdn-saddr&#34;&gt;TCD Source Address (DMA_TCDn_SADDR)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SADDR&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Source Address&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;å­˜æ”¾æŒ‡å‘æºæ•°æ®çš„åœ°å€&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-signed-source-address-offset-dma-tcdn-soff&#34;&gt;TCD Signed Source Address Offset (DMA_TCDn_SOFF)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOFF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Source address signed offset&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;æ¯æ¬¡è¯»å–æºåœ°å€åäº§ç”Ÿçš„åç§»é‡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-transfer-attributes-dma-tcdn-attr&#34;&gt;TCD Transfer Attributes (DMA_TCDn_ATTR)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨åªæœ‰ 16-bitï¼Œç›®çš„æ˜¯ç¡®è®¤ä¸€æ¬¡æ€§çš„ DMA ä¼ è¾“å¤šå°‘æ•°æ®ï¼Œåº”è¯¥å’Œå‰¯å¾ªç¯ä¸­çš„ &lt;code&gt;NBYTES&lt;/code&gt; åŒºåˆ†å¼€ï¼Œä¸€ä¸ªå‰¯å¾ªç¯å†…éƒ¨å¯èƒ½éœ€è¦å¤šæ¬¡çš„è¯»å†™è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15-11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SMOD&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Source Address Modulo&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;æºåœ°å€æ¨¡å€¼ &lt;!-- raw HTML omitted --&gt;SMOD å®šä¹‰äº†ä¸€ä¸ªåœ°å€èŒƒå›´ï¼Œè¯¥èŒƒå›´å¯ç”¨ 2^SMOD æ¥è¡¨ç¤º &lt;!-- raw HTML omitted --&gt;æ¯æ¬¡ä¼ é€ï¼Œä¹Ÿå°±æ˜¯å†…éƒ¨å®Œæˆä¸€æ¬¡è¯»/å†™ &lt;!-- raw HTML omitted --&gt;ä¸‹ä¸€æ¬¡è¯»å–æºåœ°å€å°†ä» SADDR+SOFF å¼€å§‹&lt;!-- raw HTML omitted --&gt;å¦‚æœè¿™ä¸ªåœ°å€åˆ°è¾¾äº† SMOD æŒ‡å®šçš„èŒƒå›´ï¼Œåˆ™å°†ä»å¤´å¼€å§‹&lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SSIZE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Source data transfer size&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;æºæ•°æ®è¯»å–å¤§å°è®¾ç½® &lt;!-- raw HTML omitted --&gt;000 - 8-bit&lt;!-- raw HTML omitted --&gt;001 - 16-bit&lt;!-- raw HTML omitted --&gt;010 - 32-bit &lt;!-- raw HTML omitted --&gt;011 - Reserved&lt;!-- raw HTML omitted --&gt;100 - 16-byte burst&lt;!-- raw HTML omitted --&gt;101 - 32-byte burst&lt;!-- raw HTML omitted --&gt;110 - Reserved&lt;!-- raw HTML omitted --&gt;111 - Reserved &lt;!-- raw HTML omitted --&gt;ï¼ˆè¯·ä¸è¦ä½¿ç”¨ä¿ç•™çš„å€¼ï¼Œä¼šå¯¼è‡´é…ç½®é”™è¯¯ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7-3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DMOD&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Destination Address Modulo&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;çœ‹ä¸Šé¢çš„ SMOD&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DSIZE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Destination data transfer size&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;çœ‹ä¸Šé¢çš„ SSIZE&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-minor-byte-count-minor-loop-mapping-disabled-dma-tcdn-nbytes-mlno&#34;&gt;TCD Minor Byte Count (Minor Loop Mapping Disabled) (DMA_TCDn_NBYTES_MLNO)&lt;/h3&gt;
&lt;p&gt;ä¹‹å‰æˆ‘å†™äº†ä¸€ä¸ªæœ‰å…³çš„ï¼Œåœ¨ &lt;code&gt;DMA_CR.MLME=1&lt;/code&gt; ä¼šæ”¹å˜ TCDn.word2 çš„æ”¹å˜ï¼Œè¿™ä¸ªå°±æ˜¯å½“ &lt;code&gt;DMA_CR.MLME=0&lt;/code&gt;ï¼Œä¹Ÿå³æ˜¯ Minor Loop Mapping å¤„äºå…³é—­çŠ¶æ€ä¸‹çš„ NBYTES å¯„å­˜å™¨ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;NBYTES&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Minor Byte Transfer Count&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; è¿™ä¸ªå¯„å­˜å™¨é‡Œé¢çš„å€¼å°±æ˜¯ä¸€æ¬¡å‰¯å¾ªç¯çš„ &lt;strong&gt;å­—èŠ‚æ•°&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; åœ¨ DMA ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œå‰¯å¾ªç¯æ˜¯ &lt;strong&gt;æœ€å°&lt;/strong&gt; çš„æ•°æ®ä¼ è¾“å•ä½&lt;!-- raw HTML omitted --&gt;åœ¨ä¸»å¾ªç¯ä¼ è¾“è¿‡ç¨‹ä¸­ä¸å¯æ‰“æ–­&lt;!-- raw HTML omitted --&gt;å½“ä¸€ä¸ª DMA é€šé“è¢«æ¿€æ´»åï¼Œç›¸å…³çš„ TCD å†…å®¹å°†ä¼šè¢«åŠ è½½è¿› eDMA å¼•æ“ä¸­&lt;!-- raw HTML omitted --&gt;ç»è¿‡ä¸€æ®µæ—¶é—´çš„è¯»/å†™æ•°æ®ï¼Œç›´åˆ°ä¼ è¾“äº† NBYTES ä¸ªå­—èŠ‚&lt;!-- raw HTML omitted --&gt;æ­¤æ—¶ ä¸€æ¬¡å‰¯å¾ªç¯å®Œæˆï¼Œä¸»å¾ªç¯è®¡æ•°å™¨å‡ä¸€å­˜å…¥ TCD&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-signed-minor-loop-offset-minor-loop-mapping-enabled-and-offset-disabled-dma-tcdn-nbytes-mloffno&#34;&gt;TCD Signed Minor Loop Offset (Minor Loop Mapping Enabled and Offset Disabled) (DMA_TCDn_NBYTES_MLOFFNO)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨çš„å½¢æ€æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Minor loop mapping å¼€å¯ (&lt;code&gt;CR[EMLM] = 1&lt;/code&gt;) å¹¶ä¸”&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SMLOE = 0&lt;/code&gt; &lt;strong&gt;and&lt;/strong&gt; &lt;code&gt;DMLOE = 0&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;31&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SMLOE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Source Minor Loop Offset Enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; é€‰æ‹©æ˜¯å¦è¿›è¡Œæºåœ°å€å‰¯å¾ªç¯åç§»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DMLOE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Destination Minor Loop Offset enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; é€‰æ‹©æ˜¯å¦è¿›è¡Œç›®æ ‡åœ°å€å‰¯å¾ªç¯åç§»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;29-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;NBYTES&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Minor Byte Transfer Count&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; è¿™ä¸ªå¯„å­˜å™¨é‡Œé¢çš„å€¼å°±æ˜¯ä¸€æ¬¡ä¸»å¾ªç¯çš„ &lt;strong&gt;å­—èŠ‚æ•°&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-signed-minor-loop-offset-minor-loop-mapping-and-offset-enabled-dma-tcdn-nbytes-mloffyes&#34;&gt;TCD Signed Minor Loop Offset (Minor Loop Mapping and Offset Enabled) (DMA_TCDn_NBYTES_MLOFFYES)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨çš„å½¢æ€æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Minor loop mapping å¼€å¯ (&lt;code&gt;CR[EMLM] = 1&lt;/code&gt;) å¹¶ä¸”&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SMLOE = 1&lt;/code&gt; &lt;strong&gt;or&lt;/strong&gt; &lt;code&gt;DMLOE = 1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;31&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SMLOE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Source Minor Loop Offset Enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; é€‰æ‹©æ˜¯å¦è¿›è¡Œæºåœ°å€å‰¯å¾ªç¯åç§»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DMLOE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Destination Minor Loop Offset enable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; é€‰æ‹©æ˜¯å¦è¿›è¡Œç›®æ ‡åœ°å€å‰¯å¾ªç¯åç§»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;29-10&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MLOFF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;æ‹“å±•å‰¯å¾ªç¯åç§»é‡è®¾ç½®&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; è¿™ä¸ªåç§»é‡æ˜¯åŒæ—¶ä½œç”¨åœ¨æºåœ°å€å’Œç›®æ ‡åœ°å€ä¸Šçš„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;NBYTES&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Minor Byte Transfer Count&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; è¿™ä¸ªå¯„å­˜å™¨é‡Œé¢çš„å€¼å°±æ˜¯ä¸€æ¬¡ä¸»å¾ªç¯çš„ &lt;strong&gt;å­—èŠ‚æ•°&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ³¨æ„ MLOFF å’Œ SOFF DOFF å…¶å®æ˜¯ä¸€æ ·åŠŸèƒ½çš„ï¼Œåªæ˜¯ MLOFF è®¾ç½®åä¼šåœ¨å‰¯å¾ªç¯å®Œæˆçš„æ—¶å€™å åœ¨åœ¨åœ°å€ä¸Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;tcd-last-source-address-adjustment-dma-tcdn-slast&#34;&gt;TCD Last Source Address Adjustment (DMA_TCDn_SLAST)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SLAST&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Last Source Address Adjustment&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; æœ€åæºåœ°å€è°ƒæ•´é‡ &lt;!-- raw HTML omitted --&gt; å½“ä¸»å¾ªç¯ç»“æŸåï¼Œå°†ä¼šåœ¨æ—§æºåœ°å€ä¸ŠåŠ å…¥æ­¤è°ƒæ•´é‡ &lt;!-- raw HTML omitted --&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-tcd-destination-address-dma-tcdn-daddr&#34;&gt;TCD TCD Destination Address (DMA_TCDn_DADDR)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªè·Ÿä¸Šè¾¹é‚£ä¸ª SADDR ä¸€æ ·ï¼Œä¸è¯¦ç»†å†™äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;tcd-signed-destination-address-offset-dma-tcdn-doff&#34;&gt;TCD Signed Destination Address Offset (DMA_TCDn_DOFF)&lt;/h3&gt;
&lt;p&gt;å†³å®šå½“æ¯ä¸ªä¸»å¾ªç¯ç»“æŸåï¼Œç›®æ ‡åœ°å€çš„åç§»é‡ã€‚16-bit&lt;/p&gt;
&lt;h3 id=&#34;tcd-current-minor-loop-link-major-loop-count-dma-tcdn-citer-elinkyes&#34;&gt;TCD Current Minor Loop Link, Major Loop Count (DMA_TCDn_CITER_ELINKYES)&lt;/h3&gt;
&lt;p&gt;è¯¥å¯„å­˜å™¨ä¸º 16-bitã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ELINK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Enable channel-to-channel linking on minor-loop complete&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; å¼€å¯åå³æ˜¯å¼€å¯é€šé“è¿æ¥åŠŸèƒ½ï¼Œå½“å‰¯å¾ªç¯å®Œæˆçš„æ—¶å€™ &lt;!-- raw HTML omitted --&gt; è¯¥ä½ç½® 1 å°†ä¼šå¯¼è‡´ &lt;code&gt;LINKCH&lt;/code&gt; å¯¹åº”é€šé“å†…çš„ &lt;code&gt;TCDn_CSR[START]=1&lt;/code&gt; æ¿€æ´»è¯¥é€šé“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;12-9&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;LINKCH&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Minor Loop Link Channel Number&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; &lt;code&gt;ELINK=1&lt;/code&gt; çš„æƒ…å†µä¸‹ï¼Œæ­¤å¯„å­˜å™¨æ‰ä¼šå­˜åœ¨ &lt;!-- raw HTML omitted --&gt; &lt;code&gt;ELINK=0&lt;/code&gt; æ­¤å¯„å­˜å™¨çš„ä½ç½®è¢« &lt;code&gt;CITER&lt;/code&gt; å æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;(14-0) or (8-0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CITER&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Current Major Iteration Count&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; ä¸»å¾ªç¯è®¡æ•°å™¨ &lt;!-- raw HTML omitted --&gt; 15-bit â€”â€” &lt;code&gt;ELINK=0&lt;/code&gt; &lt;!-- raw HTML omitted --&gt;  9-bit â€”â€” &lt;code&gt;ELINK=1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-last-destination-address-adjustmentscatter-gather&#34;&gt;TCD Last Destination Address Adjustment/Scatter Gather&lt;/h3&gt;
&lt;p&gt;Address (DMA_TCDn_DLASTSGA)&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DLASTSGA&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;è¿™ä¸ªå¯„å­˜å…¶æœ‰ä¸¤ä¸ªå«ä¹‰&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; åœ¨ &lt;code&gt;TCDn_CSR[ESG] = 0&lt;/code&gt; æƒ…å†µä¸‹ï¼Œå½“åšä¸»å¾ªç¯ç›®æ ‡åœ°å€åç§»é‡ &lt;!-- raw HTML omitted --&gt;å¦‚æœ &lt;code&gt;TCDn_CSR[ESG] != 0&lt;/code&gt; åˆ™å¯„å­˜å™¨æŒ‡å‘ä¸€ä¸ª TCD&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;tcd-control-and-status-dma-tcdn-csr&#34;&gt;TCD Control and Status (DMA_TCDn_CSR)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15-14&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;BWC&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;å¸¦å®½æ§åˆ¶&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 00 æ—  eDMA å¼•æ“åœæ­¢ &lt;!-- raw HTML omitted --&gt;01 Reserved&lt;!-- raw HTML omitted --&gt;10 eDMA å¼•æ“æ¯ 4 æ¬¡è¯»å†™åœæ­¢&lt;!-- raw HTML omitted --&gt;11 eDMA å¼•æ“æ¯ 8 æ¬¡è¯»å†™åœæ­¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;11-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MAJORLINKCH&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;ä¸»å¾ªç¯é€šé“è¿æ¥åºå·&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; è®¾ç½®å½“ä¸»å¾ªç¯ç»“æŸåï¼Œè§¦å‘çš„å¦ä¸€ä¸ªé€šé“å·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DONE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;é€šé“å®Œæˆä½&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; å½“ CITER è®¡æ•°å™¨å®Œæˆæ—¶è‡ªåŠ¨ç½®ä½&lt;!-- raw HTML omitted --&gt;è½¯ä»¶æ¸…é›¶æˆ–è€…å½“ä¸‹ä¸€æ¬¡æ¿€æ´»é€šé“çš„æ—¶å€™è‡ªåŠ¨æ¸…é›¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ACTIVE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;é€šé“æ¿€æ´»ä½&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; æŒ‡ç¤ºå½“å‰é€šé“çš„æ‰§è¡ŒçŠ¶æ€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MAJORELINK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;ä½¿èƒ½ä¸»å¾ªç¯é€šé“è¿æ¥ä½&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 0 å…³é—­ &lt;!-- raw HTML omitted --&gt; 1 å¼€å¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ESG&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;èšæ•£å¤„ç†ä½¿èƒ½ä½&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 0 å…³é—­ TCD æ­£å¸¸ &lt;!-- raw HTML omitted --&gt; 1 å¼€å¯ TCD.DLASTSGA å°†ä¼šæŒ‡å‘ä¸‹ä¸€ä¸ª TCD&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DREQ&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;å…³é—­è¯·æ±‚ä½&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 1 é€šé“ ERQ ä½ä¼šåœ¨ä¸»å¾ªç¯åè‡ªåŠ¨æ¸…é›¶ &lt;!-- raw HTML omitted --&gt; 0 é€šé“ ERQ ä½ä¸ä¼šè‡ªåŠ¨æ¸…é›¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;INTHALF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;å…è®¸å½“ä¸»å¾ªç¯ä¸€åŠæ—¶å‘èµ·ä¸­æ–­&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 0 å…³é—­ &lt;!-- raw HTML omitted --&gt; 1 å¼€å¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;INTMAJOR&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;å…è®¸å½“ä¸»å¾ªç¯å®Œæˆæ—¶å‘èµ·ä¸­æ–­&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 0 å…³é—­ &lt;!-- raw HTML omitted --&gt; 1 å¼€å¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;START&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;é€šé“å¼€å¯ä½&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt; 0 å…³é—­ &lt;!-- raw HTML omitted --&gt; 1 å¼€å¯ &lt;!-- raw HTML omitted --&gt; å¼€å¯åç¡¬ä»¶è‡ªåŠ¨æ¸…é›¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æœ€åï¼Œè¿˜æœ‰ä¸€ä¸ª BITER å¯„å­˜å™¨ï¼Œå…¶ç»“æ„å’Œ CITER å¹³è¡Œï¼Œç›´æ¥å°† BITER è®¾ç½®æˆä¸ºå’Œ CITER ä¸€æ ·å°±å¯ä»¥äº†ï¼Œä½†æ˜¯è¦æ³¨æ„ä¸€å®šè¦è®¾ç½® BITER å“¦ï¼Œä¸ç„¶ä¼šå‘ç”Ÿ DMA è®¾ç½®é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°è¿™ä¸ªæ—¶å€™ï¼Œå†çœ‹çœ‹ä¾‹ç¨‹ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—ååˆ†ç®€å•å‘¢ï¼Ÿ&lt;/p&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 5 NVIC</title>
      <link>https://xiahualiu.github.io/posts/2017-10-17-s32k144_5/</link>
      <pubDate>Tue, 17 Oct 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-10-17-s32k144_5/</guid>
      <description>&lt;p&gt;è¿™ä¸€èŠ‚çš„å†…å®¹æ˜¯æ ¹æ®å¯¹äºä¾‹ç¨‹çš„æ¢ç´¢ï¼Œäº†è§£ S32K ä¸Šçš„ ADC æ¨¡å—çš„ä½¿ç”¨æ–¹æ³•&lt;/p&gt;
&lt;h1 id=&#34;heading&#34;&gt;æœ¬èŠ‚ç¨‹åºåŒ…å«çš„æ­¥éª¤ï¼š&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;SOSC 8MHzï¼ŒSPLL 160Mhzï¼Œç³»ç»Ÿæ—¶é’Ÿ 80MHzï¼Œå¼€å¯ RUN æ¨¡å¼ã€‚&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–ç®¡è„šï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨ PCC ä½¿èƒ½ Port D&lt;/li&gt;
&lt;li&gt;PTD0: GPIO output - connects to blue LED&lt;/li&gt;
&lt;li&gt;PTD15: GPIO output - connects to red LED&lt;/li&gt;
&lt;li&gt;PTD16: GPIO output - connects to green LED&lt;/li&gt;
&lt;li&gt;ï¼ˆå› ä¸ºé‡å¯åï¼Œæ¨¡æ‹Ÿç®¡è„šä¸éœ€è¦åˆå§‹åŒ–ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ– ADCï¼š
&lt;ul&gt;
&lt;li&gt;é€‰æ‹© SOSCDIV2_CLK ä½œä¸ºåŠŸèƒ½å§‹ç»ˆå¹¶ä¸”åœ¨æ¨¡å—ä¸­å¯ç”¨å®ƒ&lt;/li&gt;
&lt;li&gt;å…³é—­æ¨¡å—å¹¶ä¸”å…³é—­ä¸­æ–­è¯·æ±‚&lt;/li&gt;
&lt;li&gt;è®¾ç½® ADC æ¨¡å—ä¸º 12 ä½è½¬æ¢ä½¿ç”¨ SOSCDIV_CLK, åˆ†é¢‘å› å­æ˜¯ 1&lt;/li&gt;
&lt;li&gt;è®¾ç½®å–æ ·æ—¶é—´æ˜¯ 13 ADCK æ—¶é’Ÿå‘¨æœŸ&lt;/li&gt;
&lt;li&gt;è®¾ç½®è½¯ä»¶è§¦å‘è½¬æ¢ï¼Œä¸é€‚ç”¨æ¯”è¾ƒåŠŸèƒ½ï¼Œä¸ä½¿ç”¨ DMA å¹¶ä¸”ä½¿ç”¨é»˜è®¤çš„ç”µå‹å€¼å‚è€ƒç®¡è„š - ä¹Ÿå°±æ˜¯ $V_{REFH}$ å’Œ $V_{REFL}$&lt;/li&gt;
&lt;li&gt;å…³é—­è¿ç»­è½¬æ¢ï¼ˆä¹Ÿå°±æ˜¯ä¸€æ¬¡è½¬æ¢ä½¿ç”¨ä¸€æ¬¡è½¯ä»¶è§¦å‘ï¼‰ï¼Œå…³é—­ç¡¬ä»¶å¹³å‡åŠŸèƒ½ï¼Œå…³é—­åˆå§‹çŠ¶æ€çŸ«æ­£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¾ªç¯ä½“ï¼š
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å‘å‡º ADC è½¬æ¢æŒ‡ä»¤ç»™ é€šé“ 12ï¼ˆä½¿ç”¨ &lt;code&gt;ADC_SC1[0]&lt;/code&gt; ä½œä¸ºè½¯ä»¶è§¦å‘ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç­‰å¾…è½¬æ¢å®Œæˆæ ‡å¿—&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»å–ç»“æœå¹¶ä¸”å°†å…¶è½¬æ¢æˆä¸º 0-5000mv çš„èŒƒå›´ï¼ˆå¯¹äºæ‰€æœ‰çš„è½¯ä»¶è§¦å‘å¸¦æ¥çš„ç»“æœéƒ½åœ¨ &lt;code&gt;ADC_R[0]&lt;/code&gt; å†…ï¼‰&lt;/li&gt;
&lt;li&gt;æ ¹æ®ç”µå‹èŒƒå›´ç‚¹äº® LED&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‘å‡º ADC è½¬æ¢æŒ‡ä»¤è¯»å– ADC é«˜å‚è€ƒç”µå‹ï¼ˆä½¿ç”¨ &lt;code&gt;ADC_SC1[0]&lt;/code&gt; ä½œä¸ºè½¯ä»¶è§¦å‘ï¼‰ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç­‰å¾…è½¬æ¢å®Œæˆæ ‡å¿—ï¼Œå½“è½¬æ¢å®Œæˆçš„æ—¶å€™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»å–ç»“æœå¹¶ä¸”å°†å…¶è½¬æ¢æˆä¸º 0-5000mv çš„èŒƒå›´ï¼ˆå¯¹äºæ‰€æœ‰çš„è½¯ä»¶è§¦å‘å¸¦æ¥çš„ç»“æœéƒ½åœ¨ &lt;code&gt;ADC_R[0]&lt;/code&gt; å†…ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;heading-1&#34;&gt;ä»£ç ï¼š&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34; /* include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;clocks_and_modes.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;ADC.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTD15 15 &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* RED LED*/&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTD16 16 &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* GREEN LED*/&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTD0 0 &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* BLUE LED */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PORT_init&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_PORTD_INDEX ]&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clock for PORTD */&lt;/span&gt;
PORTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[PTD0] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0: MUX = GPIO */&lt;/span&gt;
PORTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[PTD15] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D15: MUX = GPIO */&lt;/span&gt;
PORTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[PTD16] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D16: MUX = GPIO */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0: Data Direction= output */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD15; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D15: Data Direction= output */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD16; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D16: Data Direction= output */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WDOG_disable&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CNT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xD928C520&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Unlock watchdog */&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TOVAL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x0000FFFF&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Maximum timeout value */&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00002100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable watchdog */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;)
{
uint32_t adcResultInMv&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
WDOG_disable(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable WDOG*/&lt;/span&gt;
SOSC_init_8MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize system oscillator for 8 MHz xtal */&lt;/span&gt;
SPLL_init_160MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize SPLL to 160 MHz with 8 MHz SOSC */&lt;/span&gt;
NormalRUNmode_80MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init clocks: 80 MHz sysclk &amp;amp; core, 40 MHz bus, 20 MHz flash */&lt;/span&gt;
PORT_init(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init port clocks and gpio outputs */&lt;/span&gt;
ADC_init(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init ADC resolution 12 bit*/&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(;;) {
convertAdcChan(&lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Convert Channel AD12 to pot on EVB */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(adc_complete()&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;){} &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for conversion complete flag */&lt;/span&gt;
adcResultInMv &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; read_adc_chx(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Get channel&amp;#39;s conversion results in mv */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (adcResultInMv &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3750&lt;/span&gt;) { &lt;span style=&#34;color:#75715e&#34;&gt;/* If result &amp;gt; 3.75V */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PSOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD16; &lt;span style=&#34;color:#75715e&#34;&gt;/* turn off blue, green LEDs */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD15; &lt;span style=&#34;color:#75715e&#34;&gt;/* turn on red LED */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (adcResultInMv &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2500&lt;/span&gt;) { &lt;span style=&#34;color:#75715e&#34;&gt;/* If result &amp;gt; 3.75V */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PSOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD15; &lt;span style=&#34;color:#75715e&#34;&gt;/* turn off blue, red LEDs */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD16; &lt;span style=&#34;color:#75715e&#34;&gt;/* turn on green LED */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (adcResultInMv &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1250&lt;/span&gt;) { &lt;span style=&#34;color:#75715e&#34;&gt;/* If result &amp;gt; 3.75V */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PSOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD15 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD16; &lt;span style=&#34;color:#75715e&#34;&gt;/* turn off red, green LEDs */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0; &lt;span style=&#34;color:#75715e&#34;&gt;/* turn on blue LED */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PSOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; PTD15 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD16; &lt;span style=&#34;color:#75715e&#34;&gt;/* Turn off all LEDs */&lt;/span&gt;
}
convertAdcChan(&lt;span style=&#34;color:#ae81ff&#34;&gt;29&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Convert chan 29, Vrefsh */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(adc_complete()&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;){} &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for conversion complete flag */&lt;/span&gt;
adcResultInMv &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; read_adc_chx(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Get channel&amp;#39;s conversion results in mv */&lt;/span&gt;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ADC å­å‡½æ•°éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;ADC.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ADC_init&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_ADC0_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Disable clock to change PCS */&lt;/span&gt;
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_ADC0_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_PCS(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* PCS=1: Select SOSCDIV2 */&lt;/span&gt;
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_ADC0_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable bus clock in ADC */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SC1[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00001F&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* ADCH=1F: Module is disabled for conversions*/&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* AIEN=0: Interrupts are disabled */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CFG1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x000000004&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* ADICLK=0: Input clk=ALTCLK1=SOSCDIV2 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ADIV=0: Prescaler=1 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MODE=1: 12-bit conversion */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CFG2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000C&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* SMPLTS=12(default): sample time is 13 ADC clks */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SC2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* ADTRG=0: SW trigger */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ACFE,ACFGT,ACREN=0: Compare func disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* DMAEN=0: DMA disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* REFSEL=0: Voltage reference pins= VREFH, VREEFL */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SC3 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* CAL=0: Do not start calibration sequence */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* ADCO=0: One conversion performed */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* AVGE,AVGS=0: HW average function disabled */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;convertAdcChan&lt;/span&gt;(uint16_t adcChan) { &lt;span style=&#34;color:#75715e&#34;&gt;/* For SW trigger mode, SC1[0] is used */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SC1[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;ADC_SC1_ADCH_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear prior ADCH bits */&lt;/span&gt;
ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SC1[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ADC_SC1_ADCH(adcChan); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initiate Conversion*/&lt;/span&gt;
}
uint8_t &lt;span style=&#34;color:#a6e22e&#34;&gt;adc_complete&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; ((ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SC1[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; ADC_SC1_COCO_MASK)&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;ADC_SC1_COCO_SHIFT); &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for completion */&lt;/span&gt;
}
uint32_t &lt;span style=&#34;color:#a6e22e&#34;&gt;read_adc_chx&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
uint16_t adc_result&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
adc_result&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;ADC0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;R[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]; &lt;span style=&#34;color:#75715e&#34;&gt;/* For SW trigger mode, R[0] is used */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; (uint32_t) ((&lt;span style=&#34;color:#ae81ff&#34;&gt;5000&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;adc_result)&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xFFF&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Convert result to mv for 0-5V range */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…³äºç¨‹åºéƒ¨åˆ†ï¼Œéœ€è¦æ³¨æ„çš„å°±æ˜¯ ADC åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸€ç³»åˆ—å¯„å­˜å™¨ï¼Œæ¯”è¾ƒå¤šæ¯”è¾ƒå¤æ‚ï¼Œæˆ‘åœ¨è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹æœ¬ç¨‹åºæ¶‰åŠçš„å¯„å­˜å™¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;adc-status-and-control-registers-1-adc1-sc1n&#34;&gt;ADC Status and Control Registers 1 (ADC1_SC1n)&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;ADC0-&amp;gt;SC1[n]&lt;/code&gt; è®¿é—®ï¼Œn æ•°å­—å¯¹åº”å­—æ¯ ABCDEFG&amp;hellip;Pã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨ä¸€å…±æœ‰ 16 ä¸ªï¼Œåœ¨å‚è€ƒæ‰‹å†Œä¸Šé¢åˆ†åˆ«å«åš ADC1_SC1(A-P), æˆ‘åˆšå¼€å§‹çœ‹çš„æ—¶å€™å¯¹äºè¿™ä¸€ç‚¹éå¸¸å›°æƒ‘ï¼Œå› ä¸ºè¿™ 16 ä¸ªå¯„å­˜å™¨çš„å®šä¹‰ä¸€æ¨¡ä¸€æ ·ï¼Œè€Œä¸”åªèƒ½æœ‰ä¸€ä¸ªå¯„å­˜å™¨å†…éƒ¨çš„é…ç½®æ˜¯åœ¨å·¥ä½œçš„ï¼Œæœ€ååœ¨ç½‘ä¸Šå¦å¤–ä¸€æ¬¾çš„é£æ€å¡å°”å•ç‰‡æœºä¸­æ‰¾çš„äº†ä¸ºä»€ä¹ˆæœ‰å¹³è¡Œçš„å¯„å­˜å™¨ã€‚è¿™ 16 ä¸ªå¯„å­˜å™¨å¯¹åº” 16 ä¸ªé…ç½®ï¼Œå°±åƒæ˜¯å­˜æ¡£ä¸€æ ·ï¼Œæˆ‘ä»¬çŸ¥é“è¯¥æ¬¾ ADC ä¸€å…±æœ‰ 16 ä¸ªé€šé“ï¼Œè€Œç”±äºæ¨¡å—çš„ç¡¬ä»¶å› ç´ ï¼ŒADC åœ¨åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªé€šé“ä¸­æ–­ï¼Œå¦‚æœæƒ³è¦åˆ‡æ¢é€šé“å°±è¦é¢‘ç¹åˆ‡æ¢é…ç½®ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥æå‰ç›´æ¥å†™å¥½å„ä¸ªè¦ä½¿ç”¨åˆ°çš„é€šé“çš„é‡‡æ ·é…ç½®ï¼Œè¿™æ ·åœ¨ä½¿ç”¨è§¦å‘å‘½ä»¤ï¼ˆtrigger å’Œ pre-triggerï¼‰æ—¶ï¼Œåªè¦æŒ‡å®šæ˜¯æŒ‰ç…§ ADC å“ªä¸€ä¸ªé…ç½®é‡‡æ ·å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªä¹Ÿæé†’äº†æˆ‘ï¼Œè¿™ä¸ªé…ç½®å’Œå¯¹åº”çš„ç»“æœå¯„å­˜å™¨ï¼Œä¹Ÿæ˜¯ç›¸äº’å¯¹åº”çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ï¼Œä¸€å…±æœ‰ 16 ä¸ªç»“æœå¯„å­˜å™¨ï¼Œä¹Ÿæ˜¯æŒ‰ç…§ A-P æ’åˆ—çš„ï¼Œå“ªä¸€ä¸ªé…ç½®äº§ç”Ÿçš„ç»“æœå°±æ”¾åœ¨å“ªä¸€ä¸ªå¯„å­˜å™¨é‡Œé¢ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆè½¯ä»¶è§¦å‘çš„ç»“æœéƒ½åœ¨ 0 å·å¯„å­˜å™¨é‡Œé¢çš„äº†ï¼Œå› ä¸ºè½¯ä»¶åªèƒ½è§¦å‘ A é…ç½®ã€‚
ï¼ˆä¸‹åˆ—æ ‡é¢˜ä¸­çš„æ•°å­—ä¸ºå¯¹åº”çš„å¯„å­˜å™¨åœ°å€æ®µï¼Œæœªæ³¨æ˜çš„åœ°å€æ®µä¸º Reserved åœ°å€æ®µï¼‰&lt;/p&gt;
&lt;h5 id=&#34;7---cococonversion-complete-flag&#34;&gt;7 - COCO(Conversion Complete Flag):&lt;/h5&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªåªèƒ½è¯»å–çš„å¯„å­˜å™¨ï¼Œè¿™ä¸ªå¯„å­˜å™¨åœ¨è½¬æ¢å®Œæˆçš„æ—¶å€™ä¼šç½® 1ï¼Œå½“ä¸‹åˆ—çš„æŸä¸€ä¸ªæˆ–è€…å¤šä¸ªæ¡ä»¶æˆç«‹çš„æ—¶å€™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯”è¾ƒåŠŸèƒ½å·²ç»å…³é—­&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SC2[ACFE]=0&lt;/code&gt; å¹¶ä¸”ç¡¬ä»¶å¹³å‡åŠŸèƒ½å·²ç»å…³é—­&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SC3[AVGE]=0&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ¯”è¾ƒç»“æœæ˜¯çœŸçš„æƒ…å†µä¸‹ï¼ŒCOCO å¯„å­˜å™¨åœ¨è½¬æ¢å®Œæˆçš„æ—¶å€™ä¼šç½® 1ï¼Œå½“ä¸‹åˆ—çš„æŸä¸€ä¸ªæˆ–è€…å¤šä¸ªæ¡ä»¶æˆç«‹çš„æ—¶å€™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯”è¾ƒåŠŸèƒ½å·²ç»å¼€å¯&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SC2[ACFE]=1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;COCO ä¹Ÿå¯ä»¥è¿›è¡Œåœ¨é€‰å®šçš„è½¬æ¢å®Œæˆçš„æ—¶å€™è¿›è¡Œç½®ä½ï¼ˆç”± &lt;code&gt;AVGS&lt;/code&gt; å†³å®šï¼‰å¦‚æœä¸‹åˆ—çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ¡ä»¶æˆç«‹çš„æ—¶å€™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¡¬ä»¶çš„å¹³å‡åŠŸèƒ½å·²ç»å¼€å¯&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SC3[AVGE]=1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ &lt;code&gt;SC1A&lt;/code&gt; ä¸­çš„ COCO è¿˜ä¼šåœ¨æ ¡å‡†åºåˆ—ç»“æŸåç½®ä½&lt;/p&gt;
&lt;p&gt;COCO å¯„å­˜å™¨ä¼šåœ¨ä»¥ä¸‹æ¡ä»¶è¾¾æˆçš„æ—¶å€™è¢«å¤ä½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹åº”çš„ &lt;code&gt;SC1n&lt;/code&gt; å¯„å­˜å™¨è¢«å†™å…¥&lt;/li&gt;
&lt;li&gt;å¯¹åº”çš„ &lt;code&gt;Rn&lt;/code&gt; å¯„å­˜å™¨è¢«è¯»å–&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;6---aieninterrupt-enable&#34;&gt;6 - AIEN(Interrupt Enable)&lt;/h5&gt;
&lt;p&gt;ä½¿èƒ½ä½ï¼Œå…è®¸è½¬æ¢å®Œæˆçš„æ—¶å€™å‘èµ·ä¸­æ–­ï¼Œå½“æ­¤ä½è¢«ç½® 1ï¼Œä¸”å½“ COCO ç½® 1 çš„æ—¶å€™ï¼Œä¸€ä¸ªä¸­æ–­å°±ä¼šè¢«ç”Ÿæˆã€‚&lt;/p&gt;
&lt;h5 id=&#34;4-0---adchinput-channel-select&#34;&gt;(4-0) - ADCH(Input channel select)&lt;/h5&gt;
&lt;p&gt;è¾“å…¥é€šé“é€‰æ‹©ï¼Œåœ¨æ–°çš„å‚è€ƒæ‰‹å†Œä¸­è¿™ä¸ªä¸€å…±æœ‰ 6 ä½ã€‚åœ¨è€ç‰ˆæœ¬çš„ RM ä¸­ï¼Œè¿™ä¸ªä½åªæœ‰ 5 ä½ï¼Œä½†æ˜¯è€ç‰ˆæœ¬çš„è¯¥å¯„å­˜å™¨åœ°å€æ®µåªæœ‰ 4 ä½ï¼Œä¸çŸ¥é“ç¼–è¿™ä¸ª RM çš„ä½œè€…æ˜¯æƒ³è¡¨è¾¾ä»€ä¹ˆæ„æ€ã€‚&lt;br&gt;
æœ€åæˆ‘å‚è€ƒäº†ä¸€ä¸‹å¤´æ–‡ä»¶é‡Œé¢çš„å£°æ˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define ADC_SC1_ADCH_WIDTH    5u&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€ä»¥åº”è¯¥æ˜¯ 5 ä½çš„å®½åº¦ï¼Œæˆ‘ä»¬å°±æŒ‰ç…§è€çš„ RM çš„æ•°æ®æ¥è¿›è¡Œè§£è¯»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;00000 AD0 is selected as input.&lt;/li&gt;
&lt;li&gt;00001 AD1 is selected as input.&lt;/li&gt;
&lt;li&gt;00010 AD2 is selected as input.&lt;/li&gt;
&lt;li&gt;00011 AD3 is selected as input.&lt;/li&gt;
&lt;li&gt;00100 AD4 is selected as input.&lt;/li&gt;
&lt;li&gt;00101 AD5 is selected as input.&lt;/li&gt;
&lt;li&gt;00110 AD6 is selected as input.&lt;/li&gt;
&lt;li&gt;00111 AD7 is selected as input.&lt;/li&gt;
&lt;li&gt;01000 AD8 is selected as input.&lt;/li&gt;
&lt;li&gt;01001 AD9 is selected as input.&lt;/li&gt;
&lt;li&gt;01010 AD10 is selected as input.&lt;/li&gt;
&lt;li&gt;01011 AD11 is selected as input.&lt;/li&gt;
&lt;li&gt;01100 AD12 is selected as input.&lt;/li&gt;
&lt;li&gt;01101 AD13 is selected as input.&lt;/li&gt;
&lt;li&gt;01110 AD14 is selected as input.&lt;/li&gt;
&lt;li&gt;01111 AD15 is selected as input.&lt;/li&gt;
&lt;li&gt;10000 Reserved.&lt;/li&gt;
&lt;li&gt;10001 Reserved.&lt;/li&gt;
&lt;li&gt;10010 AD18 is selected as input.&lt;/li&gt;
&lt;li&gt;10011 AD19 is selected as input.&lt;/li&gt;
&lt;li&gt;10100 Reserved.&lt;/li&gt;
&lt;li&gt;10101 AD21 is selected as input.&lt;/li&gt;
&lt;li&gt;10110 AD22 is selected as input.&lt;/li&gt;
&lt;li&gt;10111 AD23 is selected as input.&lt;/li&gt;
&lt;li&gt;11000 ATX Force&lt;/li&gt;
&lt;li&gt;11001 ATX Sense&lt;/li&gt;
&lt;li&gt;11010 Temp Sensor&lt;/li&gt;
&lt;li&gt;11011 Band Gap&lt;/li&gt;
&lt;li&gt;11100 AD28 is selected as input.&lt;/li&gt;
&lt;li&gt;11101 VREFSH is selected as input. Voltage reference selected is determined by SC2[REFSEL].&lt;/li&gt;
&lt;li&gt;11110 VREFSL is selected as input. Voltage reference selected is determined by SC2[REFSEL].&lt;/li&gt;
&lt;li&gt;11111 Module is disabled.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åªè¦ç‰¢è®°ä¸€ä»¶äº‹å°±æ˜¯è¿™ä¸ªå¯„å­˜å™¨å¦‚æœå…¨éƒ¨å– 1 çš„æ—¶å€™ï¼Œç›¸å½“äºå…³é—­ ADC æ¨¡å—ã€‚å…¶ä»–çš„é€‰æ‹©é€šé“æ—¶ä½¿ç”¨ &lt;code&gt;ADC_SC1_ADCH(x)&lt;/code&gt; è¿™ä¸ªå®šä¹‰åœ¨å¤´æ–‡ä»¶çš„å‡½æ•°å¯ä»¥ç›´æ¥å°†é€šé“æ”¹ä¸ºå¯¹åº”çš„ ADCH å€¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;adc-configuration-register-1-adcx-cfg1&#34;&gt;ADC Configuration Register 1 (ADCx_CFG1)&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;ADC0-&amp;gt;CFG1&lt;/code&gt; è®¿é—®ã€‚ä¸»è¦æ¶‰åŠçš„å†…å®¹æœ‰ï¼ŒADC å·¥ä½œæ¨¡å¼ï¼Œæ—¶é’Ÿæºï¼Œæ—¶é’Ÿåˆ†é¢‘ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆä¸‹åˆ—æ ‡é¢˜ä¸­çš„æ•°å­—ä¸ºå¯¹åº”çš„å¯„å­˜å™¨åœ°å€æ®µï¼Œæœªæ³¨æ˜çš„åœ°å€æ®µä¸ºä¿ç•™ 0 æ®µï¼‰&lt;/p&gt;
&lt;h5 id=&#34;6-5---adivclock-divide-select&#34;&gt;(6-5) - ADIV(Clock Divide Select)&lt;/h5&gt;
&lt;p&gt;é€‰æ‹© ADC çš„æ—¶é’Ÿåˆ†é¢‘ï¼Œç”¨äºäº§ç”Ÿ ADCK å†…éƒ¨æ—¶é’Ÿã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;00 æ—¶é’Ÿåˆ†é¢‘ä¸º 1 ï¼Œæ—¶é’Ÿé€Ÿåº¦å°±æ˜¯è¾“å…¥æ—¶é’Ÿçš„é€Ÿåº¦&lt;/li&gt;
&lt;li&gt;01 æ—¶é’Ÿåˆ†é¢‘ä¸º 2 ï¼Œæ—¶é’Ÿé€Ÿåº¦å°±æ˜¯è¾“å…¥æ—¶é’Ÿçš„ 1/2&lt;/li&gt;
&lt;li&gt;10 æ—¶é’Ÿåˆ†é¢‘ä¸º 4 ï¼Œæ—¶é’Ÿé€Ÿåº¦å°±æ˜¯è¾“å…¥æ—¶é’Ÿçš„ 1/4&lt;/li&gt;
&lt;li&gt;11 æ—¶é’Ÿåˆ†é¢‘ä¸º 8 ï¼Œæ—¶é’Ÿé€Ÿåº¦å°±æ˜¯è¾“å…¥æ—¶é’Ÿçš„ 1/8&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;3-2---modeconversion-mode-selection&#34;&gt;(3-2) - MODE(Conversion mode selection)&lt;/h5&gt;
&lt;p&gt;é€‰æ‹© ADC çš„åˆ†è¾¨ç‡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;00 8-bit è½¬æ¢&lt;/li&gt;
&lt;li&gt;01 12-bit è½¬æ¢&lt;/li&gt;
&lt;li&gt;10 10-bit è½¬æ¢&lt;/li&gt;
&lt;li&gt;11 Reserved&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;1-0---adiclkinput-clock-select&#34;&gt;(1-0) - ADICLK(Input Clock Select)&lt;/h5&gt;
&lt;p&gt;é€‰æ‹©è¾“å…¥æ—¶é’Ÿæºæ¥äº§ç”Ÿå†…éƒ¨æ—¶é’Ÿ ADCKã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;00 Alternate clock 1 (ADC_ALTCLK1)&lt;/li&gt;
&lt;li&gt;01 Alternate clock 2 (ADC_ALTCLK2)&lt;/li&gt;
&lt;li&gt;10 Alternate clock 3 (ADC_ALTCLK3)&lt;/li&gt;
&lt;li&gt;11 Alternate clock 4 (ADC_ALTCLK4)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;adc-configuration-register-2-adcx-cfg2&#34;&gt;ADC Configuration Register 2 (ADCx_CFG2)&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;ADC0-&amp;gt;CFG2&lt;/code&gt; è®¿é—®ã€‚ ä¸»è¦æ¶‰åŠçš„å†…å®¹æœ‰ï¼Œåœ¨â€œé•¿å–æ ·æ¨¡å¼â€ä¸‹é€‰æ‹©å–æ ·æ—¶é•¿ã€‚&lt;/p&gt;
&lt;h5 id=&#34;7-0-smpltssample-time-select&#34;&gt;(7-0) SMPLTS(Sample Time Select)&lt;/h5&gt;
&lt;p&gt;é€‰å…¶ä¸€ç³»åˆ—ä» 2-256 ä¸ª ADCK å‘¨æœŸçš„å–æ ·æ—¶é•¿ï¼Œåœ¨è¿™ä¸ª 8 ä½çš„å¯„å­˜å™¨ä¸­å†™çš„å€¼åŠ ä¸€å°±æ˜¯ç›¸åº”çš„å–æ ·æ—¶é•¿ï¼Œé•¿çš„å–æ ·æ—¶é—´å¯ä»¥æœ‰æ•ˆæé«˜ç²¾ç¡®æ€§ï¼Œä½†æ˜¯çŸ­çš„å–æ ·æ—¶é—´å¯ä»¥åŠ å¿«å–æ ·é€Ÿåº¦å¹¶ä¸”å‡å°‘å–æ ·æ¶ˆè€—çš„åŠŸç‡ã€‚åœ¨å•æ¬¡é‡‡æ ·çš„æ—¶å€™ï¼Œå»ºè®®é‡‡ç”¨é•¿æ—¶é—´é‡‡æ ·ï¼Œå¦‚æœæ˜¯è¿ç»­é‡‡æ ·ï¼Œå»ºè®®é€‰æ‹©ä¸€ä¸ªè¾ƒçŸ­çš„é‡‡æ ·æ—¶é—´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;adc-data-result-register-adcx-rn&#34;&gt;ADC Data Result Register (ADCx_Rn)&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;ADC0-&amp;gt;R[n]&lt;/code&gt; è®¿é—®ã€‚
è¿™ä¸ªå°±æ˜¯ ADC ç»“æœå¯„å­˜å™¨äº†ï¼Œè·Ÿé…ç½®å¯„å­˜å™¨å¯¹åº”ï¼Œä½¿ç”¨å“ªä¸€ä¸ªé…ç½®çš„ &lt;code&gt;SC[n]&lt;/code&gt;, ç»“æœå°±ä¿å­˜åœ¨ å¯¹åº”çš„ &lt;code&gt;R[n]&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h5 id=&#34;11-0-data-result-d&#34;&gt;(11-0) Data result (D)&lt;/h5&gt;
&lt;p&gt;ä¸€å…±æœ‰ 12 ä½ï¼Œåœ¨ä½¿ç”¨ 12-bit è½¬æ¢çš„æ—¶å€™å°±æ˜¯å…¨éƒ¨ä½¿ç”¨ï¼Œåœ¨ä½¿ç”¨ 10-bit æˆ–è€… 8-bit è½¬æ¢çš„æ—¶å€™åªä½¿ç”¨åˆ°äº†æœ€ä½çš„ 10,8 ä½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;compare-value-registers-adcx-cvn&#34;&gt;Compare Value Registers (ADCx_CVn)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªçš„å¯„å­˜å™¨é…ç½®å’Œ Rn ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯é‡Œé¢å­˜æ”¾çš„æ˜¯ä¸€ä¸ªéœ€è¦æ¯”è¾ƒçš„æ•°å€¼ã€‚ä½¿ç”¨è¿™ä¸ªå¯„å­˜å™¨éœ€è¦æ‰“å¼€ ADC çš„æ¯”è¾ƒåŠŸèƒ½ï¼Œä¹Ÿå³æ˜¯ &lt;code&gt;SC2[ACREN]=1&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;status-and-control-register-2-adcx-sc2&#34;&gt;Status and Control Register 2 (ADCx_SC2)&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;ADC0-&amp;gt;SC2&lt;/code&gt; è®¿é—®ã€‚
è¿™ä¸ªå¯„å­˜å™¨è™½ç„¶å« SC2ï¼Œä½†æ˜¯å’Œ SC1 å®Œå…¨ä¸ä¸€æ ·ï¼Œæ¯ä¸ª ADC åªæœ‰ 1 ä¸ªé…ç½®ã€‚å®ƒæ¶‰åŠçš„å†…å®¹æœ‰ï¼šè½¬æ¢çŠ¶æ€æ˜¾ç¤ºï¼Œè½¯/ç¡¬è½¬æ¢è§¦å‘é€‰æ‹©ï¼Œä»¥åŠæ¯”è¾ƒåŠŸèƒ½çš„å¼€å…³ï¼Œè¿˜æœ‰è¶…çº§æ¯”è¾ƒåŠŸèƒ½å¼€å…³ï¼ˆå¯ä»¥æ¯”è¾ƒèŒƒå›´ä¹‹å¤–çš„ç”µå‹ï¼‰ï¼Œæ¯”è¾ƒæ¨¡å¼çš„ç”µå‹èŒƒå›´ï¼ŒDMA åŠŸèƒ½å¼€å¯ï¼Œå‚è€ƒç”µå‹çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“å¯„å­˜å™¨å†…å®¹è¯·æŸ¥é˜… RMã€‚å¤ªå¤šäº†ä¸å¥½å†™ã€‚&lt;/p&gt;
&lt;h3 id=&#34;status-and-control-register-3-adcx-sc3&#34;&gt;Status and Control Register 3 (ADCx_SC3)&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;ADC0-&amp;gt;SC3&lt;/code&gt; è®¿é—®ã€‚
æœ¬å¯„å­˜å™¨ä¸»è¦æ¶‰åŠï¼Œæ ¡å‡†åºåˆ—çš„å¼€å¯ï¼Œè¿ç»­è½¬æ¢å¼€å…³çš„å¼€å¯ï¼Œç¡¬ä»¶å¹³å‡åŠŸèƒ½çš„å¼€å¯ï¼Œç¡¬ä»¶å¹³å‡é‡‡å–çš„è¢«å¹³å‡å–æ ·é‡é€‰æ‹©ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä»–çš„å¯„å­˜å™¨éƒ½å’Œæ ¡å‡†æœ‰å…³ç³»ï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰æ ¡å‡†ç°åœ¨ä¹Ÿç”¨ä¸å¤ªåˆ°ï¼Œæ‰€ä»¥å‡†å¤‡åˆ°æ—¶å€™ä½¿ç”¨åˆ°çš„æ—¶å€™åœ¨è¿›è¡Œç ”ç©¶ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è¿‡ç¨‹ï¼Œå¦‚æœä½¿ç”¨è½¯ä»¶å‡ºå‘çš„æ—¶å€™å°±åªèƒ½ä½¿ç”¨ &lt;code&gt;SC1A&lt;/code&gt; é…ç½®ï¼Œå› ä¸ºè½¯ä»¶è§¦å‘æºæ˜¯å‘ &lt;code&gt;SC1A&lt;/code&gt; å†™å…¥çš„æ—¶å€™è‡ªåŠ¨è§¦å‘ ADC è½¬æ¢ã€‚&lt;/p&gt;
&lt;p&gt;è¯»å– ADC ï¼Œå¦‚æœæ²¡æœ‰ä¸­æ–­çš„è¯å°±æ˜¯ç­‰å¾…å¯¹åº”çš„é…ç½® COCO ä½å˜æˆ 1 ä¹‹åå†è¯»å–å¯¹åº”çš„ &lt;code&gt;R[n]&lt;/code&gt; é‡Œé¢çš„æ•°å€¼ï¼Œå¦‚æœæœ‰ä¸­æ–­çš„è¯å°±å¯ä»¥ç›´æ¥åœ¨ä¸­æ–­æœåŠ¡ç¨‹åºä¸­å–ä¸‹å¯¹åº”çš„ &lt;code&gt;R[n]&lt;/code&gt; å€¼ã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 4</title>
      <link>https://xiahualiu.github.io/posts/2017-10-16-s32k144_4/</link>
      <pubDate>Mon, 16 Oct 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-10-16-s32k144_4/</guid>
      <description>&lt;p&gt;è¿™ä¸€èŠ‚çš„ä¸»è¦å†…å®¹æ˜¯åœ¨ï¼ˆä¸‰ï¼‰çš„åŸºç¡€ä¸Šå®ç° NVIC ä¸­æ–­æ§åˆ¶å’Œå¤„ç†&lt;/p&gt;
&lt;h1 id=&#34;heading&#34;&gt;æœ¬èŠ‚ç¨‹åºåŒ…å«çš„æ­¥éª¤ï¼š&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åˆå§‹åŒ– NVIC éœ€è¦å†™å…¥ä¸‰æ¬¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¸…æ¥šæ‰€æœ‰çš„æ‚¬ç½®ä¸­æ–­ï¼ˆä»¥é˜²æœ‰ï¼‰, å†™ 1 åˆ° ICPR(Interrupt Clear Pending Register)&lt;/li&gt;
&lt;li&gt;å¼€å¯éœ€è¦çš„ä¸­æ–­ä½, å†™ 1 åˆ°éœ€è¦çš„ ISER(Interrupt Set Enable Register) ä½&lt;/li&gt;
&lt;li&gt;è®¾ç½®ä¸­æ–­ä¼˜å…ˆçº§, åœ¨ IP(Interrupt Priority register) ä¸­å†™ 0 - 15 ä¼˜å…ˆçº§ï¼Œè¯¥èŠ¯ç‰‡çš„IP&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆå§‹åŒ– PORT D ä½¿ä¹‹æˆä¸º GPIO output çŠ¶æ€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆå§‹åŒ– SOSC ä¸º 8MHzï¼š
-åˆå§‹åŒ–éœ€è¦çš„ SOSC åˆ†é¢‘å™¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½®èŒƒå›´ï¼Œä½å¢ç›Šï¼Œå‚è€ƒæ™¶æŒ¯ä¸ºå†…éƒ¨è¾“å…¥&lt;/li&gt;
&lt;li&gt;ç¡®è®¤ SOSC çŠ¶æ€å¯„å­˜å™¨è§£é”&lt;/li&gt;
&lt;li&gt;åœ¨ SOSCCSR ä¸­ä½¿èƒ½&lt;/li&gt;
&lt;li&gt;ç­‰å¾… SOSCCSR_SOSCVLD æœ‰æ•ˆä½ç­‰äº 1&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆå§‹åŒ– SPLL åˆ° 160MHz ä½¿ç”¨ 8MHz çš„ SOSC&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®è®¤ SPLL å¤„äºå…³é—­çŠ¶æ€&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ– SPLL çš„åˆ†é¢‘å™¨&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ– SPLL Pef åˆ†é¢‘å™¨å’Œ SPLL å€ç‡&lt;/li&gt;
&lt;li&gt;ç¡®è®¤ SPLLCSR è§£é”&lt;/li&gt;
&lt;li&gt;ä½¿èƒ½ SPLL&lt;/li&gt;
&lt;li&gt;ç­‰å¾… SPLL æœ‰æ•ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆå§‹åŒ– LPIT0 é€šé“ 0:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ PCC ä¸­é€‰æ‹©æ—¶é’Ÿä¸º SPLL_DIV2_CLK&lt;/li&gt;
&lt;li&gt;åœ¨ PCC ä¸­å¼€å¯ LPIT0 Gate&lt;/li&gt;
&lt;li&gt;åœ¨ MCR ä¸­å¼€å¯ M_EN å¼€å¯ LPIT0 æ¨¡å—&lt;/li&gt;
&lt;li&gt;åœ¨ MIER å¯„å­˜å™¨ä¸­å¼€å¯ä¸­æ–­åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;åœ¨ TMR[n].TVAL å’Œ TMR[n].TCTRL (ä¹Ÿå¯ä»¥åœ¨ TVAL0 æˆ–è€… TCTRL0) ä¸­è®¾ç½®åˆå€¼å’Œå·¥ä½œæ¨¡å¼å¹¶å¼€å¯T_EN&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¼€å¯ RUN æ¨¡å¼ç»™ SPLL&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆå§‹åŒ– COREDIV, BUSDIV, SLOWDIV ç»™ç›®æ ‡é¢‘ç‡&lt;/li&gt;
&lt;li&gt;å°†ç³»ç»Ÿæ—¶é’Ÿæºè¾“å‡ºè‡³ SPLL&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;LPIT_0 é€šé“ 0 NVIC ä¸­æ–­å¤„ç†ç¨‹åºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¢åŠ ä¸­æ–­è®¡æ•°å™¨&lt;/li&gt;
&lt;li&gt;ç¿»è½¬ GPIO PTD0 è¾“å‡º&lt;/li&gt;
&lt;li&gt;æ¸…ç©ºé€šé“ä¸­æ–­æ ‡å¿—ä½ MSR ä¸­çš„ TIF0 ä½&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;heading-1&#34;&gt;ä»£ç :&lt;/h1&gt;
&lt;h3 id=&#34;heading-2&#34;&gt;ä¸»ä½“ï¼š&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34; /* include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;clocks_and_modes.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; idle_counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* main loop idle counter */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; lpit0_ch0_flag_counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* LPIT0 chan 0 timeout counter */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NVIC_init_IRQs&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
FSL_NVIC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;ICPR[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;48&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* IRQ48-LPIT0 ch0: clr any pending IRQ*/&lt;/span&gt;
FSL_NVIC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;ISER[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;48&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* IRQ48-LPIT0 ch0: enable IRQ */&lt;/span&gt;
FSL_NVIC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;IP[&lt;span style=&#34;color:#ae81ff&#34;&gt;48&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x0A&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* IRQ48-LPIT0 ch0: priority 10 of 0-15*/&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PORT_init&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; PCCn[PCC_PORTD_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clock for PORT D */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0: Data Direction= output */&lt;/span&gt;
PORTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0: MUX = ALT1, GPIO (to blue LED on EVB) */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LPIT0_init&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_LPIT0_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_PCS(&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/* Clock Src = 6 (SPLL2_DIV2_CLK)*/&lt;/span&gt;
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_LPIT0_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clk to LPIT0 regs */&lt;/span&gt;
LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;MCR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* DBG_EN-0: Timer chans stop in Debug mode */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* DOZE_EN=0: Timer chans are stopped in DOZE mode */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SW_RST=0: SW reset does not reset timer chans, regs */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* M_CEN=1: enable module clk (allow writing other LPIT0 regs) */&lt;/span&gt;
LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;MIER &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* TIE0=1: Timer Interrupt Enabled fot Chan 0 */&lt;/span&gt;
LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TVAL0 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;80000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Chan 0 Timeout period: 80M clocks */&lt;/span&gt;
LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TCTRL0 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* T_EN=1: Timer channel is enabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* CHAIN=0: channel chaining is disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MODE=0: 32 periodic counter mode */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TSOT=0: Timer decrements immediately based on restart */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TSOI=0: Timer does not stop after timeout */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TROT=0 Timer will not reload on trigger */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TRG_SRC=0: External trigger source */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* TRG_SEL=0: Timer chan 0 trigger source is selected*/&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WDOG_disable&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CNT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xD928C520&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Unlock watchdog*/&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TOVAL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x0000FFFF&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Maximum timeout value*/&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00002100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Disable watchdog*/&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
WDOG_disable();
PORT_init(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Configure ports */&lt;/span&gt;
SOSC_init_8MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize system oscillator for 8 MHz xtal */&lt;/span&gt;
SPLL_init_160MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize SPLL to 160 MHz with 8 MHz SOSC */&lt;/span&gt;
NormalRUNmode_80MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Init clocks: 80 MHz sysclk &amp;amp; core, 40 MHz bus, 20 MHz flash */&lt;/span&gt;
NVIC_init_IRQs(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable desired interrupts and priorities */&lt;/span&gt;
LPIT0_init(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize PIT0 for 1 second timeout */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (;;) {
idle_counter&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;;
}
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LPIT0_Ch0_IRQHandler&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
lpit0_ch0_flag_counter&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Increment LPIT0 timeout counter */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PTOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Toggle output on port D0 (blue LED) */&lt;/span&gt;
LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;MSR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LPIT_MSR_TIF0_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear LPIT0 timer flag 0 */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-3&#34;&gt;ä½¿ç”¨çš„å­å‡½æ•°æ–‡ä»¶ï¼š&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34; /* include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;clocks_and_modes.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SOSC_init_8MHz&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCDIV&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000101&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCDIV1 &amp;amp; SOSCDIV2 =1: divide by 1 */&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCFG&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000024&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Range=2: Medium freq (SOSC between 1MHz-8MHz)*/&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* HGO=0: Config xtal osc for low power */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* EREFS=1: Input is external XTAL */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SOSCCSR_LK_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Ensure SOSCCSR unlocked */&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCSR&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* LK=0: SOSCCSR can be written */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCCMRE=0: OSC CLK monitor IRQ if enabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCCM=0: OSC CLK monitor disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCERCLKEN=0: Sys OSC 3V ERCLK output clk disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCLPEN=0: Sys OSC disabled in VLP modes */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCSTEN=0: Sys OSC disabled in Stop modes */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCEN=1: Enable oscillator */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SOSCCSR_SOSCVLD_MASK)); &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for sys OSC clk valid */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SPLL_init_160MHz&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SPLLCSR_LK_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Ensure SPLLCSR unlocked */&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLEN=0: SPLL is disabled (default) */&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLDIV &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000302&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLDIV1 divide by 2; SPLLDIV2 divide by 4 */&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCFG &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00180000&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* PREDIV=0: Divide SOSC_CLK by 0+1=1 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* MULT=24: Multiply sys pll by 4+24=40 */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SPLL_CLK = 8MHz / 1 * 40 / 2 = 160 MHz */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SPLLCSR_LK_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Ensure SPLLCSR unlocked */&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* LK=0: SPLLCSR can be written */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLCMRE=0: SPLL CLK monitor IRQ if enabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLCM=0: SPLL CLK monitor disabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLSTEN=0: SPLL disabled in Stop modes */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLEN=1: Enable SPLL */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SPLLCSR_SPLLVLD_MASK)); &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for SPLL valid */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NormalRUNmode_80MHz&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) { &lt;span style=&#34;color:#75715e&#34;&gt;/* Change to normal RUN mode with 8MHz SOSC, 80 MHz PLL*/&lt;/span&gt;
SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;RCCR&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;SCG_RCCR_SCS(&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;/* PLL as clock source*/&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;SCG_RCCR_DIVCORE(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;b01) &lt;span style=&#34;color:#75715e&#34;&gt;/* DIVCORE=1, div. by 2: Core clock = 160/2 MHz = 80 MHz*/&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;SCG_RCCR_DIVBUS(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;b01) &lt;span style=&#34;color:#75715e&#34;&gt;/* DIVBUS=1, div. by 2: bus clock = 40 MHz*/&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;SCG_RCCR_DIVSLOW(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;b10); &lt;span style=&#34;color:#75715e&#34;&gt;/* DIVSLOW=2, div. by 3: SCG slow, flash clock= 26 2/3 MHz*/&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (((SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_CSR_SCS_MASK) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; SCG_CSR_SCS_SHIFT ) &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;) {}
&lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for sys clk src = SPLL */&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;heading-4&#34;&gt;ä»£ç è¯¦è§£ï¼š&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªç¨‹åºä»£ç å’Œä¸Šä¸€ä¸ªä¾‹ç¨‹ç»™å‡ºçš„ä»£ç éå¸¸ç±»ä¼¼ï¼Œåªå¢åŠ äº† LPIT0 æ¨¡å—ä¸­çš„ MIER å¯„å­˜å™¨ä¿®æ”¹å’Œ NVIC çš„ä¸€ä¸ªåˆå§‹åŒ–å’Œ IRQ Handler å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é‡Œæˆ‘æƒ³è¯¦ç»†ä»‹ç»ä¸€ä¸‹æœ¬æ¬¾èŠ¯ç‰‡å†…ç½®çš„ &lt;strong&gt;NVIC&lt;/strong&gt;(Nested Vectored Interrupt Controller) çš„å·¥ä½œåŸç†ï¼Œè¯¥æ¨¡å—è¢«å†…ç½®äºå†…æ ¸ä¹‹ä¸­ï¼Œåœ¨ S32K çš„å‚è€ƒæ‰‹å†Œä¸­ï¼Œè€Œä¸”åœ¨æœ€æ–°çš„å‚è€ƒæ‰‹å†Œä¸­ï¼Œè¿™éƒ¨åˆ†å†…å®¹è¢«åˆ å»äº†ï¼Œä¸çŸ¥é“æ˜¯ä¸ºä»€ä¹ˆï¼Œå¯¼è‡´æˆ‘æ ¹æœ¬æ— æ³•æ‰¾åˆ°ç›¸å…³èµ„æ–™ï¼Œæµªè´¹äº†æˆ‘å¥½å‡ ä¸ªå°æ—¶çš„æ—¶é—´ï¼Œæœ€åè¿˜æ˜¯åœ¨è€ç‰ˆæœ¬çš„å‚è€ƒæ‰‹å†Œä¸­æ‰¾åˆ°äº†ç›¸å…³çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;NVIC å…¨åæ˜¯&lt;strong&gt;ä¸­æ–­å‘é‡åµŒå¥—æ§åˆ¶å™¨&lt;/strong&gt;ï¼Œä»è¿™ä¸ªåå­—ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™æ˜¯ä¸ªæ§åˆ¶ä¸­æ–­çš„ä¼˜å…ˆçº§çš„æ¨¡å—ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯æ¥æ”¶å…¶ä»–ä¸­æ–­è¯·æ±‚ï¼Œåˆ¤æ–­å„ä¸ªä¸­æ–­çš„ä¼˜å…ˆçº§ï¼Œç„¶åå‘å†…æ ¸å‘èµ·ä¸­æ–­æœåŠ¡ã€‚åœ¨ ARM Cortex M4 è¿™ä¸ªèŠ¯ç‰‡ä¸­ï¼ŒNVIC ä¸€å…±æœ‰ 256 è·¯ï¼Œæ”¯æŒå¤–æ¥ 256 ä¸ªä¸­æ–­æºï¼Œä½†æ˜¯åœ¨ S32K ä¸­ï¼Œä»…ä»…ç”¨åˆ°äº† 123 ä¸ªä¸­æ–­é€šé“ï¼Œè€Œæ¯ä¸€ä¸ªä¸­æ–­å‘ç”Ÿç«¯å£ï¼Œéƒ½å¯¹åº”ç€ä¸€ä¸ª IRQ å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯å›ºå®šçš„ï¼Œå°±åƒæ˜¯ IP åœ°å€ä¸€æ ·ï¼Œç”¨äºåŒºåˆ†å„ä¸ªä¸­æ–­è¯·æ±‚çš„æ¥æºï¼Œè€Œæ¯ä¸€ä¸ª IRQ å€¼å‘¢ï¼Œåˆå¯¹åº”ä¸€ä¸ªä¸­æ–­çš„ä¼˜å…ˆçº§ï¼Œä½†æ˜¯ä¼˜å…ˆçº§å¯¹åº”çš„ IPR å¯„å­˜å™¨ï¼Œåªæœ‰é«˜å››ä½å¯¹åº”ä¼˜å…ˆçº§ï¼Œä¹Ÿå°±æ˜¯ä¼˜å…ˆçº§åªæœ‰ 16 ä¸ªç­‰çº§ï¼ˆ0 - 15ï¼‰ï¼Œä¼˜å…ˆçº§æ•°å€¼è¶Šä½ä¼˜å…ˆçº§è¶Šé«˜ï¼Œé«˜ä¼˜å…ˆçº§çš„ä¸­æ–­å¯ä»¥æ‰“æ–­ä½çš„ä¼˜å…ˆçº§ä¸­æ–­ï¼Œä»è€Œå®ç°ä¸­æ–­åµŒå¥—ï¼Œè€Œä¼˜å…ˆçº§ç›¸ç­‰çš„ä¸¤ä¸ªä¸­æ–­è¯·æ±‚ï¼Œåˆ™æ— æ³•æ‰“æ–­ä¸­æ–­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªåœ°æ–¹æœ‰ç‚¹æ„æ€å•Šï¼Œåœ¨ S32K ä¸­çš„ IPR åªæœ‰é«˜å››ä½å¯¹åº”ä¼˜å…ˆçº§ï¼Œé‚£ä½å››ä½æ˜¯å¹²å˜›çš„å‘¢ï¼Œè¿™é‡Œå°±è¦è°ˆä¸€è°ˆä¼˜å…ˆçº§ç»„åˆ«çš„é—®é¢˜äº†ã€‚ä»¥ä¸‹å†…å®¹ä»…ä¾›æƒ³è¦æ·±å…¥ç†è§£çš„äººæŸ¥çœ‹ï¼Œåœ¨ S32 IDE ä¸­ï¼Œä¿®æ”¹ IPR åªèƒ½ç»™å…¶èµ‹å€¼ 0 - 15ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…¶å®åœ¨ IPR å¯„å­˜å™¨ä¸­ï¼Œæ¯ä¸ªä¸­æ–­å¯¹åº” &lt;strong&gt;8&lt;/strong&gt; ä¸ªä½ï¼Œè¿™ 8 ä¸ªä½å¯ä»¥åˆ†å‰²æˆä¸º&lt;strong&gt;ä¸¤ä¸ª&lt;/strong&gt;ä½æ®µï¼ˆ[1;7]æˆ–è€…[2;6]æˆ–è€…[3;5]æˆ–è€…[4;4]ä¸€ç›´åˆ°[7;1]ï¼‰å…¶ä¸­ï¼Œé«˜çš„ä½æ®µï¼Œè¢«ç§°ä¹‹ä¸º&lt;strong&gt;ç»„ä¼˜å…ˆçº§&lt;/strong&gt;ï¼Œä½çš„ä½æ®µï¼Œè¢«ç§°ä¹‹ä¸º&lt;strong&gt;å­ä¼˜å…ˆçº§&lt;/strong&gt;ã€‚æœ€å¸¸è§çš„åšæ³•å°±æ˜¯å¦‚ S32K è¿™æ ·ï¼Œ4 ä½å¯¹åº”ç»„ä¼˜å…ˆçº§ï¼Œ4 ä½å¯¹åº”å­ä¼˜å…ˆçº§ï¼Œè¿™æ ·ä¼šè·å¾— &lt;strong&gt;16 ä¸ªç»„ä¸­æ–­ç­‰çº§å’Œ 16 ä¸ªå­ä¸­æ–­ç­‰çº§&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-02-S32K144_4/ipr.png&#34; alt=&#34;ipr.png&#34;&gt;&lt;/p&gt;
&lt;h5 id=&#34;heading-5&#34;&gt;ç»„ä¼˜å…ˆçº§å’Œå­ä¼˜å…ˆçº§çš„ä½œç”¨ï¼š&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;å³é«˜çš„ç»„ä¼˜å…ˆçº§ä¸­æ–­ï¼ˆæ•°å€¼ä½ï¼‰å¯ä»¥ä¸­æ–­ä½çš„ç»„ä¼˜å…ˆçº§ï¼ˆæ•°å€¼é«˜ï¼‰ä¸­æ–­çš„ï¼Œå®ç°ä¸­æ–­åµŒå¥—ã€‚&lt;/li&gt;
&lt;li&gt;ç»„ä¼˜å…ˆçº§ä¸€æ ·çš„ä¸­æ–­ï¼Œå­ä¼˜å…ˆçº§é«˜çš„ä¸èƒ½ä¸­æ–­ä½çš„ç»„ä¼˜å…ˆçº§ä¸­æ–­ï¼Œæ–°ä¸­æ–­ç­‰å¾…ã€‚&lt;/li&gt;
&lt;li&gt;ä¸¤ä¸ªä¸­æ–­åŒæ—¶å‘ç”Ÿï¼Œç»„ä¼˜å…ˆçº§é«˜çš„å¯ä»¥ä¼˜å…ˆè¿›è¡Œï¼›ç»„ä¼˜å…ˆçº§ç›¸åŒçš„ä¸­æ–­åŒæ—¶å‘ç”Ÿï¼Œæ ¹æ®å­ä¼˜å…ˆçº§çš„é«˜ä½æ’é˜Ÿè¿›è¡Œä¸­æ–­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;nvic-&#34;&gt;NVIC ä¸­æ–­å‘é‡è¡¨ï¼š&lt;/h5&gt;
&lt;p&gt;NVIC çš„æ¯ä¸ªä¸­æ–­éƒ½æœ‰ä¸€ä¸ªå‘é‡å€¼ï¼Œå’Œ IRQ ä¸€æ ·ï¼Œä¸€ä¸ªä¸­æ–­çš„ IRQ å€¼åŠ  16 å°±æ˜¯è¯¥ä¸­æ–­çš„å‘é‡å€¼ã€‚åœ¨ IDE ä¸­ï¼Œä¸­æ–­æœ‰å…³çš„ &lt;code&gt;ICPR&lt;/code&gt; &lt;code&gt;ISER&lt;/code&gt; å¯„å­˜å™¨éƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ 32 ä½çš„æ— ç¬¦å·æ•´å½¢ï¼Œæ•°ç»„æœ‰ 4 ä¸ªï¼Œä¸€å…±æ˜¯ 128 ä½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æ‰“å¼€ IRQ å€¼ä¸º 48 çš„ LPIT Channel 0 ä¸­æ–­é€šé“ï¼Œè¦ &lt;code&gt;FSL_NVIC-&amp;gt;ISER[1] |= 1&amp;lt;&amp;lt; (48 % 32);&lt;/code&gt; å¾ˆåäººç±»çš„è®¾å®šï¼Œè¦æ³¨æ„ã€‚&lt;/p&gt;
&lt;p&gt;å†…æ ¸ä¸­æ–­çš„ IRQï¼Œåœ¨è¡¨ä¸­å¹¶æ²¡æœ‰ç»™å‡ºï¼Œä½†æ˜¯åœ¨å®é™…è¿ç”¨ä¸­è¦ä½¿ç”¨å†…æ ¸ä¸­æ–­è¯¥æ€ä¹ˆåŠå‘¢ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ å‘é‡å€¼å‡å» 16 çš„æ³•åˆ™è¿›è¡Œè®¡ç®— IRQï¼Œæœ€åçš„å®é™… IRQ å€¼éƒ½æ˜¯è´Ÿçš„ï¼Œè­¬å¦‚ Systick ä¸­æ–­ï¼Œå¯¹åº”çš„ IRQ å€¼ä¸º -1ã€‚åœ¨é…ç½®çš„æ—¶å€™ï¼Œå¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ä¸ºè´Ÿã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œåœ¨ä¸­æ–­æœåŠ¡ç¨‹åºç»“æŸåï¼Œä¸€å®šè¦æ¸…ä¸­æ–­æ ‡å¿—ä½ï¼Œä¸­æ–­æ ‡å¿—ä½ä¸åœ¨ NVIC çš„å¯„å­˜å™¨ä¸­ï¼Œè€Œåœ¨å„ä¸ªä¸­æ–­å‘ç”Ÿæºçš„å¯„å­˜å™¨ä¸­ï¼Œå¤§å®¶è¦æ³¨æ„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;-s32k144--irq-&#34;&gt;é™„å½•: S32K144 çš„ IRQ è¡¨ï¼š&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; * @brief Defines the Interrupt Numbers definitions
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; *
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; * This enumeration is used to configure the interrupts.
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; *
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; * Implements : IRQn_Type_Class
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt;
{
  &lt;span style=&#34;color:#75715e&#34;&gt;/* Auxiliary constants */&lt;/span&gt;
  NotAvail_IRQn                &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Not available device specific interrupt */&lt;/span&gt;

  &lt;span style=&#34;color:#75715e&#34;&gt;/* Core interrupts */&lt;/span&gt;
  NonMaskableInt_IRQn          &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;14&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Non Maskable Interrupt */&lt;/span&gt;
  HardFault_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;13&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 SV Hard Fault Interrupt */&lt;/span&gt;
  MemoryManagement_IRQn        &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 Memory Management Interrupt */&lt;/span&gt;
  BusFault_IRQn                &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 Bus Fault Interrupt */&lt;/span&gt;
  UsageFault_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 Usage Fault Interrupt */&lt;/span&gt;
  SVCall_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 SV Call Interrupt */&lt;/span&gt;
  DebugMonitor_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 Debug Monitor Interrupt */&lt;/span&gt;
  PendSV_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 Pend SV Interrupt */&lt;/span&gt;
  SysTick_IRQn                 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Cortex-M4 System Tick Interrupt */&lt;/span&gt;

  &lt;span style=&#34;color:#75715e&#34;&gt;/* Device specific interrupts */&lt;/span&gt;
  DMA0_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 0 transfer complete */&lt;/span&gt;
  DMA1_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 1 transfer complete */&lt;/span&gt;
  DMA2_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 2 transfer complete */&lt;/span&gt;
  DMA3_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 3 transfer complete */&lt;/span&gt;
  DMA4_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 4 transfer complete */&lt;/span&gt;
  DMA5_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 5 transfer complete */&lt;/span&gt;
  DMA6_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 6 transfer complete */&lt;/span&gt;
  DMA7_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 7 transfer complete */&lt;/span&gt;
  DMA8_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 8 transfer complete */&lt;/span&gt;
  DMA9_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9u&lt;/span&gt;,               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 9 transfer complete */&lt;/span&gt;
  DMA10_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 10 transfer complete */&lt;/span&gt;
  DMA11_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;11u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 11 transfer complete */&lt;/span&gt;
  DMA12_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;12u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 12 transfer complete */&lt;/span&gt;
  DMA13_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;13u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 13 transfer complete */&lt;/span&gt;
  DMA14_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;14u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 14 transfer complete */&lt;/span&gt;
  DMA15_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;15u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA channel 15 transfer complete */&lt;/span&gt;
  DMA_Error_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; DMA error interrupt channels 0-15 */&lt;/span&gt;
  MCM_IRQn                     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;17u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FPU sources */&lt;/span&gt;
  FTFC_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTFC Command complete */&lt;/span&gt;
  Read_Collision_IRQn          &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;19u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTFC Read collision */&lt;/span&gt;
  LVD_LVW_IRQn                 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;20u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; PMC Low voltage detect interrupt */&lt;/span&gt;
  FTFC_Fault_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;21u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTFC Double bit fault detect */&lt;/span&gt;
  WDOG_EWM_IRQn                &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;22u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Single interrupt vector for WDOG and EWM */&lt;/span&gt;
  RCM_IRQn                     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;23u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; RCM Asynchronous Interrupt */&lt;/span&gt;
  LPI2C0_Master_IRQn           &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;24u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPI2C0 Master Interrupt */&lt;/span&gt;
  LPI2C0_Slave_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPI2C0 Slave Interrupt */&lt;/span&gt;
  LPSPI0_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;26u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPSPI0 Interrupt */&lt;/span&gt;
  LPSPI1_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;27u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPSPI1 Interrupt */&lt;/span&gt;
  LPSPI2_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;28u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPSPI2 Interrupt */&lt;/span&gt;
  LPUART0_RxTx_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;31u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPUART0 Transmit / Receive Interrupt */&lt;/span&gt;
  LPUART1_RxTx_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;33u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPUART1 Transmit / Receive  Interrupt */&lt;/span&gt;
  LPUART2_RxTx_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;35u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPUART2 Transmit / Receive  Interrupt */&lt;/span&gt;
  ADC0_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;39u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; ADC0 interrupt request. */&lt;/span&gt;
  ADC1_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;40u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; ADC1 interrupt request. */&lt;/span&gt;
  CMP0_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;41u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CMP0 interrupt request */&lt;/span&gt;
  ERM_single_fault_IRQn        &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;44u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; ERM single bit error correction */&lt;/span&gt;
  ERM_double_fault_IRQn        &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;45u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; ERM double bit error non-correctable */&lt;/span&gt;
  RTC_IRQn                     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;46u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; RTC alarm interrupt */&lt;/span&gt;
  RTC_Seconds_IRQn             &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;47u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; RTC seconds interrupt */&lt;/span&gt;
  LPIT0_Ch0_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;48u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPIT0 channel 0 overflow interrupt */&lt;/span&gt;
  LPIT0_Ch1_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;49u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPIT0 channel 1 overflow interrupt */&lt;/span&gt;
  LPIT0_Ch2_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;50u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPIT0 channel 2 overflow interrupt */&lt;/span&gt;
  LPIT0_Ch3_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;51u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPIT0 channel 3 overflow interrupt */&lt;/span&gt;
  PDB0_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;52u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; PDB0 interrupt */&lt;/span&gt;
  SCG_IRQn                     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;57u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; SCG bus interrupt request */&lt;/span&gt;
  LPTMR0_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;58u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; LPTIMER interrupt request */&lt;/span&gt;
  PORTA_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;59u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port A pin detect interrupt */&lt;/span&gt;
  PORTB_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;60u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port B pin detect interrupt */&lt;/span&gt;
  PORTC_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;61u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port C pin detect interrupt */&lt;/span&gt;
  PORTD_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;62u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port D pin detect interrupt */&lt;/span&gt;
  PORTE_IRQn                   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;63u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port E pin detect interrupt */&lt;/span&gt;
  SWI_IRQn                     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;64u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Software interrupt */&lt;/span&gt;
  PDB1_IRQn                    &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;68u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; PDB1 interrupt */&lt;/span&gt;
  FLEXIO_IRQn                  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;69u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FlexIO Interrupt */&lt;/span&gt;
  CAN0_ORed_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;78u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN0 OR&amp;#39;ed [Bus Off OR Transmit Warning OR Receive Warning] */&lt;/span&gt;
  CAN0_Error_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;79u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN0 Interrupt indicating that errors were detected on the CAN bus */&lt;/span&gt;
  CAN0_Wake_Up_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;80u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN0 Interrupt asserted when Pretended Networking operation is enabled, and a valid message matches the selected filter criteria during Low Power mode */&lt;/span&gt;
  CAN0_ORed_0_15_MB_IRQn       &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;81u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN0 OR&amp;#39;ed Message buffer (0-15) */&lt;/span&gt;
  CAN0_ORed_16_31_MB_IRQn      &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;82u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN0 OR&amp;#39;ed Message buffer (16-31) */&lt;/span&gt;
  CAN1_ORed_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;85u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN1 OR&amp;#39;ed [Bus Off OR Transmit Warning OR Receive Warning] */&lt;/span&gt;
  CAN1_Error_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;86u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN1 Interrupt indicating that errors were detected on the CAN bus */&lt;/span&gt;
  CAN1_ORed_0_15_MB_IRQn       &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;88u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN1 OR&amp;#39;ed Interrupt for Message buffer (0-15) */&lt;/span&gt;
  CAN2_ORed_IRQn               &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;92u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN2 OR&amp;#39;ed [Bus Off OR Transmit Warning OR Receive Warning] */&lt;/span&gt;
  CAN2_Error_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;93u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN2 Interrupt indicating that errors were detected on the CAN bus */&lt;/span&gt;
  CAN2_ORed_0_15_MB_IRQn       &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;95u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; CAN2 OR&amp;#39;ed Message buffer (0-15) */&lt;/span&gt;
  FTM0_Ch0_Ch1_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;99u&lt;/span&gt;,              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM0 Channel 0 and 1 interrupt */&lt;/span&gt;
  FTM0_Ch2_Ch3_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM0 Channel 2 and 3 interrupt */&lt;/span&gt;
  FTM0_Ch4_Ch5_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;101u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM0 Channel 4 and 5 interrupt */&lt;/span&gt;
  FTM0_Ch6_Ch7_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;102u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM0 Channel 6 and 7 interrupt */&lt;/span&gt;
  FTM0_Fault_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;103u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM0 Fault interrupt */&lt;/span&gt;
  FTM0_Ovf_Reload_IRQn         &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;104u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM0 Counter overflow and Reload interrupt */&lt;/span&gt;
  FTM1_Ch0_Ch1_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;105u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM1 Channel 0 and 1 interrupt */&lt;/span&gt;
  FTM1_Ch2_Ch3_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;106u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM1 Channel 2 and 3 interrupt */&lt;/span&gt;
  FTM1_Ch4_Ch5_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;107u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM1 Channel 4 and 5 interrupt */&lt;/span&gt;
  FTM1_Ch6_Ch7_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;108u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM1 Channel 6 and 7 interrupt */&lt;/span&gt;
  FTM1_Fault_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;109u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM1 Fault interrupt */&lt;/span&gt;
  FTM1_Ovf_Reload_IRQn         &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;110u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM1 Counter overflow and Reload interrupt */&lt;/span&gt;
  FTM2_Ch0_Ch1_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;111u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM2 Channel 0 and 1 interrupt */&lt;/span&gt;
  FTM2_Ch2_Ch3_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;112u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM2 Channel 2 and 3 interrupt */&lt;/span&gt;
  FTM2_Ch4_Ch5_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;113u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM2 Channel 4 and 5 interrupt */&lt;/span&gt;
  FTM2_Ch6_Ch7_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;114u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM2 Channel 6 and 7 interrupt */&lt;/span&gt;
  FTM2_Fault_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;115u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM2 Fault interrupt */&lt;/span&gt;
  FTM2_Ovf_Reload_IRQn         &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;116u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM2 Counter overflow and Reload interrupt */&lt;/span&gt;
  FTM3_Ch0_Ch1_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;117u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM3 Channel 0 and 1 interrupt */&lt;/span&gt;
  FTM3_Ch2_Ch3_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;118u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM3 Channel 2 and 3 interrupt */&lt;/span&gt;
  FTM3_Ch4_Ch5_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;119u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM3 Channel 4 and 5 interrupt */&lt;/span&gt;
  FTM3_Ch6_Ch7_IRQn            &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;120u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM3 Channel 6 and 7 interrupt */&lt;/span&gt;
  FTM3_Fault_IRQn              &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;121u&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM3 Fault interrupt */&lt;/span&gt;
  FTM3_Ovf_Reload_IRQn         &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;122u&lt;/span&gt;              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; FTM3 Counter overflow and Reload interrupt */&lt;/span&gt;
} IRQn_Type;

&lt;span style=&#34;color:#75715e&#34;&gt;/*!
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; * @}
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt; */&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;/* end of group Interrupt_vector_numbers_S32K144 */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹‹å‰æ‰¾å†…æ ¸é‚£å‡ ä¸ªä¸­æ–­çš„ IRQn æ‰¾çš„å¥½ä¹…ï¼Œæœ€ååœ¨å¤´æ–‡ä»¶é‡Œé¢å‘ç°äº†è¿™ä¸ªè¡¨ï¼Œåœ¨è¿™é‡Œå°±å…ˆè®°å½•ä¸‹æ¥æ–¹ä¾¿ä»¥åçš„æŸ¥é˜…ã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 3 Clock Configuration Continue</title>
      <link>https://xiahualiu.github.io/posts/2017-10-02-s32k144_3/</link>
      <pubDate>Mon, 02 Oct 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-10-02-s32k144_3/</guid>
      <description>&lt;p&gt;è®©æˆ‘ä»¬ç»§ç»­ä¸Šä¸€èŠ‚çš„å†…å®¹&lt;/p&gt;
&lt;h3 id=&#34;fast-irc-control-status-register-scg-firccsr&#34;&gt;Fast IRC Control Status Register (SCG_FIRCCSR)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨å±•ç¤ºå¹¶ä¸”æ§åˆ¶ FIRC çš„å·¥ä½œçŠ¶æ€&lt;/p&gt;
&lt;h3 id=&#34;fast-irc-divide-register-scg-fircdiv&#34;&gt;Fast IRC Divide Register (SCG_FIRCDIV)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨æ§åˆ¶ FIRC çš„åˆ†é¢‘å™¨çš„å€¼&lt;/p&gt;
&lt;h3 id=&#34;fast-irc-configuration-register-scg-firccfg&#34;&gt;Fast IRC Configuration Register (SCG_FIRCCFG)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨æ§åˆ¶ FIRC çš„åŸºç¡€è®¾ç½®ï¼Œä¸èƒ½åœ¨ FIRC å¼€å¯çš„æ—¶å€™ä¿®æ”¹&lt;/p&gt;
&lt;h3 id=&#34;system-pll-control-status-register-scg-spllcsr&#34;&gt;System PLL Control Status Register (SCG_SPLLCSR)&lt;/h3&gt;
&lt;h3 id=&#34;system-pll-divide-register-scg-splldiv&#34;&gt;System PLL Divide Register (SCG_SPLLDIV)&lt;/h3&gt;
&lt;h3 id=&#34;system-pll-configuration-register-scg-spllcfg&#34;&gt;System PLL Configuration Register (SCG_SPLLCFG)&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸Šçš„å‡ ä¸ªå¯„å­˜å™¨åŸºæœ¬è®¾ç½®éƒ½ç±»ä¼¼ï¼Œä½†æ˜¯å…·ä½“åˆ°å†™ç¨‹åºçš„æ—¶å€™ï¼Œä¸€å®šè¦å¯¹ç…§å¯„å­˜å™¨çš„è¡¨æ¥å†™ï¼Œå› ä¸ºä»–ä»¬ä¹‹é—´éƒ½æœ‰ä¸€äº›ä¸åŒ&lt;/p&gt;
&lt;h2 id=&#34;-scg-&#34;&gt;ä¸åŒå·¥ä½œæ¨¡å¼ä¸­ SCG çš„å·¥ä½œæµç¨‹&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å¯åŠ¨çš„æ—¶å€™ï¼Œâ€™Resetâ€™ ä¼šç›´æ¥ä¼ é€’ç»™ Run æ¨¡å¼ä¸‹çš„ FIRCï¼ŒRun æ¨¡å¼ä¸‹ FIRCï¼ŒSOSCï¼ŒSPLLï¼ŒSIRC å…±åŒå·¥ä½œï¼Œå¯ä»¥äº’ç›¸ä¼ é€’æ—¶é’Ÿ&lt;/li&gt;
&lt;li&gt;å¯åŠ¨å®Œæˆåï¼Œå¦‚æœå•ç‰‡æœºè¿›å…¥ &lt;strong&gt;High Speed Mode&lt;/strong&gt; åˆ™ä¼šç›´æ¥å°† FIRC æ—¶é’Ÿå’Œ SPLL ç›¸äº’ä¼ é€’&lt;/li&gt;
&lt;li&gt;å¯åŠ¨å®Œæˆåï¼Œå¦‚æœå•ç‰‡æœºè¿›å…¥ &lt;strong&gt;Very Slow Power Mode&lt;/strong&gt; åˆ™åªå¯ç”¨ SIRC æ—¶é’Ÿã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;heading&#34;&gt;æŸ¥çœ‹ä»£ç å¯¹åº”çš„æ—¶é’Ÿå¯„å­˜å™¨&lt;/h1&gt;
&lt;h4 id=&#34;void-sosc-init-8mhzvoid-&#34;&gt;&lt;code&gt;void SOSC_init_8MHz(void)&lt;/code&gt; :&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;SCG-&amp;gt;SOSCDIV=0x00000101;&lt;/code&gt; è®¾ç½®å¯¹åº”çš„ä¸¤è·¯ DIV&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SCG-&amp;gt;SOSCCFG=0x00000024;&lt;/code&gt; è®¾ç½®SOSCçš„ç¡¬ä»¶å±æ€§ï¼Œæ™¶æŒ¯é¢‘ç‡é€‰æ‹©ï¼Œå¯ä»¥çœ‹å‡ºæ¥ 1MHz ~ 8Mhz æ˜¯ä¸­é¢‘çš„èŒƒå›´ï¼Œè¿™ä¸ªå€¼åœ¨ Reference Manual ä¸­å¹¶æœªç»™å‡ºã€‚HGO ä¸­é«˜å¢ç›Šæ„å‘³ç€é«˜åŠŸç‡ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦é«˜å¢ç›Šã€‚&lt;/li&gt;
&lt;li&gt;å¾ªç¯ï¼Œç­‰ &lt;code&gt;SOSCCSR&lt;/code&gt; çŠ¶æ€å¯„å­˜å™¨è§£é”&lt;/li&gt;
&lt;li&gt;è®¾ç½® &lt;code&gt;SOSCCSR&lt;/code&gt;  çŠ¶æ€å¯„å­˜å™¨ï¼Œè¿™é‡Œä»€ä¹ˆéƒ½æ²¡æœ‰å¼€å¯ï¼Œåªç»™äº†ä½¿èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;å¾ªç¯ï¼Œç­‰å¾… &lt;code&gt;SOSCCSR&lt;/code&gt; æœ‰æ•ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨æ„ï¼Œè¿™ä¸ªå‡½æ•°åº”è¯¥åœ¨å¯ç”¨ &lt;strong&gt;é”ç›¸ç¯&lt;/strong&gt; å‰è®¾å®šå®Œæˆï¼Œè€Œä¸”è¦ä¿è¯ä½¿èƒ½æ­¥éª¤åœ¨å‡½æ•°å†…éƒ¨çš„æœ€åä¸€æ­¥å®Œæˆã€‚&lt;/p&gt;
&lt;h4 id=&#34;void-spll-init-160mhzvoid-&#34;&gt;&lt;code&gt;void SPLL_init_160MHz(void)&lt;/code&gt; :&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;å¾ªç¯ï¼Œç­‰ &lt;code&gt;SPLLCSR&lt;/code&gt; çŠ¶æ€å¯„å­˜å™¨è§£é”&lt;/li&gt;
&lt;li&gt;è®¾ç½® &lt;code&gt;SPLLCSR&lt;/code&gt; å…ˆå…³é—­é”ç›¸ç¯ï¼Œ&lt;code&gt;SPLLDIV&lt;/code&gt; è®¾ç½®ä¸¤è·¯ DIVï¼Œ&lt;code&gt;SPLLCFG&lt;/code&gt; è®¾ç½® MULT å’Œ PREDIV ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-10-02-S32K144_3/SPLLCalculation.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¾ªç¯ï¼Œç­‰å¾… &lt;code&gt;SPLLCSR&lt;/code&gt; çŠ¶æ€å¯„å­˜å™¨ è§£é”&lt;/li&gt;
&lt;li&gt;ä½¿èƒ½&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;void-normalrunmode-80mhz-void-&#34;&gt;&lt;code&gt;void NormalRUNmode_80MHz (void)&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªå…¶å®å°±æ˜¯è®¾ç½® SCG_RCCR çš„å€¼ï¼Œè¿™ä¸ªå€¼åœ¨ RUN æ¨¡å¼ä¸‹æ˜¯ç”¨äºè®¾å®šä¸€äº›åˆ†é¢‘å™¨ï¼ˆ&lt;code&gt;DIVSLOW&lt;/code&gt; &lt;code&gt;DIVBUS&lt;/code&gt; &lt;code&gt;DIVCORE&lt;/code&gt;ï¼‰ å’Œé€‰æ‹©æ—¶é’Ÿæºï¼ˆ&lt;code&gt;SCS&lt;/code&gt;ï¼‰çš„ã€‚&lt;/p&gt;
&lt;h1 id=&#34;lpit&#34;&gt;ä½åŠŸç‡ä¸­æ–­è®¡æ—¶å™¨ï¼ˆLPITï¼‰è®¾ç½®&lt;/h1&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;S32K144ä¸­æœ‰ä¸€ä¸ª LPIT æ¨¡å— &lt;code&gt;LPIT0&lt;/code&gt; å’Œå››ä¸ªé€šé“ï¼Œä½æ³„éœ²æ¨¡å¼å’Œç­‰å¾…æ¨¡å¼ä¸è¢«è¯¥èŠ¯ç‰‡æ”¯æŒï¼Œä¿®æ”¹ LPIT åœ¨å…¶åŠŸèƒ½æ—¶é’Ÿåœ¨å…³é—­çš„æ—¶å€™ä¼šå¯¼è‡´èµ‹å€¼é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;LPIT æ¯ä¸ªé€šé“ä¼šç»™ DMAMUX å‘¨æœŸæ€§è§¦å‘&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;LPIT è¢«è®¾è®¡ä¸ºæ•æ‰è„‰å†²åœ¨å…¶è¾“å…¥å¼•è„šï¼Œå¹¶ä¸éœ€è¦å’Œå…¶æ—¶é’Ÿé¢‘ç‡æœ‰å…³ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯å¯é æ€§ï¼Œè¿ç»­çš„è§¦å‘æ“ä½œåº”è¯¥è‡³å°‘é—´éš” 10 ä¸ª LPIT æ€»çº¿æ—¶é’Ÿå‘¨æœŸã€‚&lt;/p&gt;
&lt;h3 id=&#34;tval-&#34;&gt;TVAL æ˜¯åˆå€¼å¯„å­˜å™¨ï¼š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœ¨ LPIT æ¯”è¾ƒæ¨¡å¼ä¸­&lt;/strong&gt;ï¼šå…¶ä¸­å‚¨å­˜çš„å€¼ä¼šé€æ¸å‡å°‘åˆ° 0ï¼Œä¹‹åä¼šäº§ç”Ÿä¸­æ–­å¹¶ä¸”å°†åˆå€¼æ¢å¤ï¼Œå†™å…¥ä¸€ä¸ªæ–°çš„å€¼ä¸ä¼šç«‹åˆ»ä¿®æ”¹åˆå€¼ï¼Œå¿…é¡»è¦åˆ°å½“å‰çš„å€¼åˆ°é›¶é‡è£…æ‰èƒ½ç”Ÿæ•ˆï¼Œå¦‚æœæƒ³è¦ç«‹å³ç”Ÿæ•ˆè¯·åœ¨ TCRTL å¯„å­˜å™¨ä¸­å…³é—­è¯¥æ¨¡å—å†é‡æ–°æ‰“å¼€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœ¨ LPIT æ•æ‰æ¨¡å¼ä¸­&lt;/strong&gt;ï¼šå…¶ä¸­å‚¨å­˜çš„å€¼æ˜¯è®¡æ•°å€¼çš„ç›¸åå€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;tctrl-&#34;&gt;TCTRL æ˜¯æ§åˆ¶å¯„å­˜å™¨ï¼š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å·¥ä½œæ¨¡å¼æœ‰ï¼š
&lt;ul&gt;
&lt;li&gt;32-bit å‘¨æœŸè®¡æ•°&lt;/li&gt;
&lt;li&gt;åŒ 16-bit å‘¨æœŸè®¡æ•°&lt;/li&gt;
&lt;li&gt;32-bit è§¦å‘ç§¯ç´¯&lt;/li&gt;
&lt;li&gt;32-bit è¾“å…¥æ•æ‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;TSOTï¼ˆTimer Start On Triggerï¼‰ï¼ŒTROTï¼ˆTimer Reset On Triggerï¼‰ å’Œ TSOIï¼ˆTimer Stop On Interruptï¼‰ ï¼ŒCHAIN è®¾ç½®è¯·å‚è€ƒ Reference Manualï¼Œä¸éš¾ï¼Œæ ¹æ®åå­—å°±å¯ä»¥ç†è§£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;lpit-&#34;&gt;LPIT ä½¿ç”¨çš„æ­¥éª¤ï¼š&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;PCC é€‰æ‹© LPIT çš„æ—¶é’Ÿæºï¼Œç„¶åä½¿ç”¨ &lt;code&gt;PCC_PCCn_CGC_MASK&lt;/code&gt; å–æˆ–æ‰“å¼€ LPIT ã€‚&lt;/li&gt;
&lt;li&gt;é¦–å…ˆä½¿ç”¨ LPIT0 æŒ‡é’ˆèµ‹å€¼ MCR å¯„å­˜å™¨ï¼Œé»˜è®¤èµ‹å€¼ &lt;code&gt;0x00000001&lt;/code&gt; å³å¯ï¼Œä»…ä»…æ‰“å¼€ &lt;code&gt;M_CEN&lt;/code&gt; å¼€å…³ï¼Œæ­¤å¼€å…³æœªæ‰“å¼€å‰åç»­çš„å¯„å­˜å™¨å¤„äºé”å®šçŠ¶æ€ï¼Œèµ‹å€¼ä»¥åŠè¯»å–å‡ä¼šæŠ¥é”™ã€‚&lt;/li&gt;
&lt;li&gt;LPIT0 æŒ‡é’ˆèµ‹å€¼ &lt;code&gt;TMR[n].TVAL&lt;/code&gt; å’Œ &lt;code&gt;TMR[n].TCTRL&lt;/code&gt;, TVAL æ§åˆ¶ timeout å‘¨æœŸï¼ŒTCTRL æ§åˆ¶å¼€å¯å¯¹åº”çš„é€šé“ã€‚å¹¶ä¸”ç¡®å®šå·¥ä½œæ¨¡å¼ã€‚&lt;/li&gt;
&lt;li&gt;æ£€æµ‹ MSR å¯„å­˜å™¨ä¸­çš„ TIFn æ˜¯å¦äº§ç”Ÿ flagï¼ˆ1ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 2 Clock Configurations</title>
      <link>https://xiahualiu.github.io/posts/2017-09-29-s32k144_2/</link>
      <pubDate>Fri, 29 Sep 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-09-29-s32k144_2/</guid>
      <description>&lt;h1 id=&#34;heading&#34;&gt;æœ¬æ–‡ç®€ä»‹&lt;/h1&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦è¯¦ç»†å™è¿°äº† S32K144 çš„æ—¶é’Ÿæ¨¡å—ç›¸å…³å†…å®¹ã€‚æœ¬æ–‡ä»£ç åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€èˆ¬çš„æ—¶é’Ÿåˆå§‹åŒ–æµç¨‹&lt;/li&gt;
&lt;li&gt;LPIT é€šé“è®¡æ•°å™¨è®¾ç½®&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;heading-1&#34;&gt;æ—¶é’Ÿç»“æ„å›¾&lt;/h1&gt;
&lt;p&gt;åœ¨çœ‹ä»£ç ä¹‹å‰ï¼Œé¦–å…ˆè¦ç†Ÿæ‚‰æ—¶é’Ÿç³»ç»Ÿï¼Œä¸‹å›¾ä¸ºæœ¬ç¨‹åºæ‰€ç”¨åˆ°çš„æ—¶é’Ÿå’Œæ¨¡å—ç¤ºæ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-9-29-S32K144_2/hello_clock.png&#34; alt=&#34;hello_clock.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°å¤–éƒ¨æ™¶æŒ¯è¾“å…¥ &lt;strong&gt;XTAL(External Crystal Oscillator)&lt;/strong&gt; å’Œéœ‡è¡å™¨ &lt;strong&gt;OSC(System Oscillator)&lt;/strong&gt; ç›¸è¿ï¼Œäº§ç”Ÿäº†ä¸€ä¸ªæ—¶é’Ÿä¿¡å·ä¸º &lt;strong&gt;SOSC_CLK&lt;/strong&gt; è¯¥ä¿¡å·è¢« &lt;strong&gt;SCG_SOSCDIV&lt;/strong&gt; åˆ†é¢‘æˆä¸ºä¸¤ä¸ª &lt;strong&gt;SOSC_DIV1_CLK&lt;/strong&gt; å’Œ &lt;strong&gt;SOSC_DIV2_CLK&lt;/strong&gt; æ—¶é’Ÿä¿¡å·ã€‚&lt;strong&gt;SOSC_CLK&lt;/strong&gt; åˆè¢«é”ç›¸ç¯ &lt;strong&gt;PLL&lt;/strong&gt; å‡é¢‘åˆ° &lt;strong&gt;SPLL_CLK&lt;/strong&gt; ä¿¡å·ï¼Œ&lt;strong&gt;SPLL_CLK&lt;/strong&gt; è¢« &lt;strong&gt;SCG_SPLLDIV&lt;/strong&gt; åˆ†é¢‘å¾—åˆ° &lt;strong&gt;SPLL_DIV1_CLK&lt;/strong&gt; æˆ–è€…å¾—åˆ° &lt;strong&gt;SPLL_DIV2_CLK&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;FIRC(Fast Internal Reference Clock)&lt;/strong&gt; äº§ç”Ÿä¸€ä¸ª 48HMz çš„æ—¶é’Ÿ &lt;strong&gt;FIRC_CLK&lt;/strong&gt;, &lt;strong&gt;SIRC(Slow Internal Reference Clock)&lt;/strong&gt; äº§ç”Ÿä¸€ä¸ª 8MHz çš„ä¿¡å· &lt;strong&gt;SIRC_SLK&lt;/strong&gt;, &lt;strong&gt;FIRC_CLK&lt;/strong&gt; å’Œ &lt;strong&gt;SIRC_SLK&lt;/strong&gt; å’Œ &lt;strong&gt;SPLL_CLK&lt;/strong&gt; å’Œ &lt;strong&gt;SOSC_CLK&lt;/strong&gt; è¢« &lt;strong&gt;SCG_RCCR[SCS]&lt;/strong&gt; é€‰æ‹©å™¨é€‰æ‹©ä¿¡å·ï¼Œä½¿ç”¨ &lt;strong&gt;DIVCORE&lt;/strong&gt; åˆ†é¢‘å¾—åˆ° &lt;strong&gt;CORE_CLK&lt;/strong&gt;,&lt;strong&gt;SYSCLK&lt;/strong&gt; ï¼›ä½¿ç”¨ &lt;strong&gt;DIVBUS&lt;/strong&gt; åˆ†é¢‘å¾—åˆ° &lt;strong&gt;BUS_CLK&lt;/strong&gt; ï¼Œä½¿ç”¨ &lt;strong&gt;DIVSLOW&lt;/strong&gt; åˆ†é¢‘å¾—åˆ° &lt;strong&gt;FLASH_CLK&lt;/strong&gt; å’Œ &lt;strong&gt;SCG_SLOW_CLK&lt;/strong&gt; åœ¨è¿™ä¸ªåœ°æ–¹ï¼Œåˆ†é¢‘å™¨çš„å€ç‡é€‰æ‹©æ˜¯æœ‰è¦æ±‚çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-9-29-S32K144_2/DIV_Requirement.png&#34; alt=&#34;DIV_Requirement.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸»è¦æ˜¯ç”±äºç»“æ„é™åˆ¶å¯¼è‡´çš„ã€‚æ³¨æ„åœ¨è®¾ç½®åˆ†é¢‘å™¨çš„æ—¶å€™ï¼Œè¯·åœ¨æ—¶é’Ÿæºå¼€å¯å‰è¿›è¡Œï¼Œå¦åˆ™æ— æ³•æ”¹å˜ï¼Œåˆ†é¢‘å™¨åœ¨æ—¶é’Ÿå¼€å¯åæ‰ä¼šè¢«æ”¹å˜å…¶å€¼ã€‚&lt;/p&gt;
&lt;p&gt;Manualä¸Šå…³äºè¯¥èŠ¯ç‰‡çš„æ—¶é’Ÿæ¨¡å—æè¿°ï¼š&lt;/p&gt;
&lt;h3 id=&#34;1--system-clock-generator-scg&#34;&gt;1. ç³»ç»Ÿæ—¶é’Ÿå‘ç”Ÿå™¨ System clock generator (SCG)&lt;/h3&gt;
&lt;p&gt;ç³»ç»Ÿæ—¶é’Ÿå‘ç”Ÿå™¨ï¼ˆä¸‹ç§° SCG ï¼‰ç»™å•ç‰‡æœºæä¾›äº†ä¸åŒçš„æ—¶é’Ÿæºï¼ŒåŒ…å«ä¸‰ä¸ªæ—¶é’Ÿåˆ†æ”¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SPLL(System Phase-locked Loop)&lt;/strong&gt; ç³»ç»Ÿé”ç›¸ç¯ï¼Œä¸€ä¸ªå‹æ§éœ‡è¡å™¨ã€‚åœ¨å…¶ä»–åœ°æ–¹ä¹Ÿè¢«ç§°ä½œ &lt;strong&gt;PLL&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç”µå‹æ§åˆ¶æŒ¯è¡å™¨ VCO(Voltage-controlled oscillator)&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨å‚è€ƒæ—¶é’Ÿæ˜¯é”ç›¸ç¯çš„æ—¶é’Ÿæº&lt;/li&gt;
&lt;li&gt;æ¨¡æ•° VCO åˆ†é¢‘å™¨&lt;/li&gt;
&lt;li&gt;ç›¸ä½/é¢‘ç‡æ¢æµ‹å™¨&lt;/li&gt;
&lt;li&gt;å¯ä»¥è¢«é€‰åšå•ç‰‡æœºçš„ç³»ç»Ÿæ—¶é’Ÿæº&lt;/li&gt;
&lt;li&gt;åŒè·¯å¯ç¼–ç¨‹æ§åˆ¶çš„æ—¶é’Ÿè¾“å‡ºï¼Œå¯ä»¥æä¾›ç»™ç‰‡å†…å¤–å›´å™¨ä»¶æ—¶é’Ÿæº&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FIRC/SIRC(Fast/Slow Internal Reference Clock)&lt;/strong&gt; ä¸¤ä¸ªå†…éƒ¨å‚è€ƒæ—¶é’Ÿ IRC å‘ç”Ÿå™¨ï¼š
&lt;ul&gt;
&lt;li&gt;å¿«é€Ÿå†…éƒ¨å‚è€ƒæ—¶é’Ÿ FIRC å¯ä»¥ç¨‹åºæ§åˆ¶é«˜/ä½é¢‘ç‡èŒƒå›´, é«˜ä¸º 48Mhzã€‚&lt;/li&gt;
&lt;li&gt;å¿«é€Ÿå†…éƒ¨å‚è€ƒæ—¶é’Ÿ FIRC å’Œæ…¢é€Ÿå†…éƒ¨å‚è€ƒæ—¶é’Ÿ SIRC éƒ½å¯ä»¥è¢«é€‰åšå•ç‰‡æœºçš„ç³»ç»Ÿæ—¶é’Ÿæº&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SOSC(System Crystal Oscillator)&lt;/strong&gt; ç³»ç»Ÿæ™¶æŒ¯æŒ¯è¡å™¨ï¼Œåœ¨å…¶ä»–åœ°æ–¹ä¹Ÿè¢«ç§°ä½œ &lt;strong&gt;OSC&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è¢«å½“åšç³»ç»Ÿ PLL çš„æ—¶é’Ÿæº&lt;/li&gt;
&lt;li&gt;å¯ä»¥è¢«å½“åšå•ç‰‡æœºçš„æ—¶é’Ÿæº&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;heading-2&#34;&gt;æ³¨æ„ï¼š&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;SPLLï¼ŒSOSC æ—¶é’Ÿå¯ä»¥è¢«æ—¶é’Ÿç›‘æµ‹å™¨æ£€æµ‹ï¼Œæä¾›é‡å¯å’Œä¸­æ–­è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;SPLL å¯ä»¥è¢«é”å®šç›‘æµ‹å™¨æ£€æµ‹ï¼Œæä¾›ä¸­æ–­è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸€ä¸ªæ—¶é’Ÿæºéƒ½æœ‰ä¸€ä¸ªå‚è€ƒåˆ†é¢‘å™¨ï¼Œç»™ç‰‡å†…æ¨¡å—å’Œå¤–å›´å™¨ä»¶æä¾›åˆ†é¢‘åŠŸèƒ½ï¼Œæ•…æ—¶é’Ÿåä¸­éƒ½æœ‰ DIV ï¼Œè­¬å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;SPLLDIV1_CLK / SPLLDIV2_CLK&lt;/li&gt;
&lt;li&gt;FIRCDIV1_CLK / SCG_FIRCDIV2_CLK&lt;/li&gt;
&lt;li&gt;SIRCDIV1_CLK / SIRCDIV2_CLK&lt;/li&gt;
&lt;li&gt;SOSCDIV1_CLK / SOSCDIV2_CLK&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;2--low-power-oscillator-lpo&#34;&gt;2. ä½åŠŸç‡æŒ¯è¡å™¨ Low Power Oscillator (LPO)&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªå†…éƒ¨çš„ä½åŠŸç‡æ—¶é’Ÿï¼Œå¯ä»¥ç»™å·¥ä½œåœ¨ä½åŠŸç‡æ¨¡å¼ä¸‹çš„å™¨ä»¶æä¾›æ—¶é’Ÿæºã€‚&lt;/p&gt;
&lt;h3 id=&#34;3--peripheral-clock-control-pcc&#34;&gt;3. å¤–å›´æ—¶é’Ÿæ§åˆ¶å™¨ Peripheral Clock Control (PCC)&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸Šä¸€èŠ‚è¯¦ç»†ä»‹ç»è¿‡è¿™ä¸ªæ§åˆ¶å™¨ï¼Œç”¨äºæ§åˆ¶å¤§å¤šæ•°å™¨ä»¶çš„æ—¶é’Ÿé€‰æ‹©ã€‚&lt;/p&gt;
&lt;h1 id=&#34;heading-3&#34;&gt;ä»£ç &lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; hello_clocks.c              Copyright NXP &lt;span style=&#34;color:#ae81ff&#34;&gt;2016&lt;/span&gt;
 &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; Description: Example clock and LPIT channel initializations
 &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2016&lt;/span&gt; Mar &lt;span style=&#34;color:#ae81ff&#34;&gt;04&lt;/span&gt; S Mihalik &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; Initial version
 &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2016&lt;/span&gt; Oct &lt;span style=&#34;color:#ae81ff&#34;&gt;27&lt;/span&gt; SM &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; Updated &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; new header files in S32DS v &lt;span style=&#34;color:#ae81ff&#34;&gt;1.3&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34;            /* include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;clocks_and_modes.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; lpit0_ch0_flag_counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* LPIT0 timeout counter */&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PORT_init&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
  PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; PCCn[PCC_PORTD_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clock for PORT D */&lt;/span&gt;
  PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;            &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0:  Data Direction= output */&lt;/span&gt;
  PORTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;  &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000100&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0:  MUX = ALT1, GPIO (to blue LED on EVB) */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LPIT0_init&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
  PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_LPIT_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_PCS(&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;);    &lt;span style=&#34;color:#75715e&#34;&gt;/* Clock Src = 6 (SPLL2_DIV2_CLK)*/&lt;/span&gt;
  PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCCn[PCC_LPIT_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clk to LPIT0 regs */&lt;/span&gt;
  LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;MCR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;;    &lt;span style=&#34;color:#75715e&#34;&gt;/* DBG_EN-0: Timer chans stop in Debug mode */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* DOZE_EN=0: Timer chans are stopped in DOZE mode */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* SW_RST=0: SW reset does not reset timer chans, regs */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* M_CEN=1: enable module clk (allows writing other LPIT0 regs) */&lt;/span&gt;
  LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TMR[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].TVAL &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;40000000&lt;/span&gt;;    &lt;span style=&#34;color:#75715e&#34;&gt;/* Chan 0 Timeout period: 40M clocks */&lt;/span&gt;
  LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TMR[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].TCTRL &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* T_EN=1: Timer channel is enabled */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* CHAIN=0: channel chaining is disabled */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* MODE=0: 32 periodic counter mode */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* TSOT=0: Timer decrements immediately based on restart */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* TSOI=0: Timer does not stop after timeout */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* TROT=0 Timer will not reload on trigger */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* TRG_SRC=0: External trigger soruce */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* TRG_SEL=0: Timer chan 0 trigger source is selected*/&lt;/span&gt;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SOSC_init_8MHz&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCDIV&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000101&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCDIV1 &amp;amp; SOSCDIV2 =1: divide by 1 */&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCFG&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000024&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* Range=2: Medium freq (SOSC betw 1MHz-8MHz)*/&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* HGO=0:   Config xtal osc for low power */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* EREFS=1: Input is external XTAL */&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SOSCCSR_LK_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Ensure SOSCCSR unlocked */&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCSR&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* LK=0:          SOSCCSR can be written */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCCMRE=0:    OSC CLK monitor IRQ if enabled */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCCM=0:      OSC CLK monitor disabled */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCERCLKEN=0: Sys OSC 3V ERCLK output clk disabled */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCLPEN=0:    Sys OSC disabled in VLP modes */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCSTEN=0:    Sys OSC disabled in Stop modes */&lt;/span&gt;
                            &lt;span style=&#34;color:#75715e&#34;&gt;/* SOSCEN=1:      Enable oscillator */&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SOSCCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SOSCCSR_SOSCVLD_MASK)); &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for sys OSC clk valid */&lt;/span&gt;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SPLL_init_160MHz&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SPLLCSR_LK_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Ensure SPLLCSR unlocked */&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000000&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLEN=0: SPLL is disabled (default) */&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLDIV &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000302&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLDIV1 divide by 2; SPLLDIV2 divide by 4 */&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCFG &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00180000&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/* PREDIV=0: Divide SOSC_CLK by 0+1=1 */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* MULT=24:  Multiply sys pll by 4+24=40 */&lt;/span&gt;
                              &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLL_CLK = 8MHz / 1 * 40 / 2 = 160 MHz */&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SPLLCSR_LK_MASK); &lt;span style=&#34;color:#75715e&#34;&gt;/* Ensure SPLLCSR unlocked */&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000001&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* LK=0:        SPLLCSR can be written */&lt;/span&gt;
                             &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLCMRE=0:  SPLL CLK monitor IRQ if enabled */&lt;/span&gt;
                             &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLCM=0:    SPLL CLK monitor disabled */&lt;/span&gt;
                             &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLSTEN=0:  SPLL disabled in Stop modes */&lt;/span&gt;
                             &lt;span style=&#34;color:#75715e&#34;&gt;/* SPLLEN=1:    Enable SPLL */&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;(SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;SPLLCSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_SPLLCSR_SPLLVLD_MASK)); &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for SPLL valid */&lt;/span&gt;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NormalRUNmode_80MHz&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {  &lt;span style=&#34;color:#75715e&#34;&gt;/* Change to normal RUN mode with 8MHz SOSC, 80 MHz PLL*/&lt;/span&gt;
  SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;RCCR&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;SCG_RCCR_SCS(&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;)      &lt;span style=&#34;color:#75715e&#34;&gt;/* PLL as clock source*/&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;SCG_RCCR_DIVCORE(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;b01)      &lt;span style=&#34;color:#75715e&#34;&gt;/* DIVCORE=1, div. by 2: Core clock = 160/2 MHz = 80 MHz*/&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;SCG_RCCR_DIVBUS(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;b01)       &lt;span style=&#34;color:#75715e&#34;&gt;/* DIVBUS=1, div. by 2: bus clock = 40 MHz*/&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;SCG_RCCR_DIVSLOW(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;b10);     &lt;span style=&#34;color:#75715e&#34;&gt;/* DIVSLOW=2, div. by 2: SCG slow, flash clock= 26 2/3 MHz*/&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (((SCG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; SCG_CSR_SCS_MASK) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; SCG_CSR_SCS_SHIFT ) &lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;) {}
                                 &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for sys clk src = SPLL */&lt;/span&gt;
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WDOG_disable&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
    WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CNT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xD928C520&lt;/span&gt;;   &lt;span style=&#34;color:#75715e&#34;&gt;/*Unlock watchdog*/&lt;/span&gt;
    WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TOVAL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x0000FFFF&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Maximum timeout value*/&lt;/span&gt;
    WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00002100&lt;/span&gt;;  &lt;span style=&#34;color:#75715e&#34;&gt;/*Disable watchdog*/&lt;/span&gt;
}


&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
  WDOG_disable();
  PORT_init();            &lt;span style=&#34;color:#75715e&#34;&gt;/* Configure ports */&lt;/span&gt;
  SOSC_init_8MHz();       &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize system oscilator for 8 MHz xtal */&lt;/span&gt;
  SPLL_init_160MHz();     &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize SPLL to 160 MHz with 8 MHz SOSC */&lt;/span&gt;
  NormalRUNmode_80MHz();  &lt;span style=&#34;color:#75715e&#34;&gt;/* Init clocks: 80 MHz sysclk &amp;amp; core, 40 MHz bus, 20 MHz flash */&lt;/span&gt;
  LPIT0_init();           &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize PIT0 for 1 second timeout  */&lt;/span&gt;

  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (;;) {                     &lt;span style=&#34;color:#75715e&#34;&gt;/* Toggle output to LED every LPIT0 timeout */&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;MSR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; LPIT_MSR_TIF0_MASK)) {} &lt;span style=&#34;color:#75715e&#34;&gt;/* Wait for LPIT0 CH0 Flag */&lt;/span&gt;
    lpit0_ch0_flag_counter&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;;         &lt;span style=&#34;color:#75715e&#34;&gt;/* Increment LPIT0 timeout counter */&lt;/span&gt;
    PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PTOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;                &lt;span style=&#34;color:#75715e&#34;&gt;/* Toggle output on port D0 (blue LED) */&lt;/span&gt;
    LPIT0&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;MSR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LPIT_MSR_TIF0_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear LPIT0 timer flag 0 */&lt;/span&gt;
  }
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;heading-4&#34;&gt;ä»£ç è¯¦è§£&lt;/h1&gt;
&lt;p&gt;è€æ ·å­ï¼Œè¿˜æ˜¯ä» &lt;code&gt;main()&lt;/code&gt; å†…å¼€å§‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;PORT_init();    &lt;span style=&#34;color:#75715e&#34;&gt;/* Configure ports */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸€è¡Œç”¨äºåˆå§‹åŒ–ç«¯å£ï¼Œå‡½æ•°å†…éƒ¨æ‰“å¼€ CGCï¼Œé…ç½® GPIO ,è®¾ç½® PCR MUX å’Œè¢«åŠ¨æ»¤æ³¢ã€‚ç”±äºç¬¬ä¸€èŠ‚å·²ç»æœ‰äº†è¯¦ç»†ä»‹ç»ï¼Œåœ¨è¿™é‡Œä¸åšè¿‡å¤šæè¿°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;SOSC_init_8MHz();   &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize system oscilator for 8 MHz xtal */&lt;/span&gt;
SPLL_init_160MHz(); &lt;span style=&#34;color:#75715e&#34;&gt;/* Initialize SPLL to 160 MHz with 8 MHz SOSC */&lt;/span&gt;
NormalRUNmode_80MHz();  &lt;span style=&#34;color:#75715e&#34;&gt;/* Init clocks: 80 MHz sysclk &amp;amp; core, 40 MHz bus, 20 MHz flash */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸‰ä¸ªæ”¾åœ¨ä¸€èµ·ï¼Œå› ä¸ºä»–ä»¬éƒ½ç”¨åˆ°äº†ä¸€ä¸ªæŒ‡é’ˆæ¥è¿›è¡Œä¿®æ”¹ï¼Œè¿™ä¸ªæŒ‡é’ˆå°±æ˜¯ &lt;code&gt;SCG&lt;/code&gt; , åœ¨å¤´æ–‡ä»¶ä¸­ &lt;code&gt;SCG&lt;/code&gt; æœ‰ä»¥ä¸‹çš„å«ä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** SCG - Register Layout Typedef */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
  __I  uint32_t VERID;                             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Version ID Register, offset: 0x0 */&lt;/span&gt;
  __I  uint32_t PARAM;                             &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Parameter Register, offset: 0x4 */&lt;/span&gt;
       uint8_t RESERVED_0[&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;];
  __I  uint32_t CSR;                               &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Clock Status Register, offset: 0x10 */&lt;/span&gt;
  __IO uint32_t RCCR;                              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Run Clock Control Register, offset: 0x14 */&lt;/span&gt;
  __IO uint32_t VCCR;                              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; VLPR Clock Control Register, offset: 0x18 */&lt;/span&gt;
  __IO uint32_t HCCR;                              &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; HSRUN Clock Control Register, offset: 0x1C */&lt;/span&gt;
  __IO uint32_t CLKOUTCNFG;                        &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; SCG CLKOUT Configuration Register, offset: 0x20 */&lt;/span&gt;
       uint8_t RESERVED_1[&lt;span style=&#34;color:#ae81ff&#34;&gt;220&lt;/span&gt;];
  __IO uint32_t SOSCCSR;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; System OSC Control Status Register, offset: 0x100 */&lt;/span&gt;
  __IO uint32_t SOSCDIV;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; System OSC Divide Register, offset: 0x104 */&lt;/span&gt;
  __IO uint32_t SOSCCFG;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; System Oscillator Configuration Register, offset: 0x108 */&lt;/span&gt;
       uint8_t RESERVED_2[&lt;span style=&#34;color:#ae81ff&#34;&gt;244&lt;/span&gt;];
  __IO uint32_t SIRCCSR;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Slow IRC Control Status Register, offset: 0x200 */&lt;/span&gt;
  __IO uint32_t SIRCDIV;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Slow IRC Divide Register, offset: 0x204 */&lt;/span&gt;
  __IO uint32_t SIRCCFG;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Slow IRC Configuration Register, offset: 0x208 */&lt;/span&gt;
       uint8_t RESERVED_3[&lt;span style=&#34;color:#ae81ff&#34;&gt;244&lt;/span&gt;];
  __IO uint32_t FIRCCSR;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Fast IRC Control Status Register, offset: 0x300 */&lt;/span&gt;
  __IO uint32_t FIRCDIV;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Fast IRC Divide Register, offset: 0x304 */&lt;/span&gt;
  __IO uint32_t FIRCCFG;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Fast IRC Configuration Register, offset: 0x308 */&lt;/span&gt;
       uint8_t RESERVED_4[&lt;span style=&#34;color:#ae81ff&#34;&gt;756&lt;/span&gt;];
  __IO uint32_t SPLLCSR;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; System PLL Control Status Register, offset: 0x600 */&lt;/span&gt;
  __IO uint32_t SPLLDIV;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; System PLL Divide Register, offset: 0x604 */&lt;/span&gt;
  __IO uint32_t SPLLCFG;                           &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; System PLL Configuration Register, offset: 0x608 */&lt;/span&gt;
} SCG_Type, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;SCG_MemMapPtr;

&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral SCG base address */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define SCG_BASE    (0x40064000u)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral SCG base pointer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define SCG    ((SCG_Type *)SCG_BASE)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç›¸å½“åºå¤§çš„ç»“æ„ï¼Œç¿»é˜… Manual ç…ä¸€ç…å„ä¸ªå°å¯„å­˜å™¨å§ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;Register name&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Width&lt;!-- raw HTML omitted --&gt;(in bits)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Access&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Version ID Register (SCG_VERID)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;R&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Parameter Register (SCG_PARAM)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;R&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Clock Status Register (SCG_CSR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;R&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Run Clock Control Register (SCG_RCCR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;VLPR Clock Control Register (SCG_VCCR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;HSRUN Clock Control Register (SCG_HCCR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;SCG CLKOUT Configuration Register (SCG_CLKOUTCNFG)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;System OSC Control Status Register (SCG_SOSCCSR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;System OSC Divide Register (SCG_SOSCDIV)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;System Oscillator Configuration Register (SCG_SOSCCFG)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Slow IRC Control Status Register (SCG_SIRCCSR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Slow IRC Divide Register (SCG_SIRCDIV)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Slow IRC Configuration Register (SCG_SIRCCFG)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Fast IRC Control Status Register (SCG_FIRCCSR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Fast IRC Divide Register (SCG_FIRCDIV)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Fast IRC Configuration Register (SCG_FIRCCFG)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;System PLL Control Status Register (SCG_SPLLCSR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;System PLL Divide Register (SCG_SPLLDIV)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;System PLL Configuration Register (SCG_SPLLCFG)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;version-id-register-scg-verid&#34;&gt;Version ID Register (SCG_VERID)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;VERSION&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SCG Version Number&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;SCG çš„ç‰ˆæœ¬å·&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;parameter-register-scg-param&#34;&gt;Parameter Register (SCG_PARAM)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†™å…¥ä¼šå¯¼è‡´é”™è¯¯ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å­—é¢æ„æ€æ˜¯å‚æ•°å¯„å­˜å™¨ï¼Œå…¶ä¸­ 32 ä½çš„å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;31-27&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DIVPRES&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;æŒ‡ç¤ºç°åœ¨çš„ SCG åˆ†é¢‘å™¨ä½¿ç”¨çŠ¶æ€&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;&lt;code&gt;DIVPRES[27]=1&lt;/code&gt; DIVSLOW æ­£åœ¨è¢«ä½¿ç”¨&lt;!-- raw HTML omitted --&gt;&lt;code&gt;DIVPRES[28]=1&lt;/code&gt; DIVBUS æ­£åœ¨è¢«ä½¿ç”¨&lt;!-- raw HTML omitted --&gt;&lt;code&gt;DIVPRES[31]=1&lt;/code&gt; DIVCORE æ­£åœ¨è¢«ä½¿ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;CLKPRES&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;æŒ‡ç¤ºå½“å‰çŠ¶æ€ä¸‹å“ªä¸ªæ—¶é’Ÿæ­£åœ¨è¢«å½“åš SCG æ—¶é’Ÿæº&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;CLKPRES[0] Reserved&lt;!-- raw HTML omitted --&gt;CLKPRES&lt;a href=&#34;https://xiahualiu.github.io/img/2017-9-29-S32K144_2/hello_clock.png&#34;&gt;1&lt;/a&gt;=1 System OSC (SOSC) æ­£åœ¨è¢«ä½¿ç”¨&lt;!-- raw HTML omitted --&gt;CLKPRES&lt;a href=&#34;https://xiahualiu.github.io/img/2017-9-29-S32K144_2/DIV_Requirement.png&#34;&gt;2&lt;/a&gt;=1 Slow IRC (SIRC) æ­£åœ¨è¢«ä½¿ç”¨&lt;!-- raw HTML omitted --&gt;CLKPRES[3]=1 Fast IRC (FIRC) æ­£åœ¨è¢«ä½¿ç”¨&lt;!-- raw HTML omitted --&gt;CLKPRES[6]=1 System PLL (SPLL) æ­£åœ¨è¢«ä½¿ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;clock-status-register-scg-csr&#34;&gt;Clock Status Register (SCG_CSR)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†™å…¥ä¼šå¯¼è‡´é”™è¯¯ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨è¿”å›å½“å‰çš„ç³»ç»Ÿæ—¶é’Ÿæºå’Œç³»ç»Ÿæ—¶é’Ÿåˆ†é¢‘å™¨é…ç½®ï¼Œé•œåƒ SCG_RCCR, SCG_VCCR, SCG_HCCR ä¸‰ä¸ªæ—¶é’Ÿæ§åˆ¶å™¨å…¶ä¸­ä¹‹ä¸€çš„é…ç½®ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;27-24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SCS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;è¿”å›å½“å‰é…ç½®çš„ç³»ç»Ÿæ—¶é’Ÿå‘ç”Ÿå™¨æ¥æº&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0001 System OSC (SOSC_CLK)&lt;!-- raw HTML omitted --&gt;0010 Slow IRC (SIRC_CLK)&lt;!-- raw HTML omitted --&gt;0011 Fast IRC (FIRC_CLK)&lt;!-- raw HTML omitted --&gt;0110 System PLL (SPLL_CLK)&lt;!-- raw HTML omitted --&gt;å…¶ä½™çš„å€¼æ— æ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;19-16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DIVCORE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;æŒ‡ç¤ºç°åœ¨çš„æ ¸å¿ƒæ—¶é’Ÿåˆ†é¢‘æ¯”ç‡&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;* è‹¥ SPLL è¢«é€‰åšæ—¶é’Ÿæºï¼Œåˆ™æœ€å¤§æ¯”ç‡æ˜¯ 4&lt;!-- raw HTML omitted --&gt; åˆ†é¢‘æ¯”ç‡ = &lt;code&gt;DIVCORE+1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7-4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DIVBUS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;è¿”å›ç°åœ¨çš„æ€»çº¿ï¼ˆBUSï¼‰æ—¶é’Ÿåˆ†é¢‘æ¯”ç‡&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;åˆ†é¢‘æ¯”ç‡ = &lt;code&gt;DIVBUS+1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DIVSLOW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;è¿”å›ç°åœ¨çš„æ…¢é€Ÿæ—¶é’Ÿåˆ†é¢‘æ¯”ç‡&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;åˆ†é¢‘æ¯”ç‡ = &lt;code&gt;DIVSLOW+1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;run-clock-control-register-scg-rccr&#34;&gt;Run Clock Control Register (SCG_RCCR)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨ç»™æ ¸å¿ƒï¼Œå¹³å°ï¼Œå¤–å›´ï¼Œæ€»çº¿æ§åˆ¶ç³»ç»Ÿæ—¶é’Ÿæºå’Œç³»ç»Ÿæ—¶é’Ÿåˆ†é¢‘å™¨ï¼Œåªåœ¨ Run æ¨¡å¼ä¸‹èµ·ä½œç”¨ï¼Œè¿™ä¸ªå¯„å­˜å™¨å†™å…¥çš„æ—¶å€™åªèƒ½ä¸€æ¬¡å†™å…¥ 32 ä½ã€‚åœ¨ Run æ¨¡å¼ä¸‹é€‰æ‹©ä¸€ä¸ªä¸åŒçš„æ—¶é’Ÿæºéœ€è¦æ—¶é’Ÿæºåœ¨ç³»ç»Ÿæ—¶é’Ÿè°ƒæ•´åˆ°æ—¶é’Ÿæºå‰å°±è¦å¼€å¯å¹¶ä¸”ä¿è¯æœ‰æ•ˆã€‚å¦‚æœç³»ç»Ÿæ—¶é’Ÿåˆ†é¢‘å™¨æ¯”ç‡æ”¹å˜çš„åŒæ—¶é€‰æ‹©äº†ä¸€ä¸ªä¸åŒçš„æ—¶é’Ÿæ¨¡å¼ï¼Œåˆ™æ–°çš„åˆ†é¢‘å™¨æ¯”ç‡åªæœ‰åœ¨æ–°çš„æ—¶é’Ÿæºæœ‰æ•ˆåæ‰ä¼šå‘ç”Ÿæ”¹å˜ã€‚&lt;/p&gt;
&lt;p&gt;å¯„å­˜å™¨è§ &lt;code&gt;SCG_CSR&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;vlpr-clock-control-register-scg-vccr&#34;&gt;VLPR Clock Control Register (SCG_VCCR)&lt;/h3&gt;
&lt;p&gt;SCG_VCCR æ§åˆ¶çš„æ˜¯ VLPR æ¨¡å¼ä¸‹çš„ï¼Œè€Œä¸æ˜¯ Run æ¨¡å¼ä¸‹çš„ï¼Œå…¶ä»–çš„å¯„å­˜å™¨åœ°å›¾ä»€ä¹ˆçš„å’Œ SCG_RCCR ä¸€æ ·ã€‚å†™å…¥çš„æ—¶å€™åªèƒ½ä¸€æ¬¡å†™å…¥ 32 ä½ã€‚&lt;/p&gt;
&lt;p&gt;å¯„å­˜å™¨è§ &lt;code&gt;SCG_CSR&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;hsrun-clock-control-register-scg-hccr&#34;&gt;HSRUN Clock Control Register (SCG_HCCR)&lt;/h3&gt;
&lt;p&gt;åœ¨ HSRUN æ¨¡å¼ä¸‹çš„æ—¶é’Ÿæ§åˆ¶å¯„å­˜å™¨ï¼ŒåŒä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å¯„å­˜å™¨è§ &lt;code&gt;SCG_CSR&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;scg-clkout-configuration-register-scg-clkoutcnfg&#34;&gt;SCG CLKOUT Configuration Register (SCG_CLKOUTCNFG)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨æ§åˆ¶å“ªä¸€ä¸ª SCG æ—¶é’Ÿæºè¢«è¾“å‡ºåˆ° &lt;strong&gt;CLKOUT&lt;/strong&gt; ç®¡è„šã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;27-24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SCS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;é€‰æ‹© SCG ç³»ç»Ÿæ—¶é’Ÿä½œä¸º CLKOUT&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0001 System OSC (SOSC_CLK)&lt;!-- raw HTML omitted --&gt;0010 Slow IRC (SIRC_CLK)&lt;!-- raw HTML omitted --&gt;0011 Fast IRC (FIRC_CLK)&lt;!-- raw HTML omitted --&gt;0110 System PLL (SPLL_CLK)&lt;!-- raw HTML omitted --&gt;å…¶ä½™çš„å€¼æ— æ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;system-osc-control-status-register-scg-sosccsr&#34;&gt;System OSC Control Status Register (SCG_SOSCCSR)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨æ§åˆ¶ SCG æ¨¡å—ä¸­çš„ SOSC å·¥ä½œçŠ¶æ€ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;26&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCERR&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Clock Error&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;æ­¤ä½åªèƒ½è¢«å•ç‰‡æœºçš„ä¸Šç”µå¤ä½é‡ç½®ï¼Œä½†æ˜¯è½¯ä»¶ä¹Ÿå¯ä»¥é€šè¿‡å‘æ­¤ä½å†™å…¥ 1 æ¸…é›¶&lt;!-- raw HTML omitted --&gt;0 SOSC æ£€æµ‹å™¨è¢«å…³é—­æˆ–è€…æ²¡æœ‰æ£€æµ‹åˆ°é”™è¯¯&lt;!-- raw HTML omitted --&gt;1 SOSC  æ£€æµ‹å™¨è¢«å¼€å¯å¹¶ä¸”æ£€æµ‹åˆ°ä¸€ä¸ªé”™è¯¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;25&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCSEL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Selected æ­¤ä½ä¸å¯å†™å…¥&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 SOSC ä¸æ˜¯ç³»ç»Ÿæ—¶é’Ÿæº&lt;!-- raw HTML omitted --&gt;1 SOSC æ˜¯ç³»ç»Ÿæ—¶é’Ÿæº&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCVLD&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Valid æ­¤ä½ä¸å¯å†™å…¥&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;0 SOSC æ— æ•ˆæˆ–è€…æ²¡æœ‰å¯ç”¨&lt;!-- raw HTML omitted --&gt;1 SOSC æœ‰æ•ˆå¹¶ä¸”è¾“å‡ºæœ‰æ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;23&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;LK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Lock Register&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;æ­¤ä½å¯ä»¥åœ¨ä»»ä½•æ—¶å€™æ¸…é›¶æˆ–è€…ç½® 1 &lt;!-- raw HTML omitted --&gt;0 CSR å¯„å­˜å™¨å¯ä»¥å†™å…¥&lt;!-- raw HTML omitted --&gt;1 CSR å¯„å­˜å™¨ä¸å¯ä»¥å†™å…¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;17&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCCMRE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Clock Monitor Reset Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;SOSC ç›‘æµ‹å™¨ä¸­æ–­/é‡ç½®å¼€å…³&lt;!-- raw HTML omitted --&gt;0 å½“é”™è¯¯è¢«æ£€æµ‹ï¼Œç›‘æµ‹å™¨äº§ç”Ÿä¸­æ–­&lt;!-- raw HTML omitted --&gt;1 å½“é”™è¯¯è¢«æ£€æµ‹ï¼Œç›‘æµ‹å™¨äº§ç”Ÿé‡å¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCCM&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Clock Monitor&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;SOSC ç›‘æµ‹å™¨å¼€å…³&lt;!-- raw HTML omitted --&gt;0 SOSC ç›‘æµ‹å™¨å…³&lt;!-- raw HTML omitted --&gt;1 SOSC ç›‘æµ‹å™¨å¼€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;SOSC ä½¿èƒ½&lt;!-- raw HTML omitted --&gt;0 SOSC å…³&lt;!-- raw HTML omitted --&gt;1 SOSC å¼€&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;system-osc-divide-register-scg-soscdiv&#34;&gt;System OSC Divide Register (SCG_SOSCDIV)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¯„å­˜å™¨æ§åˆ¶ä¸¤ä¸ªæ—¶é’Ÿè¾“å‡ºï¼Œæ—¢å¯ä»¥ç”¨ä½œå¤–å›´å™¨ä»¶çš„åŠŸèƒ½æ—¶é’Ÿï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ—¶é’Ÿæ¨¡å—ä½¿ç”¨ï¼Œæ¯ä¸€è·¯è¾“å‡ºéƒ½æœ‰åˆ†é¢‘å™¨æä¾›åˆ†é¢‘ï¼Œåº”è¯¥åœ¨ SOSC è¢«å…³é—­çš„æƒ…å†µä¸‹æ›´æ”¹è¯¥å¯„å­˜å™¨çš„å€¼ä»¥é¿å…è¾“å‡ºçš„å€¼å‡ºç°é”™è¯¯ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCDIV2&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Clock Divide 2&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;è®¾ç½® SOSC ç¬¬äºŒè·¯è¾“å‡ºçš„åˆ†é¢‘æ¯”ç‡&lt;!-- raw HTML omitted --&gt;åˆ†é¢‘æ¯”ç‡ = &lt;code&gt;2^(SOSCDIV2-1)&lt;/code&gt; &lt;!-- raw HTML omitted --&gt; 0 æ—¶å…³é—­æ—¶é’Ÿè¾“å‡º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2-1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SOSCDIV1&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Clock Divide 1&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;è®¾ç½® SOSC ç¬¬ä¸€è·¯è¾“å‡ºçš„åˆ†é¢‘æ¯”ç‡&lt;!-- raw HTML omitted --&gt;åˆ†é¢‘æ¯”ç‡ = &lt;code&gt;2^(SOSCDIV1-1)&lt;/code&gt; &lt;!-- raw HTML omitted --&gt; 0 æ—¶å…³é—­æ—¶é’Ÿè¾“å‡º&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;system-oscillator-configuration-register-scg-sosccfg&#34;&gt;System Oscillator Configuration Register (SCG_SOSCCFG)&lt;/h3&gt;
&lt;p&gt;æ­¤å¯„å­˜å™¨æ§åˆ¶æŒ¯è¡å™¨çš„å·¥ä½œçŠ¶æ€ï¼Œåœ¨ SOSC è¿è¡Œçš„æ—¶å€™æ— æ³•è¢«å†™å…¥ï¼Œå¼ºè¡Œå†™å…¥ä¼šè¢«å¿½ç•¥å¹¶ä¸ä¼šæŠ¥èµ‹å€¼é”™è¯¯ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5-4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RANGE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;System OSC Range Select&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;é€‰æ‹© SOSC å¤–æ¥æ™¶æŒ¯çš„é¢‘ç‡èŒƒå›´&lt;!-- raw HTML omitted --&gt;10 ä¸­é¢‘ (4 MHz to 8MHz)&lt;!-- raw HTML omitted --&gt;11 é«˜é¢‘ (8 MHz to 40 MHz)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;HGO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;High Gain Oscillator Select&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;é«˜å¢ç›ŠæŒ¯è¡å™¨é€‰æ‹©&lt;!-- raw HTML omitted --&gt;0 ä½å¢ç›Šè¿è¡ŒæŒ¯è¡å™¨&lt;!-- raw HTML omitted --&gt;1 é«˜å¢ç›Šè¿è¡ŒæŒ¯è¡å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;EREFS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;External Reference Select&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;å¤–éƒ¨å‚è€ƒæ—¶é’Ÿé€‰æ‹©&lt;!-- raw HTML omitted --&gt;0 å¤–éƒ¨å‚è€ƒæ—¶é’Ÿ&lt;!-- raw HTML omitted --&gt;1 SOSC å†…éƒ¨æ™¶ä½“æŒ¯è¡å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;slow-irc-control-status-register-scg-sirccsr&#34;&gt;Slow IRC Control Status Register (SCG_SIRCCSR)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;25&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCSEL&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Selected&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;é€‰æ‹© SIRC æ˜¯å¦ä½œä¸ºç³»ç»Ÿæ—¶é’Ÿæº&lt;!-- raw HTML omitted --&gt;0 Slow IRC æ˜¯ç³»ç»Ÿæ—¶é’Ÿæº&lt;!-- raw HTML omitted --&gt;1 Slow IRC ä¸æ˜¯ç³»ç»Ÿæ—¶é’Ÿæº&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCVLD&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Valid&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;Slow IRC æœ‰æ•ˆä½&lt;!-- raw HTML omitted --&gt;0 Slow IRC æ— æ•ˆæˆ–è€…æ²¡æœ‰å¯åŠ¨&lt;!-- raw HTML omitted --&gt;1 Slow IRC å¯åŠ¨å¹¶ä¸”æœ‰æ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCLPEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Low Power Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;Slow IRC ä½åŠŸç‡æ¨¡å¼å¼€å…³&lt;!-- raw HTML omitted --&gt;0 Slow IRC åœ¨ VLP æ¨¡å¼ä¸å¯åŠ¨ä¸‹&lt;!-- raw HTML omitted --&gt;1 Slow IRC åœ¨ VLP æ¨¡å¼ä¸‹å¯åŠ¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCSTEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Stop Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;Slow IRC åœæ­¢æ¨¡å¼å¼€å…³&lt;!-- raw HTML omitted --&gt;0 Slow IRC åœ¨ Stop modes ä¸‹ä¸å·¥ä½œ&lt;!-- raw HTML omitted --&gt;1 Slow IRC åœ¨ Stop modes ä¸‹å·¥ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCEN&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Enable&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;Slow IRC ä½¿èƒ½&lt;!-- raw HTML omitted --&gt;0 Slow IRC å…³é—­&lt;!-- raw HTML omitted --&gt;1 Slow IRC å¼€å¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;slow-irc-divide-register-scg-sircdiv&#34;&gt;Slow IRC Divide Register (SCG_SIRCDIV)&lt;/h3&gt;
&lt;p&gt;è¯¥å¯„å­˜å™¨æ§åˆ¶ SIRC çš„åˆ†é¢‘å™¨å·¥ä½œçŠ¶æ€ï¼Œè¯·ç¡®ä¿è¯¥å¯„å­˜å™¨åœ¨æ”¹å˜å‰ï¼ŒSIRC æ˜¯å…³é—­ç€çš„ï¼Œä»¥é˜²æ­¢å‡ºç°é”™è¯¯ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCDIV2&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Clock Divide 2&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;æä¾›ç»™éœ€è¦å¼‚æ­¥æ—¶é’Ÿçš„æ¨¡å—çš„åˆ†é¢‘å™¨ 2&lt;!-- raw HTML omitted --&gt;åˆ†é¢‘æ¯”ç‡ = &lt;code&gt;2^(SIRCDIV2-1)&lt;/code&gt; &lt;!-- raw HTML omitted --&gt; 0 æ—¶å…³é—­æ—¶é’Ÿè¾“å‡º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2-0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;SIRCDIV1&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Slow IRC Clock Divide 1&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;æä¾›ç»™éœ€è¦å¼‚æ­¥æ—¶é’Ÿçš„æ¨¡å—çš„åˆ†é¢‘å™¨ 1&lt;!-- raw HTML omitted --&gt;åˆ†é¢‘æ¯”ç‡ = &lt;code&gt;2^(SIRCDIV1-1)&lt;/code&gt; &lt;!-- raw HTML omitted --&gt; 0 æ—¶å…³é—­æ—¶é’Ÿè¾“å‡º&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;slow-irc-configuration-register-scg-sirccfg&#34;&gt;Slow IRC Configuration Register (SCG_SIRCCFG)&lt;/h3&gt;
&lt;p&gt;æ­¤å¯„å­˜å™¨æ§åˆ¶æŒ¯è¡å™¨çš„å·¥ä½œçŠ¶æ€ï¼Œåœ¨ SIRC è¿è¡Œçš„æ—¶å€™æ— æ³•è¢«å†™å…¥ï¼Œå¼ºè¡Œå†™å…¥ä¼šè¢«å¿½ç•¥å¹¶ä¸ä¼šæŠ¥èµ‹å€¼é”™è¯¯ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RANGE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Frequency Range&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;é¢‘ç‡èŒƒå›´&lt;!-- raw HTML omitted --&gt;0 Slow IRC low range clock (2 MHz)&lt;!-- raw HTML omitted --&gt;1 Slow IRC high range clock (8 MHz)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å‰©ä½™çš„ FIRC è·Ÿè¿™ä¸ªå·®ä¸å¤šï¼Œä½†æ˜¯æœ‰ä¸€éƒ¨åˆ†ç»†å¾®çš„å˜åŒ–ï¼Œåˆ°ç”¨çš„æ—¶å€™è¯·æŸ¥è¯¢å¯¹åº”çš„ç”¨æˆ·æ‰‹å†Œã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>S32K144EVB Notes 1 GPIO</title>
      <link>https://xiahualiu.github.io/posts/2017-09-28-s32k144_1/</link>
      <pubDate>Thu, 28 Sep 2017 00:00:00 +0000</pubDate>
      <guid>https://xiahualiu.github.io/posts/2017-09-28-s32k144_1/</guid>
      <description>&lt;h1 id=&#34;heading&#34;&gt;å‰è¨€&lt;/h1&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦ä»‹ç»äº†æœ¬äººåœ¨å­¦ä¹ ä½¿ç”¨ &lt;a href=&#34;https://www.nxp.com/cn/products/microcontrollers-and-processors/arm-processors/s32-arm-processors-microcontrollers/32-bit-automotive-general-purpose-microcontrollers:S32K#overviewExpand?cid=ps_cn_baidu_cpc_B_AUTO_S32K_Phrase_bd20170620002&#34;&gt;S32K144EVB&lt;/a&gt;ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³åŠæ³•ï¼Œç”±äºæœ¬èŠ¯ç‰‡æ˜¯ &lt;a href=&#34;https://www.nxp.com/&#34;&gt;NXP&lt;/a&gt;(åŸ freescale) ç”Ÿäº§çš„åŸºäº ARM M4F å†…æ ¸çš„32ä½èŠ¯ç‰‡ï¼Œä¸»è¦é€‚ç”¨å¯¹è±¡æ˜¯æ±½è½¦ ã€‚ç›®å‰åœ¨ç½‘ç»œä¸Šè¯¥èŠ¯ç‰‡è¿˜æ²¡æœ‰ç›¸å…³çš„ä¸­æ–‡å­¦ä¹ èµ„æ–™ï¼Œåˆ°ç¬”è€…å†™æœ¬æ–‡ç›®å‰ï¼Œç½‘ç»œä¸Šèƒ½å¤Ÿæ‰¾åˆ°çš„èµ„æ–™åªæœ‰å¼€å‘æ¿çš„ç”µè·¯å›¾å’Œ Reference Manual å’Œè¯¥èŠ¯ç‰‡é…å¥—çš„ IDE å†…ç½®å¤´æ–‡ä»¶ä»¥åŠç»™å‡ºçš„ cookbook ä¾‹ç¨‹ï¼Œç¬”è€…ä¹Ÿæ˜¯åœ¨ä¸€æ­¥æ­¥æ‘¸ç´¢å­¦ä¹ ï¼Œæ•…æœ¬æ–‡ä¸ºä¸€ä¸ªè®°å½•æ€§è´¨çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;æœ¬æ–‡é˜…è¯»éœ€è¦ C è¯­è¨€åŸºç¡€å’Œä¸€äº›ç®€å•çš„å•ç‰‡æœºçŸ¥è¯†ï¼Œç¬”è€…åœ¨ä¹‹å‰æ›¾ç»å¼€å‘è¿‡51å•ç‰‡æœºå’Œ freescale å…¬å¸çš„ HC08GP32 å•ç‰‡æœºï¼Œæ•…å¯èƒ½ä¼šè·³è¿‡ä¸€äº›åŸºç¡€è¯´æ˜ã€‚&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;ç”±äºè¯¥èŠ¯ç‰‡çš„ Manual æ–‡ä»¶é•¿è¾¾ 1929 é¡µï¼Œå…¨è¯»å®Œè‚¯å®šè¦æµªè´¹å¾ˆå¤šæ—¶é—´ï¼Œä¸ºäº†èŠ‚çº¦æ—¶é—´ï¼Œæˆ‘å°±é’ˆå¯¹ä¾‹ç¨‹ä¸­ç»™å‡ºçš„éƒ¨åˆ†å†…å®¹æŸ¥è¯¢æ‰‹å†Œç›¸å…³å†…å®¹ï¼Œè¿›è¡Œåˆ†æã€‚&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;æœ¬æ–‡é’ˆå¯¹ S32K144EVB-Q100X å¼€å‘æ¿ï¼Œä½†åŸºæœ¬åŸç†éƒ½æ˜¯ç›¸åŒçš„ã€‚&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;hello-world&#34;&gt;Hello World&lt;/h1&gt;
&lt;h2 id=&#34;1-&#34;&gt;1. æœ¬ä¾‹ç¨‹ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†çš„æ“ä½œï¼š&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½® GPIO&lt;/li&gt;
&lt;li&gt;æ ¹æ®æŒ‰é”®çŠ¶æ€è¾“å‡º LED ç¯ä¿¡å·&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2-&#34;&gt;2. ä½¿ç”¨åˆ°çš„ç”µè·¯å›¾ï¼š&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://xiahualiu.github.io/img/2017-09-28-S32K144_1/helloworld1.png&#34; alt=&#34;Hello World block diagram&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;3-&#34;&gt;3. ç¬¬ä¸€ä¸ªä¾‹ç¨‹çš„ä»£ç å¦‚ä¸‹ï¼š&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;S32K144.h&amp;#34; /* include peripheral declarations S32K144 */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTD0 0 &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* Port PTD0, bit 0: FRDM EVB output to blue LED */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTC12 12 &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* Port PTC12, bit 12: FRDM EVB input from BTN0 [SW2] */&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WDOG_disable&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CNT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xD928C520&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Unlock watchdog*/&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;TOVAL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x0000FFFF&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Maximum timeout value*/&lt;/span&gt;
WDOG&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;CS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00002100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/*Disable watchdog*/&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; counter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
WDOG_disable();
&lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clocks to peripherals (PORT modules) */&lt;/span&gt;
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; PCCn[PCC_PORTC_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clock to PORT C */&lt;/span&gt;
PCC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; PCCn[PCC_PORTD_INDEX] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCC_PCCn_CGC_MASK; &lt;span style=&#34;color:#75715e&#34;&gt;/* Enable clock to PORT D */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* Configure port C12 as GPIO input (BTN 0 [SW2] on EVB) */&lt;/span&gt;
PTC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTC12); &lt;span style=&#34;color:#75715e&#34;&gt;/* Port C12: Data Direction= input (default) */&lt;/span&gt;
PORTC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000110&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port C12: MUX = GPIO, input filter enabled */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/* Configure port D0 as GPIO output (LED on EVB) */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDDR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0: Data Direction= output */&lt;/span&gt;
PORTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PCR[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x00000100&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;/* Port D0: MUX = GPIO */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(;;) {
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (PTC&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;PDIR &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTC12)) { &lt;span style=&#34;color:#75715e&#34;&gt;/* If Pad Data Input = 1 (BTN0 [SW2] pushed) */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; PCOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0; &lt;span style=&#34;color:#75715e&#34;&gt;/* Clear Output on port D0 (LED on) */&lt;/span&gt;
}
&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;/* If BTN0 was not pushed */&lt;/span&gt;
PTD&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; PSOR &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;PTD0; &lt;span style=&#34;color:#75715e&#34;&gt;/* Set Output on port D0 (LED off) */&lt;/span&gt;
}
counter&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;4-&#34;&gt;4. ä»£ç è¯¦è§£&lt;/h2&gt;
&lt;p&gt;ä¸»è¦å…³æ³¨ main() å†…éƒ¨&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;PCC-&amp;gt; PCCn[PCC_PORTC_INDEX] = PCC_PCCn_CGC_MASK; /* Enable clock to PORT C */
PCC-&amp;gt; PCCn[PCC_PORTD_INDEX] = PCC_PCCn_CGC_MASK; /* Enable clock to PORT D */
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™ä¸¤å¥è¯ä½¿ç”¨çš„ &lt;code&gt;PCC&lt;/code&gt; ç­‰å˜é‡åéƒ½æ˜¯åœ¨å¤´æ–‡ä»¶ &lt;code&gt;&amp;quot;S32K144.h&amp;quot;&lt;/code&gt; ä¸­å®šä¹‰çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** PCC - Size of Registers Arrays */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PCCn_COUNT 116u&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;/** PCC - Register Layout Typedef */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
  __IO uint32_t PCCn[PCC_PCCn_COUNT];   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; PCC Reserved Register 0..PCC CMP0 Register, array offset: 0x0, array step: 0x4 */&lt;/span&gt;
} PCC_Type, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;PCC_MemMapPtr;

&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PCC base address */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_BASE (0x40065000u)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PCC base pointer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC ((PCC_Type *)PCC_BASE)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;PCC&lt;/code&gt; æ˜¯ä¸€ä¸ªæŒ‡å‘å›ºå®šåœ°å€çš„ &lt;code&gt;PCC_Type&lt;/code&gt;ç»“æ„ä½“æŒ‡é’ˆï¼Œä»–çš„å›ºå®šåœ°å€æ˜¯ &lt;code&gt;(0x40065000u)&lt;/code&gt; å®ƒå¯¹åº”çš„ &lt;code&gt;PCC_Type&lt;/code&gt; ç»“æ„æ‹¥æœ‰ä¸€ä¸ª116ä¸ªæ— ç¬¦å·æ•´å‹å˜é‡çš„æ•°ç»„ &lt;code&gt;PCCn&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ ¹æ®æ³¨é‡Šå†…å®¹åˆ¤æ–­ï¼Œè¿™ä¸ªæŒ‡é’ˆçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥æ”¹å˜ PCC (Peripheral Clock Controller)æ§åˆ¶å™¨å†…éƒ¨å¯„å­˜å™¨çš„å€¼ï¼ˆä¸‹ç§° PCC ï¼‰ï¼ŒPCC æ§åˆ¶æœ‰å…³å¤–éƒ¨æ—¶é’Ÿé¢‘ç‡ç›¸å…³çš„è®¾ç½®ã€‚&lt;br&gt;
æŸ¥è¯¢äº† Reference Manual åå¾—çŸ¥ï¼ŒPCC æœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ—¶é’Ÿç•Œé¢å¼€é—­æ§åˆ¶ CGC (Clock Gating Controller)&lt;/li&gt;
&lt;li&gt;*åŠŸèƒ½æ€§æ—¶é’Ÿæºé€‰æ‹©æ§åˆ¶ï¼ˆå¦‚æœå¯¹åº”æ¨¡å—æœ‰æ—¶é’Ÿæºï¼‰&lt;/li&gt;
&lt;li&gt;*åŠŸèƒ½æ€§æ—¶é’Ÿåˆ†é¢‘å€¼æ§åˆ¶ï¼ˆå¦‚æœå¯¹åº”æ¨¡å—æœ‰åˆ†é¢‘å™¨ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬ä»…ä»…ç”¨åˆ°ç¬¬ä¸€ä¸ªåŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯æ—¶é’Ÿç•Œé¢å¼€å…³åŠŸèƒ½ã€‚åœ¨æœ¬æ–‡æ–‡æœ«ï¼Œæˆ‘å°†ç»™å‡º PCC çš„å†…å­˜åœ°å›¾ã€‚
PCC æ¨¡å—ç»™èŠ¯ç‰‡ä¸Šé¢æ¯ä¸€ä¸ªå¤–å›´æ¨¡å—éƒ½è®¾ç½®äº†ç‹¬è‡ªçš„ PCC å†…éƒ¨å¯„å­˜å™¨åœ°å€ï¼Œç”¨äºæ§åˆ¶ä»¥ä¸Šçš„ä¸‰ä¸ªåŠŸèƒ½ï¼ŒPCC å†…çš„æ¯ä¸€ä¸ªå¯„å­˜å™¨éƒ½æœ‰ä¸€ä¸ªæ—¶é’Ÿç•Œé¢å¼€é—­ä½ (CGC)ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨æ¯ä¸€ä¸ªæ¨¡å—ä½¿ç”¨å‰ï¼Œå¿…é¡»æ‰“å¼€è¯¥æ¨¡å—çš„CGC (CGC = 1)ï¼Œæ‰èƒ½ä½¿ç”¨è¯¥æ¨¡å—&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä½•æ‰“å¼€ï¼Ÿé¦–å…ˆæ˜¯å¯»å€ï¼Œåœ¨å¤´æ–‡ä»¶ &lt;code&gt;&amp;quot;S32K144.h&amp;quot;&lt;/code&gt; ä¸­å·²ç»å°† PCC æ§åˆ¶å™¨çš„å„ä¸ªå¯„å­˜å™¨åœ°å€å…¨éƒ¨ç”¨å®å®šä¹‰äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/* PCC index offsets */&lt;/span&gt;
...
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PORTA_INDEX 73&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PORTB_INDEX 74&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PORTC_INDEX 75&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PORTD_INDEX 76&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PORTE_INDEX 77&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ° GPIO A/B/C/D/E å¯¹åº”çš„åœ°å€ã€‚å°†å…¶èµ‹å€¼ä¸º &lt;code&gt;PCC_PCCn_CGC_MASK&lt;/code&gt; å³å¯æ‰“å¼€ CGCã€‚&lt;code&gt;PCC_PCCn_CGC_MASK&lt;/code&gt; åœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰ä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PCC_PCCn_CGC_MASK 0x40000000u&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åé¢çš„ GPIO ç«¯å£æ–¹å‘æ§åˆ¶ç±»ä¼¼ PCC çš„æ§åˆ¶ï¼Œåœ¨è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ª PTC å’Œ PTD æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸¤ä¸ªå›ºå®šåœ°å€çš„ç»“æ„ä½“ &lt;code&gt;GPIO_Type&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** GPIO - Register Layout Typedef */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
  __IO uint32_t PDOR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Data Output Register, offset: 0x0 */&lt;/span&gt;
  __O  uint32_t PSOR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Set Output Register, offset: 0x4 */&lt;/span&gt;
  __O  uint32_t PCOR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Clear Output Register, offset: 0x8 */&lt;/span&gt;
  __O  uint32_t PTOR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Toggle Output Register, offset: 0xC */&lt;/span&gt;
  __I  uint32_t PDIR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Data Input Register, offset: 0x10 */&lt;/span&gt;
  __IO uint32_t PDDR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Data Direction Register, offset: 0x14 */&lt;/span&gt;
  __IO uint32_t PIDR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Port Input Disable Register, offset: 0x18 */&lt;/span&gt;
} GPIO_Type, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;GPIO_MemMapPtr;

&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PTC base address */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTC_BASE (0x400FF080u)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PTC base pointer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTC ((GPIO_Type *)PTC_BASE)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PTD base address */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTD_BASE (0x400FF0C0u)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PTD base pointer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PTD ((GPIO_Type *)PTD_BASE)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;gpio-&#34;&gt;GPIO çš„æ§åˆ¶å™¨ï¼š&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Width&lt;!-- raw HTML omitted --&gt;(in bits)&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Access&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Data Output Register (PDOR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Set Output Register (PSOR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;W&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Clear Output Register (PCOR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;W&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Toggle Output Register (PTOR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;W&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Data Input Register (PDIR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;R&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Data Direction Register (PDDR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Port Input Disable Register (PIDR)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;RW&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-data-output-register-pdor&#34;&gt;Port Data Output Register (PDOR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PDO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Data Output&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;è¾“å‡ºç®¡è„šçš„å€¼ï¼Œå¯¹åº”é€»è¾‘å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-set-output-register-psor&#34;&gt;Port Set Output Register (PSOR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PTSO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Set Output&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;å°†æŒ‡å®šç®¡è„šçš„å€¼ç½® 1&lt;!-- raw HTML omitted --&gt;è¯»å–æ’ä¸ºé›¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-clear-output-register-pcor&#34;&gt;Port Clear Output Register (PCOR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PTCO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Clear Output&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;å°†æŒ‡å®šç®¡è„šçš„å€¼ç½® 0&lt;!-- raw HTML omitted --&gt;è¯»å–æ’ä¸ºé›¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-toggle-output-register-ptor&#34;&gt;Port Toggle Output Register (PTOR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PTTO&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Toggle Output&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;å°†æŒ‡å®šç®¡è„šçš„å€¼åè½¬&lt;!-- raw HTML omitted --&gt;è¯»å–æ’ä¸ºé›¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-data-input-register-pdir&#34;&gt;Port Data Input Register (PDIR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PDI&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Data Input&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;è¯»å–æŒ‡å®šç®¡è„šçš„å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-data-direction-register-pddr&#34;&gt;Port Data Direction Register (PDDR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PDD&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Data Direction&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 Input&lt;!-- raw HTML omitted --&gt;1 Output&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;port-input-disable-register-pidr&#34;&gt;Port Input Disable Register (PIDR)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;-&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PID&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Port Input Disable&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;0 ç®¡è„šæ­£å¸¸è¾“å…¥&lt;!-- raw HTML omitted --&gt;1 ç®¡è„šä¸èƒ½è¾“å…¥&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;-port-controller-register&#34;&gt;ç«¯å£åŠŸèƒ½æ§åˆ¶ PORT Controller Register&lt;/h3&gt;
&lt;p&gt;æˆ‘åšä¸ªæ¯”å–»ï¼Œåœ¨ ARM ä¸­ï¼Œå„ä¸ªç®¡è„šå°±åƒæ˜¯ä¸€ä¸ªä¸ªç­‰å¾…å·¥ä½œçš„é“¶è¡ŒæŸœå°çª—å£ï¼Œå¯ä»¥å­˜é’±ï¼Œä¹Ÿå¯ä»¥å–é’±ï¼Œä¹Ÿå¯ä»¥å€Ÿè´·æ¬¾ï¼Œä¹Ÿå¯ä»¥åŠç†ç†è´¢ä¸šåŠ¡ï¼Œé“¶è¡Œä¸èƒ½ä¸€ä¸ªä¸šåŠ¡å¼€ä¸€ä¸ªçª—å£ï¼Œæ‰€ä»¥æ¯ä¸ªçª—å£å¿…é¡»å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼ŒARM ä¹Ÿæ˜¯è¿™æ ·ï¼Œåœ¨æœ‰é™çš„ç®¡è„šä¸Šï¼Œéœ€è¦è¿›è¡Œä¸­æ–­ï¼ŒPWMï¼ŒGPIOï¼ŒUARTä¸²å£ï¼ŒSPIï¼ŒI2Cï¼ŒCAN ä¿¡æ¯äº¤æµåŠŸèƒ½ï¼Œæ‰€ä»¥&lt;strong&gt;æœ‰äº›&lt;/strong&gt;ç®¡è„šæœ‰å¾ˆå¤šåŠŸèƒ½å¯ä»¥é€‰æ‹©ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨æŸä¸ªåŠŸèƒ½å°±è¦è‡ªå·±è¿›è¡Œè®¾ç½®ï¼Œè®¾ç½®çš„åœ°æ–¹å‘¢å°±åœ¨ &lt;strong&gt;PCR(Pin Controller Register)&lt;/strong&gt; è¿™ä¸ªå¯„å­˜å™¨é‡Œé¢ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** PORT - Register Layout Typedef */&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
  __IO uint32_t PCR[PORT_PCR_COUNT];    &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Pin Control Register n, array offset: 0x0, array step: 0x4 */&lt;/span&gt;
  __O  uint32_t GPCLR;  &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Global Pin Control Low Register, offset: 0x80 */&lt;/span&gt;
  __O  uint32_t GPCHR;  &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Global Pin Control High Register, offset: 0x84 */&lt;/span&gt;
       uint8_t RESERVED_0[&lt;span style=&#34;color:#ae81ff&#34;&gt;24&lt;/span&gt;];
  __IO uint32_t ISFR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Interrupt Status Flag Register, offset: 0xA0 */&lt;/span&gt;
       uint8_t RESERVED_1[&lt;span style=&#34;color:#ae81ff&#34;&gt;28&lt;/span&gt;];
  __IO uint32_t DFER;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Digital Filter Enable Register, offset: 0xC0 */&lt;/span&gt;
  __IO uint32_t DFCR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Digital Filter Clock Register, offset: 0xC4 */&lt;/span&gt;
  __IO uint32_t DFWR;   &lt;span style=&#34;color:#75715e&#34;&gt;/**&amp;lt; Digital Filter Width Register, offset: 0xC8 */&lt;/span&gt;
} PORT_Type, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;PORT_MemMapPtr;

&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PORTC base address */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PORTC_BASE (0x4004B000u)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PORTC base pointer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PORTC ((PORT_Type *)PORTC_BASE)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PORTD base address */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PORTD_BASE (0x4004C000u)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Peripheral PORTD base pointer */&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;define PORTD ((PORT_Type *)PORTD_BASE)&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŒæ ·æ¯ä¸ª PCR éƒ½æœ‰ 32 ä½ï¼Œä¸ä¹‹å‰ä¸åŒçš„æ˜¯ï¼Œè¿™ 32 ä½ä»…ä»…è®¾ç½®äº†ä¸€ä¸ªç®¡è„šï¼Œè€Œä¸æ˜¯ 32 ä¸ªä¸ªï¼Œè¿™ 32 ä½çš„åŠŸèƒ½å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Field&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;24&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ISF&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Interrupt Status Flag&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; ç®¡è„šæœªæ£€æµ‹ä¸­æ–­&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; ç®¡è„šæ£€æµ‹åˆ°ä¸­æ–­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;19-16&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;IRQC&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Interrupt Configuration&lt;/strong&gt; å¯¹åº”ç®¡è„šçš„è®¾ç½®å¦‚ä¸‹&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0000&lt;!-- raw HTML omitted --&gt; ISF å…³é—­&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0001&lt;!-- raw HTML omitted --&gt; ISFæ ‡å¿— å’Œ DMA è¯·æ±‚ï¼Œäº§ç”Ÿåœ¨ä¸Šå‡æ²¿&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0010&lt;!-- raw HTML omitted --&gt; ISFæ ‡å¿— å’Œ DMA è¯·æ±‚ï¼Œäº§ç”Ÿåœ¨ä¸‹é™æ²¿&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0011&lt;!-- raw HTML omitted --&gt; ISFæ ‡å¿— å’Œ DMA è¯·æ±‚ï¼Œæ—¢åœ¨ä¸Šå‡æ²¿ä¹Ÿåœ¨ä¸‹é™æ²¿äº§ç”Ÿ&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0100&lt;!-- raw HTML omitted --&gt; ä¿ç•™&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0101&lt;!-- raw HTML omitted --&gt; ä¿ç•™&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0110&lt;!-- raw HTML omitted --&gt; ä¿ç•™&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0111&lt;!-- raw HTML omitted --&gt; ä¿ç•™&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1000&lt;!-- raw HTML omitted --&gt; ISF æ ‡å¿—å’Œä¸­æ–­ï¼Œäº§ç”Ÿäºé€»è¾‘ 0&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1001&lt;!-- raw HTML omitted --&gt; ISF æ ‡å¿—å’Œä¸­æ–­ï¼Œäº§ç”Ÿäºä¸Šå‡æ²¿&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1010&lt;!-- raw HTML omitted --&gt; ISF æ ‡å¿—å’Œä¸­æ–­ï¼Œäº§ç”Ÿäºä¸‹é™æ²¿&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1100&lt;!-- raw HTML omitted --&gt; ISF æ ‡å¿—å’Œä¸­æ–­ï¼Œäº§ç”Ÿäºä¸¤ä¸ªæ²¿&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1100&lt;!-- raw HTML omitted --&gt; ISF æ ‡å¿—å’Œä¸­æ–­ï¼Œäº§ç”Ÿäºé€»è¾‘ 1&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1101&lt;!-- raw HTML omitted --&gt; ä¿ç•™&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1110&lt;!-- raw HTML omitted --&gt; ä¿ç•™&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1111&lt;!-- raw HTML omitted --&gt; ä¿ç•™&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;LK&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Lock Register&lt;/strong&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; PCR å¯„å­˜å™¨ 0 åˆ° 15 ä½å€¼ä¸é”å®š&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; PCR å¯„å­˜å™¨ 0 - 15 ä½å€¼é”å®šï¼Œç›´åˆ°ä¸‹æ¬¡é‡æ–°å¯åŠ¨æ‰èƒ½å¤Ÿæ›´æ”¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10-8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;MUX&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Pin Mux Control&lt;/strong&gt; ç®¡è„šå¤ç”¨æ§åˆ¶&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;ä¸æ˜¯æ‰€æœ‰çš„ç®¡è„šéƒ½æ”¯æŒç®¡è„šå¤ç”¨ï¼Œè‹¥æ”¯æŒï¼Œåˆ™å¯ä»¥æœ‰ä»¥ä¸‹çš„è®¾ç½®ï¼š&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;000&lt;!-- raw HTML omitted --&gt; å…³é—­ç®¡è„šå¤ç”¨&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;001&lt;!-- raw HTML omitted --&gt; åŠŸèƒ½ 1 ï¼ŒGPIO&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;010&lt;!-- raw HTML omitted --&gt; åŠŸèƒ½ 2 ï¼ŒèŠ¯ç‰‡ç‰¹å®šåŠŸèƒ½&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;011&lt;!-- raw HTML omitted --&gt; åŠŸèƒ½ 3 ï¼ŒèŠ¯ç‰‡ç‰¹å®šåŠŸèƒ½&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;100&lt;!-- raw HTML omitted --&gt; åŠŸèƒ½ 4 ï¼ŒèŠ¯ç‰‡ç‰¹å®šåŠŸèƒ½&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;101&lt;!-- raw HTML omitted --&gt; åŠŸèƒ½ 5 ï¼ŒèŠ¯ç‰‡ç‰¹å®šåŠŸèƒ½&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;110&lt;!-- raw HTML omitted --&gt; åŠŸèƒ½ 6 ï¼ŒèŠ¯ç‰‡ç‰¹å®šåŠŸèƒ½&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;111&lt;!-- raw HTML omitted --&gt; åŠŸèƒ½ 7 ï¼ŒèŠ¯ç‰‡ç‰¹å®šåŠŸèƒ½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DSE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Drive Strength Enable&lt;/strong&gt; DSE é©±åŠ¨åŠ›åŠ å¼ºè®¾ç½®ï¼Œæ­¤ä½åœ¨å„ç§å¤ç”¨æ¨¡å¼ä¸‹éƒ½æœ‰æ•ˆ&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; ä½é©±åŠ¨åŠ›æ¨¡å¼ï¼Œå¦‚æœç®¡è„šå¤„äºè¾“å‡ºæ¨¡å¼&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; é«˜é©±åŠ¨åŠ›æ¨¡å¼ï¼Œå¦‚æœç®¡è„šå¤„äºè¾“å‡ºæ¨¡å¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PFE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Passive Filter Enable&lt;/strong&gt; è¢«åŠ¨æ»¤æ³¢åŠŸèƒ½ï¼Œæ­¤ä½åœ¨å„å¤ç”¨çŠ¶æ€ä¸‹éƒ½æœ‰æ•ˆ&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; å…³é—­è¢«åŠ¨æ»¤æ³¢&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; å¼€å¯è¢«åŠ¨æ»¤æ³¢ï¼Œå·¥ä½œåœ¨è¾“å…¥çŠ¶æ€ä¸‹ï¼Œè¯¦æƒ…å‚è€ƒæ»¤æ³¢è¯´æ˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PE&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Pull Enable&lt;/strong&gt; PE ä½¿èƒ½ä¸Šä¸‹æ‹‰ç”µé˜»&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; æ— å†…éƒ¨ä¸Šä¸‹æ‹‰ç”µé˜»&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; æœ‰ä¸Šä¸‹æ‹‰ç”µé˜»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PS&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;strong&gt;Pull Select&lt;/strong&gt; PE é€‰æ‹©ä¸Šä¸‹æ‹‰ç”µé˜»&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; æœ‰ä¸Šæ‹‰ç”µé˜»&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; æœ‰ä¸‹æ‹‰ç”µé˜»&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;heading-1&#34;&gt;æ€»ç»“&lt;/h1&gt;
&lt;p&gt;å¦‚æœè¦ä½¿ç”¨æŸä¸ª GPIO ç«¯å£ï¼Œéœ€è¦çš„å‡†å¤‡å·¥ä½œæ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ PCC æŒ‡é’ˆæ‰“å¼€å¯¹åº”çš„ PCCn[] å¯¹åº”çš„CGC ï¼ŒPCCnæ˜¯ PCC æ‰€æŒ‡å‘çš„ç»“æ„ä½“å†…éƒ¨çš„æ•°ç»„ï¼Œå›ºå®šåœ°å€ï¼ŒåŒ…å«ä¸€å…±æœ‰116ä¸ª uint32 ç±»å‹å¯„å­˜å™¨ï¼Œå°†å¯¹åº”çš„å¯„å­˜å™¨èµ‹å€¼ä¸º &lt;code&gt;PCC_PCCn_CGC_MASK&lt;/code&gt; å³å¯æ‰“å¼€ CGC = 1 ã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½® GPIO çš„æ§åˆ¶å™¨ä¸­çš„ PDDR å¯„å­˜å™¨ï¼Œç”¨äºè°ƒæ•´è¾“å…¥/è¾“å‡ºæ–¹å‘ã€‚æ­¤å¯„å­˜å™¨åœ¨ä¸€ä¸ªç±»å‹ä¸º &lt;code&gt;GPIO_Type&lt;/code&gt; çš„ç»“æ„ä¸­ï¼Œä¸€å…±æœ‰ 5 ä¸ªå›ºå®šåœ°å€çš„ç»“æ„ï¼Œä½¿ç”¨ PTA/PTB/PTC/PTD/PTE è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½® PORT.PCR æ§åˆ¶å™¨ï¼Œå…³é—­ä¸­æ–­ï¼ŒMUX è®¾ç½®æˆä¸º &lt;strong&gt;001&lt;/strong&gt;ï¼Œæ˜¯å¦å¼€å¯è¢«åŠ¨æ»¤æ³¢ã€‚ä½¿ç”¨ PORTA/PORTB/PORTC/PORTD/PORTE è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;è¯»å–å¯¹åº”çš„ PDIR ï¼ˆè¾“å…¥ï¼‰ï¼Œæˆ–è€…ç»™ PDOR èµ‹å€¼ ï¼ˆè¾“å‡ºï¼‰ã€‚ä½¿ç”¨ PTA/PTB/PTC/PTD/PTE è®¿é—®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h1 id=&#34;pcc-&#34;&gt;é™„å½•ï¼šPCC å„ä¸ªå¯„å­˜å™¨åœ°å›¾&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;åç§»åœ°å€&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;å¯„å­˜å™¨åç§°&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;é•¿åº¦/ä½ (bit)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æƒé™&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;é‡å¯é»˜è®¤å€¼&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;80h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTFC Register (PCC_FTFC)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;C000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;84h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC DMAMUX Register (PCC_DMAMUX)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;90h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FlexCAN0 Register (PCC_FlexCAN0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;94h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FlexCAN1 Register (PCC_FlexCAN1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;98h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM3 Register (PCC_FTM3)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;9Ch&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC ADC1 Register (PCC_ADC1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;ACh&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FlexCAN2 Register (PCC_FlexCAN2)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;B0h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPSPI0 Register (PCC_LPSPI0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;B4h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPSPI1 Register (PCC_LPSPI1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;B8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPSPI2 Register (PCC_LPSPI2)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;C4h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PDB1 Register (PCC_PDB1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;C8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC CRC Register (PCC_CRC)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;D8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PDB0 Register (PCC_PDB0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;DCh&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPIT Register (PCC_LPIT)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;E0h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM0 Register (PCC_FTM0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;E4h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM1 Register (PCC_FTM1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;E8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM2 Register (PCC_FTM2)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;ECh&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC ADC0 Register (PCC_ADC0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;F4h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC RTC Register (PCC_RTC)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;100h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPTMR0 Register (PCC_LPTMR0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;124h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PORTA Register (PCC_PORTA)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;128h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PORTB Register (PCC_PORTB)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;12Ch&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PORTC Register (PCC_PORTC)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;130h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PORTD Register (PCC_PORTD)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;134h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC PORTE Register (PCC_PORTE)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;150h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC SAI0 Register (PCC_SAI0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;154h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC SAI1 Register (PCC_SAI1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;168h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FlexIO Register (PCC_FlexIO)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;184h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC EWM Register (PCC_EWM)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;198h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPI2C0 Register (PCC_LPI2C0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;19Ch&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPI2C1 Register (PCC_LPI2C1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1A8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPUART0 Register (PCC_LPUART0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1ACh&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPUART1 Register (PCC_LPUART1)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1B0h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC LPUART2 Register (PCC_LPUART2)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1B8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM4 Register (PCC_FTM4)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1BCh&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM5 Register (PCC_FTM5)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1C0h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM6 Register (PCC_FTM6)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1C4h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC FTM7 Register (PCC_FTM7)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1CCh&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC CMP0 Register (PCC_CMP0)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1D8h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC QSPI Register (PCC_QSPI)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1E4h&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;PCC ENET Register (PCC_ENET)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RW&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;8000_0000h&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</description>
    </item>
  </channel>
</rss>
